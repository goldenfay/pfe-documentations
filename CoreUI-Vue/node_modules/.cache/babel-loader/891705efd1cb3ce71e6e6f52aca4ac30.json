{"remainingRequest":"/home/hads/Documents/CoreUI-Vue/node_modules/babel-loader/lib/index.js!/home/hads/Downloads/pycharm-community-2020.1/plugins/python-ce/helpers/MathJax/jax/output/HTML-CSS/jax.js","dependencies":[{"path":"/home/hads/Downloads/pycharm-community-2020.1/plugins/python-ce/helpers/MathJax/jax/output/HTML-CSS/jax.js","mtime":1586259854000},{"path":"/home/hads/Documents/CoreUI-Vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/hads/Documents/CoreUI-Vue/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCi8qIC0qLSBNb2RlOiBKYXZhc2NyaXB0OyBpbmRlbnQtdGFicy1tb2RlOm5pbDsganMtaW5kZW50LWxldmVsOiAyIC0qLSAqLwoKLyogdmltOiBzZXQgdHM9MiBldCBzdz0yIHR3PTgwOiAqLwoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICoKICogIE1hdGhKYXgvamF4L291dHB1dC9IVE1MLUNTUy9qYXguanMKICoKICogIEltcGxlbWVudHMgdGhlIEhUTUwtQ1NTIE91dHB1dEpheCB0aGF0IGRpc3BsYXlzIG1hdGhlbWF0aWNzCiAqICB1c2luZyBIVE1MIGFuZCBDU1MgdG8gcG9zaXRpb24gdGhlIGNoYXJhY3RlcnMgZnJvbSBtYXRoIGZvbnRzCiAqICBpbiB0aGVpciBwcm9wZXIgbG9jYXRpb25zLgogKiAgCiAqICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogIAogKiAgQ29weXJpZ2h0IChjKSAyMDA5LTIwMTUgVGhlIE1hdGhKYXggQ29uc29ydGl1bQogKiAKICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqIAogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKiAKICogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KKGZ1bmN0aW9uIChBSkFYLCBIVUIsIEhUTUxDU1MpIHsKICB2YXIgTU1MLAogICAgICBpc01vYmlsZSA9IEhVQi5Ccm93c2VyLmlzTW9iaWxlOwoKICB2YXIgTUVTU0FHRSA9IGZ1bmN0aW9uIE1FU1NBR0UoKSB7CiAgICB2YXIgZGF0YSA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgIGRhdGFbMF1bMF0gPSBbIkhUTUwtQ1NTIiwgZGF0YVswXVswXV07CiAgICByZXR1cm4gTWF0aEpheC5NZXNzYWdlLlNldC5hcHBseShNYXRoSmF4Lk1lc3NhZ2UsIGRhdGEpOwogIH07CgogIHZhciBGT05UVEVTVCA9IE1hdGhKYXguT2JqZWN0LlN1YmNsYXNzKHsKICAgIHRpbWVvdXQ6IChpc01vYmlsZSA/IDE1IDogOCkgKiAxMDAwLAogICAgLy8gdGltZW91dCBmb3IgbG9hZGluZyB3ZWIgZm9udHMKICAgIGNvbXBhcmlzb25Gb250OiBbInNhbnMtc2VyaWYiLCAibW9ub3NwYWNlIiwgInNjcmlwdCIsICJUaW1lcyIsICJDb3VyaWVyIiwgIkFyaWFsIiwgIkhlbHZldGljYSJdLAogICAgdGVzdFNpemU6IFsiNDBweCIsICI1MHB4IiwgIjYwcHgiLCAiMzBweCIsICIyMHB4Il0sCiAgICAvLwogICAgLy8gIEZlZG9yYSBhbGlhc2VzIFNUSVhTaXplT25lU3ltIHRvIFNUSVggV29yZCwgc28gTWF0aEpheCB0aGlua3MgU1RJWCBpcwogICAgLy8gIGF2YWlsYWJsZSwgYnV0IHRoZSBmb250cyBhcmVuJ3QgYWN0dWFsbHkgY29ycmVjdC4gIFRoaXMgaXMgdG8gdGVzdCBpZgogICAgLy8gIFNUSVhTaXplT25lU3ltIGhhcyBsZXR0ZXJzIGluIGl0IChzbyBpcyBhY3R1YWxseSBTVElYIFdvcmQpLgogICAgLy8gIAogICAgRmVkb3JhU1RJWGNoZWNrOiB7CiAgICAgIGZhbWlseTogIlNUSVhTaXplT25lU3ltIiwKICAgICAgdGVzdFN0cmluZzogImFiY0FCQyIsCiAgICAgIG5vU3R5bGVDaGFyOiB0cnVlCiAgICB9LAogICAgSW5pdDogZnVuY3Rpb24gSW5pdCgpIHsKICAgICAgLy8KICAgICAgLy8gIFdyYXAgdGhlIEZvbnRfVGVzdCBESVYgaW4gYSAweDAgRElWIHNvIHRoYXQgaXQgdGFrZXMgbm8gcm9vbQogICAgICAvLwogICAgICB0aGlzLmRpdiA9IE1hdGhKYXguSFRNTC5hZGRFbGVtZW50KGRvY3VtZW50LmJvZHksICJkaXYiLCB7CiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgICBvdmVyZmxvdzogImhpZGRlbiIsCiAgICAgICAgICBwYWRkaW5nOiAwLAogICAgICAgICAgYm9yZGVyOiAwLAogICAgICAgICAgbWFyZ2luOiAwCiAgICAgICAgfQogICAgICB9LCBbWyJkaXYiLCB7CiAgICAgICAgaWQ6ICJNYXRoSmF4X0ZvbnRfVGVzdCIsCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgdmlzaWJpbGl0eTogImhpZGRlbiIsCiAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICBsZWZ0OiAwLAogICAgICAgICAgd2lkdGg6ICJhdXRvIiwKICAgICAgICAgIHBhZGRpbmc6IDAsCiAgICAgICAgICBib3JkZXI6IDAsCiAgICAgICAgICBtYXJnaW46IDAsCiAgICAgICAgICB3aGl0ZVNwYWNlOiAibm93cmFwIiwKICAgICAgICAgIHRleHRBbGlnbjogImxlZnQiLAogICAgICAgICAgdGV4dEluZGVudDogMCwKICAgICAgICAgIHRleHRUcmFuc2Zvcm06ICJub25lIiwKICAgICAgICAgIGxpbmVIZWlnaHQ6ICJub3JtYWwiLAogICAgICAgICAgbGV0dGVyU3BhY2luZzogIm5vcm1hbCIsCiAgICAgICAgICB3b3JkU3BhY2luZzogIm5vcm1hbCIsCiAgICAgICAgICBmb250U2l6ZTogdGhpcy50ZXN0U2l6ZVswXSwKICAgICAgICAgIGZvbnRXZWlnaHQ6ICJub3JtYWwiLAogICAgICAgICAgZm9udFN0eWxlOiAibm9ybWFsIiwKICAgICAgICAgIGZvbnRTaXplQWRqdXN0OiAibm9uZSIKICAgICAgICB9CiAgICAgIH0sIFsiIl1dXSkuZmlyc3RDaGlsZDsKICAgICAgdGhpcy50ZXh0ID0gdGhpcy5kaXYuZmlyc3RDaGlsZDsKICAgIH0sCiAgICBmaW5kRm9udDogZnVuY3Rpb24gZmluZEZvbnQoZm9udHMsIHByZWYpIHsKICAgICAgdmFyIGZvdW5kID0gbnVsbDsKCiAgICAgIGlmIChwcmVmICYmIHRoaXMudGVzdENvbGxlY3Rpb24ocHJlZikpIHsKICAgICAgICBmb3VuZCA9IHByZWY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG0gPSBmb250cy5sZW5ndGg7IGkgPCBtOyBpKyspIHsKICAgICAgICAgIGlmIChmb250c1tpXSA9PT0gcHJlZikgY29udGludWU7CgogICAgICAgICAgaWYgKHRoaXMudGVzdENvbGxlY3Rpb24oZm9udHNbaV0pKSB7CiAgICAgICAgICAgIGZvdW5kID0gZm9udHNbaV07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGZvdW5kID09PSAiU1RJWCIgJiYgdGhpcy50ZXN0Rm9udCh0aGlzLkZlZG9yYVNUSVhjaGVjaykpIHsKICAgICAgICBmb3VuZCA9IG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiBmb3VuZDsKICAgIH0sCiAgICB0ZXN0Q29sbGVjdGlvbjogZnVuY3Rpb24gdGVzdENvbGxlY3Rpb24obmFtZSkgewogICAgICB2YXIgZm9udCA9IHsKICAgICAgICB0ZXN0U3RyaW5nOiAiKCkge30gW10iCiAgICAgIH07CiAgICAgIGZvbnQuZmFtaWx5ID0gewogICAgICAgIFRlWDogIk1hdGhKYXhfU2l6ZTEiLAogICAgICAgIFNUSVg6ICJTVElYU2l6ZU9uZVN5bSIKICAgICAgfVtuYW1lXSB8fCBuYW1lLnJlcGxhY2UoLy0oTWF0aCk/LywgIiIpICsgIk1hdGhKYXhfU2l6ZTEiOwoKICAgICAgaWYgKG5hbWUgPT09ICJTVElYIikgewogICAgICAgIGZvbnQubm9TdHlsZUNoYXIgPSB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy50ZXN0Rm9udChmb250KTsKICAgIH0sCiAgICB0ZXN0Rm9udDogZnVuY3Rpb24gdGVzdEZvbnQoZm9udCkgewogICAgICBpZiAoZm9udC5pc1dlYkZvbnQgJiYgSFRNTENTUy5Gb250RmFjZUJ1ZykgewogICAgICAgIHRoaXMuZGl2LnN0eWxlLmZvbnRXZWlnaHQgPSB0aGlzLmRpdi5zdHlsZS5mb250U3R5bGUgPSAibm9ybWFsIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRpdi5zdHlsZS5mb250V2VpZ2h0ID0gZm9udC53ZWlnaHQgfHwgIm5vcm1hbCI7CiAgICAgICAgdGhpcy5kaXYuc3R5bGUuZm9udFN0eWxlID0gZm9udC5zdHlsZSB8fCAibm9ybWFsIjsKICAgICAgfSAvLwogICAgICAvLyAgSGFjazogIEZpeCB1cCB3ZWIgZm9udCBuYW1lcyBmb3IgbG9jYWwgYWNjZXNzLgogICAgICAvLyAgKFRoZSBuYW1lcyBmb3IgV2luZG93cyBhbmQgTWFjIGFyZSBkaWZmZXJlbnQsIHVubGlrZSBpbiB0aGUgU1RJWCBhbmQKICAgICAgLy8gIFRlWCBmb250cywgc28gd2UgaGF2ZSB0byB3b3JrIG91dCBhIGxpc3Qgb2YgbmFtZXMgaGVyZS4pCiAgICAgIC8vCiAgICAgIC8vICBUaGlzIHNob3VsZCBiZSByZW1vdmVkIHdoZW4gdGhlIHdlYiBmb250cyBhcmUgZml4ZWQuICBGSVhNRQogICAgICAvLwoKCiAgICAgIHZhciBmYW1pbHkgPSBmb250LmZhbWlseUZpeGVkIHx8IGZvbnQuZmFtaWx5OwoKICAgICAgaWYgKCFmb250LmlzV2ViRm9udCAmJiAhZmFtaWx5Lm1hdGNoKC9eKFNUSVh8TWF0aEpheCl8Jy8pKSB7CiAgICAgICAgZmFtaWx5ID0gZmFtaWx5LnJlcGxhY2UoL18vZywgIiAiKS5yZXBsYWNlKC8oW2Etel0pKFtBLVpdKS9nLCAiJDEgJDIiKS5yZXBsYWNlKC8gSmF4LywgIkpheCIpICsgIicsJyIgKyBmYW1pbHkgKyAiJywnIiArIGZhbWlseSArICItIjsKCiAgICAgICAgaWYgKGZvbnQud2VpZ2h0KSB7CiAgICAgICAgICBmYW1pbHkgKz0gIkJvbGQiOwogICAgICAgIH0KCiAgICAgICAgOwoKICAgICAgICBpZiAoZm9udC5zdHlsZSkgewogICAgICAgICAgZmFtaWx5ICs9ICJJdGFsaWMiOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFmb250LndlaWdodCAmJiAhZm9udC5zdHlsZSkgewogICAgICAgICAgZmFtaWx5ICs9ICJSZWd1bGFyIjsKICAgICAgICB9CgogICAgICAgIGZvbnQuZmFtaWx5Rml4ZWQgPSBmYW1pbHkgPSAiJyIgKyBmYW1pbHkgKyAiJyI7CiAgICAgIH0KCiAgICAgIHZhciBXID0gdGhpcy5nZXRDb21wYXJpc29uV2lkdGhzKGZvbnQudGVzdFN0cmluZywgZm9udC5ub1N0eWxlQ2hhcik7CiAgICAgIHZhciBmb3VuZCA9IG51bGw7CgogICAgICBpZiAoVykgewogICAgICAgIHRoaXMuZGl2LnN0eWxlLmZvbnRGYW1pbHkgPSBmYW1pbHkgKyAiLCIgKyB0aGlzLmNvbXBhcmlzb25Gb250WzBdOwoKICAgICAgICBpZiAodGhpcy5kaXYub2Zmc2V0V2lkdGggPT0gV1swXSkgewogICAgICAgICAgdGhpcy5kaXYuc3R5bGUuZm9udEZhbWlseSA9IGZhbWlseSArICIsIiArIHRoaXMuY29tcGFyaXNvbkZvbnRbV1syXV07CgogICAgICAgICAgaWYgKHRoaXMuZGl2Lm9mZnNldFdpZHRoID09IFdbMV0pIHsKICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChmb3VuZCA9PT0gbnVsbCAmJiAodGhpcy5kaXYub2Zmc2V0V2lkdGggIT0gV1szXSB8fCB0aGlzLmRpdi5vZmZzZXRIZWlnaHQgIT0gV1s0XSkpIHsKICAgICAgICAgIGlmICghZm9udC5ub1N0eWxlQ2hhciAmJiBIVE1MQ1NTLkZPTlREQVRBICYmIEhUTUxDU1MuRk9OVERBVEEuaGFzU3R5bGVDaGFyKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBtID0gdGhpcy50ZXN0U2l6ZS5sZW5ndGg7IGkgPCBtOyBpKyspIHsKICAgICAgICAgICAgICBpZiAodGhpcy50ZXN0U3R5bGVDaGFyKGZvbnQsIHRoaXMudGVzdFNpemVbaV0pKSB7CiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICBtID0gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChIVE1MQ1NTLnNhZmFyaVRleHROb2RlQnVnKSB7CiAgICAgICAgdGhpcy5kaXYuaW5uZXJIVE1MID0gIiI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50ZXh0Lm5vZGVWYWx1ZSA9ICIiOwogICAgICB9CgogICAgICByZXR1cm4gZm91bmQ7CiAgICB9LAogICAgc3R5bGVDaGFyOiAiXHVFRkZEIiwKICAgIC8vIHdpZHRoIGVuY29kZXMgc3R5bGUKICAgIHZlcnNpb25DaGFyOiAiXHVFRkZFIiwKICAgIC8vIHdpZHRoIGVuY29kZXMgdmVyc2lvbgogICAgY29tcENoYXI6ICJcdUVGRkYiLAogICAgLy8gInN0YW5kYXJkIiB3aWR0aCB0byBjb21wYXJlIHRvCiAgICB0ZXN0U3R5bGVDaGFyOiBmdW5jdGlvbiB0ZXN0U3R5bGVDaGFyKGZvbnQsIHNpemUpIHsKICAgICAgdmFyIG4gPSAzICsgKGZvbnQud2VpZ2h0ID8gMiA6IDApICsgKGZvbnQuc3R5bGUgPyA0IDogMCk7CiAgICAgIHZhciBleHRyYSA9ICIiLAogICAgICAgICAgZHcgPSAwOwogICAgICB2YXIgU0laRSA9IHRoaXMuZGl2LnN0eWxlLmZvbnRTaXplOwogICAgICB0aGlzLmRpdi5zdHlsZS5mb250U2l6ZSA9IHNpemU7CgogICAgICBpZiAoSFRNTENTUy5tc2llSXRhbGljV2lkdGhCdWcgJiYgZm9udC5zdHlsZSA9PT0gIml0YWxpYyIpIHsKICAgICAgICB0aGlzLnRleHQubm9kZVZhbHVlID0gZXh0cmEgPSB0aGlzLmNvbXBDaGFyOwogICAgICAgIGR3ID0gdGhpcy5kaXYub2Zmc2V0V2lkdGg7CiAgICAgIH0KCiAgICAgIGlmIChIVE1MQ1NTLnNhZmFyaVRleHROb2RlQnVnKSB7CiAgICAgICAgdGhpcy5kaXYuaW5uZXJIVE1MID0gdGhpcy5jb21wQ2hhciArIGV4dHJhOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudGV4dC5ub2RlVmFsdWUgPSB0aGlzLmNvbXBDaGFyICsgZXh0cmE7CiAgICAgIH0KCiAgICAgIHZhciBXID0gdGhpcy5kaXYub2Zmc2V0V2lkdGggLSBkdzsKCiAgICAgIGlmIChIVE1MQ1NTLnNhZmFyaVRleHROb2RlQnVnKSB7CiAgICAgICAgdGhpcy5kaXYuaW5uZXJIVE1MID0gdGhpcy5zdHlsZUNoYXIgKyBleHRyYTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRleHQubm9kZVZhbHVlID0gdGhpcy5zdHlsZUNoYXIgKyBleHRyYTsKICAgICAgfQoKICAgICAgdmFyIE4gPSBNYXRoLmZsb29yKCh0aGlzLmRpdi5vZmZzZXRXaWR0aCAtIGR3KSAvIFcgKyAuNSk7CgogICAgICBpZiAoTiA9PT0gbikgewogICAgICAgIGlmIChIVE1MQ1NTLnNhZmFyaVRleHROb2RlQnVnKSB7CiAgICAgICAgICB0aGlzLmRpdi5pbm5lckhUTUwgPSB0aGlzLnZlcnNpb25DaGFyICsgZXh0cmE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMudGV4dC5ub2RlVmFsdWUgPSB0aGlzLnZlcnNpb25DaGFyICsgZXh0cmE7CiAgICAgICAgfQoKICAgICAgICBmb250LnZlcnNpb24gPSBNYXRoLmZsb29yKCh0aGlzLmRpdi5vZmZzZXRXaWR0aCAtIGR3KSAvIFcgKyAxLjUpIC8gMjsKICAgICAgfQoKICAgICAgdGhpcy5kaXYuc3R5bGUuZm9udFNpemUgPSBTSVpFOwogICAgICByZXR1cm4gTiA9PT0gbjsKICAgIH0sCiAgICBnZXRDb21wYXJpc29uV2lkdGhzOiBmdW5jdGlvbiBnZXRDb21wYXJpc29uV2lkdGhzKHN0cmluZywgbm9TdHlsZUNoYXIpIHsKICAgICAgaWYgKEhUTUxDU1MuRk9OVERBVEEgJiYgSFRNTENTUy5GT05UREFUQS5oYXNTdHlsZUNoYXIgJiYgIW5vU3R5bGVDaGFyKSB7CiAgICAgICAgc3RyaW5nICs9IHRoaXMuc3R5bGVDaGFyICsgIiAiICsgdGhpcy5jb21wQ2hhcjsKICAgICAgfQoKICAgICAgaWYgKEhUTUxDU1Muc2FmYXJpVGV4dE5vZGVCdWcpIHsKICAgICAgICB0aGlzLmRpdi5pbm5lckhUTUwgPSBzdHJpbmc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50ZXh0Lm5vZGVWYWx1ZSA9IHN0cmluZzsKICAgICAgfQoKICAgICAgdGhpcy5kaXYuc3R5bGUuZm9udEZhbWlseSA9IHRoaXMuY29tcGFyaXNvbkZvbnRbMF07CiAgICAgIHZhciBXID0gdGhpcy5kaXYub2Zmc2V0V2lkdGg7CiAgICAgIHRoaXMuZGl2LnN0eWxlLmZvbnRGYW1pbHkgPSBIVE1MQ1NTLndlYkZvbnREZWZhdWx0OwogICAgICB2YXIgc1cgPSB0aGlzLmRpdi5vZmZzZXRXaWR0aCwKICAgICAgICAgIHNIID0gdGhpcy5kaXYub2Zmc2V0SGVpZ2h0OwoKICAgICAgZm9yICh2YXIgaSA9IDEsIG0gPSB0aGlzLmNvbXBhcmlzb25Gb250Lmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgIHRoaXMuZGl2LnN0eWxlLmZvbnRGYW1pbHkgPSB0aGlzLmNvbXBhcmlzb25Gb250W2ldOwoKICAgICAgICBpZiAodGhpcy5kaXYub2Zmc2V0V2lkdGggIT0gVykgewogICAgICAgICAgcmV0dXJuIFtXLCB0aGlzLmRpdi5vZmZzZXRXaWR0aCwgaSwgc1csIHNIXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfSwKICAgIGxvYWRXZWJGb250OiBmdW5jdGlvbiBsb2FkV2ViRm9udChmb250KSB7CiAgICAgIEhVQi5TdGFydHVwLnNpZ25hbC5Qb3N0KCJIVE1MLUNTUyBKYXggLSBXZWItRm9udCAiICsgSFRNTENTUy5mb250SW5Vc2UgKyAiLyIgKyBmb250LmRpcmVjdG9yeSk7CiAgICAgIHZhciBuID0gTUVTU0FHRShbIkxvYWRXZWJGb250IiwgIkxvYWRpbmcgd2ViLWZvbnQgJTEiLCBIVE1MQ1NTLmZvbnRJblVzZSArICIvIiArIGZvbnQuZGlyZWN0b3J5XSk7CiAgICAgIHZhciBkb25lID0gTWF0aEpheC5DYWxsYmFjayh7fSk7IC8vIGNhbGxlZCB3aGVuIGZvbnQgaXMgbG9hZGVkCgogICAgICB2YXIgY2FsbGJhY2sgPSBNYXRoSmF4LkNhbGxiYWNrKFsibG9hZENvbXBsZXRlIiwgdGhpcywgZm9udCwgbiwgZG9uZV0pOwogICAgICBBSkFYLnRpbWVyLnN0YXJ0KEFKQVgsIFt0aGlzLmNoZWNrV2ViRm9udCwgZm9udCwgY2FsbGJhY2tdLCAwLCB0aGlzLnRpbWVvdXQpOwogICAgICByZXR1cm4gZG9uZTsKICAgIH0sCiAgICBsb2FkQ29tcGxldGU6IGZ1bmN0aW9uIGxvYWRDb21wbGV0ZShmb250LCBuLCBkb25lLCBzdGF0dXMpIHsKICAgICAgTWF0aEpheC5NZXNzYWdlLkNsZWFyKG4pOwoKICAgICAgaWYgKHN0YXR1cyA9PT0gQUpBWC5TVEFUVVMuT0spIHsKICAgICAgICB0aGlzLndlYkZvbnRMb2FkZWQgPSB0cnVlOwogICAgICAgIGRvbmUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubG9hZEVycm9yKGZvbnQpOwoKICAgICAgaWYgKEhVQi5Ccm93c2VyLmlzRmlyZWZveCAmJiBIVE1MQ1NTLmFsbG93V2ViRm9udHMpIHsKICAgICAgICB2YXIgaG9zdCA9IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sICsgIi8vIiArIGRvY3VtZW50LmxvY2F0aW9uLmhvc3RuYW1lOwoKICAgICAgICBpZiAoZG9jdW1lbnQubG9jYXRpb24ucG9ydCAhPSAiIikgewogICAgICAgICAgaG9zdCArPSAiOiIgKyBkb2N1bWVudC5sb2NhdGlvbi5wb3J0OwogICAgICAgIH0KCiAgICAgICAgaG9zdCArPSAiLyI7CgogICAgICAgIGlmIChBSkFYLmZpbGVVUkwoSFRNTENTUy53ZWJmb250RGlyKS5zdWJzdHIoMCwgaG9zdC5sZW5ndGgpICE9PSBob3N0KSB7CiAgICAgICAgICB0aGlzLmZpcmVmb3hGb250RXJyb3IoZm9udCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIXRoaXMud2ViRm9udExvYWRlZCkgewogICAgICAgIEhUTUxDU1MubG9hZFdlYkZvbnRFcnJvcihmb250LCBkb25lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkb25lKCk7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkRXJyb3I6IGZ1bmN0aW9uIGxvYWRFcnJvcihmb250KSB7CiAgICAgIE1FU1NBR0UoWyJDYW50TG9hZFdlYkZvbnQiLCAiQ2FuJ3QgbG9hZCB3ZWIgZm9udCAlMSIsIEhUTUxDU1MuZm9udEluVXNlICsgIi8iICsgZm9udC5kaXJlY3RvcnldLCBudWxsLCAyMDAwKTsKICAgICAgSFVCLlN0YXJ0dXAuc2lnbmFsLlBvc3QoWyJIVE1MLUNTUyBKYXggLSB3ZWIgZm9udCBlcnJvciIsIEhUTUxDU1MuZm9udEluVXNlICsgIi8iICsgZm9udC5kaXJlY3RvcnksIGZvbnRdKTsKICAgIH0sCiAgICBmaXJlZm94Rm9udEVycm9yOiBmdW5jdGlvbiBmaXJlZm94Rm9udEVycm9yKGZvbnQpIHsKICAgICAgTUVTU0FHRShbIkZpcmVmb3hDYW50TG9hZFdlYkZvbnQiLCAiRmlyZWZveCBjYW4ndCBsb2FkIHdlYiBmb250cyBmcm9tIGEgcmVtb3RlIGhvc3QiXSwgbnVsbCwgMzAwMCk7CiAgICAgIEhVQi5TdGFydHVwLnNpZ25hbC5Qb3N0KCJIVE1MLUNTUyBKYXggLSBGaXJlZm94IHdlYiBmb250cyBvbiByZW1vdGUgaG9zdCBlcnJvciIpOwogICAgfSwKICAgIGNoZWNrV2ViRm9udDogZnVuY3Rpb24gY2hlY2tXZWJGb250KGNoZWNrLCBmb250LCBjYWxsYmFjaykgewogICAgICBpZiAoY2hlY2sudGltZShjYWxsYmFjaykpIHJldHVybjsKCiAgICAgIGlmIChIVE1MQ1NTLkZvbnQudGVzdEZvbnQoZm9udCkpIHsKICAgICAgICBjYWxsYmFjayhjaGVjay5TVEFUVVMuT0spOwogICAgICB9IGVsc2UgewogICAgICAgIHNldFRpbWVvdXQoY2hlY2ssIGNoZWNrLmRlbGF5KTsKICAgICAgfQogICAgfSwKICAgIGZvbnRGYWNlOiBmdW5jdGlvbiBmb250RmFjZShuYW1lKSB7CiAgICAgIHZhciB0eXBlID0gSFRNTENTUy5hbGxvd1dlYkZvbnRzOwogICAgICB2YXIgRk9OVCA9IEhUTUxDU1MuRk9OVERBVEEuRk9OVFNbbmFtZV07CgogICAgICBpZiAoSFRNTENTUy5tc2llRm9udENTU0J1ZyAmJiAhRk9OVC5mYW1pbHkubWF0Y2goLy1XZWIkLykpIHsKICAgICAgICBGT05ULmZhbWlseSArPSAiLVdlYiI7CiAgICAgIH0KCiAgICAgIGlmIChGT05ULmlzV2ViRm9udCkgZGVsZXRlIEZPTlQuZmFtaWx5Rml4ZWQ7CiAgICAgIHZhciB3ZWJmb250cyA9IEhUTUxDU1Mud2ViZm9udERpciArICIvIiArIHR5cGU7CiAgICAgIHZhciBkaXIgPSBBSkFYLmZpbGVVUkwod2ViZm9udHMpOwogICAgICB2YXIgZnVsbG5hbWUgPSBuYW1lLnJlcGxhY2UoLy1iLywgIi1CIikucmVwbGFjZSgvLWkvLCAiLUkiKS5yZXBsYWNlKC8tQm9sZC0vLCAiLUJvbGQiKTsKCiAgICAgIGlmICghZnVsbG5hbWUubWF0Y2goLy0vKSkgewogICAgICAgIGZ1bGxuYW1lICs9ICItUmVndWxhciI7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlID09PSAic3ZnIikgewogICAgICAgIGZ1bGxuYW1lICs9ICIuc3ZnIyIgKyBmdWxsbmFtZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmdWxsbmFtZSArPSAiLiIgKyB0eXBlOwogICAgICB9CgogICAgICB2YXIgcmV2ID0gQUpBWC5maWxlUmV2KHdlYmZvbnRzICsgIi8iICsgZnVsbG5hbWUucmVwbGFjZSgvIy4qLywgIiIpKTsKICAgICAgdmFyIGRlZiA9IHsKICAgICAgICAiZm9udC1mYW1pbHkiOiBGT05ULmZhbWlseSwKICAgICAgICBzcmM6ICJ1cmwoJyIgKyBkaXIgKyAiLyIgKyBmdWxsbmFtZSArIHJldiArICInKSIKICAgICAgfTsKCiAgICAgIGlmICh0eXBlID09PSAib3RmIikgewogICAgICAgIGZ1bGxuYW1lID0gZnVsbG5hbWUucmVwbGFjZSgvb3RmJC8sICJ3b2ZmIik7CiAgICAgICAgcmV2ID0gQUpBWC5maWxlUmV2KHdlYmZvbnRzICsgIi8iICsgZnVsbG5hbWUpOwogICAgICAgIGRlZi5zcmMgKz0gIiBmb3JtYXQoJ29wZW50eXBlJykiOwogICAgICAgIGRpciA9IEFKQVguZmlsZVVSTChIVE1MQ1NTLndlYmZvbnREaXIgKyAiL3dvZmYiKTsgLy8gYWRkIHdvZmYgZm9udHMgYXMgd2VsbAoKICAgICAgICBkZWYuc3JjID0gInVybCgnIiArIGRpciArICIvIiArIGZ1bGxuYW1lICsgcmV2ICsgIicpIGZvcm1hdCgnd29mZicpLCAiICsgZGVmLnNyYzsKICAgICAgfSBlbHNlIGlmICh0eXBlICE9PSAiZW90IikgewogICAgICAgIGRlZi5zcmMgKz0gIiBmb3JtYXQoJyIgKyB0eXBlICsgIicpIjsKICAgICAgfQoKICAgICAgaWYgKCEoSFRNTENTUy5Gb250RmFjZUJ1ZyAmJiBGT05ULmlzV2ViRm9udCkpIHsKICAgICAgICBpZiAobmFtZS5tYXRjaCgvLWJvbGQvKSkgewogICAgICAgICAgZGVmWyJmb250LXdlaWdodCJdID0gImJvbGQiOwogICAgICAgIH0KCiAgICAgICAgaWYgKG5hbWUubWF0Y2goLy1pdGFsaWMvKSkgewogICAgICAgICAgZGVmWyJmb250LXN0eWxlIl0gPSAiaXRhbGljIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBkZWY7CiAgICB9CiAgfSk7CiAgdmFyIEVWRU5ULCBUT1VDSCwgSE9WRVI7IC8vIGZpbGxlZCBpbiBsYXRlcgoKICBIVE1MQ1NTLkF1Z21lbnQoewogICAgY29uZmlnOiB7CiAgICAgIHN0eWxlczogewogICAgICAgICIuTWF0aEpheCI6IHsKICAgICAgICAgICJkaXNwbGF5IjogImlubGluZSIsCiAgICAgICAgICAiZm9udC1zdHlsZSI6ICJub3JtYWwiLAogICAgICAgICAgImZvbnQtd2VpZ2h0IjogIm5vcm1hbCIsCiAgICAgICAgICAibGluZS1oZWlnaHQiOiAibm9ybWFsIiwKICAgICAgICAgICJmb250LXNpemUiOiAiMTAwJSIsCiAgICAgICAgICAiZm9udC1zaXplLWFkanVzdCI6ICJub25lIiwKICAgICAgICAgICJ0ZXh0LWluZGVudCI6IDAsCiAgICAgICAgICAidGV4dC1hbGlnbiI6ICJsZWZ0IiwKICAgICAgICAgICJ0ZXh0LXRyYW5zZm9ybSI6ICJub25lIiwKICAgICAgICAgICJsZXR0ZXItc3BhY2luZyI6ICJub3JtYWwiLAogICAgICAgICAgIndvcmQtc3BhY2luZyI6ICJub3JtYWwiLAogICAgICAgICAgIndvcmQtd3JhcCI6ICJub3JtYWwiLAogICAgICAgICAgIndoaXRlLXNwYWNlIjogIm5vd3JhcCIsCiAgICAgICAgICAiZmxvYXQiOiAibm9uZSIsCiAgICAgICAgICAiZGlyZWN0aW9uIjogImx0ciIsCiAgICAgICAgICAibWF4LXdpZHRoIjogIm5vbmUiLAogICAgICAgICAgIm1heC1oZWlnaHQiOiAibm9uZSIsCiAgICAgICAgICAibWluLXdpZHRoIjogMCwKICAgICAgICAgICJtaW4taGVpZ2h0IjogMCwKICAgICAgICAgIGJvcmRlcjogMCwKICAgICAgICAgIHBhZGRpbmc6IDAsCiAgICAgICAgICBtYXJnaW46IDAKICAgICAgICB9LAogICAgICAgIC8vIEZvY3VzIGVsZW1lbnRzIGZvciBrZXlib2FyZCB0YWJiaW5nLgogICAgICAgICIuTWF0aEpheDpmb2N1cywgYm9keSA6Zm9jdXMgLk1hdGhKYXgiOiB7CiAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lLXRhYmxlIiAvLyBzZWUgaXNzdWVzICMxMjgyIGFuZCAjMTMzOAoKICAgICAgICB9LAogICAgICAgICIuTWF0aEpheF9EaXNwbGF5IjogewogICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICBkaXNwbGF5OiAiYmxvY2shaW1wb3J0YW50IiwKICAgICAgICAgICJ0ZXh0LWluZGVudCI6IDAsCiAgICAgICAgICAibWF4LXdpZHRoIjogIm5vbmUiLAogICAgICAgICAgIm1heC1oZWlnaHQiOiAibm9uZSIsCiAgICAgICAgICAibWluLXdpZHRoIjogMCwKICAgICAgICAgICJtaW4taGVpZ2h0IjogMCwKICAgICAgICAgIHdpZHRoOiAiMTAwJSIKICAgICAgICB9LAogICAgICAgICIuTWF0aEpheCBpbWcsIC5NYXRoSmF4IG5vYnIsIC5NYXRoSmF4IGEiOiB7CiAgICAgICAgICBib3JkZXI6IDAsCiAgICAgICAgICBwYWRkaW5nOiAwLAogICAgICAgICAgbWFyZ2luOiAwLAogICAgICAgICAgIm1heC13aWR0aCI6ICJub25lIiwKICAgICAgICAgICJtYXgtaGVpZ2h0IjogIm5vbmUiLAogICAgICAgICAgIm1pbi13aWR0aCI6IDAsCiAgICAgICAgICAibWluLWhlaWdodCI6IDAsCiAgICAgICAgICAidmVydGljYWwtYWxpZ24iOiAwLAogICAgICAgICAgImxpbmUtaGVpZ2h0IjogIm5vcm1hbCIsCiAgICAgICAgICAidGV4dC1kZWNvcmF0aW9uIjogIm5vbmUiCiAgICAgICAgfSwKICAgICAgICAiaW1nLk1hdGhKYXhfc3RydXQiOiB7CiAgICAgICAgICBib3JkZXI6ICIwIWltcG9ydGFudCIsCiAgICAgICAgICBwYWRkaW5nOiAiMCFpbXBvcnRhbnQiLAogICAgICAgICAgbWFyZ2luOiAiMCFpbXBvcnRhbnQiLAogICAgICAgICAgInZlcnRpY2FsLWFsaWduIjogIjAhaW1wb3J0YW50IgogICAgICAgIH0sCiAgICAgICAgIi5NYXRoSmF4IHNwYW4iOiB7CiAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lIiwKICAgICAgICAgIHBvc2l0aW9uOiAic3RhdGljIiwKICAgICAgICAgIGJvcmRlcjogMCwKICAgICAgICAgIHBhZGRpbmc6IDAsCiAgICAgICAgICBtYXJnaW46IDAsCiAgICAgICAgICAidmVydGljYWwtYWxpZ24iOiAwLAogICAgICAgICAgImxpbmUtaGVpZ2h0IjogIm5vcm1hbCIsCiAgICAgICAgICAidGV4dC1kZWNvcmF0aW9uIjogIm5vbmUiCiAgICAgICAgfSwKICAgICAgICAiLk1hdGhKYXggbm9iciI6IHsKICAgICAgICAgICJ3aGl0ZS1zcGFjZSI6ICJub3dyYXAhaW1wb3J0YW50IgogICAgICAgIH0sCiAgICAgICAgIi5NYXRoSmF4IGltZyI6IHsKICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUhaW1wb3J0YW50IiwKICAgICAgICAgICJmbG9hdCI6ICJub25lIWltcG9ydGFudCIKICAgICAgICB9LAogICAgICAgICIuTWF0aEpheCAqIjogewogICAgICAgICAgdHJhbnNpdGlvbjogIm5vbmUiLAogICAgICAgICAgIi13ZWJraXQtdHJhbnNpdGlvbiI6ICJub25lIiwKICAgICAgICAgICItbW96LXRyYW5zaXRpb24iOiAibm9uZSIsCiAgICAgICAgICAiLW1zLXRyYW5zaXRpb24iOiAibm9uZSIsCiAgICAgICAgICAiLW8tdHJhbnNpdGlvbiI6ICJub25lIgogICAgICAgIH0sCiAgICAgICAgIi5NYXRoSmF4X1Byb2Nlc3NpbmciOiB7CiAgICAgICAgICB2aXNpYmlsaXR5OiAiaGlkZGVuIiwKICAgICAgICAgIHBvc2l0aW9uOiAiZml4ZWQiLAogICAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgICBvdmVyZmxvdzogImhpZGRlbiIKICAgICAgICB9LAogICAgICAgICIuTWF0aEpheF9Qcm9jZXNzZWQiOiB7CiAgICAgICAgICBkaXNwbGF5OiAibm9uZSFpbXBvcnRhbnQiCiAgICAgICAgfSwKICAgICAgICAiLk1hdGhKYXhfRXhCb3giOiB7CiAgICAgICAgICBkaXNwbGF5OiAiYmxvY2shaW1wb3J0YW50IiwKICAgICAgICAgIG92ZXJmbG93OiAiaGlkZGVuIiwKICAgICAgICAgIHdpZHRoOiAiMXB4IiwKICAgICAgICAgIGhlaWdodDogIjYwZXgiLAogICAgICAgICAgIm1pbi1oZWlnaHQiOiAwLAogICAgICAgICAgIm1heC1oZWlnaHQiOiAibm9uZSIKICAgICAgICB9LAogICAgICAgICIuTWF0aEpheCAuTWF0aEpheF9FbUJveCI6IHsKICAgICAgICAgIGRpc3BsYXk6ICJibG9jayFpbXBvcnRhbnQiLAogICAgICAgICAgb3ZlcmZsb3c6ICJoaWRkZW4iLAogICAgICAgICAgd2lkdGg6ICIxcHgiLAogICAgICAgICAgaGVpZ2h0OiAiNjBlbSIsCiAgICAgICAgICAibWluLWhlaWdodCI6IDAsCiAgICAgICAgICAibWF4LWhlaWdodCI6ICJub25lIgogICAgICAgIH0sCiAgICAgICAgIi5NYXRoSmF4IC5NYXRoSmF4X0hpdEJveCI6IHsKICAgICAgICAgIGN1cnNvcjogInRleHQiLAogICAgICAgICAgYmFja2dyb3VuZDogIndoaXRlIiwKICAgICAgICAgIG9wYWNpdHk6IDAsCiAgICAgICAgICBmaWx0ZXI6ICJhbHBoYShvcGFjaXR5PTApIgogICAgICAgIH0sCiAgICAgICAgIi5NYXRoSmF4IC5NYXRoSmF4X0hpdEJveCAqIjogewogICAgICAgICAgZmlsdGVyOiAibm9uZSIsCiAgICAgICAgICBvcGFjaXR5OiAxLAogICAgICAgICAgYmFja2dyb3VuZDogInRyYW5zcGFyZW50IiAvLyBmb3IgSUUKCiAgICAgICAgfSwKICAgICAgICAiI01hdGhKYXhfVG9vbHRpcCI6IHsKICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgbGVmdDogMCwKICAgICAgICAgIHRvcDogMCwKICAgICAgICAgIHdpZHRoOiAiYXV0byIsCiAgICAgICAgICBoZWlnaHQ6ICJhdXRvIiwKICAgICAgICAgIGRpc3BsYXk6ICJub25lIgogICAgICAgIH0sCiAgICAgICAgIiNNYXRoSmF4X1Rvb2x0aXAgKiI6IHsKICAgICAgICAgIGZpbHRlcjogIm5vbmUiLAogICAgICAgICAgb3BhY2l0eTogMSwKICAgICAgICAgIGJhY2tncm91bmQ6ICJ0cmFuc3BhcmVudCIgLy8gZm9yIElFCgogICAgICAgIH0sCiAgICAgICAgLy8KICAgICAgICAvLyAgVXNlZCBmb3IgdGVzdGluZyB3ZWIgZm9udHMgYWdhaW5zdCB0aGUgZGVmYXVsdCBmb250IHVzZWQgd2hpbGUKICAgICAgICAvLyAgd2ViIGZvbnRzIGFyZSBsb2FkaW5nCiAgICAgICAgLy8KICAgICAgICAiQGZvbnQtZmFjZSI6IHsKICAgICAgICAgICJmb250LWZhbWlseSI6ICJNYXRoSmF4X0JsYW5rIiwKICAgICAgICAgICJzcmMiOiAidXJsKCdhYm91dDpibGFuaycpIgogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNldHRpbmdzOiBIVUIuY29uZmlnLm1lbnVTZXR0aW5ncywKICAgIEZvbnQ6IG51bGwsCiAgICAvLyBjcmVhdGVkIGJ5IENvbmZpZygpIGJlbG93CiAgICB3ZWJGb250RGVmYXVsdDogIk1hdGhKYXhfQmxhbmsiLAogICAgYWxsb3dXZWJGb250czogIm90ZiIsCiAgICAvLyBhc3N1bWUgYnJvd3NlciBjYW4gdXNlIE9URiB3ZWIgZm9udHMKICAgIG1heFN0cmV0Y2h5UGFydHM6IDEwMDAsCiAgICAvLyBsaW1pdCB0aGUgbnVtYmVyIG9mIHBhcnRzIGFsbG93ZWQgZm9yCiAgICAvLyBzdHJldGNoeSBvcGVyYXRvcnMuIFNlZSBpc3N1ZSAzNjYuCiAgICBmb250TmFtZTogewogICAgICBUZVhMb2NhbDogIlRlWCIsCiAgICAgIFRlWFdlYjogWyIiLCAiVGVYIl0sCiAgICAgIFRlWEltYWdlOiBbIiIsICIiXSwKICAgICAgU1RJWExvY2FsOiBbIlNUSVgiLCAiU1RJWC1XZWIiXSwKICAgICAgU1RJWFdlYjogIlNUSVgtV2ViIiwKICAgICAgQXNhbmFNYXRoV2ViOiAiQXNhbmEtTWF0aCIsCiAgICAgIEd5cmVQYWdlbGxhV2ViOiAiR3lyZS1QYWdlbGxhIiwKICAgICAgR3lyZVRlcm1lc1dlYjogIkd5cmUtVGVybWVzIiwKICAgICAgTGF0aW5Nb2Rlcm5XZWI6ICJMYXRpbi1Nb2Rlcm4iLAogICAgICBOZW9FdWxlcldlYjogIk5lby1FdWxlciIKICAgIH0sCiAgICBmb250SW5Vc2U6ICJnZW5lcmljIiwKICAgIEZPTlREQVRBOiB7CiAgICAgIFRlWF9mYWN0b3I6IDEsCiAgICAgIGJhc2VsaW5lc2tpcDogMS4yLAogICAgICBsaW5lSDogLjgsCiAgICAgIGxpbmVEOiAuMiwKICAgICAgZmZMaW5lSDogLjgsCiAgICAgIEZPTlRTOiB7fSwKICAgICAgVkFSSUFOVDogewogICAgICAgICJub3JtYWwiOiB7CiAgICAgICAgICBmb250czogW10KICAgICAgICB9LAogICAgICAgICItZ2VuZXJpYy12YXJpYW50Ijoge30sCiAgICAgICAgIi1sYXJnZU9wIjoge30sCiAgICAgICAgIi1zbWFsbE9wIjoge30KICAgICAgfSwKICAgICAgUkFOR0VTOiBbXSwKICAgICAgREVMSU1JVEVSUzoge30sCiAgICAgIFJVTEVDSEFSOiAweDJELAogICAgICBSRU1BUDoge30KICAgIH0sCiAgICBDb25maWc6IGZ1bmN0aW9uIENvbmZpZygpIHsKICAgICAgaWYgKCF0aGlzLnJlcXVpcmUpIHsKICAgICAgICB0aGlzLnJlcXVpcmUgPSBbXTsKICAgICAgfQoKICAgICAgdGhpcy5Gb250ID0gRk9OVFRFU1QoKTsKICAgICAgdGhpcy5TVVBFUihhcmd1bWVudHMpLkNvbmZpZy5jYWxsKHRoaXMpOwogICAgICB2YXIgc2V0dGluZ3MgPSB0aGlzLnNldHRpbmdzLAogICAgICAgICAgY29uZmlnID0gdGhpcy5jb25maWcsCiAgICAgICAgICBmb250ID0gc2V0dGluZ3MuZm9udDsKCiAgICAgIGlmICh0aGlzLmFkanVzdEF2YWlsYWJsZUZvbnRzKSB7CiAgICAgICAgdGhpcy5hZGp1c3RBdmFpbGFibGVGb250cyhjb25maWcuYXZhaWxhYmxlRm9udHMpOwogICAgICB9CgogICAgICBpZiAoc2V0dGluZ3Muc2NhbGUpIHsKICAgICAgICBjb25maWcuc2NhbGUgPSBzZXR0aW5ncy5zY2FsZTsKICAgICAgfQoKICAgICAgaWYgKGZvbnQgJiYgZm9udCAhPT0gIkF1dG8iICYmIHRoaXMuZm9udE5hbWVbZm9udF0pIHsKICAgICAgICBjb25maWcuYXZhaWxhYmxlRm9udHMgPSBbXTsKICAgICAgICBkZWxldGUgY29uZmlnLmZvbnRzOwoKICAgICAgICBpZiAodGhpcy5mb250TmFtZVtmb250XSBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgICBjb25maWcucHJlZmVycmVkRm9udCA9IHRoaXMuZm9udE5hbWVbZm9udF1bMF07CiAgICAgICAgICBjb25maWcud2ViRm9udCA9IHRoaXMuZm9udE5hbWVbZm9udF1bMV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbmZpZy5wcmVmZXJyZWRGb250ID0gY29uZmlnLndlYkZvbnQgPSB0aGlzLmZvbnROYW1lW2ZvbnRdOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbmZpZy5wcmVmZXJyZWRGb250KSB7CiAgICAgICAgICBjb25maWcuYXZhaWxhYmxlRm9udHNbMF0gPSBjb25maWcucHJlZmVycmVkRm9udDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChjb25maWcuZm9udHMpIHsKICAgICAgICBjb25maWcuYXZhaWxhYmxlRm9udHMgPSBjb25maWcuZm9udHM7CiAgICAgICAgY29uZmlnLnByZWZlcnJlZEZvbnQgPSBjb25maWcud2ViRm9udCA9IGNvbmZpZy5mb250c1swXTsKCiAgICAgICAgaWYgKGNvbmZpZy53ZWJGb250ID09PSAiU1RJWCIpIHsKICAgICAgICAgIGNvbmZpZy53ZWJGb250ICs9ICItV2ViIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvbnQgPSB0aGlzLkZvbnQuZmluZEZvbnQoY29uZmlnLmF2YWlsYWJsZUZvbnRzLCBjb25maWcucHJlZmVycmVkRm9udCk7CgogICAgICBpZiAoIWZvbnQgJiYgdGhpcy5hbGxvd1dlYkZvbnRzKSB7CiAgICAgICAgZm9udCA9IGNvbmZpZy53ZWJGb250OwoKICAgICAgICBpZiAoZm9udCkgewogICAgICAgICAgdGhpcy53ZWJGb250cyA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIWZvbnQgJiYgdGhpcy5jb25maWcuaW1hZ2VGb250KSB7CiAgICAgICAgZm9udCA9IGNvbmZpZy5pbWFnZUZvbnQ7CiAgICAgICAgdGhpcy5pbWdGb250cyA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmIChmb250KSB7CiAgICAgICAgdGhpcy5mb250SW5Vc2UgPSBmb250OwogICAgICAgIHRoaXMuZm9udERpciArPSAiLyIgKyBmb250OwogICAgICAgIHRoaXMud2ViZm9udERpciArPSAiLyIgKyBmb250OwoKICAgICAgICB0aGlzLnJlcXVpcmUucHVzaCh0aGlzLmZvbnREaXIgKyAiL2ZvbnRkYXRhLmpzIik7CgogICAgICAgIGlmICh0aGlzLmltZ0ZvbnRzKSB7CiAgICAgICAgICB0aGlzLnJlcXVpcmUucHVzaCh0aGlzLmRpcmVjdG9yeSArICIvaW1hZ2VGb250cy5qcyIpOwoKICAgICAgICAgIEhVQi5TdGFydHVwLnNpZ25hbC5Qb3N0KCJIVE1MLUNTUyBKYXggLSB1c2luZyBpbWFnZSBmb250cyIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBNRVNTQUdFKFsiQ2FudEZpbmRGb250VXNpbmciLCAiQ2FuJ3QgZmluZCBhIHZhbGlkIGZvbnQgdXNpbmcgJTEiLCAiWyIgKyB0aGlzLmNvbmZpZy5hdmFpbGFibGVGb250cy5qb2luKCIsICIpICsgIl0iXSwgbnVsbCwgMzAwMCk7CiAgICAgICAgSFVCLlN0YXJ0dXAuc2lnbmFsLlBvc3QoIkhUTUwtQ1NTIEpheCAtIG5vIHZhbGlkIGZvbnQiKTsKICAgICAgfQoKICAgICAgdGhpcy5yZXF1aXJlLnB1c2goTWF0aEpheC5PdXRwdXRKYXguZXh0ZW5zaW9uRGlyICsgIi9NYXRoRXZlbnRzLmpzIik7CiAgICB9LAogICAgU3RhcnR1cDogZnVuY3Rpb24gU3RhcnR1cCgpIHsKICAgICAgLy8gIFNldCB1cCBldmVudCBoYW5kbGluZwogICAgICBFVkVOVCA9IE1hdGhKYXguRXh0ZW5zaW9uLk1hdGhFdmVudHMuRXZlbnQ7CiAgICAgIFRPVUNIID0gTWF0aEpheC5FeHRlbnNpb24uTWF0aEV2ZW50cy5Ub3VjaDsKICAgICAgSE9WRVIgPSBNYXRoSmF4LkV4dGVuc2lvbi5NYXRoRXZlbnRzLkhvdmVyOwogICAgICB0aGlzLkNvbnRleHRNZW51ID0gRVZFTlQuQ29udGV4dE1lbnU7CiAgICAgIHRoaXMuTW91c2Vkb3duID0gRVZFTlQuQWx0Q29udGV4dE1lbnU7CiAgICAgIHRoaXMuTW91c2VvdmVyID0gSE9WRVIuTW91c2VvdmVyOwogICAgICB0aGlzLk1vdXNlb3V0ID0gSE9WRVIuTW91c2VvdXQ7CiAgICAgIHRoaXMuTW91c2Vtb3ZlID0gSE9WRVIuTW91c2Vtb3ZlOyAvLyBNYWtlIGhpZGRlbiBkaXYgZm9yIHdoZW4gbWF0aCBpcyBpbiBhIGRpc3BsYXk6bm9uZSBibG9jawoKICAgICAgdGhpcy5oaWRkZW5EaXYgPSB0aGlzLkVsZW1lbnQoImRpdiIsIHsKICAgICAgICBzdHlsZTogewogICAgICAgICAgdmlzaWJpbGl0eTogImhpZGRlbiIsCiAgICAgICAgICBvdmVyZmxvdzogImhpZGRlbiIsCiAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgIHRvcDogMCwKICAgICAgICAgIGhlaWdodDogIjFweCIsCiAgICAgICAgICB3aWR0aDogImF1dG8iLAogICAgICAgICAgcGFkZGluZzogMCwKICAgICAgICAgIGJvcmRlcjogMCwKICAgICAgICAgIG1hcmdpbjogMCwKICAgICAgICAgIHRleHRBbGlnbjogImxlZnQiLAogICAgICAgICAgdGV4dEluZGVudDogMCwKICAgICAgICAgIHRleHRUcmFuc2Zvcm06ICJub25lIiwKICAgICAgICAgIGxpbmVIZWlnaHQ6ICJub3JtYWwiLAogICAgICAgICAgbGV0dGVyU3BhY2luZzogIm5vcm1hbCIsCiAgICAgICAgICB3b3JkU3BhY2luZzogIm5vcm1hbCIKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgaWYgKCFkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGQpIHsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuaGlkZGVuRGl2KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkb2N1bWVudC5ib2R5Lmluc2VydEJlZm9yZSh0aGlzLmhpZGRlbkRpdiwgZG9jdW1lbnQuYm9keS5maXJzdENoaWxkKTsKICAgICAgfQoKICAgICAgdGhpcy5oaWRkZW5EaXYgPSB0aGlzLmFkZEVsZW1lbnQodGhpcy5oaWRkZW5EaXYsICJkaXYiLCB7CiAgICAgICAgaWQ6ICJNYXRoSmF4X0hpZGRlbiIKICAgICAgfSk7IC8vIERldGVybWluZSBwaXhlbHMgcGVyIGluY2gKCiAgICAgIHZhciBkaXYgPSB0aGlzLmFkZEVsZW1lbnQodGhpcy5oaWRkZW5EaXYsICJkaXYiLCB7CiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHdpZHRoOiAiNWluIgogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMucHhQZXJJbmNoID0gZGl2Lm9mZnNldFdpZHRoIC8gNTsKICAgICAgdGhpcy5oaWRkZW5EaXYucmVtb3ZlQ2hpbGQoZGl2KTsgLy8gTWFya2VycyB1c2VkIGJ5IGdldFcKCiAgICAgIHRoaXMuc3RhcnRNYXJrZXIgPSB0aGlzLmNyZWF0ZVN0cnV0KHRoaXMuRWxlbWVudCgic3BhbiIpLCAxMCwgdHJ1ZSk7CiAgICAgIHRoaXMuZW5kTWFya2VyID0gdGhpcy5hZGRUZXh0KHRoaXMuRWxlbWVudCgic3BhbiIpLCAieCIpLnBhcmVudE5vZGU7IC8vIFVzZWQgaW4gZ2V0SEQKCiAgICAgIHRoaXMuSERzcGFuID0gdGhpcy5FbGVtZW50KCJzcGFuIik7CgogICAgICBpZiAodGhpcy5vcGVyYUhlaWdodEJ1ZykgewogICAgICAgIHRoaXMuY3JlYXRlU3RydXQodGhpcy5IRHNwYW4sIDApOwogICAgICB9CgogICAgICBpZiAodGhpcy5tc2llSW5saW5lQmxvY2tBbGlnbkJ1ZykgewogICAgICAgIHRoaXMuSERpbWcgPSB0aGlzLmFkZEVsZW1lbnQodGhpcy5IRHNwYW4sICJpbWciLCB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBoZWlnaHQ6ICIwcHgiLAogICAgICAgICAgICB3aWR0aDogIjFweCIKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuSERpbWcuc3JjID0gImFib3V0OmJsYW5rIjsKICAgICAgICB9IGNhdGNoIChlcnIpIHt9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5IRGltZyA9IHRoaXMuY3JlYXRlU3RydXQodGhpcy5IRHNwYW4sIDApOwogICAgICB9IC8vIFVzZWQgaW4gcHJlVHJhbnNsYXRlIHRvIGdldCBzY2FsaW5nIGZhY3RvcnMKCgogICAgICB0aGlzLkVtRXhTcGFuID0gdGhpcy5FbGVtZW50KCJzcGFuIiwgewogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICJmb250LXNpemUtYWRqdXN0IjogIm5vbmUiCiAgICAgICAgfQogICAgICB9LCBbWyJzcGFuIiwgewogICAgICAgIGNsYXNzTmFtZTogIk1hdGhKYXhfRXhCb3giCiAgICAgIH1dLCBbInNwYW4iLCB7CiAgICAgICAgY2xhc3NOYW1lOiAiTWF0aEpheCIKICAgICAgfSwgW1sic3BhbiIsIHsKICAgICAgICBjbGFzc05hbWU6ICJNYXRoSmF4X0VtQm94IgogICAgICB9XV1dXSk7IC8vIFVzZWQgaW4gcHJlVHJhbnNsYXRlIHRvIGdldCBsaW5lYnJlYWsgd2lkdGgKCiAgICAgIHRoaXMubGluZWJyZWFrU3BhbiA9IHRoaXMuRWxlbWVudCgic3BhbiIsIG51bGwsIFtbImhyIiwgewogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgc2l6ZTogMSwKICAgICAgICAgIHBhZGRpbmc6IDAsCiAgICAgICAgICBib3JkZXI6IDAsCiAgICAgICAgICBtYXJnaW46IDAKICAgICAgICB9CiAgICAgIH1dXSk7IC8vIFNldCB1cCBzdHlsZXMgYW5kIHByZWxvYWQgd2ViIGZvbnRzCgogICAgICByZXR1cm4gQUpBWC5TdHlsZXModGhpcy5jb25maWcuc3R5bGVzLCBbIkluaXRpYWxpemVIVE1MIiwgdGhpc10pOwogICAgfSwKICAgIHJlbW92ZVNUSVhmb250czogZnVuY3Rpb24gcmVtb3ZlU1RJWGZvbnRzKGZvbnRzKSB7CiAgICAgIC8vCiAgICAgIC8vICBPcGVyYSBkb2Vzbid0IGRpc3BsYXkgbGFyZ2UgY2h1bmtzIG9mIHRoZSBTVElYIGZvbnRzLCBhbmQKICAgICAgLy8gIFNhZmFyaS9XaW5kb3dzIGRvZXNuJ3QgZGlzcGxheSBQbGFuZTEsCiAgICAgIC8vICBzbyBkaXNhYmxlIFNUSVggZm9yIHRoZXNlIGJyb3dzZXJzLgogICAgICAvLwogICAgICAvLyAgIyMjIEZJWE1FICMjIyBEbyB3ZSBuZWVkIHRvIGRpc2FibGUgdGhlIG90aGVyIHdlYiBmb250cyBmb3IgdGhlc2U/CiAgICAgIC8vCiAgICAgIGZvciAodmFyIGkgPSAwLCBtID0gZm9udHMubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgaWYgKGZvbnRzW2ldID09PSAiU1RJWCIpIHsKICAgICAgICAgIGZvbnRzLnNwbGljZShpLCAxKTsKICAgICAgICAgIG0tLTsKICAgICAgICAgIGktLTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmNvbmZpZy5wcmVmZXJyZWRGb250ID09PSAiU1RJWCIpIHsKICAgICAgICB0aGlzLmNvbmZpZy5wcmVmZXJyZWRGb250ID0gZm9udHNbMF07CiAgICAgIH0KICAgIH0sCiAgICBQcmVsb2FkV2ViRm9udHM6IGZ1bmN0aW9uIFByZWxvYWRXZWJGb250cygpIHsKICAgICAgaWYgKCFIVE1MQ1NTLmFsbG93V2ViRm9udHMgfHwgIUhUTUxDU1MuY29uZmlnLnByZWxvYWRXZWJGb250cykgcmV0dXJuOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIG0gPSBIVE1MQ1NTLmNvbmZpZy5wcmVsb2FkV2ViRm9udHMubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgdmFyIEZPTlQgPSBIVE1MQ1NTLkZPTlREQVRBLkZPTlRTW0hUTUxDU1MuY29uZmlnLnByZWxvYWRXZWJGb250c1tpXV07CgogICAgICAgIGlmICghRk9OVC5hdmFpbGFibGUpIHsKICAgICAgICAgIEhUTUxDU1MuRm9udC50ZXN0Rm9udChGT05UKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLwogICAgLy8gIEhhbmRsZSBpbml0aWFsaXphdGlvbiB0aGF0IHJlcXVpcmVzIHN0eWxlcyB0byBiZSBzZXQgdXAKICAgIC8vCiAgICBJbml0aWFsaXplSFRNTDogZnVuY3Rpb24gSW5pdGlhbGl6ZUhUTUwoKSB7CiAgICAgIHRoaXMuUHJlbG9hZFdlYkZvbnRzKCk7CiAgICAgIHRoaXMuZ2V0RGVmYXVsdEV4RW0oKTsgLy8KICAgICAgLy8gIElmIHRoZSBkZWZhdWx0RW0gc2l6ZSBpcyB6ZXJvLCBpdCBtaWdodCBiZSB0aGF0IGEgd2ViIGZvbnQgaGFzbid0CiAgICAgIC8vICBhcnJpdmVkIHlldCwgc28gdHJ5IHRvIHdhaXQgZm9yIGl0LCBidXQgZG9uJ3Qgd2FpdCB0b28gbG9uZy4KICAgICAgLy8KCiAgICAgIGlmICh0aGlzLmRlZmF1bHRFbSkgcmV0dXJuOwogICAgICB2YXIgcmVhZHkgPSBNYXRoSmF4LkNhbGxiYWNrKCk7CiAgICAgIEFKQVgudGltZXIuc3RhcnQoQUpBWCwgZnVuY3Rpb24gKGNoZWNrKSB7CiAgICAgICAgaWYgKGNoZWNrLnRpbWUocmVhZHkpKSB7CiAgICAgICAgICBIVUIuc2lnbmFsLlBvc3QoWyJIVE1MLUNTUyBKYXggLSBubyBkZWZhdWx0IGVtIHNpemUiXSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBIVE1MQ1NTLmdldERlZmF1bHRFeEVtKCk7CgogICAgICAgIGlmIChIVE1MQ1NTLmRlZmF1bHRFbSkgewogICAgICAgICAgcmVhZHkoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2V0VGltZW91dChjaGVjaywgY2hlY2suZGVsYXkpOwogICAgICAgIH0KICAgICAgfSwgdGhpcy5kZWZhdWx0RW1EZWxheSwgdGhpcy5kZWZhdWx0RW1UaW1lb3V0KTsKICAgICAgcmV0dXJuIHJlYWR5OwogICAgfSwKICAgIGRlZmF1bHRFbURlbGF5OiAxMDAsCiAgICAvLyBpbml0aWFsIGRlbGF5IHdoZW4gY2hlY2tpbmcgZm9yIGRlZmF1bHRFbQogICAgZGVmYXVsdEVtVGltZW91dDogMTAwMCwKICAgIC8vIHdoZW4gdG8gc3RvcCBsb29raW5nIGZvciBkZWZhdWx0RW0KICAgIGdldERlZmF1bHRFeEVtOiBmdW5jdGlvbiBnZXREZWZhdWx0RXhFbSgpIHsKICAgICAgLy8KICAgICAgLy8gIEdldCB0aGUgZGVmYXVsdCBzaXplcyAobmVlZCBzdHlsZXMgaW4gcGxhY2UgdG8gZG8gdGhpcykKICAgICAgLy8KICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLkVtRXhTcGFuKTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmxpbmVicmVha1NwYW4pOwogICAgICB0aGlzLmRlZmF1bHRFeCA9IHRoaXMuRW1FeFNwYW4uZmlyc3RDaGlsZC5vZmZzZXRIZWlnaHQgLyA2MDsKICAgICAgdGhpcy5kZWZhdWx0RW0gPSB0aGlzLkVtRXhTcGFuLmxhc3RDaGlsZC5maXJzdENoaWxkLm9mZnNldEhlaWdodCAvIDYwOwogICAgICB0aGlzLmRlZmF1bHRXaWR0aCA9IHRoaXMubGluZWJyZWFrU3Bhbi5maXJzdENoaWxkLm9mZnNldFdpZHRoOwogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMubGluZWJyZWFrU3Bhbik7CiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5FbUV4U3Bhbik7CiAgICB9LAogICAgcHJlVHJhbnNsYXRlOiBmdW5jdGlvbiBwcmVUcmFuc2xhdGUoc3RhdGUpIHsKICAgICAgdmFyIHNjcmlwdHMgPSBzdGF0ZS5qYXhbdGhpcy5pZF0sCiAgICAgICAgICBpLAogICAgICAgICAgbSA9IHNjcmlwdHMubGVuZ3RoLAogICAgICAgICAgbiwKICAgICAgICAgIHNjcmlwdCwKICAgICAgICAgIHByZXYsCiAgICAgICAgICBzcGFuLAogICAgICAgICAgZGl2LAogICAgICAgICAgdGVzdCwKICAgICAgICAgIGpheCwKICAgICAgICAgIGV4LAogICAgICAgICAgZW0sCiAgICAgICAgICBzY2FsZSwKICAgICAgICAgIG1heHdpZHRoLAogICAgICAgICAgcmVsd2lkdGggPSBmYWxzZSwKICAgICAgICAgIGN3aWR0aCwKICAgICAgICAgIGxpbmVicmVhayA9IHRoaXMuY29uZmlnLmxpbmVicmVha3MuYXV0b21hdGljLAogICAgICAgICAgd2lkdGggPSB0aGlzLmNvbmZpZy5saW5lYnJlYWtzLndpZHRoOwoKICAgICAgaWYgKGxpbmVicmVhaykgewogICAgICAgIHJlbHdpZHRoID0gd2lkdGgubWF0Y2goL15ccyooXGQrKFwuXGQqKT8lXHMqKT9jb250YWluZXJccyokLykgIT0gbnVsbDsKCiAgICAgICAgaWYgKHJlbHdpZHRoKSB7CiAgICAgICAgICB3aWR0aCA9IHdpZHRoLnJlcGxhY2UoL1xzKmNvbnRhaW5lclxzKi8sICIiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF4d2lkdGggPSB0aGlzLmRlZmF1bHRXaWR0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aWR0aCA9PT0gIiIpIHsKICAgICAgICAgIHdpZHRoID0gIjEwMCUiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBtYXh3aWR0aCA9IDEwMDAwMDsKICAgICAgfSAvLyBhIGJpZyB3aWR0aCwgc28gbm8gaW1wbGljaXQgbGluZSBicmVha3MKICAgICAgLy8KICAgICAgLy8gIExvb3AgdGhyb3VnaCB0aGUgc2NyaXB0cwogICAgICAvLwoKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBtOyBpKyspIHsKICAgICAgICBzY3JpcHQgPSBzY3JpcHRzW2ldOwogICAgICAgIGlmICghc2NyaXB0LnBhcmVudE5vZGUpIGNvbnRpbnVlOyAvLwogICAgICAgIC8vICBSZW1vdmUgYW55IGV4aXN0aW5nIG91dHB1dAogICAgICAgIC8vCgogICAgICAgIHByZXYgPSBzY3JpcHQucHJldmlvdXNTaWJsaW5nOwoKICAgICAgICBpZiAocHJldiAmJiBTdHJpbmcocHJldi5jbGFzc05hbWUpLm1hdGNoKC9eTWF0aEpheChfRGlzcGxheSk/KCBNYXRoSmF4X1Byb2Nlc3NpbmcpPyQvKSkgewogICAgICAgICAgcHJldi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHByZXYpOwogICAgICAgIH0gLy8KICAgICAgICAvLyAgQWRkIHRoZSBzcGFuLCBhbmQgYSBkaXYgaWYgaW4gZGlzcGxheSBtb2RlLAogICAgICAgIC8vICB0aGVuIHNldCB0aGUgcm9sZSBhbmQgbWFyayBpdCBhcyBiZWluZyBwcm9jZXNzZWQKICAgICAgICAvLwoKCiAgICAgICAgamF4ID0gc2NyaXB0Lk1hdGhKYXguZWxlbWVudEpheDsKICAgICAgICBpZiAoIWpheCkgY29udGludWU7CiAgICAgICAgamF4LkhUTUxDU1MgPSB7CiAgICAgICAgICBkaXNwbGF5OiBqYXgucm9vdC5HZXQoImRpc3BsYXkiKSA9PT0gImJsb2NrIgogICAgICAgIH07CiAgICAgICAgc3BhbiA9IGRpdiA9IHRoaXMuRWxlbWVudCgic3BhbiIsIHsKICAgICAgICAgIGNsYXNzTmFtZTogIk1hdGhKYXgiLAogICAgICAgICAgaWQ6IGpheC5pbnB1dElEICsgIi1GcmFtZSIsCiAgICAgICAgICBpc01hdGhKYXg6IHRydWUsCiAgICAgICAgICBqYXhJRDogdGhpcy5pZCwKICAgICAgICAgIG9uY29udGV4dG1lbnU6IEVWRU5ULk1lbnUsCiAgICAgICAgICBvbm1vdXNlZG93bjogRVZFTlQuTW91c2Vkb3duLAogICAgICAgICAgb25tb3VzZW92ZXI6IEVWRU5ULk1vdXNlb3ZlciwKICAgICAgICAgIG9ubW91c2VvdXQ6IEVWRU5ULk1vdXNlb3V0LAogICAgICAgICAgb25tb3VzZW1vdmU6IEVWRU5ULk1vdXNlbW92ZSwKICAgICAgICAgIG9uY2xpY2s6IEVWRU5ULkNsaWNrLAogICAgICAgICAgb25kYmxjbGljazogRVZFTlQuRGJsQ2xpY2ssCiAgICAgICAgICAvLyBBZGRlZCBmb3Iga2V5Ym9hcmQgYWNjZXNzaWJsZSBtZW51LgogICAgICAgICAgb25rZXlkb3duOiBFVkVOVC5LZXlkb3duLAogICAgICAgICAgdGFiSW5kZXg6IEhVQi5nZXRUYWJPcmRlcihqYXgpCiAgICAgICAgfSk7CgogICAgICAgIGlmIChIVUIuQnJvd3Nlci5ub0NvbnRleHRNZW51KSB7CiAgICAgICAgICBzcGFuLm9udG91Y2hzdGFydCA9IFRPVUNILnN0YXJ0OwogICAgICAgICAgc3Bhbi5vbnRvdWNoZW5kID0gVE9VQ0guZW5kOwogICAgICAgIH0KCiAgICAgICAgaWYgKGpheC5IVE1MQ1NTLmRpc3BsYXkpIHsKICAgICAgICAgIGRpdiA9IHRoaXMuRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICBjbGFzc05hbWU6ICJNYXRoSmF4X0Rpc3BsYXkiCiAgICAgICAgICB9KTsKICAgICAgICAgIGRpdi5hcHBlbmRDaGlsZChzcGFuKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMubXNpZURpc2FwcGVhcmluZ0J1ZykgewogICAgICAgICAgc3Bhbi5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CiAgICAgICAgfQoKICAgICAgICBkaXYuY2xhc3NOYW1lICs9ICIgTWF0aEpheF9Qcm9jZXNzaW5nIjsKICAgICAgICBzY3JpcHQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZGl2LCBzY3JpcHQpOyAvLwogICAgICAgIC8vICBBZGQgdGhlIHRlc3Qgc3BhbiBmb3IgZGV0ZXJtaW5pbmcgc2NhbGVzIGFuZCBsaW5lYnJlYWsgd2lkdGhzCiAgICAgICAgLy8KCiAgICAgICAgc2NyaXB0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMuRW1FeFNwYW4uY2xvbmVOb2RlKHRydWUpLCBzY3JpcHQpOwogICAgICAgIGRpdi5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLmxpbmVicmVha1NwYW4uY2xvbmVOb2RlKHRydWUpLCBkaXYpOwogICAgICB9IC8vCiAgICAgIC8vICBEZXRlcm1pbmUgdGhlIHNjYWxpbmcgZmFjdG9ycyBmb3IgZWFjaCBzY3JpcHQKICAgICAgLy8gICh0aGlzIG9ubHkgcmVxdWlyZXMgb25lIHJlZmxvdyByYXRoZXIgdGhhbiBhIHJlZmxvdyBmb3IgZWFjaCBlcXVhdGlvbikKICAgICAgLy8gIFJlY29yZCBhbnkgdGhhdCBuZWVkIHRvIGJlIGhpZGRlbiAoZG9uJ3QgbW92ZSB0aGVtIG5vdywgc2luY2UgdGhhdAogICAgICAvLyAgd291bGQgY2F1c2UgcmVmbG93cykuCiAgICAgIC8vCgoKICAgICAgdmFyIGhpZGRlbiA9IFtdOwoKICAgICAgZm9yIChpID0gMDsgaSA8IG07IGkrKykgewogICAgICAgIHNjcmlwdCA9IHNjcmlwdHNbaV07CiAgICAgICAgaWYgKCFzY3JpcHQucGFyZW50Tm9kZSkgY29udGludWU7CiAgICAgICAgdGVzdCA9IHNjcmlwdC5wcmV2aW91c1NpYmxpbmc7CiAgICAgICAgZGl2ID0gdGVzdC5wcmV2aW91c1NpYmxpbmc7CiAgICAgICAgamF4ID0gc2NyaXB0Lk1hdGhKYXguZWxlbWVudEpheDsKICAgICAgICBpZiAoIWpheCkgY29udGludWU7CiAgICAgICAgZXggPSB0ZXN0LmZpcnN0Q2hpbGQub2Zmc2V0SGVpZ2h0IC8gNjA7CiAgICAgICAgZW0gPSB0ZXN0Lmxhc3RDaGlsZC5maXJzdENoaWxkLm9mZnNldEhlaWdodCAvIDYwOwogICAgICAgIGN3aWR0aCA9IGRpdi5wcmV2aW91c1NpYmxpbmcuZmlyc3RDaGlsZC5vZmZzZXRXaWR0aDsKCiAgICAgICAgaWYgKHJlbHdpZHRoKSB7CiAgICAgICAgICBtYXh3aWR0aCA9IGN3aWR0aDsKICAgICAgICB9CgogICAgICAgIGlmIChleCA9PT0gMCB8fCBleCA9PT0gIk5hTiIpIHsKICAgICAgICAgIC8vIGNhbid0IHJlYWQgd2lkdGgsIHNvIG1vdmUgdG8gaGlkZGVuIGRpdiBmb3IgcHJvY2Vzc2luZwogICAgICAgICAgaGlkZGVuLnB1c2goZGl2KTsKICAgICAgICAgIGpheC5IVE1MQ1NTLmlzSGlkZGVuID0gdHJ1ZTsKICAgICAgICAgIGV4ID0gdGhpcy5kZWZhdWx0RXg7CiAgICAgICAgICBlbSA9IHRoaXMuZGVmYXVsdEVtOwogICAgICAgICAgY3dpZHRoID0gdGhpcy5kZWZhdWx0V2lkdGg7CgogICAgICAgICAgaWYgKHJlbHdpZHRoKSB7CiAgICAgICAgICAgIG1heHdpZHRoID0gY3dpZHRoOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2NhbGUgPSB0aGlzLmNvbmZpZy5tYXRjaEZvbnRIZWlnaHQgPyBleCAvIHRoaXMuVGVYLnhfaGVpZ2h0IC8gZW0gOiAxOwogICAgICAgIHNjYWxlID0gTWF0aC5mbG9vcihNYXRoLm1heCh0aGlzLmNvbmZpZy5taW5TY2FsZUFkanVzdCAvIDEwMCwgc2NhbGUpICogdGhpcy5jb25maWcuc2NhbGUpOwogICAgICAgIGpheC5IVE1MQ1NTLnNjYWxlID0gc2NhbGUgLyAxMDA7CiAgICAgICAgamF4LkhUTUxDU1MuZm9udFNpemUgPSBzY2FsZSArICIlIjsKICAgICAgICBqYXguSFRNTENTUy5lbSA9IGpheC5IVE1MQ1NTLm91dGVyRW0gPSBlbTsKICAgICAgICB0aGlzLmVtID0gZW0gKiBzY2FsZSAvIDEwMDsKICAgICAgICBqYXguSFRNTENTUy5leCA9IGV4OwogICAgICAgIGpheC5IVE1MQ1NTLmN3aWR0aCA9IGN3aWR0aCAvIHRoaXMuZW07CiAgICAgICAgamF4LkhUTUxDU1MubGluZVdpZHRoID0gbGluZWJyZWFrID8gdGhpcy5sZW5ndGgyZW0od2lkdGgsIDEsIG1heHdpZHRoIC8gdGhpcy5lbSkgOiAxMDAwMDAwOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwLCBuID0gaGlkZGVuLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgIHRoaXMuaGlkZGVuRGl2LmFwcGVuZENoaWxkKGhpZGRlbltpXSk7CiAgICAgICAgdGhpcy5hZGRFbGVtZW50KHRoaXMuaGlkZGVuRGl2LCAiYnIiKTsKICAgICAgfSAvLwogICAgICAvLyAgUmVtb3ZlIHRoZSB0ZXN0IHNwYW5zIHVzZWQgZm9yIGRldGVybWluaW5nIHNjYWxlcyBhbmQgbGluZWJyZWFrIHdpZHRocwogICAgICAvLwoKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBtOyBpKyspIHsKICAgICAgICBzY3JpcHQgPSBzY3JpcHRzW2ldOwogICAgICAgIGlmICghc2NyaXB0LnBhcmVudE5vZGUpIGNvbnRpbnVlOwogICAgICAgIHRlc3QgPSBzY3JpcHRzW2ldLnByZXZpb3VzU2libGluZzsKICAgICAgICBqYXggPSBzY3JpcHRzW2ldLk1hdGhKYXguZWxlbWVudEpheDsKICAgICAgICBpZiAoIWpheCkgY29udGludWU7CiAgICAgICAgc3BhbiA9IHRlc3QucHJldmlvdXNTaWJsaW5nOwoKICAgICAgICBpZiAoIWpheC5IVE1MQ1NTLmlzSGlkZGVuKSB7CiAgICAgICAgICBzcGFuID0gc3Bhbi5wcmV2aW91c1NpYmxpbmc7CiAgICAgICAgfQoKICAgICAgICBzcGFuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc3Bhbik7CiAgICAgICAgdGVzdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRlc3QpOwogICAgICB9IC8vCiAgICAgIC8vICBTZXQgc3RhdGUgdmFyaWFibGVzIHVzZWQgZm9yIGRpc3BsYXlpbmcgZXF1YXRpb25zIGluIGNodW5rcwogICAgICAvLwoKCiAgICAgIHN0YXRlLkhUTUxDU1NlcW4gPSBzdGF0ZS5IVE1MQ1NTbGFzdCA9IDA7CiAgICAgIHN0YXRlLkhUTUxDU1NpID0gLTE7CiAgICAgIHN0YXRlLkhUTUxDU1NjaHVuayA9IHRoaXMuY29uZmlnLkVxbkNodW5rOwogICAgICBzdGF0ZS5IVE1MQ1NTZGVsYXkgPSBmYWxzZTsKICAgIH0sCiAgICBQSEFTRTogewogICAgICBJOiAxLAogICAgICBJSTogMiwKICAgICAgSUlJOiAzCiAgICB9LAogICAgLy8gcHJvY2Vzc2luZyBwaGFzZXMKICAgIFRyYW5zbGF0ZTogZnVuY3Rpb24gVHJhbnNsYXRlKHNjcmlwdCwgc3RhdGUpIHsKICAgICAgaWYgKCFzY3JpcHQucGFyZW50Tm9kZSkgcmV0dXJuOyAvLwogICAgICAvLyAgSWYgd2UgYXJlIHN1cHBvc2VkIHRvIGRvIGEgY2h1bmsgZGVsYXksIGRvIGl0CiAgICAgIC8vICAKCiAgICAgIGlmIChzdGF0ZS5IVE1MQ1NTZGVsYXkpIHsKICAgICAgICBzdGF0ZS5IVE1MQ1NTZGVsYXkgPSBmYWxzZTsKICAgICAgICBIVUIuUmVzdGFydEFmdGVyKE1hdGhKYXguQ2FsbGJhY2suRGVsYXkodGhpcy5jb25maWcuRXFuQ2h1bmtEZWxheSkpOwogICAgICB9IC8vCiAgICAgIC8vICBHZXQgdGhlIGRhdGEgYWJvdXQgdGhlIG1hdGgKICAgICAgLy8KCgogICAgICB2YXIgamF4ID0gc2NyaXB0Lk1hdGhKYXguZWxlbWVudEpheCwKICAgICAgICAgIG1hdGggPSBqYXgucm9vdCwKICAgICAgICAgIHNwYW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChqYXguaW5wdXRJRCArICItRnJhbWUiKSwKICAgICAgICAgIGRpdiA9IGpheC5IVE1MQ1NTLmRpc3BsYXkgPyAoc3BhbiB8fCB7fSkucGFyZW50Tm9kZSA6IHNwYW47CiAgICAgIGlmICghZGl2KSByZXR1cm47IC8vCiAgICAgIC8vICBTZXQgdGhlIGZvbnQgbWV0cmljcwogICAgICAvLwoKICAgICAgdGhpcy5nZXRNZXRyaWNzKGpheCk7CgogICAgICBpZiAodGhpcy5zY2FsZSAhPT0gMSkgewogICAgICAgIHNwYW4uc3R5bGUuZm9udFNpemUgPSBqYXguSFRNTENTUy5mb250U2l6ZTsKICAgICAgfSAvLwogICAgICAvLyAgVHlwZXNldCB0aGUgbWF0aAogICAgICAvLwoKCiAgICAgIHRoaXMuaW5pdEltZyhzcGFuKTsKICAgICAgdGhpcy5pbml0SFRNTChtYXRoLCBzcGFuKTsKICAgICAgdGhpcy5zYXZlUHJldmlldyhzY3JpcHQpOwoKICAgICAgdHJ5IHsKICAgICAgICBtYXRoLnNldFRlWGNsYXNzKCk7CiAgICAgICAgamF4LkhUTUxDU1Muc3BhbiA9IHNwYW47CiAgICAgICAgamF4LkhUTUxDU1MuZGl2ID0gZGl2OyAvLyBzYXZlIGZvciBwaGFzZSBJSSBhbmQgSUlJCgogICAgICAgIG1hdGgudG9IVE1MKHNwYW4sIGRpdiwgdGhpcy5QSEFTRS5JKTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgaWYgKGVyci5yZXN0YXJ0KSB7CiAgICAgICAgICB3aGlsZSAoc3Bhbi5maXJzdENoaWxkKSB7CiAgICAgICAgICAgIHNwYW4ucmVtb3ZlQ2hpbGQoc3Bhbi5maXJzdENoaWxkKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMucmVzdG9yZVByZXZpZXcoc2NyaXB0KTsKICAgICAgICB0aHJvdyBlcnI7CiAgICAgIH0KCiAgICAgIHRoaXMucmVzdG9yZVByZXZpZXcoc2NyaXB0KTsgLy8KICAgICAgLy8gIFJlbW92ZSB0aGUgcHJvY2Vzc2luZyBtYXJrZXIsIGFuZCBzaWduYWwgdGhlIG5ldyBtYXRoIHBlbmRpbmcKICAgICAgLy8KCiAgICAgIGRpdi5jbGFzc05hbWUgPSBkaXYuY2xhc3NOYW1lLnNwbGl0KC8gLylbMF0gKyAiIE1hdGhKYXhfUHJvY2Vzc2VkIjsKICAgICAgSFVCLnNpZ25hbC5Qb3N0KFsiTmV3IE1hdGggUGVuZGluZyIsIGpheC5pbnB1dElEXSk7IC8vIEZJWE1FOiB3YWl0IGZvciB0aGlzPyAgKGkuZS4sIHJlc3RhcnQgaWYgcmV0dXJucyB1bmNhbGxlZCBjYWxsYmFjaykKICAgICAgLy8KICAgICAgLy8gIENoZWNrIGlmIHdlIHNob3VsZCBzaG93IHRoaXMgY2h1bmsgb2YgZXF1YXRpb25zCiAgICAgIC8vCgogICAgICBzdGF0ZS5IVE1MQ1NTZXFuICs9IHN0YXRlLmkgLSBzdGF0ZS5IVE1MQ1NTaTsKICAgICAgc3RhdGUuSFRNTENTU2kgPSBzdGF0ZS5pOwoKICAgICAgaWYgKHN0YXRlLkhUTUxDU1NlcW4gPj0gc3RhdGUuSFRNTENTU2xhc3QgKyBzdGF0ZS5IVE1MQ1NTY2h1bmspIHsKICAgICAgICB0aGlzLnBvc3RUcmFuc2xhdGUoc3RhdGUsIHRydWUpOwogICAgICAgIHN0YXRlLkhUTUxDU1NjaHVuayA9IE1hdGguZmxvb3Ioc3RhdGUuSFRNTENTU2NodW5rICogdGhpcy5jb25maWcuRXFuQ2h1bmtGYWN0b3IpOwogICAgICAgIHN0YXRlLkhUTUxDU1NkZWxheSA9IHRydWU7IC8vIGRlbGF5IGlmIHRoZXJlIGFyZSBtb3JlIHNjcmlwdHMKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIC8vCiAgICAvLyAgTWF0aE1MIHByZXZpZXdzIGNhbiBjb250YWluIHRoZSBzYW1lIElEJ3MgYXMgdGhlIEhUTUwgb3V0cHV0LAogICAgLy8gIHdoaWNoIGNvbmZ1c2VzIEhUTUxzcGFuRWxlbWVudCgpLCBzbyByZW1vdmUgdGhlIHByZXZpZXcgdGVtcG9yYXJpbHkKICAgIC8vICBhbmQgcmVzdG9yZSBpdCBhZnRlciB0eXBlc2V0dGluZyB0aGUgbWF0aC4KICAgIC8vCiAgICBzYXZlUHJldmlldzogZnVuY3Rpb24gc2F2ZVByZXZpZXcoc2NyaXB0KSB7CiAgICAgIHZhciBwcmV2aWV3ID0gc2NyaXB0Lk1hdGhKYXgucHJldmlldzsKCiAgICAgIGlmIChwcmV2aWV3KSB7CiAgICAgICAgc2NyaXB0Lk1hdGhKYXgudG1wUHJldmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgICBwcmV2aWV3LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHNjcmlwdC5NYXRoSmF4LnRtcFByZXZpZXcsIHByZXZpZXcpOwogICAgICB9CiAgICB9LAogICAgcmVzdG9yZVByZXZpZXc6IGZ1bmN0aW9uIHJlc3RvcmVQcmV2aWV3KHNjcmlwdCkgewogICAgICB2YXIgdG1wUHJldmlldyA9IHNjcmlwdC5NYXRoSmF4LnRtcFByZXZpZXc7CgogICAgICBpZiAodG1wUHJldmlldykgewogICAgICAgIHRtcFByZXZpZXcucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoc2NyaXB0Lk1hdGhKYXgucHJldmlldywgdG1wUHJldmlldyk7CiAgICAgICAgZGVsZXRlIHNjcmlwdC5NYXRoSmF4LnRtcFByZXZpZXc7CiAgICAgIH0KICAgIH0sCiAgICAvLwogICAgLy8gIEdldCB0aGUgamF4IG1ldHJpYyBpbmZvcm1hdGlvbgogICAgLy8KICAgIGdldE1ldHJpY3M6IGZ1bmN0aW9uIGdldE1ldHJpY3MoamF4KSB7CiAgICAgIHZhciBkYXRhID0gamF4LkhUTUxDU1M7CiAgICAgIHRoaXMuZW0gPSBNTUwubWJhc2UucHJvdG90eXBlLmVtID0gZGF0YS5lbSAqIGRhdGEuc2NhbGU7CiAgICAgIHRoaXMub3V0ZXJFbSA9IGRhdGEuZW07CiAgICAgIHRoaXMuc2NhbGUgPSBkYXRhLnNjYWxlOwogICAgICB0aGlzLmN3aWR0aCA9IGRhdGEuY3dpZHRoOwogICAgICB0aGlzLmxpbmVicmVha1dpZHRoID0gZGF0YS5saW5lV2lkdGg7CiAgICB9LAogICAgcG9zdFRyYW5zbGF0ZTogZnVuY3Rpb24gcG9zdFRyYW5zbGF0ZShzdGF0ZSwgcGFydGlhbCkgewogICAgICB2YXIgc2NyaXB0cyA9IHN0YXRlLmpheFt0aGlzLmlkXSwKICAgICAgICAgIHNjcmlwdCwKICAgICAgICAgIGpheCwKICAgICAgICAgIGksCiAgICAgICAgICBtOyAvLwogICAgICAvLyAgUmVtb3ZlIHRoZSBwcm9jZXNzZWQgbWFya2VycyBzbyB0aGF0IG1lYXN1cmluZyBjYW4gb2NjdXIsCiAgICAgIC8vICBhbmQgcmVtb3ZlIHRoZSBwcmV2aWV3LCBpZiBhbnksIHNpbmNlIHRoZSBtYXRoIHdpbGwgbm93IGJlIHZpc2libGUuCiAgICAgIC8vCgogICAgICBmb3IgKGkgPSBzdGF0ZS5IVE1MQ1NTbGFzdCwgbSA9IHN0YXRlLkhUTUxDU1NlcW47IGkgPCBtOyBpKyspIHsKICAgICAgICBzY3JpcHQgPSBzY3JpcHRzW2ldOwoKICAgICAgICBpZiAoc2NyaXB0ICYmIHNjcmlwdC5NYXRoSmF4LmVsZW1lbnRKYXgpIHsKICAgICAgICAgIHZhciBkaXYgPSBzY3JpcHQuTWF0aEpheC5lbGVtZW50SmF4LkhUTUxDU1MuZGl2OwogICAgICAgICAgZGl2LmNsYXNzTmFtZSA9IGRpdi5jbGFzc05hbWUuc3BsaXQoLyAvKVswXTsKCiAgICAgICAgICBpZiAoc2NyaXB0Lk1hdGhKYXgucHJldmlldykgewogICAgICAgICAgICBzY3JpcHQuTWF0aEpheC5wcmV2aWV3LmlubmVySFRNTCA9ICIiOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLwogICAgICAvLyAgTWVhc3VyZSB0aGUgbWF0aCBpbiB0aGlzIGNodW5rICh0b0hUTUwgcGhhc2UgSUkpCiAgICAgIC8vCgoKICAgICAgZm9yIChpID0gc3RhdGUuSFRNTENTU2xhc3QsIG0gPSBzdGF0ZS5IVE1MQ1NTZXFuOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgc2NyaXB0ID0gc2NyaXB0c1tpXTsKCiAgICAgICAgaWYgKHNjcmlwdCAmJiBzY3JpcHQuTWF0aEpheC5lbGVtZW50SmF4KSB7CiAgICAgICAgICBqYXggPSBzY3JpcHQuTWF0aEpheC5lbGVtZW50SmF4OwogICAgICAgICAgdGhpcy5nZXRNZXRyaWNzKGpheCk7CiAgICAgICAgICBqYXgucm9vdC50b0hUTUwoamF4LkhUTUxDU1Muc3BhbiwgamF4LkhUTUxDU1MuZGl2LCB0aGlzLlBIQVNFLklJKTsKICAgICAgICB9CiAgICAgIH0gLy8KICAgICAgLy8gIFJldmVhbCB0aGlzIGNodW5rIG9mIG1hdGgKICAgICAgLy8KCgogICAgICBmb3IgKGkgPSBzdGF0ZS5IVE1MQ1NTbGFzdCwgbSA9IHN0YXRlLkhUTUxDU1NlcW47IGkgPCBtOyBpKyspIHsKICAgICAgICBzY3JpcHQgPSBzY3JpcHRzW2ldOwoKICAgICAgICBpZiAoc2NyaXB0ICYmIHNjcmlwdC5NYXRoSmF4LmVsZW1lbnRKYXgpIHsKICAgICAgICAgIC8vCiAgICAgICAgICAvLyAgRmluaXNoIHRoZSBtYXRoIHdpdGggaXRzIG1lYXN1cmVkIHNpemUgKHRvSFRNTCBwaGFzZSBJSUkpCiAgICAgICAgICAvLwogICAgICAgICAgamF4ID0gc2NyaXB0Lk1hdGhKYXguZWxlbWVudEpheDsKICAgICAgICAgIHRoaXMuZ2V0TWV0cmljcyhqYXgpOwogICAgICAgICAgamF4LnJvb3QudG9IVE1MKGpheC5IVE1MQ1NTLnNwYW4sIGpheC5IVE1MQ1NTLmRpdiwgdGhpcy5QSEFTRS5JSUkpOwogICAgICAgICAgaWYgKGpheC5IVE1MQ1NTLmlzSGlkZGVuKSBzY3JpcHQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoamF4LkhUTUxDU1MuZGl2LCBzY3JpcHQpOwogICAgICAgICAgZGVsZXRlIGpheC5IVE1MQ1NTLnNwYW47CiAgICAgICAgICBkZWxldGUgamF4LkhUTUxDU1MuZGl2OyAvLwogICAgICAgICAgLy8gIFRoZSBtYXRoIGlzIG5vdyBmdWxseSBwcm9jZXNzZWQKICAgICAgICAgIC8vCgogICAgICAgICAgc2NyaXB0Lk1hdGhKYXguc3RhdGUgPSBqYXguU1RBVEUuUFJPQ0VTU0VEOwogICAgICAgICAgSFVCLnNpZ25hbC5Qb3N0KFsiTmV3IE1hdGgiLCBzY3JpcHQuTWF0aEpheC5lbGVtZW50SmF4LmlucHV0SURdKTsgLy8gRklYTUU6IHdhaXQgZm9yIHRoaXM/ICAoaS5lLiwgcmVzdGFydCBpZiByZXR1cm5zIHVuY2FsbGVkIGNhbGxiYWNrKQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuZm9yY2VSZWZsb3cpIHsKICAgICAgICAvLyAgV2ViS2l0IGNhbiBtaXNwbGFjZSBzb21lIGVsZW1lbnRzIHRoYXQgc2hvdWxkIHdyYXAgdG8gdGhlIG5leHQgbGluZQogICAgICAgIC8vICBidXQgZ2V0cyB0aGVtIHJpZ2h0IG9uIGEgcmVmbG93LCBzbyBmb3JjZSByZWZsb3cgYnkgdG9nZ2xpbmcgYSBzdHlsZXNoZWV0CiAgICAgICAgdmFyIHNoZWV0ID0gKGRvY3VtZW50LnN0eWxlU2hlZXRzIHx8IFtdKVswXSB8fCB7fTsKICAgICAgICBzaGVldC5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgc2hlZXQuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgfSAvLwogICAgICAvLyAgU2F2ZSBvdXIgcGxhY2Ugc28gd2Uga25vdyB3aGF0IGlzIHJldmVhbGVkCiAgICAgIC8vCgoKICAgICAgc3RhdGUuSFRNTENTU2xhc3QgPSBzdGF0ZS5IVE1MQ1NTZXFuOwogICAgfSwKICAgIGdldEpheEZyb21NYXRoOiBmdW5jdGlvbiBnZXRKYXhGcm9tTWF0aChtYXRoKSB7CiAgICAgIGlmIChtYXRoLnBhcmVudE5vZGUuY2xhc3NOYW1lID09PSAiTWF0aEpheF9EaXNwbGF5IikgewogICAgICAgIG1hdGggPSBtYXRoLnBhcmVudE5vZGU7CiAgICAgIH0KCiAgICAgIGRvIHsKICAgICAgICBtYXRoID0gbWF0aC5uZXh0U2libGluZzsKICAgICAgfSB3aGlsZSAobWF0aCAmJiBtYXRoLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJzY3JpcHQiKTsKCiAgICAgIHJldHVybiBIVUIuZ2V0SmF4Rm9yKG1hdGgpOwogICAgfSwKICAgIGdldEhvdmVyU3BhbjogZnVuY3Rpb24gZ2V0SG92ZXJTcGFuKGpheCwgbWF0aCkgewogICAgICByZXR1cm4gamF4LnJvb3QuSFRNTHNwYW5FbGVtZW50KCk7CiAgICB9LAogICAgZ2V0SG92ZXJCQm94OiBmdW5jdGlvbiBnZXRIb3ZlckJCb3goamF4LCBzcGFuLCBtYXRoKSB7CiAgICAgIHZhciBiYm94ID0gc3Bhbi5iYm94LAogICAgICAgICAgZW0gPSBqYXguSFRNTENTUy5vdXRlckVtOwogICAgICB2YXIgQkJPWCA9IHsKICAgICAgICB3OiBiYm94LncgKiBlbSwKICAgICAgICBoOiBiYm94LmggKiBlbSwKICAgICAgICBkOiBiYm94LmQgKiBlbQogICAgICB9OwoKICAgICAgaWYgKGJib3gud2lkdGgpIHsKICAgICAgICBCQk9YLndpZHRoID0gYmJveC53aWR0aDsKICAgICAgfQoKICAgICAgcmV0dXJuIEJCT1g7CiAgICB9LAogICAgWm9vbTogZnVuY3Rpb24gWm9vbShqYXgsIHNwYW4sIG1hdGgsIE13LCBNaCkgewogICAgICAvLwogICAgICAvLyAgUmUtcmVuZGVyIGF0IGxhcmdlciBzaXplCiAgICAgIC8vCiAgICAgIHNwYW4uY2xhc3NOYW1lID0gIk1hdGhKYXgiOwogICAgICBzcGFuLnN0eWxlLmZvbnRTaXplID0gamF4LkhUTUxDU1MuZm9udFNpemU7IC8vCiAgICAgIC8vICBnZXQgZW0gc2l6ZXMgKHRha2VuIGZyb20gSFRNTENTUy5wcmVUcmFuc2xhdGUpCiAgICAgIC8vCgogICAgICB2YXIgZW1leCA9IHNwYW4uYXBwZW5kQ2hpbGQodGhpcy5FbUV4U3Bhbi5jbG9uZU5vZGUodHJ1ZSkpOwogICAgICB2YXIgZW0gPSBlbWV4Lmxhc3RDaGlsZC5maXJzdENoaWxkLm9mZnNldEhlaWdodCAvIDYwOwogICAgICB0aGlzLmVtID0gTU1MLm1iYXNlLnByb3RvdHlwZS5lbSA9IGVtOwogICAgICB0aGlzLm91dGVyRW0gPSBlbSAvIGpheC5IVE1MQ1NTLnNjYWxlOwogICAgICBlbWV4LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZW1leCk7CiAgICAgIHRoaXMuc2NhbGUgPSBqYXguSFRNTENTUy5zY2FsZTsKICAgICAgdGhpcy5saW5lYnJlYWtXaWR0aCA9IGpheC5IVE1MQ1NTLmxpbmVXaWR0aDsKICAgICAgdGhpcy5jd2lkdGggPSBqYXguSFRNTENTUy5jd2lkdGg7CiAgICAgIHRoaXMuem9vbVNjYWxlID0gcGFyc2VJbnQoSFVCLmNvbmZpZy5tZW51U2V0dGluZ3MuenNjYWxlKSAvIDEwMDsKICAgICAgdGhpcy5pZFBvc3RmaXggPSAiLXpvb20iOwogICAgICBqYXgucm9vdC50b0hUTUwoc3Bhbiwgc3Bhbik7CiAgICAgIHRoaXMuaWRQb3N0Zml4ID0gIiI7CiAgICAgIHRoaXMuem9vbVNjYWxlID0gMTsKICAgICAgdmFyIGJib3ggPSBqYXgucm9vdC5IVE1Mc3BhbkVsZW1lbnQoKS5iYm94LAogICAgICAgICAgd2lkdGggPSBiYm94LndpZHRoOwoKICAgICAgaWYgKHdpZHRoKSB7CiAgICAgICAgLy8gIEhhbmRsZSBmdWxsLXdpZHRoIGRpc3BsYXllZCBlcXVhdGlvbnMKICAgICAgICBpZiAoYmJveC50dykgewogICAgICAgICAgTXcgPSBiYm94LnR3ICogZW07CiAgICAgICAgfQoKICAgICAgICBpZiAoYmJveC53ICogZW0gPCBNdykgewogICAgICAgICAgTXcgPSBiYm94LncgKiBlbTsKICAgICAgICB9CgogICAgICAgIHNwYW4uc3R5bGUud2lkdGggPSBNYXRoLmZsb29yKE13IC0gMS41ICogSFRNTENTUy5lbSkgKyAicHgiOwogICAgICAgIHNwYW4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwogICAgICAgIHZhciBpZCA9IChqYXgucm9vdC5pZCB8fCAiTWF0aEpheC1TcGFuLSIgKyBqYXgucm9vdC5zcGFuSUQpICsgIi16b29tIjsKICAgICAgICB2YXIgY2hpbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuZmlyc3RDaGlsZDsKCiAgICAgICAgd2hpbGUgKGNoaWxkICYmIGNoaWxkLnN0eWxlLndpZHRoICE9PSB3aWR0aCkgewogICAgICAgICAgY2hpbGQgPSBjaGlsZC5uZXh0U2libGluZzsKICAgICAgICB9CgogICAgICAgIGlmIChjaGlsZCkgewogICAgICAgICAgdmFyIGN3aWR0aCA9IGNoaWxkLm9mZnNldFdpZHRoOwogICAgICAgICAgY2hpbGQuc3R5bGUud2lkdGggPSAiMTAwJSI7CgogICAgICAgICAgaWYgKGN3aWR0aCA+IE13KSB7CiAgICAgICAgICAgIHNwYW4uc3R5bGUud2lkdGggPSBjd2lkdGggKyAxMDAgKyAicHgiOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLwogICAgICAvLyAgQWRqdXN0IG1hcmdpbnMgdG8gcHJldmVudCBvdmVybGFwcyBhdCB0aGUgZWRnZXMKICAgICAgLy8KCgogICAgICBjaGlsZCA9IHNwYW4uZmlyc3RDaGlsZC5maXJzdENoaWxkLnN0eWxlOwoKICAgICAgaWYgKGJib3guSCAhPSBudWxsICYmIGJib3guSCA+IGJib3guaCkgewogICAgICAgIGNoaWxkLm1hcmdpblRvcCA9IEhUTUxDU1MuRW0oYmJveC5IIC0gTWF0aC5tYXgoYmJveC5oLCBIVE1MQ1NTLkZPTlREQVRBLmxpbmVIKSk7CiAgICAgIH0KCiAgICAgIGlmIChiYm94LkQgIT0gbnVsbCAmJiBiYm94LkQgPiBiYm94LmQpIHsKICAgICAgICBjaGlsZC5tYXJnaW5Cb3R0b20gPSBIVE1MQ1NTLkVtKGJib3guRCAtIE1hdGgubWF4KGJib3guZCwgSFRNTENTUy5GT05UREFUQS5saW5lRCkpOwogICAgICB9CgogICAgICBpZiAoYmJveC5sdyA8IDApIHsKICAgICAgICBjaGlsZC5wYWRkaW5nTGVmdCA9IEhUTUxDU1MuRW0oLWJib3gubHcpOwogICAgICB9CgogICAgICBpZiAoYmJveC5ydyA+IGJib3gudykgewogICAgICAgIGNoaWxkLm1hcmdpblJpZ2h0ID0gSFRNTENTUy5FbShiYm94LnJ3IC0gYmJveC53KTsKICAgICAgfSAvLwogICAgICAvLyAgR2V0IGhlaWdodCBhbmQgd2lkdGggb2Ygem9vbWVkIG1hdGggYW5kIG9yaWdpbmFsIG1hdGgKICAgICAgLy8KCgogICAgICBzcGFuLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKCiAgICAgIGlmICghd2lkdGgpIHsKICAgICAgICBtYXRoLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgICAgfQoKICAgICAgdmFyIHpXID0gc3Bhbi5vZmZzZXRXaWR0aCwKICAgICAgICAgIHpIID0gc3Bhbi5vZmZzZXRIZWlnaHQsCiAgICAgICAgICBtSCA9IG1hdGgub2Zmc2V0SGVpZ2h0LAogICAgICAgICAgbVcgPSBtYXRoLm9mZnNldFdpZHRoOwogICAgICBzcGFuLnN0eWxlLnBvc2l0aW9uID0gbWF0aC5zdHlsZS5wb3NpdGlvbiA9ICIiOyAvLwoKICAgICAgcmV0dXJuIHsKICAgICAgICBZOiAtRVZFTlQuZ2V0QkJveChzcGFuKS5oLAogICAgICAgIG1XOiBtVywKICAgICAgICBtSDogbUgsCiAgICAgICAgelc6IHpXLAogICAgICAgIHpIOiB6SAogICAgICB9OwogICAgfSwKICAgIGluaXRJbWc6IGZ1bmN0aW9uIGluaXRJbWcoc3Bhbikge30sCiAgICBpbml0SFRNTDogZnVuY3Rpb24gaW5pdEhUTUwobWF0aCwgc3Bhbikge30sCiAgICBpbml0Rm9udDogZnVuY3Rpb24gaW5pdEZvbnQobmFtZSkgewogICAgICB2YXIgRk9OVFMgPSBIVE1MQ1NTLkZPTlREQVRBLkZPTlRTLAogICAgICAgICAgQVZBSUwgPSBIVE1MQ1NTLmNvbmZpZy5hdmFpbGFibGVGb250czsKCiAgICAgIGlmIChBVkFJTCAmJiBBVkFJTC5sZW5ndGggJiYgSFRNTENTUy5Gb250LnRlc3RGb250KEZPTlRTW25hbWVdKSkgewogICAgICAgIEZPTlRTW25hbWVdLmF2YWlsYWJsZSA9IHRydWU7CgogICAgICAgIGlmIChGT05UU1tuYW1lXS5mYW1pbHlGaXhlZCkgewogICAgICAgICAgRk9OVFNbbmFtZV0uZmFtaWx5ID0gRk9OVFNbbmFtZV0uZmFtaWx5Rml4ZWQ7CiAgICAgICAgICBkZWxldGUgRk9OVFNbbmFtZV0uZmFtaWx5Rml4ZWQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLmFsbG93V2ViRm9udHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgRk9OVFNbbmFtZV0uaXNXZWJGb250ID0gdHJ1ZTsKCiAgICAgIGlmIChIVE1MQ1NTLkZvbnRGYWNlQnVnKSB7CiAgICAgICAgRk9OVFNbbmFtZV0uZmFtaWx5ID0gbmFtZTsKCiAgICAgICAgaWYgKEhUTUxDU1MubXNpZUZvbnRDU1NCdWcpIHsKICAgICAgICAgIEZPTlRTW25hbWVdLmZhbWlseSArPSAiLVdlYiI7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gQUpBWC5TdHlsZXMoewogICAgICAgICJAZm9udC1mYWNlIjogdGhpcy5Gb250LmZvbnRGYWNlKG5hbWUpCiAgICAgIH0pOwogICAgfSwKICAgIFJlbW92ZTogZnVuY3Rpb24gUmVtb3ZlKGpheCkgewogICAgICB2YXIgc3BhbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGpheC5pbnB1dElEICsgIi1GcmFtZSIpOwoKICAgICAgaWYgKHNwYW4pIHsKICAgICAgICBpZiAoamF4LkhUTUxDU1MuZGlzcGxheSkgewogICAgICAgICAgc3BhbiA9IHNwYW4ucGFyZW50Tm9kZTsKICAgICAgICB9CgogICAgICAgIHNwYW4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzcGFuKTsKICAgICAgfQoKICAgICAgZGVsZXRlIGpheC5IVE1MQ1NTOwogICAgfSwKICAgIGdldEhEOiBmdW5jdGlvbiBnZXRIRChzcGFuLCBmb3JjZSkgewogICAgICBpZiAoc3Bhbi5iYm94ICYmIHRoaXMuY29uZmlnLm5vUmVmbG93cyAmJiAhZm9yY2UpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaDogc3Bhbi5iYm94LmgsCiAgICAgICAgICBkOiBzcGFuLmJib3guZAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHZhciBwb3NpdGlvbiA9IHNwYW4uc3R5bGUucG9zaXRpb247CiAgICAgIHNwYW4uc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICB0aGlzLkhEaW1nLnN0eWxlLmhlaWdodCA9ICIwcHgiOwogICAgICBzcGFuLmFwcGVuZENoaWxkKHRoaXMuSERzcGFuKTsKICAgICAgdmFyIEhEID0gewogICAgICAgIGg6IHNwYW4ub2Zmc2V0SGVpZ2h0CiAgICAgIH07CiAgICAgIHRoaXMuSERpbWcuc3R5bGUuaGVpZ2h0ID0gSEQuaCArICJweCI7CiAgICAgIEhELmQgPSBzcGFuLm9mZnNldEhlaWdodCAtIEhELmg7CiAgICAgIEhELmggLT0gSEQuZDsKICAgICAgSEQuaCAvPSB0aGlzLmVtOwogICAgICBIRC5kIC89IHRoaXMuZW07CiAgICAgIHNwYW4ucmVtb3ZlQ2hpbGQodGhpcy5IRHNwYW4pOwogICAgICBzcGFuLnN0eWxlLnBvc2l0aW9uID0gcG9zaXRpb247CiAgICAgIHJldHVybiBIRDsKICAgIH0sCiAgICBnZXRXOiBmdW5jdGlvbiBnZXRXKHNwYW4pIHsKICAgICAgdmFyIFcsCiAgICAgICAgICBILAogICAgICAgICAgdyA9IChzcGFuLmJib3ggfHwge30pLncsCiAgICAgICAgICBzdGFydCA9IHNwYW47CgogICAgICBpZiAoc3Bhbi5iYm94ICYmIHRoaXMuY29uZmlnLm5vUmVmbG93cyAmJiBzcGFuLmJib3guZXhhY3RXICE9PSBmYWxzZSkgewogICAgICAgIGlmICghc3Bhbi5iYm94LmV4YWN0VykgewogICAgICAgICAgaWYgKHNwYW4uc3R5bGUucGFkZGluZ0xlZnQpIHcgKz0gdGhpcy51bkVtKHNwYW4uc3R5bGUucGFkZGluZ0xlZnQpICogKHNwYW4uc2NhbGUgfHwgMSk7CiAgICAgICAgICBpZiAoc3Bhbi5zdHlsZS5wYWRkaW5nUmlnaHQpIHcgKz0gdGhpcy51bkVtKHNwYW4uc3R5bGUucGFkZGluZ1JpZ2h0KSAqIChzcGFuLnNjYWxlIHx8IDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHc7CiAgICAgIH0KCiAgICAgIGlmIChzcGFuLmJib3ggJiYgc3Bhbi5iYm94LmV4YWN0VykgewogICAgICAgIHJldHVybiB3OwogICAgICB9CgogICAgICBpZiAoc3Bhbi5iYm94ICYmIHcgPj0gMCAmJiAhdGhpcy5pbml0aWFsU2tpcEJ1ZyAmJiAhdGhpcy5tc2llSXRhbGljV2lkdGhCdWcgfHwgdGhpcy5uZWdhdGl2ZUJCb3hlcyB8fCAhc3Bhbi5maXJzdENoaWxkKSB7CiAgICAgICAgVyA9IHNwYW4ub2Zmc2V0V2lkdGg7CiAgICAgICAgSCA9IHNwYW4ucGFyZW50Tm9kZS5vZmZzZXRIZWlnaHQ7CiAgICAgIH0gZWxzZSBpZiAoc3Bhbi5iYm94ICYmIHcgPCAwICYmIHRoaXMubXNpZU5lZ2F0aXZlQkJveEJ1ZykgewogICAgICAgIFcgPSAtc3Bhbi5vZmZzZXRXaWR0aCwgSCA9IHNwYW4ucGFyZW50Tm9kZS5vZmZzZXRIZWlnaHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gSUUgY2FuJ3QgZGVhbCB3aXRoIGEgc3BhY2UgYXQgdGhlIGJlZ2lubmluZywgc28gcHV0IHNvbWV0aGluZyBlbHNlIGZpcnN0CiAgICAgICAgdmFyIHBvc2l0aW9uID0gc3Bhbi5zdHlsZS5wb3NpdGlvbjsKICAgICAgICBzcGFuLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgICAgICBzdGFydCA9IHRoaXMuc3RhcnRNYXJrZXI7CiAgICAgICAgc3Bhbi5pbnNlcnRCZWZvcmUoc3RhcnQsIHNwYW4uZmlyc3RDaGlsZCk7CiAgICAgICAgc3Bhbi5hcHBlbmRDaGlsZCh0aGlzLmVuZE1hcmtlcik7CiAgICAgICAgVyA9IHRoaXMuZW5kTWFya2VyLm9mZnNldExlZnQgLSBzdGFydC5vZmZzZXRMZWZ0OwogICAgICAgIHNwYW4ucmVtb3ZlQ2hpbGQodGhpcy5lbmRNYXJrZXIpOwogICAgICAgIHNwYW4ucmVtb3ZlQ2hpbGQoc3RhcnQpOwogICAgICAgIHNwYW4uc3R5bGUucG9zaXRpb24gPSBwb3NpdGlvbjsKICAgICAgfQoKICAgICAgaWYgKEggIT0gbnVsbCkgewogICAgICAgIHNwYW4ucGFyZW50Tm9kZS5ISCA9IEggLyB0aGlzLmVtOwogICAgICB9CgogICAgICByZXR1cm4gVyAvIHRoaXMuZW07CiAgICB9LAogICAgTWVhc3VyZWQ6IGZ1bmN0aW9uIE1lYXN1cmVkKHNwYW4sIHBhcmVudCkgewogICAgICB2YXIgYmJveCA9IHNwYW4uYmJveDsKCiAgICAgIGlmIChiYm94LndpZHRoID09IG51bGwgJiYgYmJveC53ICYmICFiYm94LmlzTXVsdGlsaW5lKSB7CiAgICAgICAgdmFyIHcgPSB0aGlzLmdldFcoc3Bhbik7CiAgICAgICAgYmJveC5ydyArPSB3IC0gYmJveC53OwogICAgICAgIGJib3gudyA9IHc7CiAgICAgICAgYmJveC5leGFjdFcgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAoIXBhcmVudCkgewogICAgICAgIHBhcmVudCA9IHNwYW4ucGFyZW50Tm9kZTsKICAgICAgfQoKICAgICAgaWYgKCFwYXJlbnQuYmJveCkgewogICAgICAgIHBhcmVudC5iYm94ID0gYmJveDsKICAgICAgfQoKICAgICAgcmV0dXJuIHNwYW47CiAgICB9LAogICAgUmVtZWFzdXJlZDogZnVuY3Rpb24gUmVtZWFzdXJlZChzcGFuLCBwYXJlbnQpIHsKICAgICAgcGFyZW50LmJib3ggPSB0aGlzLk1lYXN1cmVkKHNwYW4sIHBhcmVudCkuYmJveDsKICAgIH0sCiAgICBNZWFzdXJlU3BhbnM6IGZ1bmN0aW9uIE1lYXN1cmVTcGFucyhTUEFOUykgewogICAgICB2YXIgc3BhbnMgPSBbXSwKICAgICAgICAgIHNwYW4sCiAgICAgICAgICBpLAogICAgICAgICAgbSwKICAgICAgICAgIGJib3gsCiAgICAgICAgICBzdGFydCwKICAgICAgICAgIGVuZCwKICAgICAgICAgIFcsCiAgICAgICAgICBwYXJlbnQ7IC8vCiAgICAgIC8vICBJbnNlcnQgdGhlIG5lZWRlZCBtYXJrZXJzCiAgICAgIC8vIAoKICAgICAgZm9yIChpID0gMCwgbSA9IFNQQU5TLmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgIHNwYW4gPSBTUEFOU1tpXTsKICAgICAgICBpZiAoIXNwYW4pIGNvbnRpbnVlOwogICAgICAgIGJib3ggPSBzcGFuLmJib3g7CiAgICAgICAgcGFyZW50ID0gdGhpcy5wYXJlbnROb2RlKHNwYW4pOwoKICAgICAgICBpZiAoYmJveC5leGFjdFcgfHwgYmJveC53aWR0aCB8fCBiYm94LncgPT09IDAgfHwgYmJveC5pc011bHRpbGluZSB8fCB0aGlzLmNvbmZpZy5ub1JlZmxvd3MgJiYgYmJveC5leGFjdFcgIT09IGZhbHNlKSB7CiAgICAgICAgICBpZiAoIXBhcmVudC5iYm94KSB7CiAgICAgICAgICAgIHBhcmVudC5iYm94ID0gYmJveDsKICAgICAgICAgIH0KCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLm5lZ2F0aXZlQkJveGVzIHx8ICFzcGFuLmZpcnN0Q2hpbGQgfHwgYmJveC53ID49IDAgJiYgIXRoaXMuaW5pdGlhbFNraXBCdWcgfHwgYmJveC53IDwgMCAmJiB0aGlzLm1zaWVOZWdhdGl2ZUJCb3hCdWcpIHsKICAgICAgICAgIHNwYW5zLnB1c2goW3NwYW5dKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaW5pdGlhbFNraXBCdWcpIHsKICAgICAgICAgIHN0YXJ0ID0gdGhpcy5zdGFydE1hcmtlci5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICBlbmQgPSB0aGlzLmVuZE1hcmtlci5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICBzcGFuLmluc2VydEJlZm9yZShzdGFydCwgc3Bhbi5maXJzdENoaWxkKTsKICAgICAgICAgIHNwYW4uYXBwZW5kQ2hpbGQoZW5kKTsKICAgICAgICAgIHNwYW5zLnB1c2goW3NwYW4sIHN0YXJ0LCBlbmQsIHNwYW4uc3R5bGUucG9zaXRpb25dKTsKICAgICAgICAgIHNwYW4uc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbmQgPSB0aGlzLmVuZE1hcmtlci5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICBzcGFuLmFwcGVuZENoaWxkKGVuZCk7CiAgICAgICAgICBzcGFucy5wdXNoKFtzcGFuLCBudWxsLCBlbmRdKTsKICAgICAgICB9CiAgICAgIH0gLy8KICAgICAgLy8gIFJlYWQgdGhlIHdpZHRocyBhbmQgaGVpZ2h0cwogICAgICAvLwoKCiAgICAgIGZvciAoaSA9IDAsIG0gPSBzcGFucy5sZW5ndGg7IGkgPCBtOyBpKyspIHsKICAgICAgICBzcGFuID0gc3BhbnNbaV1bMF07CiAgICAgICAgYmJveCA9IHNwYW4uYmJveDsKICAgICAgICBwYXJlbnQgPSB0aGlzLnBhcmVudE5vZGUoc3Bhbik7CgogICAgICAgIGlmIChiYm94LncgPj0gMCAmJiAhdGhpcy5pbml0aWFsU2tpcEJ1ZyB8fCB0aGlzLm5lZ2F0aXZlQkJveGVzIHx8ICFzcGFuLmZpcnN0Q2hpbGQpIHsKICAgICAgICAgIFcgPSBzcGFuLm9mZnNldFdpZHRoOwogICAgICAgICAgcGFyZW50LkhIID0gcGFyZW50Lm9mZnNldEhlaWdodCAvIHRoaXMuZW07CiAgICAgICAgfSBlbHNlIGlmIChiYm94LncgPCAwICYmIHRoaXMubXNpZU5lZ2F0aXZlQkJveEJ1ZykgewogICAgICAgICAgVyA9IC1zcGFuLm9mZnNldFdpZHRoLCBwYXJlbnQuSEggPSBwYXJlbnQub2Zmc2V0SGVpZ2h0IC8gdGhpcy5lbTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgVyA9IHNwYW5zW2ldWzJdLm9mZnNldExlZnQgLSAoKHNwYW5zW2ldWzFdIHx8IHt9KS5vZmZzZXRMZWZ0IHx8IDApOwogICAgICAgIH0KCiAgICAgICAgVyAvPSB0aGlzLmVtOwogICAgICAgIGJib3gucncgKz0gVyAtIGJib3gudzsKICAgICAgICBiYm94LncgPSBXOwogICAgICAgIGJib3guZXhhY3RXID0gdHJ1ZTsKCiAgICAgICAgaWYgKCFwYXJlbnQuYmJveCkgewogICAgICAgICAgcGFyZW50LmJib3ggPSBiYm94OwogICAgICAgIH0KICAgICAgfSAvLwogICAgICAvLyAgUmVtb3ZlIG1hcmtlcnMKICAgICAgLy8KCgogICAgICBmb3IgKGkgPSAwLCBtID0gc3BhbnMubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgc3BhbiA9IHNwYW5zW2ldOwoKICAgICAgICBpZiAoc3BhblsxXSkgewogICAgICAgICAgc3BhblsxXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNwYW5bMV0pLCBzcGFuWzBdLnN0eWxlLnBvc2l0aW9uID0gc3BhblszXTsKICAgICAgICB9CgogICAgICAgIGlmIChzcGFuWzJdKSB7CiAgICAgICAgICBzcGFuWzJdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc3BhblsyXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgRW06IGZ1bmN0aW9uIEVtKG0pIHsKICAgICAgaWYgKE1hdGguYWJzKG0pIDwgLjAwMDYpIHsKICAgICAgICByZXR1cm4gIjBlbSI7CiAgICAgIH0KCiAgICAgIHJldHVybiBtLnRvRml4ZWQoMykucmVwbGFjZSgvXC4/MCskLywgIiIpICsgImVtIjsKICAgIH0sCiAgICBFbVJvdW5kZWQ6IGZ1bmN0aW9uIEVtUm91bmRlZChtKSB7CiAgICAgIG0gPSAoTWF0aC5yb3VuZChtICogSFRNTENTUy5lbSkgKyAuMDUpIC8gSFRNTENTUy5lbTsKCiAgICAgIGlmIChNYXRoLmFicyhtKSA8IC4wMDA2KSB7CiAgICAgICAgcmV0dXJuICIwZW0iOwogICAgICB9CgogICAgICByZXR1cm4gbS50b0ZpeGVkKDMpLnJlcGxhY2UoL1wuPzArJC8sICIiKSArICJlbSI7CiAgICB9LAogICAgdW5FbTogZnVuY3Rpb24gdW5FbShtKSB7CiAgICAgIHJldHVybiBwYXJzZUZsb2F0KG0pOwogICAgfSwKICAgIFB4OiBmdW5jdGlvbiBQeChtKSB7CiAgICAgIG0gKj0gdGhpcy5lbTsKICAgICAgdmFyIHMgPSBtIDwgMCA/ICItIiA6ICIiOwogICAgICByZXR1cm4gcyArIE1hdGguYWJzKG0pLnRvRml4ZWQoMSkucmVwbGFjZSgvXC4/MCskLywgIiIpICsgInB4IjsKICAgIH0sCiAgICB1blB4OiBmdW5jdGlvbiB1blB4KG0pIHsKICAgICAgcmV0dXJuIHBhcnNlRmxvYXQobSkgLyB0aGlzLmVtOwogICAgfSwKICAgIFBlcmNlbnQ6IGZ1bmN0aW9uIFBlcmNlbnQobSkgewogICAgICByZXR1cm4gKDEwMCAqIG0pLnRvRml4ZWQoMSkucmVwbGFjZSgvXC4/MCskLywgIiIpICsgIiUiOwogICAgfSwKICAgIGxlbmd0aDJlbTogZnVuY3Rpb24gbGVuZ3RoMmVtKGxlbmd0aCwgbXUsIHNpemUpIHsKICAgICAgaWYgKHR5cGVvZiBsZW5ndGggIT09ICJzdHJpbmciKSB7CiAgICAgICAgbGVuZ3RoID0gbGVuZ3RoLnRvU3RyaW5nKCk7CiAgICAgIH0KCiAgICAgIGlmIChsZW5ndGggPT09ICIiKSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CgogICAgICBpZiAobGVuZ3RoID09PSBNTUwuU0laRS5OT1JNQUwpIHsKICAgICAgICByZXR1cm4gMTsKICAgICAgfQoKICAgICAgaWYgKGxlbmd0aCA9PT0gTU1MLlNJWkUuQklHKSB7CiAgICAgICAgcmV0dXJuIDI7CiAgICAgIH0KCiAgICAgIGlmIChsZW5ndGggPT09IE1NTC5TSVpFLlNNQUxMKSB7CiAgICAgICAgcmV0dXJuIC43MTsKICAgICAgfQoKICAgICAgaWYgKGxlbmd0aCA9PT0gImluZmluaXR5IikgewogICAgICAgIHJldHVybiBIVE1MQ1NTLkJJR0RJTUVOOwogICAgICB9CgogICAgICB2YXIgZmFjdG9yID0gdGhpcy5GT05UREFUQS5UZVhfZmFjdG9yLAogICAgICAgICAgZW1GYWN0b3IgPSAoSFRNTENTUy56b29tU2NhbGUgfHwgMSkgLyBIVE1MQ1NTLmVtOwoKICAgICAgaWYgKGxlbmd0aC5tYXRjaCgvbWF0aHNwYWNlJC8pKSB7CiAgICAgICAgcmV0dXJuIEhUTUxDU1MuTUFUSFNQQUNFW2xlbmd0aF0gKiBmYWN0b3I7CiAgICAgIH0KCiAgICAgIHZhciBtYXRjaCA9IGxlbmd0aC5tYXRjaCgvXlxzKihbLStdPyg/OlwuXGQrfFxkKyg/OlwuXGQqKT8pKT8ocHR8ZW18ZXh8bXV8cHh8cGN8aW58bW18Y218JSk/Lyk7CiAgICAgIHZhciBtID0gcGFyc2VGbG9hdChtYXRjaFsxXSB8fCAiMSIpLAogICAgICAgICAgdW5pdCA9IG1hdGNoWzJdOwoKICAgICAgaWYgKHNpemUgPT0gbnVsbCkgewogICAgICAgIHNpemUgPSAxOwogICAgICB9CgogICAgICA7CgogICAgICBpZiAobXUgPT0gbnVsbCkgewogICAgICAgIG11ID0gMTsKICAgICAgfQoKICAgICAgaWYgKHVuaXQgPT09ICJlbSIpIHsKICAgICAgICByZXR1cm4gbSAqIGZhY3RvcjsKICAgICAgfQoKICAgICAgaWYgKHVuaXQgPT09ICJleCIpIHsKICAgICAgICByZXR1cm4gbSAqIEhUTUxDU1MuVGVYLnhfaGVpZ2h0ICogZmFjdG9yOwogICAgICB9CgogICAgICBpZiAodW5pdCA9PT0gIiUiKSB7CiAgICAgICAgcmV0dXJuIG0gLyAxMDAgKiBzaXplOwogICAgICB9CgogICAgICBpZiAodW5pdCA9PT0gInB4IikgewogICAgICAgIHJldHVybiBtICogZW1GYWN0b3I7CiAgICAgIH0KCiAgICAgIGlmICh1bml0ID09PSAicHQiKSB7CiAgICAgICAgcmV0dXJuIG0gLyAxMCAqIGZhY3RvcjsKICAgICAgfSAvLyAxMCBwdCB0byBhbiBlbQoKCiAgICAgIGlmICh1bml0ID09PSAicGMiKSB7CiAgICAgICAgcmV0dXJuIG0gKiAxLjIgKiBmYWN0b3I7CiAgICAgIH0gLy8gMTIgcHQgdG8gYSBwYwoKCiAgICAgIGlmICh1bml0ID09PSAiaW4iKSB7CiAgICAgICAgcmV0dXJuIG0gKiB0aGlzLnB4UGVySW5jaCAqIGVtRmFjdG9yOwogICAgICB9CgogICAgICBpZiAodW5pdCA9PT0gImNtIikgewogICAgICAgIHJldHVybiBtICogdGhpcy5weFBlckluY2ggKiBlbUZhY3RvciAvIDIuNTQ7CiAgICAgIH0gLy8gMi41NCBjbSB0byBhbiBpbmNoCgoKICAgICAgaWYgKHVuaXQgPT09ICJtbSIpIHsKICAgICAgICByZXR1cm4gbSAqIHRoaXMucHhQZXJJbmNoICogZW1GYWN0b3IgLyAyNS40OwogICAgICB9IC8vIDEwIG1tIHRvIGEgY20KCgogICAgICBpZiAodW5pdCA9PT0gIm11IikgewogICAgICAgIHJldHVybiBtIC8gMTggKiBmYWN0b3IgKiBtdTsKICAgICAgfSAvLyAxOG11IHRvIGFuIGVtIGZvciB0aGUgc2NyaXB0bGV2ZWwKCgogICAgICByZXR1cm4gbSAqIHNpemU7IC8vIHJlbGF0aXZlIHRvIGdpdmVuIHNpemUgKG9yIDFlbSBhcyBkZWZhdWx0KQogICAgfSwKICAgIHRoaWNrbmVzczJlbTogZnVuY3Rpb24gdGhpY2tuZXNzMmVtKGxlbmd0aCwgbXUpIHsKICAgICAgdmFyIHRoaWNrID0gSFRNTENTUy5UZVgucnVsZV90aGlja25lc3M7CgogICAgICBpZiAobGVuZ3RoID09PSBNTUwuTElORVRISUNLTkVTUy5NRURJVU0pIHsKICAgICAgICByZXR1cm4gdGhpY2s7CiAgICAgIH0KCiAgICAgIGlmIChsZW5ndGggPT09IE1NTC5MSU5FVEhJQ0tORVNTLlRISU4pIHsKICAgICAgICByZXR1cm4gLjY3ICogdGhpY2s7CiAgICAgIH0KCiAgICAgIGlmIChsZW5ndGggPT09IE1NTC5MSU5FVEhJQ0tORVNTLlRISUNLKSB7CiAgICAgICAgcmV0dXJuIDEuNjcgKiB0aGljazsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoMmVtKGxlbmd0aCwgbXUsIHRoaWNrKTsKICAgIH0sCiAgICBnZXRQYWRkaW5nOiBmdW5jdGlvbiBnZXRQYWRkaW5nKHNwYW4pIHsKICAgICAgdmFyIHBhZGRpbmcgPSB7CiAgICAgICAgdG9wOiAwLAogICAgICAgIHJpZ2h0OiAwLAogICAgICAgIGJvdHRvbTogMCwKICAgICAgICBsZWZ0OiAwCiAgICAgIH0sCiAgICAgICAgICBoYXMgPSBmYWxzZTsKCiAgICAgIGZvciAodmFyIGlkIGluIHBhZGRpbmcpIHsKICAgICAgICBpZiAocGFkZGluZy5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgIHZhciBwYWQgPSBzcGFuLnN0eWxlWyJwYWRkaW5nIiArIGlkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgaWQuc3Vic3RyKDEpXTsKCiAgICAgICAgICBpZiAocGFkKSB7CiAgICAgICAgICAgIHBhZGRpbmdbaWRdID0gdGhpcy5sZW5ndGgyZW0ocGFkKTsKICAgICAgICAgICAgaGFzID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBoYXMgPyBwYWRkaW5nIDogZmFsc2U7CiAgICB9LAogICAgZ2V0Qm9yZGVyczogZnVuY3Rpb24gZ2V0Qm9yZGVycyhzcGFuKSB7CiAgICAgIHZhciBib3JkZXIgPSB7CiAgICAgICAgdG9wOiAwLAogICAgICAgIHJpZ2h0OiAwLAogICAgICAgIGJvdHRvbTogMCwKICAgICAgICBsZWZ0OiAwCiAgICAgIH0sCiAgICAgICAgICBjc3MgPSB7fSwKICAgICAgICAgIGhhcyA9IGZhbHNlOwoKICAgICAgZm9yICh2YXIgaWQgaW4gYm9yZGVyKSB7CiAgICAgICAgaWYgKGJvcmRlci5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgIHZhciBJRCA9ICJib3JkZXIiICsgaWQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBpZC5zdWJzdHIoMSk7CiAgICAgICAgICB2YXIgc3R5bGUgPSBzcGFuLnN0eWxlW0lEICsgIlN0eWxlIl07CgogICAgICAgICAgaWYgKHN0eWxlKSB7CiAgICAgICAgICAgIGhhcyA9IHRydWU7CiAgICAgICAgICAgIGJvcmRlcltpZF0gPSB0aGlzLmxlbmd0aDJlbShzcGFuLnN0eWxlW0lEICsgIldpZHRoIl0pOwogICAgICAgICAgICBjc3NbSURdID0gW3NwYW4uc3R5bGVbSUQgKyAiV2lkdGgiXSwgc3Bhbi5zdHlsZVtJRCArICJTdHlsZSJdLCBzcGFuLnN0eWxlW0lEICsgIkNvbG9yIl1dLmpvaW4oIiAiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGJvcmRlci5jc3MgPSBjc3M7CiAgICAgIHJldHVybiBoYXMgPyBib3JkZXIgOiBmYWxzZTsKICAgIH0sCiAgICBzZXRCb3JkZXJzOiBmdW5jdGlvbiBzZXRCb3JkZXJzKHNwYW4sIGJvcmRlcnMpIHsKICAgICAgaWYgKGJvcmRlcnMpIHsKICAgICAgICBmb3IgKHZhciBpZCBpbiBib3JkZXJzLmNzcykgewogICAgICAgICAgaWYgKGJvcmRlcnMuY3NzLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgICAgICBzcGFuLnN0eWxlW2lkXSA9IGJvcmRlcnMuY3NzW2lkXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVTdHJ1dDogZnVuY3Rpb24gY3JlYXRlU3RydXQoc3BhbiwgaCwgYmVmb3JlKSB7CiAgICAgIHZhciBzdHJ1dCA9IHRoaXMuRWxlbWVudCgic3BhbiIsIHsKICAgICAgICBpc01hdGhKYXg6IHRydWUsCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUtYmxvY2siLAogICAgICAgICAgb3ZlcmZsb3c6ICJoaWRkZW4iLAogICAgICAgICAgaGVpZ2h0OiBoICsgInB4IiwKICAgICAgICAgIHdpZHRoOiAiMXB4IiwKICAgICAgICAgIG1hcmdpblJpZ2h0OiAiLTFweCIKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgaWYgKGJlZm9yZSkgewogICAgICAgIHNwYW4uaW5zZXJ0QmVmb3JlKHN0cnV0LCBzcGFuLmZpcnN0Q2hpbGQpOwogICAgICB9IGVsc2UgewogICAgICAgIHNwYW4uYXBwZW5kQ2hpbGQoc3RydXQpOwogICAgICB9CgogICAgICByZXR1cm4gc3RydXQ7CiAgICB9LAogICAgY3JlYXRlQmxhbms6IGZ1bmN0aW9uIGNyZWF0ZUJsYW5rKHNwYW4sIHcsIGJlZm9yZSkgewogICAgICB2YXIgYmxhbmsgPSB0aGlzLkVsZW1lbnQoInNwYW4iLCB7CiAgICAgICAgaXNNYXRoSmF4OiB0cnVlLAogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lLWJsb2NrIiwKICAgICAgICAgIG92ZXJmbG93OiAiaGlkZGVuIiwKICAgICAgICAgIGhlaWdodDogIjFweCIsCiAgICAgICAgICB3aWR0aDogdGhpcy5FbSh3KQogICAgICAgIH0KICAgICAgfSk7CgogICAgICBpZiAodyA8IDApIHsKICAgICAgICBibGFuay5zdHlsZS5tYXJnaW5SaWdodCA9IGJsYW5rLnN0eWxlLndpZHRoOwogICAgICAgIGJsYW5rLnN0eWxlLndpZHRoID0gMDsKICAgICAgfQoKICAgICAgaWYgKGJlZm9yZSkgewogICAgICAgIHNwYW4uaW5zZXJ0QmVmb3JlKGJsYW5rLCBzcGFuLmZpcnN0Q2hpbGQpOwogICAgICB9IGVsc2UgewogICAgICAgIHNwYW4uYXBwZW5kQ2hpbGQoYmxhbmspOwogICAgICB9CgogICAgICByZXR1cm4gYmxhbms7CiAgICB9LAogICAgY3JlYXRlU2hpZnQ6IGZ1bmN0aW9uIGNyZWF0ZVNoaWZ0KHNwYW4sIHcsIGJlZm9yZSkgewogICAgICB2YXIgc3BhY2UgPSB0aGlzLkVsZW1lbnQoInNwYW4iLCB7CiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIG1hcmdpbkxlZnQ6IHRoaXMuRW0odykKICAgICAgICB9LAogICAgICAgIGlzTWF0aEpheDogdHJ1ZQogICAgICB9KTsKCiAgICAgIGlmIChiZWZvcmUpIHsKICAgICAgICBzcGFuLmluc2VydEJlZm9yZShzcGFjZSwgc3Bhbi5maXJzdENoaWxkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzcGFuLmFwcGVuZENoaWxkKHNwYWNlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNwYWNlOwogICAgfSwKICAgIGNyZWF0ZVNwYWNlOiBmdW5jdGlvbiBjcmVhdGVTcGFjZShzcGFuLCBoLCBkLCB3LCBjb2xvciwgaXNTcGFjZSkgewogICAgICBpZiAoaCA8IC1kKSB7CiAgICAgICAgZCA9IC1oOwogICAgICB9IC8vIG1ha2Ugc3VyZSBoIGlzIGFib3ZlIGQKCgogICAgICB2YXIgSCA9IHRoaXMuRW0oaCArIGQpLAogICAgICAgICAgRCA9IHRoaXMuRW0oLWQpOwoKICAgICAgaWYgKHRoaXMubXNpZUlubGluZUJsb2NrQWxpZ25CdWcpIHsKICAgICAgICBEID0gdGhpcy5FbShIVE1MQ1NTLmdldEhEKHNwYW4ucGFyZW50Tm9kZSwgdHJ1ZSkuZCAtIGQpOwogICAgICB9CgogICAgICBpZiAoc3Bhbi5pc0JveCB8fCBpc1NwYWNlKSB7CiAgICAgICAgdmFyIHNjYWxlID0gc3Bhbi5zY2FsZSA9PSBudWxsID8gMSA6IHNwYW4uc2NhbGU7CiAgICAgICAgc3Bhbi5iYm94ID0gewogICAgICAgICAgZXhhY3RXOiB0cnVlLAogICAgICAgICAgaDogaCAqIHNjYWxlLAogICAgICAgICAgZDogZCAqIHNjYWxlLAogICAgICAgICAgdzogdyAqIHNjYWxlLAogICAgICAgICAgcnc6IHcgKiBzY2FsZSwKICAgICAgICAgIGx3OiAwCiAgICAgICAgfTsKICAgICAgICBzcGFuLnN0eWxlLmhlaWdodCA9IEg7CiAgICAgICAgc3Bhbi5zdHlsZS52ZXJ0aWNhbEFsaWduID0gRDsKICAgICAgICBzcGFuLkhIID0gKGggKyBkKSAqIHNjYWxlOwogICAgICB9IGVsc2UgewogICAgICAgIHNwYW4gPSB0aGlzLmFkZEVsZW1lbnQoc3BhbiwgInNwYW4iLCB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBoZWlnaHQ6IEgsCiAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246IEQKICAgICAgICAgIH0sCiAgICAgICAgICBpc01hdGhKYXg6IHRydWUKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKHcgPj0gMCkgewogICAgICAgIHNwYW4uc3R5bGUud2lkdGggPSB0aGlzLkVtKHcpOwogICAgICAgIHNwYW4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwogICAgICAgIHNwYW4uc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsgLy8gZm9yIElFIGluIHF1aXJrcyBtb2RlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMubXNpZU5lZ2F0aXZlU3BhY2VCdWcpIHsKICAgICAgICAgIHNwYW4uc3R5bGUuaGVpZ2h0ID0gIiI7CiAgICAgICAgfQoKICAgICAgICBzcGFuLnN0eWxlLm1hcmdpbkxlZnQgPSB0aGlzLkVtKHcpOwoKICAgICAgICBpZiAoSFRNTENTUy5zYWZhcmlOZWdhdGl2ZVNwYWNlQnVnICYmIHNwYW4ucGFyZW50Tm9kZS5maXJzdENoaWxkID09IHNwYW4pIHsKICAgICAgICAgIHRoaXMuY3JlYXRlQmxhbmsoc3BhbiwgMCwgdHJ1ZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY29sb3IgJiYgY29sb3IgIT09IE1NTC5DT0xPUi5UUkFOU1BBUkVOVCkgewogICAgICAgIHNwYW4uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7CiAgICAgICAgc3Bhbi5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7IC8vIG1ha2Ugc3VyZSBpdCBjb3ZlcnMgZWFybGllciBpdGVtcwogICAgICB9CgogICAgICByZXR1cm4gc3BhbjsKICAgIH0sCiAgICBjcmVhdGVSdWxlOiBmdW5jdGlvbiBjcmVhdGVSdWxlKHNwYW4sIGgsIGQsIHcsIGNvbG9yKSB7CiAgICAgIGlmIChoIDwgLWQpIHsKICAgICAgICBkID0gLWg7CiAgICAgIH0gLy8gbWFrZSBzdXJlIGggaXMgYWJvdmUgZAoKCiAgICAgIHZhciBtaW4gPSBIVE1MQ1NTLlRlWC5taW5fcnVsZV90aGlja25lc3MsCiAgICAgICAgICBmID0gMTsgLy8gSWYgcnVsZSBpcyB2ZXJ5IHRoaW4sIG1ha2UgaXQgYXQgbGVhc3QgbWluX3J1bGVfdGhpY2tuZXNzIHNvIGl0IGRvZXNuJ3QgZGlzYXBwZWFyCgogICAgICBpZiAodyA+IDAgJiYgdyAqIHRoaXMuZW0gPCBtaW4pIHsKICAgICAgICB3ID0gbWluIC8gdGhpcy5lbTsKICAgICAgfQoKICAgICAgaWYgKGggKyBkID4gMCAmJiAoaCArIGQpICogdGhpcy5lbSA8IG1pbikgewogICAgICAgIGYgPSAxIC8gKGggKyBkKSAqIChtaW4gLyB0aGlzLmVtKTsKICAgICAgICBoICo9IGY7CiAgICAgICAgZCAqPSBmOwogICAgICB9CgogICAgICBpZiAoIWNvbG9yKSB7CiAgICAgICAgY29sb3IgPSAic29saWQiOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbG9yID0gInNvbGlkICIgKyBjb2xvcjsKICAgICAgfQoKICAgICAgdmFyIHN0eWxlID0gewogICAgICAgIGRpc3BsYXk6ICJpbmxpbmUtYmxvY2siLAogICAgICAgIG92ZXJmbG93OiAiaGlkZGVuIiwKICAgICAgICB2ZXJ0aWNhbEFsaWduOiB0aGlzLkVtKC1kKQogICAgICB9OwoKICAgICAgaWYgKHcgPiBoICsgZCkgewogICAgICAgIHN0eWxlLmJvcmRlclRvcCA9IHRoaXMuUHgoaCArIGQpICsgIiAiICsgY29sb3I7CiAgICAgICAgc3R5bGUud2lkdGggPSB0aGlzLkVtKHcpOwogICAgICAgIHN0eWxlLmhlaWdodCA9IHRoaXMubXNpZVJ1bGVCdWcgJiYgaCArIGQgPiAwID8gdGhpcy5FbShoICsgZCkgOiAwOwogICAgICB9IGVsc2UgewogICAgICAgIHN0eWxlLmJvcmRlckxlZnQgPSB0aGlzLlB4KHcpICsgIiAiICsgY29sb3I7CiAgICAgICAgc3R5bGUud2lkdGggPSB0aGlzLm1zaWVSdWxlQnVnICYmIHcgPiAwID8gdGhpcy5FbSh3KSA6IDA7CiAgICAgICAgc3R5bGUuaGVpZ2h0ID0gdGhpcy5FbShoICsgZCk7CiAgICAgIH0KCiAgICAgIHZhciBydWxlID0gdGhpcy5hZGRFbGVtZW50KHNwYW4sICJzcGFuIiwgewogICAgICAgIHN0eWxlOiBzdHlsZSwKICAgICAgICBub0FkanVzdDogdHJ1ZSwKICAgICAgICBISDogaCArIGQsCiAgICAgICAgaXNNYXRoSmF4OiB0cnVlLAogICAgICAgIGJib3g6IHsKICAgICAgICAgIGg6IGgsCiAgICAgICAgICBkOiBkLAogICAgICAgICAgdzogdywKICAgICAgICAgIHJ3OiB3LAogICAgICAgICAgbHc6IDAsCiAgICAgICAgICBleGFjdFc6IHRydWUKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgaWYgKHNwYW4uaXNCb3ggfHwgc3Bhbi5jbGFzc05hbWUgPT0gIm1zcGFjZSIpIHsKICAgICAgICBzcGFuLmJib3ggPSBydWxlLmJib3gsIHNwYW4uSEggPSBoICsgZDsKICAgICAgfQoKICAgICAgcmV0dXJuIHJ1bGU7CiAgICB9LAogICAgY3JlYXRlRnJhbWU6IGZ1bmN0aW9uIGNyZWF0ZUZyYW1lKHNwYW4sIGgsIGQsIHcsIHQsIHN0eWxlKSB7CiAgICAgIGlmIChoIDwgLWQpIHsKICAgICAgICBkID0gLWg7CiAgICAgIH0gLy8gbWFrZSBzdXJlIGggaXMgYWJvdmUgZAoKCiAgICAgIHZhciBUID0gMiAqIHQ7CgogICAgICBpZiAodGhpcy5tc2llRnJhbWVTaXplQnVnKSB7CiAgICAgICAgaWYgKHcgPCBUKSB7CiAgICAgICAgICB3ID0gVDsKICAgICAgICB9CgogICAgICAgIDsKCiAgICAgICAgaWYgKGggKyBkIDwgVCkgewogICAgICAgICAgaCA9IFQgLSBkOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMubXNpZUJvcmRlcldpZHRoQnVnKSB7CiAgICAgICAgVCA9IDA7CiAgICAgIH0KCiAgICAgIHZhciBIID0gdGhpcy5FbShoICsgZCAtIFQpLAogICAgICAgICAgRCA9IHRoaXMuRW0oLWQgLSB0KSwKICAgICAgICAgIFcgPSB0aGlzLkVtKHcgLSBUKTsKICAgICAgdmFyIEIgPSB0aGlzLlB4KHQpICsgIiAiICsgc3R5bGU7CiAgICAgIHZhciBmcmFtZSA9IHRoaXMuYWRkRWxlbWVudChzcGFuLCAic3BhbiIsIHsKICAgICAgICBzdHlsZTogewogICAgICAgICAgYm9yZGVyOiBCLAogICAgICAgICAgZGlzcGxheTogImlubGluZS1ibG9jayIsCiAgICAgICAgICBvdmVyZmxvdzogImhpZGRlbiIsCiAgICAgICAgICB3aWR0aDogVywKICAgICAgICAgIGhlaWdodDogSAogICAgICAgIH0sCiAgICAgICAgYmJveDogewogICAgICAgICAgaDogaCwKICAgICAgICAgIGQ6IGQsCiAgICAgICAgICB3OiB3LAogICAgICAgICAgcnc6IHcsCiAgICAgICAgICBsdzogMCwKICAgICAgICAgIGV4YWN0VzogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgbm9BZGp1c3Q6IHRydWUsCiAgICAgICAgSEg6IGggKyBkLAogICAgICAgIGlzTWF0aEpheDogdHJ1ZQogICAgICB9KTsKCiAgICAgIGlmIChEKSB7CiAgICAgICAgZnJhbWUuc3R5bGUudmVydGljYWxBbGlnbiA9IEQ7CiAgICAgIH0KCiAgICAgIHJldHVybiBmcmFtZTsKICAgIH0sCiAgICAvLwogICAgLy8gIEZpbmQgcGFyZW50IHNwYW4gKHNraXBwaW5nIG92ZXIgPGE+IHRhZ3MpCiAgICAvLwogICAgcGFyZW50Tm9kZTogZnVuY3Rpb24gcGFyZW50Tm9kZShzcGFuKSB7CiAgICAgIHZhciBwYXJlbnQgPSBzcGFuLnBhcmVudE5vZGU7CgogICAgICBpZiAocGFyZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJhIikgewogICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlOwogICAgICB9CgogICAgICByZXR1cm4gcGFyZW50OwogICAgfSwKICAgIGNyZWF0ZVN0YWNrOiBmdW5jdGlvbiBjcmVhdGVTdGFjayhzcGFuLCBub2Jib3gsIHcpIHsKICAgICAgaWYgKHRoaXMubXNpZVBhZGRpbmdXaWR0aEJ1ZykgewogICAgICAgIHRoaXMuY3JlYXRlU3RydXQoc3BhbiwgMCk7CiAgICAgIH0KCiAgICAgIHZhciByZWxhdGl2ZVcgPSBTdHJpbmcodykubWF0Y2goLyUkLyk7CiAgICAgIHZhciBXID0gIXJlbGF0aXZlVyAmJiB3ICE9IG51bGwgPyB3IDogMDsKICAgICAgc3BhbiA9IHRoaXMuYWRkRWxlbWVudChzcGFuLCAic3BhbiIsIHsKICAgICAgICBub0FkanVzdDogdHJ1ZSwKICAgICAgICBISDogMCwKICAgICAgICBpc01hdGhKYXg6IHRydWUsCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUtYmxvY2siLAogICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICB3aWR0aDogcmVsYXRpdmVXID8gIjEwMCUiIDogdGhpcy5FbShXKSwKICAgICAgICAgIGhlaWdodDogMAogICAgICAgIH0KICAgICAgfSk7CgogICAgICBpZiAoIW5vYmJveCkgewogICAgICAgIHNwYW4ucGFyZW50Tm9kZS5iYm94ID0gc3Bhbi5iYm94ID0gewogICAgICAgICAgZXhhY3RXOiB0cnVlLAogICAgICAgICAgaDogLXRoaXMuQklHRElNRU4sCiAgICAgICAgICBkOiAtdGhpcy5CSUdESU1FTiwKICAgICAgICAgIHc6IFcsCiAgICAgICAgICBsdzogdGhpcy5CSUdESU1FTiwKICAgICAgICAgIHJ3OiAhcmVsYXRpdmVXICYmIHcgIT0gbnVsbCA/IHcgOiAtdGhpcy5CSUdESU1FTgogICAgICAgIH07CgogICAgICAgIGlmIChyZWxhdGl2ZVcpIHsKICAgICAgICAgIHNwYW4uYmJveC53aWR0aCA9IHc7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gc3BhbjsKICAgIH0sCiAgICBjcmVhdGVCb3g6IGZ1bmN0aW9uIGNyZWF0ZUJveChzcGFuLCB3KSB7CiAgICAgIHZhciBib3ggPSB0aGlzLmFkZEVsZW1lbnQoc3BhbiwgInNwYW4iLCB7CiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiCiAgICAgICAgfSwKICAgICAgICBpc0JveDogdHJ1ZSwKICAgICAgICBpc01hdGhKYXg6IHRydWUKICAgICAgfSk7CgogICAgICBpZiAodyAhPSBudWxsKSB7CiAgICAgICAgYm94LnN0eWxlLndpZHRoID0gdzsKICAgICAgfQoKICAgICAgcmV0dXJuIGJveDsKICAgIH0sCiAgICBhZGRCb3g6IGZ1bmN0aW9uIGFkZEJveChzcGFuLCBib3gpIHsKICAgICAgYm94LnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgICAgYm94LmlzQm94ID0gYm94LmlzTWF0aEpheCA9IHRydWU7CiAgICAgIHJldHVybiBzcGFuLmFwcGVuZENoaWxkKGJveCk7CiAgICB9LAogICAgcGxhY2VCb3g6IGZ1bmN0aW9uIHBsYWNlQm94KHNwYW4sIHgsIHksIG5vY2xpcCkgewogICAgICBzcGFuLmlzTWF0aEpheCA9IHRydWU7CiAgICAgIHZhciBwYXJlbnQgPSBIVE1MQ1NTLnBhcmVudE5vZGUoc3BhbiksCiAgICAgICAgICBiYm94ID0gc3Bhbi5iYm94LAogICAgICAgICAgQkJPWCA9IHBhcmVudC5iYm94OwoKICAgICAgaWYgKHRoaXMubXNpZVBsYWNlQm94QnVnKSB7CiAgICAgICAgdGhpcy5hZGRUZXh0KHNwYW4sIHRoaXMuTkJTUCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmltZ1NwYWNlQnVnKSB7CiAgICAgICAgdGhpcy5hZGRUZXh0KHNwYW4sIHRoaXMuaW1nU3BhY2UpOwogICAgICB9IC8vIFBsYWNlIHRoZSBib3gKCgogICAgICB2YXIgSEgsCiAgICAgICAgICBkeCA9IDA7CgogICAgICBpZiAoc3Bhbi5ISCAhPSBudWxsKSB7CiAgICAgICAgSEggPSBzcGFuLkhIOwogICAgICB9IGVsc2UgaWYgKGJib3gpIHsKICAgICAgICBISCA9IE1hdGgubWF4KDMsIGJib3guaCArIGJib3guZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgSEggPSBzcGFuLm9mZnNldEhlaWdodCAvIHRoaXMuZW07CiAgICAgIH0KCiAgICAgIGlmICghc3Bhbi5ub0FkanVzdCkgewogICAgICAgIEhIICs9IDE7CiAgICAgICAgSEggPSBNYXRoLnJvdW5kKEhIICogdGhpcy5lbSkgLyB0aGlzLmVtOyAvLyBtYWtlIHRoaXMgYW4gaW50ZWdlciBudW1iZXIgb2YgcGl4ZWxzIChmb3IgQ2hyb21lKQoKICAgICAgICBpZiAodGhpcy5tc2llSW5saW5lQmxvY2tBbGlnbkJ1ZykgewogICAgICAgICAgdGhpcy5hZGRFbGVtZW50KHNwYW4sICJpbWciLCB7CiAgICAgICAgICAgIGNsYXNzTmFtZTogIk1hdGhKYXhfc3RydXQiLAogICAgICAgICAgICBib3JkZXI6IDAsCiAgICAgICAgICAgIHNyYzogImFib3V0OmJsYW5rIiwKICAgICAgICAgICAgaXNNYXRoSmF4OiB0cnVlLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICAgIGhlaWdodDogdGhpcy5FbShISCkKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYWRkRWxlbWVudChzcGFuLCAic3BhbiIsIHsKICAgICAgICAgICAgaXNNYXRoSmF4OiB0cnVlLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUtYmxvY2siLAogICAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICAgIGhlaWdodDogdGhpcy5FbShISCkKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKEhUTUxDU1MuY2hyb21lSGVpZ2h0QnVnKSB7CiAgICAgICAgICAgIEhIIC09IChzcGFuLmxhc3RDaGlsZC5vZmZzZXRIZWlnaHQgLSBNYXRoLnJvdW5kKEhIICogdGhpcy5lbSkpIC8gdGhpcy5lbTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gQ2xpcCBzbyB0aGF0IGJib3ggZG9lc24ndCBpbmNsdWRlIGV4dHJhIGhlaWdodCBhbmQgZGVwdGgKCgogICAgICBpZiAoYmJveCkgewogICAgICAgIGlmICh0aGlzLmluaXRpYWxTa2lwQnVnKSB7CiAgICAgICAgICBpZiAoYmJveC5sdyA8IDApIHsKICAgICAgICAgICAgZHggPSBiYm94Lmx3OwogICAgICAgICAgICBIVE1MQ1NTLmNyZWF0ZUJsYW5rKHNwYW4sIC1keCwgdHJ1ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJib3gucncgPiBiYm94LncpIHsKICAgICAgICAgICAgSFRNTENTUy5jcmVhdGVCbGFuayhzcGFuLCBiYm94LnJ3IC0gYmJveC53ICsgLjEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCF0aGlzLm1zaWVDbGlwUmVjdEJ1ZyAmJiAhYmJveC5ub2NsaXAgJiYgIW5vY2xpcCkgewogICAgICAgICAgdmFyIGRkID0gMyAvIHRoaXMuZW07CiAgICAgICAgICB2YXIgSCA9IGJib3guSCA9PSBudWxsID8gYmJveC5oIDogYmJveC5ILAogICAgICAgICAgICAgIEQgPSBiYm94LkQgPT0gbnVsbCA/IGJib3guZCA6IGJib3guRDsKICAgICAgICAgIHZhciB0ID0gSEggLSBIIC0gZGQsCiAgICAgICAgICAgICAgYiA9IEhIICsgRCArIGRkLAogICAgICAgICAgICAgIGwgPSAtMTAwMCwKICAgICAgICAgICAgICByID0gYmJveC5ydyArIDEwMDA7CiAgICAgICAgICBzcGFuLnN0eWxlLmNsaXAgPSAicmVjdCgiICsgdGhpcy5FbSh0KSArICIgIiArIHRoaXMuRW0ocikgKyAiICIgKyB0aGlzLkVtKGIpICsgIiAiICsgdGhpcy5FbShsKSArICIpIjsKICAgICAgICB9CiAgICAgIH0gLy8gUGxhY2UgdGhlIGJveAoKCiAgICAgIHNwYW4uc3R5bGUudG9wID0gdGhpcy5FbSgteSAtIEhIKTsKICAgICAgc3Bhbi5zdHlsZS5sZWZ0ID0gdGhpcy5FbSh4ICsgZHgpOyAvLyBVcGRhdGUgdGhlIGJvdW5kaW5nIGJveAoKICAgICAgaWYgKGJib3ggJiYgQkJPWCkgewogICAgICAgIGlmIChiYm94LkggIT0gbnVsbCAmJiAoQkJPWC5IID09IG51bGwgfHwgYmJveC5IICsgeSA+IEJCT1guSCkpIHsKICAgICAgICAgIEJCT1guSCA9IGJib3guSCArIHk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmJveC5EICE9IG51bGwgJiYgKEJCT1guRCA9PSBudWxsIHx8IGJib3guRCAtIHkgPiBCQk9YLkQpKSB7CiAgICAgICAgICBCQk9YLkQgPSBiYm94LkQgLSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKGJib3guaCArIHkgPiBCQk9YLmgpIHsKICAgICAgICAgIEJCT1guaCA9IGJib3guaCArIHk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmJveC5kIC0geSA+IEJCT1guZCkgewogICAgICAgICAgQkJPWC5kID0gYmJveC5kIC0geTsKICAgICAgICB9CgogICAgICAgIGlmIChCQk9YLkggIT0gbnVsbCAmJiBCQk9YLkggPD0gQkJPWC5oKSB7CiAgICAgICAgICBkZWxldGUgQkJPWC5IOwogICAgICAgIH0KCiAgICAgICAgaWYgKEJCT1guRCAhPSBudWxsICYmIEJCT1guRCA8PSBCQk9YLmQpIHsKICAgICAgICAgIGRlbGV0ZSBCQk9YLkQ7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmJveC53ICsgeCA+IEJCT1gudykgewogICAgICAgICAgQkJPWC53ID0gYmJveC53ICsgeDsKCiAgICAgICAgICBpZiAoQkJPWC53aWR0aCA9PSBudWxsKSB7CiAgICAgICAgICAgIHBhcmVudC5zdHlsZS53aWR0aCA9IHRoaXMuRW0oQkJPWC53KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChiYm94LnJ3ICsgeCA+IEJCT1gucncpIHsKICAgICAgICAgIEJCT1gucncgPSBiYm94LnJ3ICsgeDsKICAgICAgICB9CgogICAgICAgIGlmIChiYm94Lmx3ICsgeCA8IEJCT1gubHcpIHsKICAgICAgICAgIEJCT1gubHcgPSBiYm94Lmx3ICsgeDsKICAgICAgICB9CgogICAgICAgIGlmIChiYm94LndpZHRoICE9IG51bGwgJiYgIWJib3guaXNGaXhlZCkgewogICAgICAgICAgaWYgKEJCT1gud2lkdGggPT0gbnVsbCkgewogICAgICAgICAgICBwYXJlbnQuc3R5bGUud2lkdGggPSBCQk9YLndpZHRoID0gIjEwMCUiOwoKICAgICAgICAgICAgaWYgKGJib3gubWluV2lkdGgpIHsKICAgICAgICAgICAgICBwYXJlbnQuc3R5bGUubWluV2lkdGggPSBCQk9YLm1pbldpZHRoID0gYmJveC5taW5XaWR0aDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHNwYW4uc3R5bGUud2lkdGggPSBiYm94LndpZHRoOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJib3gudHcpIHsKICAgICAgICAgIEJCT1gudHcgPSBiYm94LnR3OwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFsaWduQm94OiBmdW5jdGlvbiBhbGlnbkJveChzcGFuLCBhbGlnbiwgeSwgZHgpIHsKICAgICAgaWYgKGR4ID09IG51bGwpIHsKICAgICAgICBkeCA9IDA7CiAgICAgIH0KCiAgICAgIHRoaXMucGxhY2VCb3goc3BhbiwgZHgsIHkpOyAvLyBzZXQgeSBwb3NpdGlvbiAoYW5kIGxlZnQgYWxpZ25lZCkKCiAgICAgIGlmICh0aGlzLm1zaWVQbGFjZUJveEJ1ZykgewogICAgICAgIC8vCiAgICAgICAgLy8gIHBsYWNlQm94KCkgYWRkcyBhbiBleHRyYSAmbmJzcDssIHNvIHJlbW92ZSBpdCBoZXJlLgogICAgICAgIC8vCiAgICAgICAgdmFyIG5vZGUgPSBzcGFuLmxhc3RDaGlsZDsKCiAgICAgICAgd2hpbGUgKG5vZGUgJiYgbm9kZS5ub2RlTmFtZSAhPT0gIiN0ZXh0IikgewogICAgICAgICAgbm9kZSA9IG5vZGUucHJldmlvdXNTaWJsaW5nOwogICAgICAgIH0KCiAgICAgICAgaWYgKG5vZGUpIHsKICAgICAgICAgIHNwYW4ucmVtb3ZlQ2hpbGQobm9kZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgYmJveCA9IHNwYW4uYmJveDsKICAgICAgaWYgKGJib3guaXNNdWx0aWxpbmUpIHJldHVybjsKICAgICAgdmFyIGlzUmVsYXRpdmUgPSBiYm94LndpZHRoICE9IG51bGwgJiYgIWJib3guaXNGaXhlZDsKICAgICAgdmFyIHIgPSAwLAogICAgICAgICAgYyA9IGR4IC0gYmJveC53IC8gMiwKICAgICAgICAgIGwgPSAiNTAlIjsKCiAgICAgIGlmICh0aGlzLmluaXRpYWxTa2lwQnVnKSB7CiAgICAgICAgciA9IGJib3gudyAtIGJib3gucncgLSAuMTsKICAgICAgICBjICs9IGJib3gubHc7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLm1zaWVNYXJnaW5TY2FsZUJ1ZykgewogICAgICAgIGMgPSBjICogdGhpcy5lbSArICJweCI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyA9IHRoaXMuRW0oYyk7CiAgICAgIH0KCiAgICAgIGlmIChpc1JlbGF0aXZlKSB7CiAgICAgICAgYyA9IGR4ID09PSAwID8gIiIgOiB0aGlzLkVtKGR4KTsKICAgICAgICBsID0gNTAgLSBwYXJzZUZsb2F0KGJib3gud2lkdGgpIC8gMiArICIlIjsKICAgICAgfQoKICAgICAgSFVCLkluc2VydChzcGFuLnN0eWxlLCB7CiAgICAgICAgcmlnaHQ6IHsKICAgICAgICAgIGxlZnQ6ICIiLAogICAgICAgICAgcmlnaHQ6IHRoaXMuRW0ociAtIGR4KQogICAgICAgIH0sCiAgICAgICAgY2VudGVyOiB7CiAgICAgICAgICBsZWZ0OiBsLAogICAgICAgICAgbWFyZ2luTGVmdDogYwogICAgICAgIH0KICAgICAgfVthbGlnbl0pOwogICAgfSwKICAgIHNldFN0YWNrV2lkdGg6IGZ1bmN0aW9uIHNldFN0YWNrV2lkdGgoc3BhbiwgdykgewogICAgICBpZiAodHlwZW9mIHcgPT09ICJudW1iZXIiKSB7CiAgICAgICAgc3Bhbi5zdHlsZS53aWR0aCA9IHRoaXMuRW0oTWF0aC5tYXgoMCwgdykpOwogICAgICAgIHZhciBiYm94ID0gc3Bhbi5iYm94OwoKICAgICAgICBpZiAoYmJveCkgewogICAgICAgICAgYmJveC53ID0gdzsKICAgICAgICAgIGJib3guZXhhY3RXID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIDsKICAgICAgICBiYm94ID0gc3Bhbi5wYXJlbnROb2RlLmJib3g7CgogICAgICAgIGlmIChiYm94KSB7CiAgICAgICAgICBiYm94LncgPSB3OwogICAgICAgICAgYmJveC5leGFjdFcgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgOwogICAgICB9IGVsc2UgewogICAgICAgIHNwYW4uc3R5bGUud2lkdGggPSBzcGFuLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSAiMTAwJSI7CgogICAgICAgIGlmIChzcGFuLmJib3gpIHsKICAgICAgICAgIHNwYW4uYmJveC53aWR0aCA9IHc7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3Bhbi5wYXJlbnROb2RlLmJib3gpIHsKICAgICAgICAgIHNwYW4ucGFyZW50Tm9kZS5iYm94LndpZHRoID0gdzsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVEZWxpbWl0ZXI6IGZ1bmN0aW9uIGNyZWF0ZURlbGltaXRlcihzcGFuLCBjb2RlLCBIVywgc2NhbGUsIGZvbnQpIHsKICAgICAgaWYgKCFjb2RlKSB7CiAgICAgICAgc3Bhbi5iYm94ID0gewogICAgICAgICAgaDogMCwKICAgICAgICAgIGQ6IDAsCiAgICAgICAgICB3OiB0aGlzLlRlWC5udWxsZGVsaW1pdGVyc3BhY2UsCiAgICAgICAgICBsdzogMAogICAgICAgIH07CiAgICAgICAgc3Bhbi5iYm94LnJ3ID0gc3Bhbi5iYm94Lnc7CiAgICAgICAgdGhpcy5jcmVhdGVTcGFjZShzcGFuLCBzcGFuLmJib3guaCwgc3Bhbi5iYm94LmQsIHNwYW4uYmJveC53KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghc2NhbGUpIHsKICAgICAgICBzY2FsZSA9IDE7CiAgICAgIH0KCiAgICAgIDsKCiAgICAgIGlmICghKEhXIGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAgICAgSFcgPSBbSFcsIEhXXTsKICAgICAgfQoKICAgICAgdmFyIGh3ID0gSFdbMV07CiAgICAgIEhXID0gSFdbMF07CiAgICAgIHZhciBkZWxpbSA9IHsKICAgICAgICBhbGlhczogY29kZQogICAgICB9OwoKICAgICAgd2hpbGUgKGRlbGltLmFsaWFzKSB7CiAgICAgICAgY29kZSA9IGRlbGltLmFsaWFzOwogICAgICAgIGRlbGltID0gdGhpcy5GT05UREFUQS5ERUxJTUlURVJTW2NvZGVdOwoKICAgICAgICBpZiAoIWRlbGltKSB7CiAgICAgICAgICBkZWxpbSA9IHsKICAgICAgICAgICAgSFc6IFswLCB0aGlzLkZPTlREQVRBLlZBUklBTlRbTU1MLlZBUklBTlQuTk9STUFMXV0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoZGVsaW0ubG9hZCkgewogICAgICAgIEhVQi5SZXN0YXJ0QWZ0ZXIoQUpBWC5SZXF1aXJlKHRoaXMuZm9udERpciArICIvZm9udGRhdGEtIiArIGRlbGltLmxvYWQgKyAiLmpzIikpOwogICAgICB9CgogICAgICBmb3IgKHZhciBpID0gMCwgbSA9IGRlbGltLkhXLmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgIGlmIChkZWxpbS5IV1tpXVswXSAqIHNjYWxlID49IEhXIC0gLjAxIHx8IGkgPT0gbSAtIDEgJiYgIWRlbGltLnN0cmV0Y2gpIHsKICAgICAgICAgIGlmIChkZWxpbS5IV1tpXVsyXSkgewogICAgICAgICAgICBzY2FsZSAqPSBkZWxpbS5IV1tpXVsyXTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZGVsaW0uSFdbaV1bM10pIHsKICAgICAgICAgICAgY29kZSA9IGRlbGltLkhXW2ldWzNdOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBjaHIgPSB0aGlzLmFkZEVsZW1lbnQoc3BhbiwgInNwYW4iKTsKICAgICAgICAgIHRoaXMuY3JlYXRlQ2hhcihjaHIsIFtjb2RlLCBkZWxpbS5IV1tpXVsxXV0sIHNjYWxlLCBmb250KTsKICAgICAgICAgIHNwYW4uYmJveCA9IGNoci5iYm94OwogICAgICAgICAgc3Bhbi5vZmZzZXQgPSAuNjUgKiBzcGFuLmJib3gudzsKICAgICAgICAgIHNwYW4uc2NhbGUgPSBzY2FsZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChkZWxpbS5zdHJldGNoKSB7CiAgICAgICAgdGhpc1siZXh0ZW5kRGVsaW1pdGVyIiArIGRlbGltLmRpcl0oc3BhbiwgaHcsIGRlbGltLnN0cmV0Y2gsIHNjYWxlLCBmb250KTsKICAgICAgfQogICAgfSwKICAgIGV4dGVuZERlbGltaXRlclY6IGZ1bmN0aW9uIGV4dGVuZERlbGltaXRlclYoc3BhbiwgSCwgZGVsaW0sIHNjYWxlLCBmb250KSB7CiAgICAgIHZhciBzdGFjayA9IHRoaXMuY3JlYXRlU3RhY2soc3BhbiwgdHJ1ZSk7CiAgICAgIHZhciB0b3AgPSB0aGlzLmNyZWF0ZUJveChzdGFjayksCiAgICAgICAgICBib3QgPSB0aGlzLmNyZWF0ZUJveChzdGFjayk7CiAgICAgIHRoaXMuY3JlYXRlQ2hhcih0b3AsIGRlbGltLnRvcCB8fCBkZWxpbS5leHQsIHNjYWxlLCBmb250KTsKICAgICAgdGhpcy5jcmVhdGVDaGFyKGJvdCwgZGVsaW0uYm90IHx8IGRlbGltLmV4dCwgc2NhbGUsIGZvbnQpOwogICAgICB2YXIgZXh0ID0gewogICAgICAgIGJib3g6IHsKICAgICAgICAgIHc6IDAsCiAgICAgICAgICBsdzogMCwKICAgICAgICAgIHJ3OiAwCiAgICAgICAgfQogICAgICB9LAogICAgICAgICAgbWlkID0gZXh0LAogICAgICAgICAgRVhUOwogICAgICB2YXIgaCA9IHRvcC5iYm94LmggKyB0b3AuYmJveC5kICsgYm90LmJib3guaCArIGJvdC5iYm94LmQ7CiAgICAgIHZhciB5ID0gLXRvcC5iYm94Lmg7CiAgICAgIHRoaXMucGxhY2VCb3godG9wLCAwLCB5LCB0cnVlKTsKICAgICAgeSAtPSB0b3AuYmJveC5kOwoKICAgICAgaWYgKGRlbGltLm1pZCkgewogICAgICAgIG1pZCA9IHRoaXMuY3JlYXRlQm94KHN0YWNrKTsKICAgICAgICB0aGlzLmNyZWF0ZUNoYXIobWlkLCBkZWxpbS5taWQsIHNjYWxlLCBmb250KTsKICAgICAgICBoICs9IG1pZC5iYm94LmggKyBtaWQuYmJveC5kOwogICAgICB9CgogICAgICBpZiAoZGVsaW0ubWluICYmIEggPCBoICogZGVsaW0ubWluKSB7CiAgICAgICAgSCA9IGggKiBkZWxpbS5taW47CiAgICAgIH0KCiAgICAgIGlmIChIID4gaCkgewogICAgICAgIGV4dCA9IHRoaXMuRWxlbWVudCgic3BhbiIpOwogICAgICAgIHRoaXMuY3JlYXRlQ2hhcihleHQsIGRlbGltLmV4dCwgc2NhbGUsIGZvbnQpOwogICAgICAgIHZhciBlSCA9IGV4dC5iYm94LmggKyBleHQuYmJveC5kLAogICAgICAgICAgICBlaCA9IGVIIC0gLjA1LAogICAgICAgICAgICBuLAogICAgICAgICAgICBOLAogICAgICAgICAgICBrID0gZGVsaW0ubWlkID8gMiA6IDE7CiAgICAgICAgTiA9IG4gPSBNYXRoLm1pbihNYXRoLmNlaWwoKEggLSBoKSAvIChrICogZWgpKSwgdGhpcy5tYXhTdHJldGNoeVBhcnRzKTsKCiAgICAgICAgaWYgKCFkZWxpbS5mdWxsRXh0ZW5kZXJzKSB7CiAgICAgICAgICBlaCA9IChIIC0gaCkgLyAoayAqIG4pOwogICAgICAgIH0KCiAgICAgICAgdmFyIGR5ID0gbiAvIChuICsgMSkgKiAoZUggLSBlaCk7CiAgICAgICAgZWggPSBlSCAtIGR5OwogICAgICAgIHkgKz0gZHkgKyBlaCAtIGV4dC5iYm94Lmg7CgogICAgICAgIHdoaWxlIChrLS0gPiAwKSB7CiAgICAgICAgICB3aGlsZSAobi0tID4gMCkgewogICAgICAgICAgICBpZiAoIXRoaXMubXNpZUNsb25lTm9kZUJ1ZykgewogICAgICAgICAgICAgIEVYVCA9IGV4dC5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgRVhUID0gdGhpcy5FbGVtZW50KCJzcGFuIik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVDaGFyKEVYVCwgZGVsaW0uZXh0LCBzY2FsZSwgZm9udCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEVYVC5iYm94ID0gZXh0LmJib3g7CiAgICAgICAgICAgIHkgLT0gZWg7CiAgICAgICAgICAgIHRoaXMucGxhY2VCb3godGhpcy5hZGRCb3goc3RhY2ssIEVYVCksIDAsIHksIHRydWUpOwogICAgICAgICAgfQoKICAgICAgICAgIHkgKz0gZHkgLSBleHQuYmJveC5kOwoKICAgICAgICAgIGlmIChkZWxpbS5taWQgJiYgaykgewogICAgICAgICAgICB0aGlzLnBsYWNlQm94KG1pZCwgMCwgeSAtIG1pZC5iYm94LmgsIHRydWUpOwogICAgICAgICAgICBuID0gTjsKICAgICAgICAgICAgeSArPSAtKG1pZC5iYm94LmggKyBtaWQuYmJveC5kKSArIGR5ICsgZWggLSBleHQuYmJveC5oOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB5ICs9IChoIC0gSCkgLyAyOwoKICAgICAgICBpZiAoZGVsaW0ubWlkKSB7CiAgICAgICAgICB0aGlzLnBsYWNlQm94KG1pZCwgMCwgeSAtIG1pZC5iYm94LmgsIHRydWUpOwogICAgICAgICAgeSArPSAtKG1pZC5iYm94LmggKyBtaWQuYmJveC5kKTsKICAgICAgICB9CgogICAgICAgIHkgKz0gKGggLSBIKSAvIDI7CiAgICAgIH0KCiAgICAgIHRoaXMucGxhY2VCb3goYm90LCAwLCB5IC0gYm90LmJib3guaCwgdHJ1ZSk7CiAgICAgIHkgLT0gYm90LmJib3guaCArIGJvdC5iYm94LmQ7CiAgICAgIHNwYW4uYmJveCA9IHsKICAgICAgICB3OiBNYXRoLm1heCh0b3AuYmJveC53LCBleHQuYmJveC53LCBib3QuYmJveC53LCBtaWQuYmJveC53KSwKICAgICAgICBsdzogTWF0aC5taW4odG9wLmJib3gubHcsIGV4dC5iYm94Lmx3LCBib3QuYmJveC5sdywgbWlkLmJib3gubHcpLAogICAgICAgIHJ3OiBNYXRoLm1heCh0b3AuYmJveC5ydywgZXh0LmJib3gucncsIGJvdC5iYm94LnJ3LCBtaWQuYmJveC5ydyksCiAgICAgICAgaDogMCwKICAgICAgICBkOiAteSwKICAgICAgICBleGFjdFc6IHRydWUKICAgICAgfTsKICAgICAgc3Bhbi5zY2FsZSA9IHNjYWxlOwogICAgICBzcGFuLm9mZnNldCA9IC41NSAqIHNwYW4uYmJveC53OwogICAgICBzcGFuLmlzTXVsdGlDaGFyID0gdHJ1ZTsKICAgICAgdGhpcy5zZXRTdGFja1dpZHRoKHN0YWNrLCBzcGFuLmJib3gudyk7CiAgICB9LAogICAgZXh0ZW5kRGVsaW1pdGVySDogZnVuY3Rpb24gZXh0ZW5kRGVsaW1pdGVySChzcGFuLCBXLCBkZWxpbSwgc2NhbGUsIGZvbnQpIHsKICAgICAgdmFyIHN0YWNrID0gdGhpcy5jcmVhdGVTdGFjayhzcGFuLCB0cnVlKTsKICAgICAgdmFyIGxlZnQgPSB0aGlzLmNyZWF0ZUJveChzdGFjayksCiAgICAgICAgICByaWdodCA9IHRoaXMuY3JlYXRlQm94KHN0YWNrKTsKICAgICAgdGhpcy5jcmVhdGVDaGFyKGxlZnQsIGRlbGltLmxlZnQgfHwgZGVsaW0ucmVwLCBzY2FsZSwgZm9udCk7CiAgICAgIHRoaXMuY3JlYXRlQ2hhcihyaWdodCwgZGVsaW0ucmlnaHQgfHwgZGVsaW0ucmVwLCBzY2FsZSwgZm9udCk7CiAgICAgIHZhciByZXAgPSB0aGlzLkVsZW1lbnQoInNwYW4iKTsKICAgICAgdGhpcy5jcmVhdGVDaGFyKHJlcCwgZGVsaW0ucmVwLCBzY2FsZSwgZm9udCk7CiAgICAgIHZhciBtaWQgPSB7CiAgICAgICAgYmJveDogewogICAgICAgICAgaDogLXRoaXMuQklHRElNRU4sCiAgICAgICAgICBkOiAtdGhpcy5CSUdESU1FTgogICAgICAgIH0KICAgICAgfSwKICAgICAgICAgIFJFUDsKICAgICAgdGhpcy5wbGFjZUJveChsZWZ0LCAtbGVmdC5iYm94Lmx3LCAwLCB0cnVlKTsKICAgICAgdmFyIHcgPSBsZWZ0LmJib3gucncgLSBsZWZ0LmJib3gubHcgKyAocmlnaHQuYmJveC5ydyAtIHJpZ2h0LmJib3gubHcpIC0gLjA1LAogICAgICAgICAgeCA9IGxlZnQuYmJveC5ydyAtIGxlZnQuYmJveC5sdyAtIC4wMjUsCiAgICAgICAgICBkeDsKCiAgICAgIGlmIChkZWxpbS5taWQpIHsKICAgICAgICBtaWQgPSB0aGlzLmNyZWF0ZUJveChzdGFjayk7CiAgICAgICAgdGhpcy5jcmVhdGVDaGFyKG1pZCwgZGVsaW0ubWlkLCBzY2FsZSwgZm9udCk7CiAgICAgICAgdyArPSBtaWQuYmJveC53OwogICAgICB9CgogICAgICBpZiAoZGVsaW0ubWluICYmIFcgPCB3ICogZGVsaW0ubWluKSB7CiAgICAgICAgVyA9IHcgKiBkZWxpbS5taW47CiAgICAgIH0KCiAgICAgIGlmIChXID4gdykgewogICAgICAgIHZhciByVyA9IHJlcC5iYm94LnJ3IC0gcmVwLmJib3gubHcsCiAgICAgICAgICAgIHJ3ID0gclcgLSAuMDUsCiAgICAgICAgICAgIG4sCiAgICAgICAgICAgIE4sCiAgICAgICAgICAgIGsgPSBkZWxpbS5taWQgPyAyIDogMTsKICAgICAgICBOID0gbiA9IE1hdGgubWluKE1hdGguY2VpbCgoVyAtIHcpIC8gKGsgKiBydykpLCB0aGlzLm1heFN0cmV0Y2h5UGFydHMpOwoKICAgICAgICBpZiAoIWRlbGltLmZpbGxFeHRlbmRlcnMpIHsKICAgICAgICAgIHJ3ID0gKFcgLSB3KSAvIChrICogbik7CiAgICAgICAgfQoKICAgICAgICBkeCA9IG4gLyAobiArIDEpICogKHJXIC0gcncpOwogICAgICAgIHJ3ID0gclcgLSBkeDsKICAgICAgICB4IC09IHJlcC5iYm94Lmx3ICsgZHg7CgogICAgICAgIHdoaWxlIChrLS0gPiAwKSB7CiAgICAgICAgICB3aGlsZSAobi0tID4gMCkgewogICAgICAgICAgICBpZiAoIXRoaXMuY2xvbmVOb2RlQnVnKSB7CiAgICAgICAgICAgICAgUkVQID0gcmVwLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBSRVAgPSB0aGlzLkVsZW1lbnQoInNwYW4iKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUNoYXIoUkVQLCBkZWxpbS5yZXAsIHNjYWxlLCBmb250KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgUkVQLmJib3ggPSByZXAuYmJveDsKICAgICAgICAgICAgdGhpcy5wbGFjZUJveCh0aGlzLmFkZEJveChzdGFjaywgUkVQKSwgeCwgMCwgdHJ1ZSk7CiAgICAgICAgICAgIHggKz0gcnc7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGRlbGltLm1pZCAmJiBrKSB7CiAgICAgICAgICAgIHRoaXMucGxhY2VCb3gobWlkLCB4LCAwLCB0cnVlKTsKICAgICAgICAgICAgeCArPSBtaWQuYmJveC53IC0gZHg7CiAgICAgICAgICAgIG4gPSBOOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB4IC09ICh3IC0gVykgLyAyOwoKICAgICAgICBpZiAoZGVsaW0ubWlkKSB7CiAgICAgICAgICB0aGlzLnBsYWNlQm94KG1pZCwgeCwgMCwgdHJ1ZSk7CiAgICAgICAgICB4ICs9IG1pZC5iYm94Lnc7CiAgICAgICAgfQoKICAgICAgICA7CiAgICAgICAgeCAtPSAodyAtIFcpIC8gMjsKICAgICAgfQoKICAgICAgdGhpcy5wbGFjZUJveChyaWdodCwgeCwgMCwgdHJ1ZSk7CiAgICAgIHNwYW4uYmJveCA9IHsKICAgICAgICB3OiB4ICsgcmlnaHQuYmJveC5ydywKICAgICAgICBsdzogMCwKICAgICAgICBydzogeCArIHJpZ2h0LmJib3gucncsCiAgICAgICAgaDogTWF0aC5tYXgobGVmdC5iYm94LmgsIHJlcC5iYm94LmgsIHJpZ2h0LmJib3guaCwgbWlkLmJib3guaCksCiAgICAgICAgZDogTWF0aC5tYXgobGVmdC5iYm94LmQsIHJlcC5iYm94LmQsIHJpZ2h0LmJib3guZCwgbWlkLmJib3guZCksCiAgICAgICAgZXhhY3RXOiB0cnVlCiAgICAgIH07CiAgICAgIHNwYW4uc2NhbGUgPSBzY2FsZTsKICAgICAgc3Bhbi5pc011bHRpQ2hhciA9IHRydWU7CiAgICAgIHRoaXMuc2V0U3RhY2tXaWR0aChzdGFjaywgc3Bhbi5iYm94LncpOwogICAgfSwKICAgIGNyZWF0ZUNoYXI6IGZ1bmN0aW9uIGNyZWF0ZUNoYXIoc3BhbiwgZGF0YSwgc2NhbGUsIGZvbnQpIHsKICAgICAgc3Bhbi5pc01hdGhKYXggPSB0cnVlOwogICAgICB2YXIgU1BBTiA9IHNwYW4sCiAgICAgICAgICB0ZXh0ID0gIiIsCiAgICAgICAgICB2YXJpYW50ID0gewogICAgICAgIGZvbnRzOiBbZGF0YVsxXV0sCiAgICAgICAgbm9SZW1hcDogdHJ1ZQogICAgICB9OwoKICAgICAgaWYgKGZvbnQgJiYgZm9udCA9PT0gTU1MLlZBUklBTlQuQk9MRCkgewogICAgICAgIHZhcmlhbnQuZm9udHMgPSBbZGF0YVsxXSArICItYm9sZCIsIGRhdGFbMV1dOwogICAgICB9CgogICAgICBpZiAodHlwZW9mIGRhdGFbMV0gIT09ICJzdHJpbmciKSB7CiAgICAgICAgdmFyaWFudCA9IGRhdGFbMV07CiAgICAgIH0KCiAgICAgIGlmIChkYXRhWzBdIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbSA9IGRhdGFbMF0ubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgICB0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZGF0YVswXVtpXSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRleHQgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGRhdGFbMF0pOwogICAgICB9CgogICAgICBpZiAoZGF0YVs0XSkgewogICAgICAgIHNjYWxlICo9IGRhdGFbNF07CiAgICAgIH0KCiAgICAgIGlmIChzY2FsZSAhPT0gMSB8fCBkYXRhWzNdKSB7CiAgICAgICAgU1BBTiA9IHRoaXMuYWRkRWxlbWVudChzcGFuLCAic3BhbiIsIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGZvbnRTaXplOiB0aGlzLlBlcmNlbnQoc2NhbGUpCiAgICAgICAgICB9LAogICAgICAgICAgc2NhbGU6IHNjYWxlLAogICAgICAgICAgaXNNYXRoSmF4OiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5oYW5kbGVWYXJpYW50KFNQQU4sIHZhcmlhbnQsIHRleHQpOwogICAgICAgIHNwYW4uYmJveCA9IFNQQU4uYmJveDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmhhbmRsZVZhcmlhbnQoc3BhbiwgdmFyaWFudCwgdGV4dCk7CiAgICAgIH0KCiAgICAgIGlmIChkYXRhWzJdKSB7CiAgICAgICAgc3Bhbi5zdHlsZS5tYXJnaW5MZWZ0ID0gdGhpcy5FbShkYXRhWzJdKTsKICAgICAgfSAvLyB4IG9mZnNldAoKCiAgICAgIGlmIChkYXRhWzNdKSB7CiAgICAgICAgLy8geSBvZmZzZXQKICAgICAgICBzcGFuLmZpcnN0Q2hpbGQuc3R5bGUudmVydGljYWxBbGlnbiA9IHRoaXMuRW0oZGF0YVszXSk7CiAgICAgICAgc3Bhbi5iYm94LmggKz0gZGF0YVszXTsKCiAgICAgICAgaWYgKHNwYW4uYmJveC5oIDwgMCkgewogICAgICAgICAgc3Bhbi5iYm94LmggPSAwOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGRhdGFbNV0pIHsKICAgICAgICBzcGFuLmJib3guaCArPSBkYXRhWzVdOwogICAgICB9IC8vIGV4dHJhIGhlaWdodAoKCiAgICAgIGlmIChkYXRhWzZdKSB7CiAgICAgICAgc3Bhbi5iYm94LmQgKz0gZGF0YVs2XTsKICAgICAgfSAvLyBleHRyYSBkZXB0aAogICAgICAvLyAgSGFuZGxlIGNvbWJpbmluZyBjaGFyYWN0ZXJzIGJ5IGFkZGluZyBhIG5vbi1icmVha2luZyBzcGFjZSBzbyBpdCBzaG93cyB1cAoKCiAgICAgIGlmICh0aGlzLkFjY2VudEJ1ZyAmJiBzcGFuLmJib3gudyA9PT0gMCkgewogICAgICAgIFNQQU4uZmlyc3RDaGlsZC5ub2RlVmFsdWUgKz0gdGhpcy5OQlNQOwogICAgICB9CiAgICB9LAogICAgcG9zaXRpb25EZWxpbWl0ZXI6IGZ1bmN0aW9uIHBvc2l0aW9uRGVsaW1pdGVyKHNwYW4sIGgpIHsKICAgICAgaCAtPSBzcGFuLmJib3guaDsKICAgICAgc3Bhbi5iYm94LmQgLT0gaDsKICAgICAgc3Bhbi5iYm94LmggKz0gaDsKCiAgICAgIGlmIChoKSB7CiAgICAgICAgaWYgKHRoaXMuc2FmYXJpVmVydGljYWxBbGlnbkJ1ZyB8fCB0aGlzLmtvbnF1ZXJvclZlcnRpY2FsQWxpZ25CdWcgfHwgdGhpcy5vcGVyYVZlcnRpY2FsQWxpZ25CdWcgJiYgc3Bhbi5pc011bHRpQ2hhcikgewogICAgICAgICAgaWYgKHNwYW4uZmlyc3RDaGlsZC5zdHlsZS5kaXNwbGF5ID09PSAiIiAmJiBzcGFuLnN0eWxlLnRvcCAhPT0gIiIpIHsKICAgICAgICAgICAgc3BhbiA9IHNwYW4uZmlyc3RDaGlsZDsKICAgICAgICAgICAgaCAtPSBIVE1MQ1NTLnVuRW0oc3Bhbi5zdHlsZS50b3ApOwogICAgICAgICAgfQoKICAgICAgICAgIHNwYW4uc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwogICAgICAgICAgc3Bhbi5zdHlsZS50b3AgPSB0aGlzLkVtKC1oKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3Bhbi5zdHlsZS52ZXJ0aWNhbEFsaWduID0gdGhpcy5FbShoKTsKCiAgICAgICAgICBpZiAoSFRNTENTUy5mZlZlcnRpY2FsQWxpZ25CdWcpIHsKICAgICAgICAgICAgSFRNTENTUy5jcmVhdGVSdWxlKHNwYW4ucGFyZW50Tm9kZSwgc3Bhbi5iYm94LmgsIDAsIDApOwogICAgICAgICAgICBkZWxldGUgc3Bhbi5wYXJlbnROb2RlLmJib3g7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaGFuZGxlVmFyaWFudDogZnVuY3Rpb24gaGFuZGxlVmFyaWFudChzcGFuLCB2YXJpYW50LCB0ZXh0KSB7CiAgICAgIHZhciBuZXd0ZXh0ID0gIiIsCiAgICAgICAgICBuLAogICAgICAgICAgYywKICAgICAgICAgIGZvbnQsCiAgICAgICAgICBWQVJJQU5ULAogICAgICAgICAgU1BBTiA9IHNwYW4sCiAgICAgICAgICBmb3JjZSA9ICEhc3Bhbi5zdHlsZS5mb250RmFtaWx5OwogICAgICBpZiAodGV4dC5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICAgIGlmICghc3Bhbi5iYm94KSB7CiAgICAgICAgc3Bhbi5iYm94ID0gewogICAgICAgICAgdzogMCwKICAgICAgICAgIGg6IC10aGlzLkJJR0RJTUVOLAogICAgICAgICAgZDogLXRoaXMuQklHRElNRU4sCiAgICAgICAgICBydzogLXRoaXMuQklHRElNRU4sCiAgICAgICAgICBsdzogdGhpcy5CSUdESU1FTgogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlmICghdmFyaWFudCkgewogICAgICAgIHZhcmlhbnQgPSB0aGlzLkZPTlREQVRBLlZBUklBTlRbTU1MLlZBUklBTlQuTk9STUFMXTsKICAgICAgfQoKICAgICAgVkFSSUFOVCA9IHZhcmlhbnQ7CgogICAgICBmb3IgKHZhciBpID0gMCwgbSA9IHRleHQubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgdmFyaWFudCA9IFZBUklBTlQ7CiAgICAgICAgbiA9IHRleHQuY2hhckNvZGVBdChpKTsKICAgICAgICBjID0gdGV4dC5jaGFyQXQoaSk7CgogICAgICAgIGlmIChuID49IDB4RDgwMCAmJiBuIDwgMHhEQkZGKSB7CiAgICAgICAgICBpKys7CiAgICAgICAgICBuID0gKG4gLSAweEQ4MDAgPDwgMTApICsgKHRleHQuY2hhckNvZGVBdChpKSAtIDB4REMwMCkgKyAweDEwMDAwOwoKICAgICAgICAgIGlmICh0aGlzLkZPTlREQVRBLlJlbWFwUGxhbmUxKSB7CiAgICAgICAgICAgIHZhciBudiA9IHRoaXMuRk9OVERBVEEuUmVtYXBQbGFuZTEobiwgdmFyaWFudCk7CiAgICAgICAgICAgIG4gPSBudi5uOwogICAgICAgICAgICB2YXJpYW50ID0gbnYudmFyaWFudDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGlkLAogICAgICAgICAgICAgIE0sCiAgICAgICAgICAgICAgUkFOR0VTID0gdGhpcy5GT05UREFUQS5SQU5HRVM7CgogICAgICAgICAgZm9yIChpZCA9IDAsIE0gPSBSQU5HRVMubGVuZ3RoOyBpZCA8IE07IGlkKyspIHsKICAgICAgICAgICAgaWYgKFJBTkdFU1tpZF0ubmFtZSA9PT0gImFscGhhIiAmJiB2YXJpYW50Lm5vTG93ZXJDYXNlKSBjb250aW51ZTsKICAgICAgICAgICAgdmFyIE4gPSB2YXJpYW50WyJvZmZzZXQiICsgUkFOR0VTW2lkXS5vZmZzZXRdOwoKICAgICAgICAgICAgaWYgKE4gJiYgbiA+PSBSQU5HRVNbaWRdLmxvdyAmJiBuIDw9IFJBTkdFU1tpZF0uaGlnaCkgewogICAgICAgICAgICAgIGlmIChSQU5HRVNbaWRdLnJlbWFwICYmIFJBTkdFU1tpZF0ucmVtYXBbbl0pIHsKICAgICAgICAgICAgICAgIG4gPSBOICsgUkFOR0VTW2lkXS5yZW1hcFtuXTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbiA9IG4gLSBSQU5HRVNbaWRdLmxvdyArIE47CgogICAgICAgICAgICAgICAgaWYgKFJBTkdFU1tpZF0uYWRkKSB7CiAgICAgICAgICAgICAgICAgIG4gKz0gUkFOR0VTW2lkXS5hZGQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodmFyaWFudFsidmFyaWFudCIgKyBSQU5HRVNbaWRdLm9mZnNldF0pIHsKICAgICAgICAgICAgICAgIHZhcmlhbnQgPSB0aGlzLkZPTlREQVRBLlZBUklBTlRbdmFyaWFudFsidmFyaWFudCIgKyBSQU5HRVNbaWRdLm9mZnNldF1dOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh2YXJpYW50LnJlbWFwICYmIHZhcmlhbnQucmVtYXBbbl0pIHsKICAgICAgICAgIG4gPSB2YXJpYW50LnJlbWFwW25dOwoKICAgICAgICAgIGlmICh2YXJpYW50LnJlbWFwLnZhcmlhbnQpIHsKICAgICAgICAgICAgdmFyaWFudCA9IHRoaXMuRk9OVERBVEEuVkFSSUFOVFt2YXJpYW50LnJlbWFwLnZhcmlhbnRdOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodGhpcy5GT05UREFUQS5SRU1BUFtuXSAmJiAhdmFyaWFudC5ub1JlbWFwKSB7CiAgICAgICAgICBuID0gdGhpcy5GT05UREFUQS5SRU1BUFtuXTsKICAgICAgICB9CgogICAgICAgIGlmIChuIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICAgIHZhcmlhbnQgPSB0aGlzLkZPTlREQVRBLlZBUklBTlRbblsxXV07CiAgICAgICAgICBuID0gblswXTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgbiA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIHRleHQgPSBuICsgdGV4dC5zdWJzdHIoaSArIDEpOwogICAgICAgICAgbSA9IHRleHQubGVuZ3RoOwogICAgICAgICAgaSA9IC0xOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBmb250ID0gdGhpcy5sb29rdXBDaGFyKHZhcmlhbnQsIG4pOwogICAgICAgIGMgPSBmb250W25dOwoKICAgICAgICBpZiAoZm9yY2UgfHwgIXRoaXMuY2hlY2tGb250KGZvbnQsIFNQQU4uc3R5bGUpICYmICFjWzVdLmltZykgewogICAgICAgICAgaWYgKG5ld3RleHQubGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMuYWRkVGV4dChTUEFOLCBuZXd0ZXh0KTsKICAgICAgICAgICAgbmV3dGV4dCA9ICIiOwogICAgICAgICAgfQoKICAgICAgICAgIDsKICAgICAgICAgIHZhciBhZGRTcGFuID0gISFTUEFOLnN0eWxlLmZvbnRGYW1pbHkgfHwgISFzcGFuLnN0eWxlLmZvbnRTdHlsZSB8fCAhIXNwYW4uc3R5bGUuZm9udFdlaWdodCB8fCAhZm9udC5kaXJlY3RvcnkgfHwgZm9yY2U7CiAgICAgICAgICBmb3JjZSA9IGZhbHNlOwoKICAgICAgICAgIGlmIChTUEFOICE9PSBzcGFuKSB7CiAgICAgICAgICAgIGFkZFNwYW4gPSAhdGhpcy5jaGVja0ZvbnQoZm9udCwgc3Bhbi5zdHlsZSk7CiAgICAgICAgICAgIFNQQU4gPSBzcGFuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChhZGRTcGFuKSB7CiAgICAgICAgICAgIFNQQU4gPSB0aGlzLmFkZEVsZW1lbnQoc3BhbiwgInNwYW4iLCB7CiAgICAgICAgICAgICAgaXNNYXRoSmF4OiB0cnVlLAogICAgICAgICAgICAgIHN1YlNwYW46IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5oYW5kbGVGb250KFNQQU4sIGZvbnQsIFNQQU4gIT09IHNwYW4pOwogICAgICAgIH0KCiAgICAgICAgbmV3dGV4dCA9IHRoaXMuaGFuZGxlQ2hhcihTUEFOLCBmb250LCBjLCBuLCBuZXd0ZXh0KTsKCiAgICAgICAgaWYgKCEoY1s1XSB8fCB7fSkuc3BhY2UpIHsKICAgICAgICAgIGlmIChjWzBdIC8gMTAwMCA+IHNwYW4uYmJveC5oKSB7CiAgICAgICAgICAgIHNwYW4uYmJveC5oID0gY1swXSAvIDEwMDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNbMV0gLyAxMDAwID4gc3Bhbi5iYm94LmQpIHsKICAgICAgICAgICAgc3Bhbi5iYm94LmQgPSBjWzFdIC8gMTAwMDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzcGFuLmJib3gudyArIGNbM10gLyAxMDAwIDwgc3Bhbi5iYm94Lmx3KSB7CiAgICAgICAgICBzcGFuLmJib3gubHcgPSBzcGFuLmJib3gudyArIGNbM10gLyAxMDAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNwYW4uYmJveC53ICsgY1s0XSAvIDEwMDAgPiBzcGFuLmJib3gucncpIHsKICAgICAgICAgIHNwYW4uYmJveC5ydyA9IHNwYW4uYmJveC53ICsgY1s0XSAvIDEwMDA7CiAgICAgICAgfQoKICAgICAgICBzcGFuLmJib3gudyArPSBjWzJdIC8gMTAwMDsKICAgICAgICBpZiAoKGNbNV0gfHwge30pLmlzVW5rbm93bikgc3Bhbi5iYm94LmV4YWN0VyA9IGZhbHNlOyAvLyBmb3JjZSBtZWFzdXJlbWVudAogICAgICB9CgogICAgICBpZiAobmV3dGV4dC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmFkZFRleHQoU1BBTiwgbmV3dGV4dCk7CiAgICAgIH0KCiAgICAgIGlmIChzcGFuLnNjYWxlICYmIHNwYW4uc2NhbGUgIT09IDEpIHsKICAgICAgICBzcGFuLmJib3guaCAqPSBzcGFuLnNjYWxlOwogICAgICAgIHNwYW4uYmJveC5kICo9IHNwYW4uc2NhbGU7CiAgICAgICAgc3Bhbi5iYm94LncgKj0gc3Bhbi5zY2FsZTsKICAgICAgICBzcGFuLmJib3gubHcgKj0gc3Bhbi5zY2FsZTsKICAgICAgICBzcGFuLmJib3gucncgKj0gc3Bhbi5zY2FsZTsKICAgICAgfQoKICAgICAgaWYgKHRleHQubGVuZ3RoID09IDEgJiYgZm9udC5za2V3ICYmIGZvbnQuc2tld1tuXSkgewogICAgICAgIHNwYW4uYmJveC5za2V3ID0gZm9udC5za2V3W25dOwogICAgICB9CiAgICB9LAogICAgY2hlY2tGb250OiBmdW5jdGlvbiBjaGVja0ZvbnQoZm9udCwgc3R5bGUpIHsKICAgICAgdmFyIHdlaWdodCA9IHN0eWxlLmZvbnRXZWlnaHQgfHwgIm5vcm1hbCI7CgogICAgICBpZiAod2VpZ2h0Lm1hdGNoKC9eXGQrJC8pKSB7CiAgICAgICAgd2VpZ2h0ID0gcGFyc2VJbnQod2VpZ2h0KSA+PSA2MDAgPyAiYm9sZCIgOiAibm9ybWFsIjsKICAgICAgfQoKICAgICAgcmV0dXJuIGZvbnQuZmFtaWx5LnJlcGxhY2UoLycvZywgIiIpID09PSBzdHlsZS5mb250RmFtaWx5LnJlcGxhY2UoLycvZywgIiIpICYmIChmb250LnN0eWxlIHx8ICJub3JtYWwiKSA9PT0gKHN0eWxlLmZvbnRTdHlsZSB8fCAibm9ybWFsIikgJiYgKGZvbnQud2VpZ2h0IHx8ICJub3JtYWwiKSA9PT0gd2VpZ2h0OwogICAgfSwKICAgIGhhbmRsZUZvbnQ6IGZ1bmN0aW9uIGhhbmRsZUZvbnQoc3BhbiwgZm9udCwgZm9yY2UpIHsKICAgICAgc3Bhbi5zdHlsZS5mb250RmFtaWx5ID0gZm9udC5mYW1pbHk7CgogICAgICBpZiAoIWZvbnQuZGlyZWN0b3J5KSB7CiAgICAgICAgc3Bhbi5zdHlsZS5mb250U2l6ZSA9IE1hdGguZmxvb3IoSFRNTENTUy5jb25maWcuc2NhbGUgLyBIVE1MQ1NTLnNjYWxlICsgLjUpICsgIiUiOwogICAgICB9CgogICAgICBpZiAoIShIVE1MQ1NTLkZvbnRGYWNlQnVnICYmIGZvbnQuaXNXZWJGb250KSkgewogICAgICAgIHZhciBzdHlsZSA9IGZvbnQuc3R5bGUgfHwgIm5vcm1hbCIsCiAgICAgICAgICAgIHdlaWdodCA9IGZvbnQud2VpZ2h0IHx8ICJub3JtYWwiOwoKICAgICAgICBpZiAoc3R5bGUgIT09ICJub3JtYWwiIHx8IGZvcmNlKSB7CiAgICAgICAgICBzcGFuLnN0eWxlLmZvbnRTdHlsZSA9IHN0eWxlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdlaWdodCAhPT0gIm5vcm1hbCIgfHwgZm9yY2UpIHsKICAgICAgICAgIHNwYW4uc3R5bGUuZm9udFdlaWdodCA9IHdlaWdodDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVDaGFyOiBmdW5jdGlvbiBoYW5kbGVDaGFyKHNwYW4sIGZvbnQsIGMsIG4sIHRleHQpIHsKICAgICAgdmFyIEMgPSBjWzVdOwoKICAgICAgaWYgKEMuc3BhY2UpIHsKICAgICAgICBpZiAodGV4dC5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuYWRkVGV4dChzcGFuLCB0ZXh0KTsKICAgICAgICB9CgogICAgICAgIEhUTUxDU1MuY3JlYXRlU2hpZnQoc3BhbiwgY1syXSAvIDEwMDApOwogICAgICAgIHJldHVybiAiIjsKICAgICAgfQoKICAgICAgaWYgKEMuaW1nKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlSW1nKHNwYW4sIGZvbnQsIGMsIG4sIHRleHQpOwogICAgICB9CgogICAgICBpZiAoQy5pc1Vua25vd24gJiYgdGhpcy5GT05UREFUQS5ERUxJTUlURVJTW25dKSB7CiAgICAgICAgaWYgKHRleHQubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmFkZFRleHQoc3BhbiwgdGV4dCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2NhbGUgPSBzcGFuLnNjYWxlOwogICAgICAgIEhUTUxDU1MuY3JlYXRlRGVsaW1pdGVyKHNwYW4sIG4sIDAsIDEsIGZvbnQpOwoKICAgICAgICBpZiAodGhpcy5GT05UREFUQS5ERUxJTUlURVJTW25dLmRpciA9PT0gIlYiKSB7CiAgICAgICAgICBzcGFuLnN0eWxlLnZlcnRpY2FsQWxpZ24gPSB0aGlzLkVtKHNwYW4uYmJveC5kKTsKICAgICAgICAgIHNwYW4uYmJveC5oICs9IHNwYW4uYmJveC5kOwogICAgICAgICAgc3Bhbi5iYm94LmQgPSAwOwogICAgICAgIH0KCiAgICAgICAgc3Bhbi5zY2FsZSA9IHNjYWxlOwogICAgICAgIGNbMF0gPSBzcGFuLmJib3guaCAqIDEwMDA7CiAgICAgICAgY1sxXSA9IHNwYW4uYmJveC5kICogMTAwMDsKICAgICAgICBjWzJdID0gc3Bhbi5iYm94LncgKiAxMDAwOwogICAgICAgIGNbM10gPSBzcGFuLmJib3gubHcgKiAxMDAwOwogICAgICAgIGNbNF0gPSBzcGFuLmJib3gucncgKiAxMDAwOwogICAgICAgIHJldHVybiAiIjsKICAgICAgfQoKICAgICAgaWYgKEMuYyA9PSBudWxsKSB7CiAgICAgICAgaWYgKG4gPD0gMHhGRkZGKSB7CiAgICAgICAgICBDLmMgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgTiA9IG4gLSAweDEwMDAwOwogICAgICAgICAgQy5jID0gU3RyaW5nLmZyb21DaGFyQ29kZSgoTiA+PiAxMCkgKyAweEQ4MDApICsgU3RyaW5nLmZyb21DaGFyQ29kZSgoTiAmIDB4M0ZGKSArIDB4REMwMCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoSFRNTENTUy5mZkZvbnRPcHRpbWl6YXRpb25CdWcgJiYgY1s0XSAtIGNbMl0gPiAxMjUpIHsKICAgICAgICBzcGFuLnN0eWxlLnRleHRSZW5kZXJpbmcgPSAib3B0aW1pemVMZWdpYmlsaXR5IjsKICAgICAgfQoKICAgICAgaWYgKEMucmZpeCkgewogICAgICAgIHRoaXMuYWRkVGV4dChzcGFuLCB0ZXh0ICsgQy5jKTsKICAgICAgICBIVE1MQ1NTLmNyZWF0ZVNoaWZ0KHNwYW4sIEMucmZpeCAvIDEwMDApOwogICAgICAgIHJldHVybiAiIjsKICAgICAgfQoKICAgICAgaWYgKGNbMl0gfHwgIXRoaXMubXNpZUFjY2VudEJ1ZyB8fCB0ZXh0Lmxlbmd0aCkgewogICAgICAgIHJldHVybiB0ZXh0ICsgQy5jOwogICAgICB9IC8vICBIYW5kbGUgSUUgYWNjZW50IGNsaXBwaW5nIGJ1ZwoKCiAgICAgIEhUTUxDU1MuY3JlYXRlU2hpZnQoc3BhbiwgY1szXSAvIDEwMDApOwogICAgICBIVE1MQ1NTLmNyZWF0ZVNoaWZ0KHNwYW4sIChjWzRdIC0gY1szXSkgLyAxMDAwKTsKICAgICAgdGhpcy5hZGRUZXh0KHNwYW4sIEMuYyk7CiAgICAgIEhUTUxDU1MuY3JlYXRlU2hpZnQoc3BhbiwgLWNbNF0gLyAxMDAwKTsKICAgICAgcmV0dXJuICIiOwogICAgfSwKICAgIGhhbmRsZUltZzogZnVuY3Rpb24gaGFuZGxlSW1nKHNwYW4sIGZvbnQsIGMsIG4sIHRleHQpIHsKICAgICAgcmV0dXJuIHRleHQ7CiAgICB9LAogICAgLy8gcmVwbGFjZWQgYnkgaW1hZ2VGb250IGV4dGVuc2lvbgogICAgbG9va3VwQ2hhcjogZnVuY3Rpb24gbG9va3VwQ2hhcih2YXJpYW50LCBuKSB7CiAgICAgIHZhciBpLCBtOwoKICAgICAgaWYgKCF2YXJpYW50LkZPTlRTKSB7CiAgICAgICAgdmFyIEZPTlRTID0gdGhpcy5GT05UREFUQS5GT05UUzsKICAgICAgICB2YXIgZm9udHMgPSB2YXJpYW50LmZvbnRzIHx8IHRoaXMuRk9OVERBVEEuVkFSSUFOVC5ub3JtYWwuZm9udHM7CgogICAgICAgIGlmICghKGZvbnRzIGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAgICAgICBmb250cyA9IFtmb250c107CiAgICAgICAgfQoKICAgICAgICBpZiAodmFyaWFudC5mb250cyAhPSBmb250cykgewogICAgICAgICAgdmFyaWFudC5mb250cyA9IGZvbnRzOwogICAgICAgIH0KCiAgICAgICAgdmFyaWFudC5GT05UUyA9IFtdOwoKICAgICAgICBmb3IgKGkgPSAwLCBtID0gZm9udHMubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgICBpZiAoRk9OVFNbZm9udHNbaV1dKSB7CiAgICAgICAgICAgIHZhcmlhbnQuRk9OVFMucHVzaChGT05UU1tmb250c1tpXV0pOwogICAgICAgICAgICBGT05UU1tmb250c1tpXV0ubmFtZSA9IGZvbnRzW2ldOyAvLyBGSVhNRTogc2hvdWxkIHJlYWxseSBiZSBpbiB0aGUgZm9udCBmaWxlcwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChpID0gMCwgbSA9IHZhcmlhbnQuRk9OVFMubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgdmFyIGZvbnQgPSB2YXJpYW50LkZPTlRTW2ldOwoKICAgICAgICBpZiAodHlwZW9mIGZvbnQgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBkZWxldGUgdmFyaWFudC5GT05UUzsKICAgICAgICAgIHRoaXMubG9hZEZvbnQoZm9udCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZm9udFtuXSkgewogICAgICAgICAgaWYgKGZvbnRbbl0ubGVuZ3RoID09PSA1KSB7CiAgICAgICAgICAgIGZvbnRbbl1bNV0gPSB7fTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoSFRNTENTUy5hbGxvd1dlYkZvbnRzICYmICFmb250LmF2YWlsYWJsZSkgewogICAgICAgICAgICB0aGlzLmxvYWRXZWJGb250KGZvbnQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZvbnQ7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZmluZEJsb2NrKGZvbnQsIG4pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMudW5rbm93bkNoYXIodmFyaWFudCwgbik7CiAgICB9LAogICAgdW5rbm93bkNoYXI6IGZ1bmN0aW9uIHVua25vd25DaGFyKHZhcmlhbnQsIG4pIHsKICAgICAgdmFyIHVua25vd24gPSB2YXJpYW50LmRlZmF1bHRGb250IHx8IHsKICAgICAgICBmYW1pbHk6IEhUTUxDU1MuY29uZmlnLnVuZGVmaW5lZEZhbWlseQogICAgICB9OwoKICAgICAgaWYgKHZhcmlhbnQuYm9sZCkgewogICAgICAgIHVua25vd24ud2VpZ2h0ID0gImJvbGQiOwogICAgICB9CgogICAgICA7CgogICAgICBpZiAodmFyaWFudC5pdGFsaWMpIHsKICAgICAgICB1bmtub3duLnN0eWxlID0gIml0YWxpYyI7CiAgICAgIH0KCiAgICAgIGlmICghdW5rbm93bltuXSkgewogICAgICAgIHVua25vd25bbl0gPSBbODAwLCAyMDAsIDUwMCwgMCwgNTAwLCB7CiAgICAgICAgICBpc1Vua25vd246IHRydWUKICAgICAgICB9XTsKICAgICAgfSAvLyBbaCxkLHcsbHcscncse2RhdGF9XQoKCiAgICAgIEhVQi5zaWduYWwuUG9zdChbIkhUTUwtQ1NTIEpheCAtIHVua25vd24gY2hhciIsIG4sIHZhcmlhbnRdKTsKICAgICAgcmV0dXJuIHVua25vd247CiAgICB9LAogICAgZmluZEJsb2NrOiBmdW5jdGlvbiBmaW5kQmxvY2soZm9udCwgYykgewogICAgICBpZiAoZm9udC5SYW5nZXMpIHsKICAgICAgICAvLyBGSVhNRTogIGRvIGJpbmFyeSBzZWFyY2g/CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG0gPSBmb250LlJhbmdlcy5sZW5ndGg7IGkgPCBtOyBpKyspIHsKICAgICAgICAgIGlmIChjIDwgZm9udC5SYW5nZXNbaV1bMF0pIHJldHVybjsKCiAgICAgICAgICBpZiAoYyA8PSBmb250LlJhbmdlc1tpXVsxXSkgewogICAgICAgICAgICB2YXIgZmlsZSA9IGZvbnQuUmFuZ2VzW2ldWzJdOwoKICAgICAgICAgICAgZm9yICh2YXIgaiA9IGZvbnQuUmFuZ2VzLmxlbmd0aCAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICAgICAgaWYgKGZvbnQuUmFuZ2VzW2pdWzJdID09IGZpbGUpIHsKICAgICAgICAgICAgICAgIGZvbnQuUmFuZ2VzLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMubG9hZEZvbnQoZm9udC5kaXJlY3RvcnkgKyAiLyIgKyBmaWxlICsgIi5qcyIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGxvYWRGb250OiBmdW5jdGlvbiBsb2FkRm9udChmaWxlKSB7CiAgICAgIHZhciBxdWV1ZSA9IE1hdGhKYXguQ2FsbGJhY2suUXVldWUoKTsKICAgICAgcXVldWUuUHVzaChbIlJlcXVpcmUiLCBBSkFYLCB0aGlzLmZvbnREaXIgKyAiLyIgKyBmaWxlXSk7CgogICAgICBpZiAodGhpcy5pbWdGb250cykgewogICAgICAgIGlmICghTWF0aEpheC5pc1BhY2tlZCkgewogICAgICAgICAgZmlsZSA9IGZpbGUucmVwbGFjZSgvXC8oW15cL10qKSQvLCBIVE1MQ1NTLmltZ1BhY2tlZCArICIvJDEiKTsKICAgICAgICB9CgogICAgICAgIHF1ZXVlLlB1c2goWyJSZXF1aXJlIiwgQUpBWCwgdGhpcy53ZWJmb250RGlyICsgIi9wbmcvIiArIGZpbGVdKTsKICAgICAgfQoKICAgICAgSFVCLlJlc3RhcnRBZnRlcihxdWV1ZS5QdXNoKHt9KSk7CiAgICB9LAogICAgbG9hZFdlYkZvbnQ6IGZ1bmN0aW9uIGxvYWRXZWJGb250KGZvbnQpIHsKICAgICAgZm9udC5hdmFpbGFibGUgPSBmb250LmlzV2ViRm9udCA9IHRydWU7CgogICAgICBpZiAoSFRNTENTUy5Gb250RmFjZUJ1ZykgewogICAgICAgIGZvbnQuZmFtaWx5ID0gZm9udC5uYW1lOwoKICAgICAgICBpZiAoSFRNTENTUy5tc2llRm9udENTU0J1ZykgewogICAgICAgICAgZm9udC5mYW1pbHkgKz0gIi1XZWIiOwogICAgICAgIH0KICAgICAgfQoKICAgICAgSFVCLlJlc3RhcnRBZnRlcih0aGlzLkZvbnQubG9hZFdlYkZvbnQoZm9udCkpOwogICAgfSwKICAgIGxvYWRXZWJGb250RXJyb3I6IGZ1bmN0aW9uIGxvYWRXZWJGb250RXJyb3IoZm9udCwgZG9uZSkgewogICAgICAvLwogICAgICAvLyAgQWZ0ZXIgdGhlIGZpcnN0IHdlYiBmb250IGZhaWxzIHRvIGxvYWQsIHN3aXRjaCB0byBpbWFnZSBmb250cywgaWYgcG9zc2libGUKICAgICAgLy8gIG90aGVyd2lzZSwgZ2l2ZSB1cCBvbiB3ZWIgZm9udHMgYWxsIHRvZ2V0aGVyCiAgICAgIC8vIAogICAgICBIVUIuU3RhcnR1cC5zaWduYWwuUG9zdCgiSFRNTC1DU1MgSmF4IC0gZGlzYWJsZSB3ZWIgZm9udHMiKTsKICAgICAgZm9udC5pc1dlYkZvbnQgPSBmYWxzZTsKCiAgICAgIGlmICh0aGlzLmNvbmZpZy5pbWFnZUZvbnQgJiYgdGhpcy5jb25maWcuaW1hZ2VGb250ID09PSB0aGlzLmZvbnRJblVzZSkgewogICAgICAgIHRoaXMuaW1nRm9udHMgPSB0cnVlOwogICAgICAgIEhVQi5TdGFydHVwLnNpZ25hbC5Qb3N0KCJIVE1MLUNTUyBKYXggLSBzd2l0Y2ggdG8gaW1hZ2UgZm9udHMiKTsKICAgICAgICBIVUIuU3RhcnR1cC5zaWduYWwuUG9zdCgiSFRNTC1DU1MgSmF4IC0gdXNpbmcgaW1hZ2UgZm9udHMiKTsKICAgICAgICBNRVNTQUdFKFsiV2ViRm9udE5vdEF2YWlsYWJsZSIsICJXZWItRm9udHMgbm90IGF2YWlsYWJsZSAtLSB1c2luZyBpbWFnZSBmb250cyBpbnN0ZWFkIl0sIG51bGwsIDMwMDApOwogICAgICAgIEFKQVguUmVxdWlyZSh0aGlzLmRpcmVjdG9yeSArICIvaW1hZ2VGb250cy5qcyIsIGRvbmUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWxsb3dXZWJGb250cyA9IGZhbHNlOwogICAgICAgIGRvbmUoKTsKICAgICAgfQogICAgfSwKICAgIEVsZW1lbnQ6IE1hdGhKYXguSFRNTC5FbGVtZW50LAogICAgYWRkRWxlbWVudDogTWF0aEpheC5IVE1MLmFkZEVsZW1lbnQsCiAgICBUZXh0Tm9kZTogTWF0aEpheC5IVE1MLlRleHROb2RlLAogICAgYWRkVGV4dDogTWF0aEpheC5IVE1MLmFkZFRleHQsCiAgICB1Y01hdGNoOiBNYXRoSmF4LkhUTUwudWNNYXRjaCwKICAgIEJJR0RJTUVOOiAxMDAwMDAwMCwKICAgIElEOiAwLAogICAgaWRQb3N0Zml4OiAiIiwKICAgIEdldElEOiBmdW5jdGlvbiBHZXRJRCgpIHsKICAgICAgdGhpcy5JRCsrOwogICAgICByZXR1cm4gdGhpcy5JRDsKICAgIH0sCiAgICBNQVRIU1BBQ0U6IHsKICAgICAgdmVyeXZlcnl0aGlubWF0aHNwYWNlOiAxIC8gMTgsCiAgICAgIHZlcnl0aGlubWF0aHNwYWNlOiAyIC8gMTgsCiAgICAgIHRoaW5tYXRoc3BhY2U6IDMgLyAxOCwKICAgICAgbWVkaXVtbWF0aHNwYWNlOiA0IC8gMTgsCiAgICAgIHRoaWNrbWF0aHNwYWNlOiA1IC8gMTgsCiAgICAgIHZlcnl0aGlja21hdGhzcGFjZTogNiAvIDE4LAogICAgICB2ZXJ5dmVyeXRoaWNrbWF0aHNwYWNlOiA3IC8gMTgsCiAgICAgIG5lZ2F0aXZldmVyeXZlcnl0aGlubWF0aHNwYWNlOiAtMSAvIDE4LAogICAgICBuZWdhdGl2ZXZlcnl0aGlubWF0aHNwYWNlOiAtMiAvIDE4LAogICAgICBuZWdhdGl2ZXRoaW5tYXRoc3BhY2U6IC0zIC8gMTgsCiAgICAgIG5lZ2F0aXZlbWVkaXVtbWF0aHNwYWNlOiAtNCAvIDE4LAogICAgICBuZWdhdGl2ZXRoaWNrbWF0aHNwYWNlOiAtNSAvIDE4LAogICAgICBuZWdhdGl2ZXZlcnl0aGlja21hdGhzcGFjZTogLTYgLyAxOCwKICAgICAgbmVnYXRpdmV2ZXJ5dmVyeXRoaWNrbWF0aHNwYWNlOiAtNyAvIDE4CiAgICB9LAogICAgVGVYOiB7CiAgICAgIHhfaGVpZ2h0OiAuNDMwNTU0LAogICAgICBxdWFkOiAxLAogICAgICBudW0xOiAuNjc2NTA4LAogICAgICBudW0yOiAuMzkzNzMyLAogICAgICBudW0zOiAuNDQzNzMsCiAgICAgIGRlbm9tMTogLjY4NTk1MSwKICAgICAgZGVub20yOiAuMzQ0ODQxLAogICAgICBzdXAxOiAuNDEyODkyLAogICAgICBzdXAyOiAuMzYyODkyLAogICAgICBzdXAzOiAuMjg4ODg4LAogICAgICBzdWIxOiAuMTUsCiAgICAgIHN1YjI6IC4yNDcyMTcsCiAgICAgIHN1cF9kcm9wOiAuMzg2MTA4LAogICAgICBzdWJfZHJvcDogLjA1LAogICAgICBkZWxpbTE6IDIuMzksCiAgICAgIGRlbGltMjogMS4wLAogICAgICBheGlzX2hlaWdodDogLjI1LAogICAgICBydWxlX3RoaWNrbmVzczogLjA2LAogICAgICBiaWdfb3Bfc3BhY2luZzE6IC4xMTExMTEsCiAgICAgIGJpZ19vcF9zcGFjaW5nMjogLjE2NjY2NiwKICAgICAgYmlnX29wX3NwYWNpbmczOiAuMiwKICAgICAgYmlnX29wX3NwYWNpbmc0OiAuNiwKICAgICAgYmlnX29wX3NwYWNpbmc1OiAuMSwKICAgICAgc2NyaXB0c3BhY2U6IC4xLAogICAgICBudWxsZGVsaW1pdGVyc3BhY2U6IC4xMiwKICAgICAgZGVsaW1pdGVyZmFjdG9yOiA5MDEsCiAgICAgIGRlbGltaXRlcnNob3J0ZmFsbDogLjMsCiAgICAgIG1pbl9ydWxlX3RoaWNrbmVzczogMS4yNSAvLyBpbiBwaXhlbHMKCiAgICB9LAogICAgTkJTUDogIlx4QTAiLAogICAgcmZ1eno6IDAgLy8gYWRqdXN0bWVudCB0byBydWxlIHBsYWNlbWVudHMgaW4gcm9vdHMKCiAgfSk7CiAgTWF0aEpheC5IdWIuUmVnaXN0ZXIuU3RhcnR1cEhvb2soIm1tbCBKYXggUmVhZHkiLCBmdW5jdGlvbiAoKSB7CiAgICBNTUwgPSBNYXRoSmF4LkVsZW1lbnRKYXgubW1sOwogICAgTU1MLm1iYXNlLkF1Z21lbnQoewogICAgICB0b0hUTUw6IGZ1bmN0aW9uIHRvSFRNTChzcGFuKSB7CiAgICAgICAgc3BhbiA9IHRoaXMuSFRNTGNyZWF0ZVNwYW4oc3Bhbik7CgogICAgICAgIGlmICh0aGlzLnR5cGUgIT0gIm1yb3ciKSB7CiAgICAgICAgICBzcGFuID0gdGhpcy5IVE1MaGFuZGxlU2l6ZShzcGFuKTsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBtID0gdGhpcy5kYXRhLmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgICAgaWYgKHRoaXMuZGF0YVtpXSkgewogICAgICAgICAgICB0aGlzLmRhdGFbaV0udG9IVE1MKHNwYW4pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHN0cmV0Y2h5ID0gdGhpcy5IVE1MY29tcHV0ZUJCb3goc3Bhbik7CiAgICAgICAgdmFyIGggPSBzcGFuLmJib3guaCwKICAgICAgICAgICAgZCA9IHNwYW4uYmJveC5kLAogICAgICAgICAgICBzdHJldGNoZWQgPSBmYWxzZSwKICAgICAgICAgICAgYmJveDsKCiAgICAgICAgZm9yIChpID0gMCwgbSA9IHN0cmV0Y2h5Lmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgICAgYmJveCA9IHN0cmV0Y2h5W2ldLkhUTUxzcGFuRWxlbWVudCgpLmJib3g7CgogICAgICAgICAgaWYgKHN0cmV0Y2h5W2ldLmZvcmNlU3RyZXRjaCB8fCBiYm94LmggIT09IGggfHwgYmJveC5kICE9PSBkKSB7CiAgICAgICAgICAgIHN0cmV0Y2h5W2ldLkhUTUxzdHJldGNoVihzcGFuLCBoLCBkKTsKICAgICAgICAgICAgc3RyZXRjaGVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAoc3RyZXRjaHlbaV0ubmVlZHNCQm94KSBzdHJldGNoZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHN0cmV0Y2hlZCkgewogICAgICAgICAgdGhpcy5IVE1MY29tcHV0ZUJCb3goc3BhbiwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5IVE1MbGluZUJyZWFrcyhzcGFuKSkgewogICAgICAgICAgc3BhbiA9IHRoaXMuSFRNTG11bHRpbGluZShzcGFuKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGhhbmRsZVNwYWNlKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZUNvbG9yKHNwYW4pOwoKICAgICAgICBpZiAodGhpcy5kYXRhLmxlbmd0aCA9PT0gMSAmJiB0aGlzLmRhdGFbMF0pIHsKICAgICAgICAgIC8vIGNvcHkgc2tldyBkYXRhIGZyb20gYWNjZW50ZWQgY2hhcmFjdGVyCiAgICAgICAgICBiYm94ID0gdGhpcy5kYXRhWzBdLkhUTUxzcGFuRWxlbWVudCgpLmJib3g7CiAgICAgICAgICBpZiAoYmJveC5za2V3KSBzcGFuLmJib3guc2tldyA9IGJib3guc2tldzsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzcGFuOwogICAgICB9LAogICAgICBIVE1MbGluZUJyZWFrczogZnVuY3Rpb24gSFRNTGxpbmVCcmVha3MoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9LAogICAgICBIVE1MbXVsdGlsaW5lOiBmdW5jdGlvbiBIVE1MbXVsdGlsaW5lKCkgewogICAgICAgIE1NTC5tYmFzZS5IVE1MYXV0b2xvYWRGaWxlKCJtdWx0aWxpbmUiKTsKICAgICAgfSwKICAgICAgSFRNTGNvbXB1dGVCQm94OiBmdW5jdGlvbiBIVE1MY29tcHV0ZUJCb3goc3BhbiwgZnVsbCwgaSwgbSkgewogICAgICAgIGlmIChpID09IG51bGwpIHsKICAgICAgICAgIGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgOwoKICAgICAgICBpZiAobSA9PSBudWxsKSB7CiAgICAgICAgICBtID0gdGhpcy5kYXRhLmxlbmd0aDsKICAgICAgICB9CgogICAgICAgIHZhciBCQk9YID0gc3Bhbi5iYm94ID0gewogICAgICAgICAgZXhhY3RXOiB0cnVlCiAgICAgICAgfSwKICAgICAgICAgICAgc3RyZXRjaHkgPSBbXTsKCiAgICAgICAgd2hpbGUgKGkgPCBtKSB7CiAgICAgICAgICB2YXIgY29yZSA9IHRoaXMuZGF0YVtpXTsKICAgICAgICAgIGlmICghY29yZSkgY29udGludWU7CgogICAgICAgICAgaWYgKCFmdWxsICYmIGNvcmUuSFRNTGNhblN0cmV0Y2goIlZlcnRpY2FsIikpIHsKICAgICAgICAgICAgc3RyZXRjaHkucHVzaChjb3JlKTsKICAgICAgICAgICAgY29yZSA9IGNvcmUuQ29yZU1PKCkgfHwgY29yZTsKICAgICAgICAgICAgc3RyZXRjaHlbc3RyZXRjaHkubGVuZ3RoIC0gMV0ubmVlZHNCQm94ID0gY29yZSAhPT0gdGhpcy5kYXRhW2ldOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuSFRNTGNvbWJpbmVCQm94ZXMoY29yZSwgQkJPWCk7CiAgICAgICAgICBpKys7CiAgICAgICAgfQoKICAgICAgICB0aGlzLkhUTUxjbGVhbkJCb3goQkJPWCk7CiAgICAgICAgcmV0dXJuIHN0cmV0Y2h5OwogICAgICB9LAogICAgICBIVE1MY29tYmluZUJCb3hlczogZnVuY3Rpb24gSFRNTGNvbWJpbmVCQm94ZXMoY29yZSwgQkJPWCkgewogICAgICAgIGlmIChCQk9YLncgPT0gbnVsbCkgewogICAgICAgICAgdGhpcy5IVE1MZW1wdHlCQm94KEJCT1gpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNoaWxkID0gY29yZS5iYm94ID8gY29yZSA6IGNvcmUuSFRNTHNwYW5FbGVtZW50KCk7CiAgICAgICAgaWYgKCFjaGlsZCB8fCAhY2hpbGQuYmJveCkgcmV0dXJuOwogICAgICAgIHZhciBiYm94ID0gY2hpbGQuYmJveDsKCiAgICAgICAgaWYgKGJib3guZCA+IEJCT1guZCkgewogICAgICAgICAgQkJPWC5kID0gYmJveC5kOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJib3guaCA+IEJCT1guaCkgewogICAgICAgICAgQkJPWC5oID0gYmJveC5oOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJib3guRCAhPSBudWxsICYmIGJib3guRCA+IEJCT1guRCkgewogICAgICAgICAgQkJPWC5EID0gYmJveC5EOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJib3guSCAhPSBudWxsICYmIGJib3guSCA+IEJCT1guSCkgewogICAgICAgICAgQkJPWC5IID0gYmJveC5IOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNoaWxkLnN0eWxlLnBhZGRpbmdMZWZ0KSB7CiAgICAgICAgICBCQk9YLncgKz0gSFRNTENTUy51bkVtKGNoaWxkLnN0eWxlLnBhZGRpbmdMZWZ0KSAqIChjaGlsZC5zY2FsZSB8fCAxKTsKICAgICAgICB9CgogICAgICAgIGlmIChCQk9YLncgKyBiYm94Lmx3IDwgQkJPWC5sdykgewogICAgICAgICAgQkJPWC5sdyA9IEJCT1gudyArIGJib3gubHc7CiAgICAgICAgfQoKICAgICAgICBpZiAoQkJPWC53ICsgYmJveC5ydyA+IEJCT1gucncpIHsKICAgICAgICAgIEJCT1gucncgPSBCQk9YLncgKyBiYm94LnJ3OwogICAgICAgIH0KCiAgICAgICAgQkJPWC53ICs9IGJib3gudzsKCiAgICAgICAgaWYgKGNoaWxkLnN0eWxlLnBhZGRpbmdSaWdodCkgewogICAgICAgICAgQkJPWC53ICs9IEhUTUxDU1MudW5FbShjaGlsZC5zdHlsZS5wYWRkaW5nUmlnaHQpICogKGNoaWxkLnNjYWxlIHx8IDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJib3gud2lkdGgpIHsKICAgICAgICAgIEJCT1gud2lkdGggPSBiYm94LndpZHRoOwogICAgICAgICAgQkJPWC5taW5XaWR0aCA9IGJib3gubWluV2lkdGg7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmJveC50dykgewogICAgICAgICAgQkJPWC50dyA9IGJib3gudHc7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmJveC5pYykgewogICAgICAgICAgQkJPWC5pYyA9IGJib3guaWM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlbGV0ZSBCQk9YLmljOwogICAgICAgIH0KCiAgICAgICAgaWYgKEJCT1guZXhhY3RXICYmICFiYm94LmV4YWN0VykgewogICAgICAgICAgQkJPWC5leGFjdFcgPSBiYm94LmV4YWN0VzsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIEhUTUxlbXB0eUJCb3g6IGZ1bmN0aW9uIEhUTUxlbXB0eUJCb3goQkJPWCkgewogICAgICAgIEJCT1guaCA9IEJCT1guZCA9IEJCT1guSCA9IEJCT1guRCA9IEJCT1gucncgPSAtSFRNTENTUy5CSUdESU1FTjsKICAgICAgICBCQk9YLncgPSAwOwogICAgICAgIEJCT1gubHcgPSBIVE1MQ1NTLkJJR0RJTUVOOwogICAgICAgIHJldHVybiBCQk9YOwogICAgICB9LAogICAgICBIVE1MY2xlYW5CQm94OiBmdW5jdGlvbiBIVE1MY2xlYW5CQm94KEJCT1gpIHsKICAgICAgICBpZiAoQkJPWC5oID09PSB0aGlzLkJJR0RJTUVOKSB7CiAgICAgICAgICBCQk9YLmggPSBCQk9YLmQgPSBCQk9YLkggPSBCQk9YLkQgPSBCQk9YLncgPSBCQk9YLnJ3ID0gQkJPWC5sdyA9IDA7CiAgICAgICAgfQoKICAgICAgICBpZiAoQkJPWC5EIDw9IEJCT1guZCkgewogICAgICAgICAgZGVsZXRlIEJCT1guRDsKICAgICAgICB9CgogICAgICAgIDsKCiAgICAgICAgaWYgKEJCT1guSCA8PSBCQk9YLmgpIHsKICAgICAgICAgIGRlbGV0ZSBCQk9YLkg7CiAgICAgICAgfQogICAgICB9LAogICAgICBIVE1MemVyb0JCb3g6IGZ1bmN0aW9uIEhUTUx6ZXJvQkJveCgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaDogMCwKICAgICAgICAgIGQ6IDAsCiAgICAgICAgICB3OiAwLAogICAgICAgICAgbHc6IDAsCiAgICAgICAgICBydzogMAogICAgICAgIH07CiAgICAgIH0sCiAgICAgIEhUTUxjYW5TdHJldGNoOiBmdW5jdGlvbiBIVE1MY2FuU3RyZXRjaChkaXJlY3Rpb24pIHsKICAgICAgICBpZiAodGhpcy5pc0VtYmVsbGlzaGVkKCkpIHsKICAgICAgICAgIHZhciBjb3JlID0gdGhpcy5Db3JlKCk7CgogICAgICAgICAgaWYgKGNvcmUgJiYgY29yZSAhPT0gdGhpcykgewogICAgICAgICAgICByZXR1cm4gY29yZS5IVE1MY2FuU3RyZXRjaChkaXJlY3Rpb24pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9LAogICAgICBIVE1Mc3RyZXRjaEg6IGZ1bmN0aW9uIEhUTUxzdHJldGNoSChib3gsIFcpIHsKICAgICAgICByZXR1cm4gdGhpcy5IVE1Mc3BhbkVsZW1lbnQoKTsKICAgICAgfSwKICAgICAgSFRNTHN0cmV0Y2hWOiBmdW5jdGlvbiBIVE1Mc3RyZXRjaFYoYm94LCBoLCBkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSFRNTHNwYW5FbGVtZW50KCk7CiAgICAgIH0sCiAgICAgIEhUTUxub3RFbXB0eTogZnVuY3Rpb24gSFRNTG5vdEVtcHR5KGRhdGEpIHsKICAgICAgICB3aGlsZSAoZGF0YSkgewogICAgICAgICAgaWYgKGRhdGEudHlwZSAhPT0gIm1yb3ciICYmIGRhdGEudHlwZSAhPT0gInRleGF0b20iIHx8IGRhdGEuZGF0YS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGRhdGEgPSBkYXRhLmRhdGFbMF07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCiAgICAgIEhUTUxtZWFzdXJlQ2hpbGQ6IGZ1bmN0aW9uIEhUTUxtZWFzdXJlQ2hpbGQobiwgYm94KSB7CiAgICAgICAgaWYgKHRoaXMuZGF0YVtuXSkgewogICAgICAgICAgSFRNTENTUy5NZWFzdXJlZCh0aGlzLmRhdGFbbl0udG9IVE1MKGJveCksIGJveCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJveC5iYm94ID0gdGhpcy5IVE1MemVyb0JCb3goKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIEhUTUxib3hDaGlsZDogZnVuY3Rpb24gSFRNTGJveENoaWxkKG4sIGJveCkgewogICAgICAgIGlmICghdGhpcy5kYXRhW25dKSB7CiAgICAgICAgICB0aGlzLlNldERhdGEobiwgTU1MLm1yb3coKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpcy5kYXRhW25dLnRvSFRNTChib3gpOwogICAgICB9LAogICAgICBIVE1MY3JlYXRlU3BhbjogZnVuY3Rpb24gSFRNTGNyZWF0ZVNwYW4oc3BhbikgewogICAgICAgIGlmICh0aGlzLnNwYW5JRCkgewogICAgICAgICAgdmFyIFNQQU4gPSB0aGlzLkhUTUxzcGFuRWxlbWVudCgpOwoKICAgICAgICAgIGlmIChTUEFOICYmIChTUEFOLnBhcmVudE5vZGUgPT09IHNwYW4gfHwgKFNQQU4ucGFyZW50Tm9kZSB8fCB7fSkucGFyZW50Tm9kZSA9PT0gc3BhbikpIHsKICAgICAgICAgICAgd2hpbGUgKFNQQU4uZmlyc3RDaGlsZCkgewogICAgICAgICAgICAgIFNQQU4ucmVtb3ZlQ2hpbGQoU1BBTi5maXJzdENoaWxkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgU1BBTi5iYm94ID0gdGhpcy5IVE1MemVyb0JCb3goKTsKICAgICAgICAgICAgU1BBTi5zY2FsZSA9IDE7CiAgICAgICAgICAgIFNQQU4uaXNNdWx0Q2hhciA9IFNQQU4uSEggPSBudWxsOwogICAgICAgICAgICBTUEFOLnN0eWxlLmNzc1RleHQgPSAiIjsKICAgICAgICAgICAgcmV0dXJuIFNQQU47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5ocmVmKSB7CiAgICAgICAgICBzcGFuID0gSFRNTENTUy5hZGRFbGVtZW50KHNwYW4sICJhIiwgewogICAgICAgICAgICBocmVmOiB0aGlzLmhyZWYsCiAgICAgICAgICAgIGlzTWF0aEpheDogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBzcGFuID0gSFRNTENTUy5hZGRFbGVtZW50KHNwYW4sICJzcGFuIiwgewogICAgICAgICAgY2xhc3NOYW1lOiB0aGlzLnR5cGUsCiAgICAgICAgICBpc01hdGhKYXg6IHRydWUKICAgICAgICB9KTsKCiAgICAgICAgaWYgKEhUTUxDU1MuaW1nSGVpZ2h0QnVnKSB7CiAgICAgICAgICBzcGFuLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzWyJjbGFzcyJdKSB7CiAgICAgICAgICBzcGFuLmNsYXNzTmFtZSArPSAiICIgKyB0aGlzWyJjbGFzcyJdOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0aGlzLnNwYW5JRCkgewogICAgICAgICAgdGhpcy5zcGFuSUQgPSBIVE1MQ1NTLkdldElEKCk7CiAgICAgICAgfQoKICAgICAgICBzcGFuLmlkID0gKHRoaXMuaWQgfHwgIk1hdGhKYXgtU3Bhbi0iICsgdGhpcy5zcGFuSUQpICsgSFRNTENTUy5pZFBvc3RmaXg7CiAgICAgICAgc3Bhbi5iYm94ID0gdGhpcy5IVE1MemVyb0JCb3goKTsKICAgICAgICB0aGlzLnN0eWxlcyA9IHt9OwoKICAgICAgICBpZiAodGhpcy5zdHlsZSkgewogICAgICAgICAgc3Bhbi5zdHlsZS5jc3NUZXh0ID0gdGhpcy5zdHlsZTsKCiAgICAgICAgICBpZiAoc3Bhbi5zdHlsZS5mb250U2l6ZSkgewogICAgICAgICAgICB0aGlzLm1hdGhzaXplID0gc3Bhbi5zdHlsZS5mb250U2l6ZTsKICAgICAgICAgICAgc3Bhbi5zdHlsZS5mb250U2l6ZSA9ICIiOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc3R5bGVzID0gewogICAgICAgICAgICBib3JkZXI6IEhUTUxDU1MuZ2V0Qm9yZGVycyhzcGFuKSwKICAgICAgICAgICAgcGFkZGluZzogSFRNTENTUy5nZXRQYWRkaW5nKHNwYW4pCiAgICAgICAgICB9OwoKICAgICAgICAgIGlmICh0aGlzLnN0eWxlcy5ib3JkZXIpIHsKICAgICAgICAgICAgc3Bhbi5zdHlsZS5ib3JkZXIgPSAiIjsKICAgICAgICAgIH0gLy8gSUUgbmVlZHMgIjBweCBub25lIj8KCgogICAgICAgICAgaWYgKHRoaXMuc3R5bGVzLnBhZGRpbmcpIHsKICAgICAgICAgICAgc3Bhbi5zdHlsZS5wYWRkaW5nID0gIiI7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5ocmVmKSB7CiAgICAgICAgICBzcGFuLnBhcmVudE5vZGUuYmJveCA9IHNwYW4uYmJveDsKICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGFkZEF0dHJpYnV0ZXMoc3Bhbik7CiAgICAgICAgcmV0dXJuIHNwYW47CiAgICAgIH0sCiAgICAgIEhUTUxhZGRBdHRyaWJ1dGVzOiBmdW5jdGlvbiBIVE1MYWRkQXR0cmlidXRlcyhzcGFuKSB7CiAgICAgICAgLy8KICAgICAgICAvLyAgQ29weSBSREZhLCBhcmlhLCBhbmQgb3RoZXIgdGFncyBmcm9tIHRoZSBNYXRoTUwgdG8gdGhlIEhUTUwtQ1NTCiAgICAgICAgLy8gIG91dHB1dCBzcGFucy4gIERvbid0IGNvcHkgdGhvc2UgaW4gdGhlIE1NTC5ub2NvcHlBdHRyaWJ1dGVzIGxpc3QsCiAgICAgICAgLy8gIHRoZSBpZ25vcmVNTUxhdHRyaWJ1dGVzIGNvbmZpZ3VyYXRpb24gbGlzdCwgb3IgYW55dGhpbmcgdGhhdAogICAgICAgIC8vICBhbHJlYWR5IGV4aXN0cyBhcyBhIHByb3BlcnR5IG9mIHRoZSBzcGFuIChlLmcuLCBubyAib25saWNrIiwgZXRjLikKICAgICAgICAvLyAgSWYgYSBuYW1lIGluIHRoZSBpZ25vcmVNTUxhdHRyaWJ1dGVzIG9iamVjdCBpcyBzZXQgdG8gZmFsc2UsIHRoZW4KICAgICAgICAvLyAgdGhlIGF0dHJpYnV0ZSBXSUxMIGJlIGNvcGllZC4KICAgICAgICAvLwogICAgICAgIGlmICh0aGlzLmF0dHJOYW1lcykgewogICAgICAgICAgdmFyIGNvcHkgPSB0aGlzLmF0dHJOYW1lcywKICAgICAgICAgICAgICBza2lwID0gTU1MLm5vY29weUF0dHJpYnV0ZXMsCiAgICAgICAgICAgICAgaWdub3JlID0gSFVCLmNvbmZpZy5pZ25vcmVNTUxhdHRyaWJ1dGVzOwogICAgICAgICAgdmFyIGRlZmF1bHRzID0gdGhpcy50eXBlID09PSAibXN0eWxlIiA/IE1NTC5tYXRoLnByb3RvdHlwZS5kZWZhdWx0cyA6IHRoaXMuZGVmYXVsdHM7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG0gPSBjb3B5Lmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgICAgICB2YXIgaWQgPSBjb3B5W2ldOwoKICAgICAgICAgICAgaWYgKGlnbm9yZVtpZF0gPT0gZmFsc2UgfHwgIXNraXBbaWRdICYmICFpZ25vcmVbaWRdICYmIGRlZmF1bHRzW2lkXSA9PSBudWxsICYmIHR5cGVvZiBzcGFuW2lkXSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZShpZCwgdGhpcy5hdHRyW2lkXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIEhUTUxzcGFuRWxlbWVudDogZnVuY3Rpb24gSFRNTHNwYW5FbGVtZW50KCkgewogICAgICAgIGlmICghdGhpcy5zcGFuSUQpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCh0aGlzLmlkIHx8ICJNYXRoSmF4LVNwYW4tIiArIHRoaXMuc3BhbklEKSArIEhUTUxDU1MuaWRQb3N0Zml4KTsKICAgICAgfSwKICAgICAgSFRNTGhhbmRsZVZhcmlhbnQ6IGZ1bmN0aW9uIEhUTUxoYW5kbGVWYXJpYW50KHNwYW4sIHZhcmlhbnQsIHRleHQpIHsKICAgICAgICBIVE1MQ1NTLmhhbmRsZVZhcmlhbnQoc3BhbiwgdmFyaWFudCwgdGV4dCk7CiAgICAgIH0sCiAgICAgIEhUTUxoYW5kbGVTaXplOiBmdW5jdGlvbiBIVE1MaGFuZGxlU2l6ZShzcGFuKSB7CiAgICAgICAgaWYgKCFzcGFuLnNjYWxlKSB7CiAgICAgICAgICBzcGFuLnNjYWxlID0gdGhpcy5IVE1MZ2V0U2NhbGUoKTsKCiAgICAgICAgICBpZiAoc3Bhbi5zY2FsZSAhPT0gMSkgewogICAgICAgICAgICBzcGFuLnN0eWxlLmZvbnRTaXplID0gSFRNTENTUy5QZXJjZW50KHNwYW4uc2NhbGUpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNwYW47CiAgICAgIH0sCiAgICAgIEhUTUxoYW5kbGVEaXI6IGZ1bmN0aW9uIEhUTUxoYW5kbGVEaXIoc3BhbikgewogICAgICAgIHZhciBkaXIgPSB0aGlzLkdldCgiZGlyIiwgdHJ1ZSk7IC8vIG9ubHkgZ2V0IHZhbHVlIGlmIG5vdCB0aGUgZGVmYXVsdAoKICAgICAgICBpZiAoZGlyKSB7CiAgICAgICAgICBzcGFuLmRpciA9IGRpcjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzcGFuOwogICAgICB9LAogICAgICBIVE1MaGFuZGxlQ29sb3I6IGZ1bmN0aW9uIEhUTUxoYW5kbGVDb2xvcihzcGFuKSB7CiAgICAgICAgdmFyIHZhbHVlcyA9IHRoaXMuZ2V0VmFsdWVzKCJtYXRoY29sb3IiLCAiY29sb3IiKTsKCiAgICAgICAgaWYgKHRoaXMubWF0aGJhY2tncm91bmQpIHsKICAgICAgICAgIHZhbHVlcy5tYXRoYmFja2dyb3VuZCA9IHRoaXMubWF0aGJhY2tncm91bmQ7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5iYWNrZ3JvdW5kKSB7CiAgICAgICAgICB2YWx1ZXMuYmFja2dyb3VuZCA9IHRoaXMuYmFja2dyb3VuZDsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLnN0eWxlICYmIHNwYW4uc3R5bGUuYmFja2dyb3VuZENvbG9yKSB7CiAgICAgICAgICB2YWx1ZXMubWF0aGJhY2tncm91bmQgPSBzcGFuLnN0eWxlLmJhY2tncm91bmRDb2xvcjsKICAgICAgICAgIHNwYW4uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInRyYW5zcGFyZW50IjsKICAgICAgICB9CgogICAgICAgIHZhciBib3JkZXJzID0gKHRoaXMuc3R5bGVzIHx8IHt9KS5ib3JkZXIsCiAgICAgICAgICAgIHBhZGRpbmcgPSAodGhpcy5zdHlsZXMgfHwge30pLnBhZGRpbmc7CgogICAgICAgIGlmICh2YWx1ZXMuY29sb3IgJiYgIXRoaXMubWF0aGNvbG9yKSB7CiAgICAgICAgICB2YWx1ZXMubWF0aGNvbG9yID0gdmFsdWVzLmNvbG9yOwogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbHVlcy5iYWNrZ3JvdW5kICYmICF0aGlzLm1hdGhiYWNrZ3JvdW5kKSB7CiAgICAgICAgICB2YWx1ZXMubWF0aGJhY2tncm91bmQgPSB2YWx1ZXMuYmFja2dyb3VuZDsKICAgICAgICB9CgogICAgICAgIGlmICh2YWx1ZXMubWF0aGNvbG9yKSB7CiAgICAgICAgICBzcGFuLnN0eWxlLmNvbG9yID0gdmFsdWVzLm1hdGhjb2xvcjsKICAgICAgICB9CgogICAgICAgIGlmICh2YWx1ZXMubWF0aGJhY2tncm91bmQgJiYgdmFsdWVzLm1hdGhiYWNrZ3JvdW5kICE9PSBNTUwuQ09MT1IuVFJBTlNQQVJFTlQgfHwgYm9yZGVycyB8fCBwYWRkaW5nKSB7CiAgICAgICAgICB2YXIgYmJveCA9IHNwYW4uYmJveCwKICAgICAgICAgICAgICBkZCA9IGJib3guZXhhY3QgPyAwIDogMSAvIEhUTUxDU1MuZW0sCiAgICAgICAgICAgICAgbFcgPSAwLAogICAgICAgICAgICAgIHJXID0gMCwKICAgICAgICAgICAgICBscGFkID0gc3Bhbi5zdHlsZS5wYWRkaW5nTGVmdCwKICAgICAgICAgICAgICBycGFkID0gc3Bhbi5zdHlsZS5wYWRkaW5nUmlnaHQ7CgogICAgICAgICAgaWYgKHRoaXMuaXNUb2tlbikgewogICAgICAgICAgICBsVyA9IGJib3gubHc7CiAgICAgICAgICAgIHJXID0gYmJveC5ydyAtIGJib3gudzsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobHBhZCAhPT0gIiIpIHsKICAgICAgICAgICAgbFcgKz0gSFRNTENTUy51bkVtKGxwYWQpICogKHNwYW4uc2NhbGUgfHwgMSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHJwYWQgIT09ICIiKSB7CiAgICAgICAgICAgIHJXIC09IEhUTUxDU1MudW5FbShycGFkKSAqIChzcGFuLnNjYWxlIHx8IDEpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkdyA9IEhUTUxDU1MuUGFkZGluZ1dpZHRoQnVnIHx8IGJib3gua2VlcFBhZGRpbmcgfHwgYmJveC5leGFjdFcgPyAwIDogclcgLSBsVzsKICAgICAgICAgIHZhciBXID0gTWF0aC5tYXgoMCwgSFRNTENTUy5nZXRXKHNwYW4pICsgZHcpOwogICAgICAgICAgdmFyIEggPSBiYm94LmggKyBiYm94LmQsCiAgICAgICAgICAgICAgRCA9IC1iYm94LmQsCiAgICAgICAgICAgICAgbHAgPSAwLAogICAgICAgICAgICAgIHJwID0gMDsKCiAgICAgICAgICBpZiAoVyA+IDApIHsKICAgICAgICAgICAgVyArPSAyICogZGQ7CiAgICAgICAgICAgIGxXIC09IGRkOwogICAgICAgICAgfQoKICAgICAgICAgIDsKCiAgICAgICAgICBpZiAoSCA+IDApIHsKICAgICAgICAgICAgSCArPSAyICogZGQ7CiAgICAgICAgICAgIEQgLT0gZGQ7CiAgICAgICAgICB9CgogICAgICAgICAgOwogICAgICAgICAgclcgPSAtVyAtIGxXOwoKICAgICAgICAgIGlmIChib3JkZXJzKSB7CiAgICAgICAgICAgIHJXIC09IGJvcmRlcnMucmlnaHQ7CiAgICAgICAgICAgIEQgLT0gYm9yZGVycy5ib3R0b207CiAgICAgICAgICAgIGxwICs9IGJvcmRlcnMubGVmdDsKICAgICAgICAgICAgcnAgKz0gYm9yZGVycy5yaWdodDsKICAgICAgICAgICAgYmJveC5oICs9IGJvcmRlcnMudG9wOwogICAgICAgICAgICBiYm94LmQgKz0gYm9yZGVycy5ib3R0b207CiAgICAgICAgICAgIGJib3gudyArPSBib3JkZXJzLmxlZnQgKyBib3JkZXJzLnJpZ2h0OwogICAgICAgICAgICBiYm94Lmx3IC09IGJvcmRlcnMubGVmdDsKICAgICAgICAgICAgYmJveC5ydyArPSBib3JkZXJzLnJpZ2h0OwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwYWRkaW5nKSB7CiAgICAgICAgICAgIEggKz0gcGFkZGluZy50b3AgKyBwYWRkaW5nLmJvdHRvbTsKICAgICAgICAgICAgVyArPSBwYWRkaW5nLmxlZnQgKyBwYWRkaW5nLnJpZ2h0OwogICAgICAgICAgICByVyAtPSBwYWRkaW5nLnJpZ2h0OwogICAgICAgICAgICBEIC09IHBhZGRpbmcuYm90dG9tOwogICAgICAgICAgICBscCArPSBwYWRkaW5nLmxlZnQ7CiAgICAgICAgICAgIHJwICs9IHBhZGRpbmcucmlnaHQ7CiAgICAgICAgICAgIGJib3guaCArPSBwYWRkaW5nLnRvcDsKICAgICAgICAgICAgYmJveC5kICs9IHBhZGRpbmcuYm90dG9tOwogICAgICAgICAgICBiYm94LncgKz0gcGFkZGluZy5sZWZ0ICsgcGFkZGluZy5yaWdodDsKICAgICAgICAgICAgYmJveC5sdyAtPSBwYWRkaW5nLmxlZnQ7CiAgICAgICAgICAgIGJib3gucncgKz0gcGFkZGluZy5yaWdodDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocnApIHsKICAgICAgICAgICAgc3Bhbi5zdHlsZS5wYWRkaW5nUmlnaHQgPSBIVE1MQ1NTLkVtKHJwKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZnJhbWUgPSBIVE1MQ1NTLkVsZW1lbnQoInNwYW4iLCB7CiAgICAgICAgICAgIGlkOiAiTWF0aEpheC1Db2xvci0iICsgdGhpcy5zcGFuSUQgKyBIVE1MQ1NTLmlkUG9zdGZpeCwKICAgICAgICAgICAgaXNNYXRoSmF4OiB0cnVlLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUtYmxvY2siLAogICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogdmFsdWVzLm1hdGhiYWNrZ3JvdW5kLAogICAgICAgICAgICAgIHdpZHRoOiBIVE1MQ1NTLkVtKFcpLAogICAgICAgICAgICAgIGhlaWdodDogSFRNTENTUy5FbShIKSwKICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiBIVE1MQ1NTLkVtKEQpLAogICAgICAgICAgICAgIG1hcmdpbkxlZnQ6IEhUTUxDU1MuRW0obFcpLAogICAgICAgICAgICAgIG1hcmdpblJpZ2h0OiBIVE1MQ1NTLkVtKHJXKQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIEhUTUxDU1Muc2V0Qm9yZGVycyhmcmFtZSwgYm9yZGVycyk7CgogICAgICAgICAgaWYgKGJib3gud2lkdGgpIHsKICAgICAgICAgICAgZnJhbWUuc3R5bGUud2lkdGggPSBiYm94LndpZHRoOwogICAgICAgICAgICBmcmFtZS5zdHlsZS5tYXJnaW5SaWdodCA9ICItIiArIGJib3gud2lkdGg7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKEhUTUxDU1MubXNpZUlubGluZUJsb2NrQWxpZ25CdWcpIHsKICAgICAgICAgICAgLy8gRklYTUU6ICBoYW5kbGUgdmFyaWFibGUgd2lkdGggYmFja2dyb3VuZAogICAgICAgICAgICBmcmFtZS5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CiAgICAgICAgICAgIGZyYW1lLnN0eWxlLndpZHRoID0gZnJhbWUuc3R5bGUuaGVpZ2h0ID0gMDsKICAgICAgICAgICAgZnJhbWUuc3R5bGUudmVydGljYWxBbGlnbiA9IGZyYW1lLnN0eWxlLm1hcmdpbkxlZnQgPSBmcmFtZS5zdHlsZS5tYXJnaW5SaWdodCA9ICIiOwogICAgICAgICAgICBmcmFtZS5zdHlsZS5ib3JkZXIgPSBmcmFtZS5zdHlsZS5wYWRkaW5nID0gIiI7CgogICAgICAgICAgICBpZiAoYm9yZGVycyAmJiBIVE1MQ1NTLm1zaWVCb3JkZXJXaWR0aEJ1ZykgewogICAgICAgICAgICAgIEggKz0gYm9yZGVycy50b3AgKyBib3JkZXJzLmJvdHRvbTsKICAgICAgICAgICAgICBXICs9IGJvcmRlcnMubGVmdCArIGJvcmRlcnMucmlnaHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZyYW1lLnN0eWxlLndpZHRoID0gSFRNTENTUy5FbShscCArIGRkKTsKICAgICAgICAgICAgSFRNTENTUy5wbGFjZUJveChIVE1MQ1NTLmFkZEVsZW1lbnQoZnJhbWUsICJzcGFuIiwgewogICAgICAgICAgICAgIG5vQWRqdXN0OiB0cnVlLAogICAgICAgICAgICAgIGlzTWF0aEpheDogdHJ1ZSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgZGlzcGxheTogImlubGluZS1ibG9jayIsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgICAgIG92ZXJmbG93OiAiaGlkZGVuIiwKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhbHVlcy5tYXRoYmFja2dyb3VuZCB8fCAidHJhbnNwYXJlbnQiLAogICAgICAgICAgICAgICAgd2lkdGg6IEhUTUxDU1MuRW0oVyksCiAgICAgICAgICAgICAgICBoZWlnaHQ6IEhUTUxDU1MuRW0oSCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLCBsVywgYmJveC5oICsgZGQpOwogICAgICAgICAgICBIVE1MQ1NTLnNldEJvcmRlcnMoZnJhbWUuZmlyc3RDaGlsZCwgYm9yZGVycyk7CiAgICAgICAgICB9CgogICAgICAgICAgc3Bhbi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShmcmFtZSwgc3Bhbik7CgogICAgICAgICAgaWYgKEhUTUxDU1MubXNpZUNvbG9yUG9zaXRpb25CdWcpIHsKICAgICAgICAgICAgc3Bhbi5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGZyYW1lOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0sCiAgICAgIEhUTUxyZW1vdmVDb2xvcjogZnVuY3Rpb24gSFRNTHJlbW92ZUNvbG9yKCkgewogICAgICAgIHZhciBjb2xvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJNYXRoSmF4LUNvbG9yLSIgKyB0aGlzLnNwYW5JRCArIEhUTUxDU1MuaWRQb3N0Zml4KTsKCiAgICAgICAgaWYgKGNvbG9yKSB7CiAgICAgICAgICBjb2xvci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGNvbG9yKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIEhUTUxoYW5kbGVTcGFjZTogZnVuY3Rpb24gSFRNTGhhbmRsZVNwYWNlKHNwYW4pIHsKICAgICAgICBpZiAodGhpcy51c2VNTUxzcGFjaW5nKSB7CiAgICAgICAgICBpZiAodGhpcy50eXBlICE9PSAibW8iKSByZXR1cm47CiAgICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoInNjcmlwdGxldmVsIiwgImxzcGFjZSIsICJyc3BhY2UiKTsKCiAgICAgICAgICBpZiAodmFsdWVzLnNjcmlwdGxldmVsIDw9IDAgfHwgdGhpcy5oYXNWYWx1ZSgibHNwYWNlIikgfHwgdGhpcy5oYXNWYWx1ZSgicnNwYWNlIikpIHsKICAgICAgICAgICAgdmFyIG11ID0gdGhpcy5IVE1MZ2V0TXUoc3Bhbik7CiAgICAgICAgICAgIHZhbHVlcy5sc3BhY2UgPSBNYXRoLm1heCgwLCBIVE1MQ1NTLmxlbmd0aDJlbSh2YWx1ZXMubHNwYWNlLCBtdSkpOwogICAgICAgICAgICB2YWx1ZXMucnNwYWNlID0gTWF0aC5tYXgoMCwgSFRNTENTUy5sZW5ndGgyZW0odmFsdWVzLnJzcGFjZSwgbXUpKTsKICAgICAgICAgICAgdmFyIGNvcmUgPSB0aGlzLAogICAgICAgICAgICAgICAgcGFyZW50ID0gdGhpcy5QYXJlbnQoKTsKCiAgICAgICAgICAgIHdoaWxlIChwYXJlbnQgJiYgcGFyZW50LmlzRW1iZWxsaXNoZWQoKSAmJiBwYXJlbnQuQ29yZSgpID09PSBjb3JlKSB7CiAgICAgICAgICAgICAgY29yZSA9IHBhcmVudDsKICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQuUGFyZW50KCk7CiAgICAgICAgICAgICAgc3BhbiA9IGNvcmUuSFRNTHNwYW5FbGVtZW50KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWx1ZXMubHNwYWNlKSB7CiAgICAgICAgICAgICAgc3Bhbi5zdHlsZS5wYWRkaW5nTGVmdCA9IEhUTUxDU1MuRW0odmFsdWVzLmxzcGFjZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWx1ZXMucnNwYWNlKSB7CiAgICAgICAgICAgICAgc3Bhbi5zdHlsZS5wYWRkaW5nUmlnaHQgPSBIVE1MQ1NTLkVtKHZhbHVlcy5yc3BhY2UpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBzcGFjZSA9IHRoaXMudGV4U3BhY2luZygpOwoKICAgICAgICAgIGlmIChzcGFjZSAhPT0gIiIpIHsKICAgICAgICAgICAgdGhpcy5IVE1MZ2V0U2NhbGUoKTsKICAgICAgICAgICAgc3BhY2UgPSBIVE1MQ1NTLmxlbmd0aDJlbShzcGFjZSwgdGhpcy5zY2FsZSkgLyAoc3Bhbi5zY2FsZSB8fCAxKSAqIHRoaXMubXNjYWxlOwoKICAgICAgICAgICAgaWYgKHNwYW4uc3R5bGUucGFkZGluZ0xlZnQpIHsKICAgICAgICAgICAgICBzcGFjZSArPSBIVE1MQ1NTLnVuRW0oc3Bhbi5zdHlsZS5wYWRkaW5nTGVmdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNwYW4uc3R5bGUucGFkZGluZ0xlZnQgPSBIVE1MQ1NTLkVtKHNwYWNlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIEhUTUxnZXRTY2FsZTogZnVuY3Rpb24gSFRNTGdldFNjYWxlKCkgewogICAgICAgIGlmICh0aGlzLnNjYWxlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5zY2FsZSAqIHRoaXMubXNjYWxlOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNjYWxlID0gMSwKICAgICAgICAgICAgdmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoInNjcmlwdGxldmVsIiwgImZvbnRzaXplIik7CiAgICAgICAgdmFsdWVzLm1hdGhzaXplID0gKHRoaXMuaXNUb2tlbiA/IHRoaXMgOiB0aGlzLlBhcmVudCgpKS5HZXQoIm1hdGhzaXplIik7CgogICAgICAgIGlmICh0aGlzLnN0eWxlKSB7CiAgICAgICAgICB2YXIgc3BhbiA9IHRoaXMuSFRNTHNwYW5FbGVtZW50KCk7CgogICAgICAgICAgaWYgKHNwYW4uc3R5bGUuZm9udFNpemUgIT0gIiIpIHsKICAgICAgICAgICAgdmFsdWVzLmZvbnRzaXplID0gc3Bhbi5zdHlsZS5mb250U2l6ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh2YWx1ZXMuZm9udHNpemUgJiYgIXRoaXMubWF0aHNpemUpIHsKICAgICAgICAgIHZhbHVlcy5tYXRoc2l6ZSA9IHZhbHVlcy5mb250c2l6ZTsKICAgICAgICB9CgogICAgICAgIGlmICh2YWx1ZXMuc2NyaXB0bGV2ZWwgIT09IDApIHsKICAgICAgICAgIGlmICh2YWx1ZXMuc2NyaXB0bGV2ZWwgPiAyKSB7CiAgICAgICAgICAgIHZhbHVlcy5zY3JpcHRsZXZlbCA9IDI7CiAgICAgICAgICB9CgogICAgICAgICAgc2NhbGUgPSBNYXRoLnBvdyh0aGlzLkdldCgic2NyaXB0c2l6ZW11bHRpcGxpZXIiKSwgdmFsdWVzLnNjcmlwdGxldmVsKTsKICAgICAgICAgIHZhbHVlcy5zY3JpcHRtaW5zaXplID0gSFRNTENTUy5sZW5ndGgyZW0odGhpcy5HZXQoInNjcmlwdG1pbnNpemUiKSk7CgogICAgICAgICAgaWYgKHNjYWxlIDwgdmFsdWVzLnNjcmlwdG1pbnNpemUpIHsKICAgICAgICAgICAgc2NhbGUgPSB2YWx1ZXMuc2NyaXB0bWluc2l6ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuc2NhbGUgPSBzY2FsZTsKICAgICAgICB0aGlzLm1zY2FsZSA9IEhUTUxDU1MubGVuZ3RoMmVtKHZhbHVlcy5tYXRoc2l6ZSk7CiAgICAgICAgcmV0dXJuIHNjYWxlICogdGhpcy5tc2NhbGU7CiAgICAgIH0sCiAgICAgIEhUTUxnZXRNdTogZnVuY3Rpb24gSFRNTGdldE11KHNwYW4pIHsKICAgICAgICB2YXIgbXUgPSAxLAogICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLmdldFZhbHVlcygic2NyaXB0bGV2ZWwiLCAic2NyaXB0c2l6ZW11bHRpcGxpZXIiKTsKCiAgICAgICAgaWYgKHNwYW4uc2NhbGUgJiYgc3Bhbi5zY2FsZSAhPT0gMSkgewogICAgICAgICAgbXUgPSAxIC8gc3Bhbi5zY2FsZTsKICAgICAgICB9CgogICAgICAgIGlmICh2YWx1ZXMuc2NyaXB0bGV2ZWwgIT09IDApIHsKICAgICAgICAgIGlmICh2YWx1ZXMuc2NyaXB0bGV2ZWwgPiAyKSB7CiAgICAgICAgICAgIHZhbHVlcy5zY3JpcHRsZXZlbCA9IDI7CiAgICAgICAgICB9CgogICAgICAgICAgbXUgPSBNYXRoLnNxcnQoTWF0aC5wb3codmFsdWVzLnNjcmlwdHNpemVtdWx0aXBsaWVyLCB2YWx1ZXMuc2NyaXB0bGV2ZWwpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtdTsKICAgICAgfSwKICAgICAgSFRNTGdldFZhcmlhbnQ6IGZ1bmN0aW9uIEhUTUxnZXRWYXJpYW50KCkgewogICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLmdldFZhbHVlcygibWF0aHZhcmlhbnQiLCAiZm9udGZhbWlseSIsICJmb250d2VpZ2h0IiwgImZvbnRzdHlsZSIpOwogICAgICAgIHZhbHVlcy5oYXNWYXJpYW50ID0gdGhpcy5HZXQoIm1hdGh2YXJpYW50IiwgdHJ1ZSk7IC8vIG51bGwgaWYgbm90IGV4cGxpY2l0bHkgc3BlY2lmaWVkCgogICAgICAgIGlmICghdmFsdWVzLmhhc1ZhcmlhbnQpIHsKICAgICAgICAgIHZhbHVlcy5mYW1pbHkgPSB2YWx1ZXMuZm9udGZhbWlseTsKICAgICAgICAgIHZhbHVlcy53ZWlnaHQgPSB2YWx1ZXMuZm9udHdlaWdodDsKICAgICAgICAgIHZhbHVlcy5zdHlsZSA9IHZhbHVlcy5mb250c3R5bGU7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5zdHlsZSkgewogICAgICAgICAgdmFyIHNwYW4gPSB0aGlzLkhUTUxzcGFuRWxlbWVudCgpOwoKICAgICAgICAgIGlmICghdmFsdWVzLmZhbWlseSAmJiBzcGFuLnN0eWxlLmZvbnRGYW1pbHkpIHsKICAgICAgICAgICAgdmFsdWVzLmZhbWlseSA9IHNwYW4uc3R5bGUuZm9udEZhbWlseTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXZhbHVlcy53ZWlnaHQgJiYgc3Bhbi5zdHlsZS5mb250V2VpZ2h0KSB7CiAgICAgICAgICAgIHZhbHVlcy53ZWlnaHQgPSBzcGFuLnN0eWxlLmZvbnRXZWlnaHQ7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCF2YWx1ZXMuc3R5bGUgJiYgc3Bhbi5zdHlsZS5mb250U3R5bGUpIHsKICAgICAgICAgICAgdmFsdWVzLnN0eWxlID0gc3Bhbi5zdHlsZS5mb250U3R5bGU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsdWVzLndlaWdodCAmJiB2YWx1ZXMud2VpZ2h0Lm1hdGNoKC9eXGQrJC8pKSB7CiAgICAgICAgICB2YWx1ZXMud2VpZ2h0ID0gcGFyc2VJbnQodmFsdWVzLndlaWdodCkgPiA2MDAgPyAiYm9sZCIgOiAibm9ybWFsIjsKICAgICAgICB9CgogICAgICAgIHZhciB2YXJpYW50ID0gdmFsdWVzLm1hdGh2YXJpYW50OwoKICAgICAgICBpZiAodGhpcy52YXJpYW50Rm9ybSkgewogICAgICAgICAgdmFyaWFudCA9ICItIiArIEhUTUxDU1MuZm9udEluVXNlICsgIi12YXJpYW50IjsKICAgICAgICB9CgogICAgICAgIGlmICh2YWx1ZXMuZmFtaWx5ICYmICF2YWx1ZXMuaGFzVmFyaWFudCkgewogICAgICAgICAgaWYgKCF2YWx1ZXMud2VpZ2h0ICYmIHZhbHVlcy5tYXRodmFyaWFudC5tYXRjaCgvYm9sZC8pKSB7CiAgICAgICAgICAgIHZhbHVlcy53ZWlnaHQgPSAiYm9sZCI7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCF2YWx1ZXMuc3R5bGUgJiYgdmFsdWVzLm1hdGh2YXJpYW50Lm1hdGNoKC9pdGFsaWMvKSkgewogICAgICAgICAgICB2YWx1ZXMuc3R5bGUgPSAiaXRhbGljIjsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBGT05UUzogW10sCiAgICAgICAgICAgIGZvbnRzOiBbXSwKICAgICAgICAgICAgbm9SZW1hcDogdHJ1ZSwKICAgICAgICAgICAgZGVmYXVsdEZvbnQ6IHsKICAgICAgICAgICAgICBmYW1pbHk6IHZhbHVlcy5mYW1pbHksCiAgICAgICAgICAgICAgc3R5bGU6IHZhbHVlcy5zdHlsZSwKICAgICAgICAgICAgICB3ZWlnaHQ6IHZhbHVlcy53ZWlnaHQKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGlmICh2YWx1ZXMud2VpZ2h0ID09PSAiYm9sZCIpIHsKICAgICAgICAgIHZhcmlhbnQgPSB7CiAgICAgICAgICAgIG5vcm1hbDogTU1MLlZBUklBTlQuQk9MRCwKICAgICAgICAgICAgaXRhbGljOiBNTUwuVkFSSUFOVC5CT0xESVRBTElDLAogICAgICAgICAgICBmcmFrdHVyOiBNTUwuVkFSSUFOVC5CT0xERlJBS1RVUiwKICAgICAgICAgICAgc2NyaXB0OiBNTUwuVkFSSUFOVC5CT0xEU0NSSVBULAogICAgICAgICAgICAic2Fucy1zZXJpZiI6IE1NTC5WQVJJQU5ULkJPTERTQU5TU0VSSUYsCiAgICAgICAgICAgICJzYW5zLXNlcmlmLWl0YWxpYyI6IE1NTC5WQVJJQU5ULlNBTlNTRVJJRkJPTERJVEFMSUMKICAgICAgICAgIH1bdmFyaWFudF0gfHwgdmFyaWFudDsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlcy53ZWlnaHQgPT09ICJub3JtYWwiKSB7CiAgICAgICAgICB2YXJpYW50ID0gewogICAgICAgICAgICBib2xkOiBNTUwuVkFSSUFOVC5ub3JtYWwsCiAgICAgICAgICAgICJib2xkLWl0YWxpYyI6IE1NTC5WQVJJQU5ULklUQUxJQywKICAgICAgICAgICAgImJvbGQtZnJha3R1ciI6IE1NTC5WQVJJQU5ULkZSQUtUVVIsCiAgICAgICAgICAgICJib2xkLXNjcmlwdCI6IE1NTC5WQVJJQU5ULlNDUklQVCwKICAgICAgICAgICAgImJvbGQtc2Fucy1zZXJpZiI6IE1NTC5WQVJJQU5ULlNBTlNTRVJJRiwKICAgICAgICAgICAgInNhbnMtc2VyaWYtYm9sZC1pdGFsaWMiOiBNTUwuVkFSSUFOVC5TQU5TU0VSSUZJVEFMSUMKICAgICAgICAgIH1bdmFyaWFudF0gfHwgdmFyaWFudDsKICAgICAgICB9CgogICAgICAgIGlmICh2YWx1ZXMuc3R5bGUgPT09ICJpdGFsaWMiKSB7CiAgICAgICAgICB2YXJpYW50ID0gewogICAgICAgICAgICBub3JtYWw6IE1NTC5WQVJJQU5ULklUQUxJQywKICAgICAgICAgICAgYm9sZDogTU1MLlZBUklBTlQuQk9MRElUQUxJQywKICAgICAgICAgICAgInNhbnMtc2VyaWYiOiBNTUwuVkFSSUFOVC5TQU5TU0VSSUZJVEFMSUMsCiAgICAgICAgICAgICJib2xkLXNhbnMtc2VyaWYiOiBNTUwuVkFSSUFOVC5TQU5TU0VSSUZCT0xESVRBTElDCiAgICAgICAgICB9W3ZhcmlhbnRdIHx8IHZhcmlhbnQ7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZXMuc3R5bGUgPT09ICJub3JtYWwiKSB7CiAgICAgICAgICB2YXJpYW50ID0gewogICAgICAgICAgICBpdGFsaWM6IE1NTC5WQVJJQU5ULk5PUk1BTCwKICAgICAgICAgICAgImJvbGQtaXRhbGljIjogTU1MLlZBUklBTlQuQk9MRCwKICAgICAgICAgICAgInNhbnMtc2VyaWYtaXRhbGljIjogTU1MLlZBUklBTlQuU0FOU1NFUklGLAogICAgICAgICAgICAic2Fucy1zZXJpZi1ib2xkLWl0YWxpYyI6IE1NTC5WQVJJQU5ULkJPTERTQU5TU0VSSUYKICAgICAgICAgIH1bdmFyaWFudF0gfHwgdmFyaWFudDsKICAgICAgICB9CgogICAgICAgIGlmICghKHZhcmlhbnQgaW4gSFRNTENTUy5GT05UREFUQS5WQVJJQU5UKSkgewogICAgICAgICAgLy8gSWYgdGhlIG1hdGh2YXJpYW50IHZhbHVlIGlzIGludmFsaWQgb3Igbm90IHN1cHBvcnRlZCBieSB0aGlzCiAgICAgICAgICAvLyBmb250LCBmYWxsYmFjayB0byBub3JtYWwuIFNlZSBpc3N1ZSAzNjMuCiAgICAgICAgICB2YXJpYW50ID0gIm5vcm1hbCI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gSFRNTENTUy5GT05UREFUQS5WQVJJQU5UW3ZhcmlhbnRdOwogICAgICB9LAogICAgICBIVE1MZHJhd0JCb3g6IGZ1bmN0aW9uIEhUTUxkcmF3QkJveChzcGFuKSB7CiAgICAgICAgdmFyIGJib3ggPSBzcGFuLmJib3g7CiAgICAgICAgdmFyIGJveCA9IEhUTUxDU1MuRWxlbWVudCgic3BhbiIsIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICJmb250LXNpemUiOiBzcGFuLnN0eWxlLmZvbnRTaXplLAogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lLWJsb2NrIiwKICAgICAgICAgICAgb3BhY2l0eTogLjI1LAogICAgICAgICAgICAibWFyZ2luLWxlZnQiOiBIVE1MQ1NTLkVtKC1iYm94LncpCiAgICAgICAgICB9CiAgICAgICAgfSwgW1sic3BhbiIsIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGhlaWdodDogSFRNTENTUy5FbShiYm94LmgpLAogICAgICAgICAgICB3aWR0aDogSFRNTENTUy5FbShiYm94LncpLAogICAgICAgICAgICAiYmFja2dyb3VuZC1jb2xvciI6ICJyZWQiLAogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lLWJsb2NrIgogICAgICAgICAgfQogICAgICAgIH1dLCBbInNwYW4iLCB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBoZWlnaHQ6IEhUTUxDU1MuRW0oYmJveC5kKSwKICAgICAgICAgICAgd2lkdGg6IEhUTUxDU1MuRW0oYmJveC53KSwKICAgICAgICAgICAgIm1hcmdpbi1sZWZ0IjogSFRNTENTUy5FbSgtYmJveC53KSwKICAgICAgICAgICAgInZlcnRpY2FsLWFsaWduIjogSFRNTENTUy5FbSgtYmJveC5kKSwKICAgICAgICAgICAgImJhY2tncm91bmQtY29sb3IiOiAiZ3JlZW4iLAogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lLWJsb2NrIgogICAgICAgICAgfQogICAgICAgIH1dXSk7CgogICAgICAgIGlmIChzcGFuLm5leHRTaWJsaW5nKSB7CiAgICAgICAgICBzcGFuLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGJveCwgc3Bhbi5uZXh0U2libGluZyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNwYW4ucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChib3gpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBIVE1MYXV0b2xvYWQ6IGZ1bmN0aW9uIEhUTUxhdXRvbG9hZCgpIHsKICAgICAgICB2YXIgZmlsZSA9IEhUTUxDU1MuYXV0b2xvYWREaXIgKyAiLyIgKyB0aGlzLnR5cGUgKyAiLmpzIjsKICAgICAgICBIVUIuUmVzdGFydEFmdGVyKEFKQVguUmVxdWlyZShmaWxlKSk7CiAgICAgIH0sCiAgICAgIEhUTUxhdXRvbG9hZEZpbGU6IGZ1bmN0aW9uIEhUTUxhdXRvbG9hZEZpbGUobmFtZSkgewogICAgICAgIHZhciBmaWxlID0gSFRNTENTUy5hdXRvbG9hZERpciArICIvIiArIG5hbWUgKyAiLmpzIjsKICAgICAgICBIVUIuUmVzdGFydEFmdGVyKEFKQVguUmVxdWlyZShmaWxlKSk7CiAgICAgIH0sCiAgICAgIEhUTUxzdHJldGNoSDogZnVuY3Rpb24gSFRNTHN0cmV0Y2hIKGJveCwgdykgewogICAgICAgIHRoaXMuSFRNTHJlbW92ZUNvbG9yKCk7CiAgICAgICAgcmV0dXJuIHRoaXMudG9IVE1MKGJveCwgdyk7CiAgICAgIH0sCiAgICAgIEhUTUxzdHJldGNoVjogZnVuY3Rpb24gSFRNTHN0cmV0Y2hWKGJveCwgaCwgZCkgewogICAgICAgIHRoaXMuSFRNTHJlbW92ZUNvbG9yKCk7CiAgICAgICAgcmV0dXJuIHRoaXMudG9IVE1MKGJveCwgaCwgZCk7CiAgICAgIH0KICAgIH0pOwogICAgTU1MLmNoYXJzLkF1Z21lbnQoewogICAgICB0b0hUTUw6IGZ1bmN0aW9uIHRvSFRNTChzcGFuLCB2YXJpYW50LCByZW1hcCwgY2hhcnMpIHsKICAgICAgICB2YXIgdGV4dCA9IHRoaXMuZGF0YS5qb2luKCIiKS5yZXBsYWNlKC9bXHUyMDYxLVx1MjA2NF0vZywgIiIpOyAvLyByZW1vdmUgaW52aXNpYmxlcwoKICAgICAgICBpZiAocmVtYXApIHsKICAgICAgICAgIHRleHQgPSByZW1hcCh0ZXh0LCBjaGFycyk7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFyaWFudC5mb250SW5oZXJpdCkgewogICAgICAgICAgdmFyIHNjYWxlID0gTWF0aC5mbG9vcihIVE1MQ1NTLmNvbmZpZy5zY2FsZSAvIEhUTUxDU1Muc2NhbGUgKyAuNSkgKyAiJSI7CiAgICAgICAgICBIVE1MQ1NTLmFkZEVsZW1lbnQoc3BhbiwgInNwYW4iLCB7CiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgImZvbnQtc2l6ZSI6IHNjYWxlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIFt0ZXh0XSk7CgogICAgICAgICAgaWYgKHZhcmlhbnQuYm9sZCkgewogICAgICAgICAgICBzcGFuLmxhc3RDaGlsZC5zdHlsZS5mb250V2VpZ2h0ID0gImJvbGQiOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh2YXJpYW50Lml0YWxpYykgewogICAgICAgICAgICBzcGFuLmxhc3RDaGlsZC5zdHlsZS5mb250U3R5bGUgPSAiaXRhbGljIjsKICAgICAgICAgIH0KCiAgICAgICAgICBzcGFuLmJib3ggPSBudWxsOwogICAgICAgICAgdmFyIEhEID0gSFRNTENTUy5nZXRIRChzcGFuKSwKICAgICAgICAgICAgICBXID0gSFRNTENTUy5nZXRXKHNwYW4pOwogICAgICAgICAgc3Bhbi5iYm94ID0gewogICAgICAgICAgICBoOiBIRC5oLAogICAgICAgICAgICBkOiBIRC5kLAogICAgICAgICAgICB3OiBXLAogICAgICAgICAgICBsdzogMCwKICAgICAgICAgICAgcnc6IFcsCiAgICAgICAgICAgIGV4YWN0VzogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5IVE1MaGFuZGxlVmFyaWFudChzcGFuLCB2YXJpYW50LCB0ZXh0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgTU1MLmVudGl0eS5BdWdtZW50KHsKICAgICAgdG9IVE1MOiBmdW5jdGlvbiB0b0hUTUwoc3BhbiwgdmFyaWFudCwgcmVtYXAsIGNoYXJzKSB7CiAgICAgICAgdmFyIHRleHQgPSB0aGlzLnRvU3RyaW5nKCkucmVwbGFjZSgvW1x1MjA2MS1cdTIwNjRdL2csICIiKTsgLy8gcmVtb3ZlIGludmlzaWJsZXMKCiAgICAgICAgaWYgKHJlbWFwKSB7CiAgICAgICAgICB0ZXh0ID0gcmVtYXAodGV4dCwgY2hhcnMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHZhcmlhbnQuZm9udEluaGVyaXQpIHsKICAgICAgICAgIHZhciBzY2FsZSA9IE1hdGguZmxvb3IoSFRNTENTUy5jb25maWcuc2NhbGUgLyBIVE1MQ1NTLnNjYWxlICsgLjUpICsgIiUiOwogICAgICAgICAgSFRNTENTUy5hZGRFbGVtZW50KHNwYW4sICJzcGFuIiwgewogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICJmb250LXNpemUiOiBzY2FsZQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBbdGV4dF0pOwoKICAgICAgICAgIGlmICh2YXJpYW50LmJvbGQpIHsKICAgICAgICAgICAgc3Bhbi5sYXN0Q2hpbGQuc3R5bGUuZm9udFdlaWdodCA9ICJib2xkIjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodmFyaWFudC5pdGFsaWMpIHsKICAgICAgICAgICAgc3Bhbi5sYXN0Q2hpbGQuc3R5bGUuZm9udFN0eWxlID0gIml0YWxpYyI7CiAgICAgICAgICB9CgogICAgICAgICAgZGVsZXRlIHNwYW4uYmJveDsKICAgICAgICAgIHZhciBIRCA9IEhUTUxDU1MuZ2V0SEQoc3BhbiksCiAgICAgICAgICAgICAgVyA9IEhUTUxDU1MuZ2V0VyhzcGFuKTsKICAgICAgICAgIHNwYW4uYmJveCA9IHsKICAgICAgICAgICAgaDogSEQuaCwKICAgICAgICAgICAgZDogSEQuZCwKICAgICAgICAgICAgdzogVywKICAgICAgICAgICAgbHc6IDAsCiAgICAgICAgICAgIHJ3OiBXLAogICAgICAgICAgICBleGFjdFc6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuSFRNTGhhbmRsZVZhcmlhbnQoc3BhbiwgdmFyaWFudCwgdGV4dCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIE1NTC5taS5BdWdtZW50KHsKICAgICAgdG9IVE1MOiBmdW5jdGlvbiB0b0hUTUwoc3BhbikgewogICAgICAgIHNwYW4gPSB0aGlzLkhUTUxoYW5kbGVTaXplKHRoaXMuSFRNTGNyZWF0ZVNwYW4oc3BhbikpOwogICAgICAgIHNwYW4uYmJveCA9IG51bGw7CiAgICAgICAgdmFyIHZhcmlhbnQgPSB0aGlzLkhUTUxnZXRWYXJpYW50KCk7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBtID0gdGhpcy5kYXRhLmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgICAgaWYgKHRoaXMuZGF0YVtpXSkgewogICAgICAgICAgICB0aGlzLmRhdGFbaV0udG9IVE1MKHNwYW4sIHZhcmlhbnQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCFzcGFuLmJib3gpIHsKICAgICAgICAgIHNwYW4uYmJveCA9IHRoaXMuSFRNTHplcm9CQm94KCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgdGV4dCA9IHRoaXMuZGF0YS5qb2luKCIiKSwKICAgICAgICAgICAgYmJveCA9IHNwYW4uYmJveDsKCiAgICAgICAgaWYgKGJib3guc2tldyAmJiB0ZXh0Lmxlbmd0aCAhPT0gMSkgewogICAgICAgICAgZGVsZXRlIGJib3guc2tldzsKICAgICAgICB9CgogICAgICAgIGlmIChiYm94LnJ3ID4gYmJveC53ICYmIHRleHQubGVuZ3RoID09PSAxICYmICF2YXJpYW50Lm5vSUMpIHsKICAgICAgICAgIGJib3guaWMgPSBiYm94LnJ3IC0gYmJveC53OwogICAgICAgICAgSFRNTENTUy5jcmVhdGVCbGFuayhzcGFuLCBiYm94LmljIC8gdGhpcy5tc2NhbGUpOwogICAgICAgICAgYmJveC53ID0gYmJveC5ydzsKICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGhhbmRsZVNwYWNlKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZUNvbG9yKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZURpcihzcGFuKTsKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfQogICAgfSk7CiAgICBNTUwubW4uQXVnbWVudCh7CiAgICAgIHRvSFRNTDogZnVuY3Rpb24gdG9IVE1MKHNwYW4pIHsKICAgICAgICBzcGFuID0gdGhpcy5IVE1MaGFuZGxlU2l6ZSh0aGlzLkhUTUxjcmVhdGVTcGFuKHNwYW4pKTsKICAgICAgICBzcGFuLmJib3ggPSBudWxsOwogICAgICAgIHZhciB2YXJpYW50ID0gdGhpcy5IVE1MZ2V0VmFyaWFudCgpOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgbSA9IHRoaXMuZGF0YS5sZW5ndGg7IGkgPCBtOyBpKyspIHsKICAgICAgICAgIGlmICh0aGlzLmRhdGFbaV0pIHsKICAgICAgICAgICAgdGhpcy5kYXRhW2ldLnRvSFRNTChzcGFuLCB2YXJpYW50KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghc3Bhbi5iYm94KSB7CiAgICAgICAgICBzcGFuLmJib3ggPSB0aGlzLkhUTUx6ZXJvQkJveCgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZGF0YS5qb2luKCIiKS5sZW5ndGggIT09IDEpIHsKICAgICAgICAgIGRlbGV0ZSBzcGFuLmJib3guc2tldzsKICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGhhbmRsZVNwYWNlKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZUNvbG9yKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZURpcihzcGFuKTsKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfQogICAgfSk7CiAgICBNTUwubW8uQXVnbWVudCh7CiAgICAgIHRvSFRNTDogZnVuY3Rpb24gdG9IVE1MKHNwYW4pIHsKICAgICAgICBzcGFuID0gdGhpcy5IVE1MaGFuZGxlU2l6ZSh0aGlzLkhUTUxjcmVhdGVTcGFuKHNwYW4pKTsKCiAgICAgICAgaWYgKHRoaXMuZGF0YS5sZW5ndGggPT0gMCkgewogICAgICAgICAgcmV0dXJuIHNwYW47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNwYW4uYmJveCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB2YXIgdGV4dCA9IHRoaXMuZGF0YS5qb2luKCIiKTsgLy8KICAgICAgICAvLyAgR2V0IHRoZSB2YXJpYW50LCBhbmQgY2hlY2sgZm9yIG9wZXJhdG9yIHNpemUKICAgICAgICAvLwoKICAgICAgICB2YXIgdmFyaWFudCA9IHRoaXMuSFRNTGdldFZhcmlhbnQoKTsKICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoImxhcmdlb3AiLCAiZGlzcGxheXN0eWxlIik7CgogICAgICAgIGlmICh2YWx1ZXMubGFyZ2VvcCkgewogICAgICAgICAgdmFyaWFudCA9IEhUTUxDU1MuRk9OVERBVEEuVkFSSUFOVFt2YWx1ZXMuZGlzcGxheXN0eWxlID8gIi1sYXJnZU9wIiA6ICItc21hbGxPcCJdOwogICAgICAgIH0gLy8KICAgICAgICAvLyAgR2V0IGNoYXJhY3RlciB0cmFuc2xhdGlvbiBmb3Igc3VwZXJzY3JpcHQgYW5kIGFjY2VudHMKICAgICAgICAvLwoKCiAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMuQ29yZVBhcmVudCgpLAogICAgICAgICAgICBpc1NjcmlwdCA9IHBhcmVudCAmJiBwYXJlbnQuaXNhKE1NTC5tc3Vic3VwKSAmJiB0aGlzICE9PSBwYXJlbnQuZGF0YVtwYXJlbnQuYmFzZV0sCiAgICAgICAgICAgIG1hcGNoYXJzID0gaXNTY3JpcHQgPyB0aGlzLnJlbWFwQ2hhcnMgOiBudWxsOwoKICAgICAgICBpZiAodGV4dC5sZW5ndGggPT09IDEgJiYgcGFyZW50ICYmIHBhcmVudC5pc2EoTU1MLm11bmRlcm92ZXIpICYmIHRoaXMuQ29yZVRleHQocGFyZW50LmRhdGFbcGFyZW50LmJhc2VdKS5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIHZhciBvdmVyID0gcGFyZW50LmRhdGFbcGFyZW50Lm92ZXJdLAogICAgICAgICAgICAgIHVuZGVyID0gcGFyZW50LmRhdGFbcGFyZW50LnVuZGVyXTsKCiAgICAgICAgICBpZiAob3ZlciAmJiB0aGlzID09PSBvdmVyLkNvcmVNTygpICYmIHBhcmVudC5HZXQoImFjY2VudCIpKSB7CiAgICAgICAgICAgIG1hcGNoYXJzID0gSFRNTENTUy5GT05UREFUQS5SRU1BUEFDQ0VOVDsKICAgICAgICAgIH0gZWxzZSBpZiAodW5kZXIgJiYgdGhpcyA9PT0gdW5kZXIuQ29yZU1PKCkgJiYgcGFyZW50LkdldCgiYWNjZW50dW5kZXIiKSkgewogICAgICAgICAgICBtYXBjaGFycyA9IEhUTUxDU1MuRk9OVERBVEEuUkVNQVBBQ0NFTlRVTkRFUjsKICAgICAgICAgIH0KICAgICAgICB9IC8vCiAgICAgICAgLy8gIFNUSVggYW5kIFRlWCBmb250cyBuZWVkIHF1b3RlcyBmcm9tIHZhcmlhbnQgZm9udAogICAgICAgIC8vCgoKICAgICAgICBpZiAoaXNTY3JpcHQgJiYgdGV4dC5tYXRjaCgvWydgIlx1MDBCNFx1MjAzMi1cdTIwMzdcdTIwNTddLykpIHsKICAgICAgICAgIHZhcmlhbnQgPSBIVE1MQ1NTLkZPTlREQVRBLlZBUklBTlRbIi0iICsgSFRNTENTUy5mb250SW5Vc2UgKyAiLXZhcmlhbnQiXTsKICAgICAgICB9IC8vCiAgICAgICAgLy8gIFR5cGVzZXQgY29udGVudHMKICAgICAgICAvLwoKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG0gPSB0aGlzLmRhdGEubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy5kYXRhW2ldKSB7CiAgICAgICAgICAgIHRoaXMuZGF0YVtpXS50b0hUTUwoc3BhbiwgdmFyaWFudCwgdGhpcy5yZW1hcCwgbWFwY2hhcnMpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCFzcGFuLmJib3gpIHsKICAgICAgICAgIHNwYW4uYmJveCA9IHRoaXMuSFRNTHplcm9CQm94KCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGV4dC5sZW5ndGggIT09IDEpIHsKICAgICAgICAgIGRlbGV0ZSBzcGFuLmJib3guc2tldzsKICAgICAgICB9IC8vCiAgICAgICAgLy8gIEhhbmRsZSBjb21iaW5pbmcgY2hhcmFjdGVycyBieSBhZGRpbmcgYSBub24tYnJlYWtpbmcgc3BhY2UgYW5kIHJlbW92aW5nIHRoYXQgd2lkdGgKICAgICAgICAvLwoKCiAgICAgICAgaWYgKEhUTUxDU1MuQWNjZW50QnVnICYmIHNwYW4uYmJveC53ID09PSAwICYmIHRleHQubGVuZ3RoID09PSAxICYmIHNwYW4uZmlyc3RDaGlsZCkgewogICAgICAgICAgc3Bhbi5maXJzdENoaWxkLm5vZGVWYWx1ZSArPSBIVE1MQ1NTLk5CU1A7CiAgICAgICAgICBIVE1MQ1NTLmNyZWF0ZVNwYWNlKHNwYW4sIDAsIDAsIC1zcGFuLm9mZnNldFdpZHRoIC8gSFRNTENTUy5lbSk7CiAgICAgICAgfSAvLwogICAgICAgIC8vICBIYW5kbGUgbGFyZ2Ugb3BlcmF0b3IgY2VudGVyaW5nCiAgICAgICAgLy8KCgogICAgICAgIGlmICh2YWx1ZXMubGFyZ2VvcCkgewogICAgICAgICAgdmFyIGEgPSBIVE1MQ1NTLlRlWC5heGlzX2hlaWdodCAqIHRoaXMuc2NhbGUgKiB0aGlzLm1zY2FsZTsKICAgICAgICAgIHZhciBwID0gKHNwYW4uYmJveC5oIC0gc3Bhbi5iYm94LmQpIC8gMiAtIGE7CgogICAgICAgICAgaWYgKEhUTUxDU1Muc2FmYXJpVmVydGljYWxBbGlnbkJ1ZyAmJiBzcGFuLmxhc3RDaGlsZC5ub2RlTmFtZSA9PT0gIklNRyIpIHsKICAgICAgICAgICAgc3Bhbi5sYXN0Q2hpbGQuc3R5bGUudmVydGljYWxBbGlnbiA9IEhUTUxDU1MuRW0oSFRNTENTUy51bkVtKHNwYW4ubGFzdENoaWxkLnN0eWxlLnZlcnRpY2FsQWxpZ24gfHwgMCkgLyBIVE1MQ1NTLmVtIC0gcCAvIHNwYW4uc2NhbGUpOwogICAgICAgICAgfSBlbHNlIGlmIChIVE1MQ1NTLmtvbnF1ZXJvclZlcnRpY2FsQWxpZ25CdWcgJiYgc3Bhbi5sYXN0Q2hpbGQubm9kZU5hbWUgPT09ICJJTUciKSB7CiAgICAgICAgICAgIHNwYW4uc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwogICAgICAgICAgICBzcGFuLmxhc3RDaGlsZC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CiAgICAgICAgICAgIHNwYW4ubGFzdENoaWxkLnN0eWxlLnRvcCA9IEhUTUxDU1MuRW0ocCAvIHNwYW4uc2NhbGUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3Bhbi5zdHlsZS52ZXJ0aWNhbEFsaWduID0gSFRNTENTUy5FbSgtcCAvIHNwYW4uc2NhbGUpOwogICAgICAgICAgfQoKICAgICAgICAgIHNwYW4uYmJveC5oIC09IHA7CiAgICAgICAgICBzcGFuLmJib3guZCArPSBwOwoKICAgICAgICAgIGlmIChzcGFuLmJib3gucncgPiBzcGFuLmJib3gudykgewogICAgICAgICAgICBzcGFuLmJib3guaWMgPSBzcGFuLmJib3gucncgLSBzcGFuLmJib3gudzsKICAgICAgICAgICAgSFRNTENTUy5jcmVhdGVCbGFuayhzcGFuLCBzcGFuLmJib3guaWMgLyB0aGlzLm1zY2FsZSk7CiAgICAgICAgICAgIHNwYW4uYmJveC53ID0gc3Bhbi5iYm94LnJ3OwogICAgICAgICAgfQogICAgICAgIH0gLy8KICAgICAgICAvLyAgRmluaXNoIHVwCiAgICAgICAgLy8KCgogICAgICAgIHRoaXMuSFRNTGhhbmRsZVNwYWNlKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZUNvbG9yKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZURpcihzcGFuKTsKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfSwKICAgICAgSFRNTGNhblN0cmV0Y2g6IGZ1bmN0aW9uIEhUTUxjYW5TdHJldGNoKGRpcmVjdGlvbikgewogICAgICAgIGlmICghdGhpcy5HZXQoInN0cmV0Y2h5IikpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHZhciBjID0gdGhpcy5kYXRhLmpvaW4oIiIpOwoKICAgICAgICBpZiAoYy5sZW5ndGggPiAxKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5Db3JlUGFyZW50KCk7CgogICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50LmlzYShNTUwubXVuZGVyb3ZlcikgJiYgdGhpcy5Db3JlVGV4dChwYXJlbnQuZGF0YVtwYXJlbnQuYmFzZV0pLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgdmFyIG92ZXIgPSBwYXJlbnQuZGF0YVtwYXJlbnQub3Zlcl0sCiAgICAgICAgICAgICAgdW5kZXIgPSBwYXJlbnQuZGF0YVtwYXJlbnQudW5kZXJdOwoKICAgICAgICAgIGlmIChvdmVyICYmIHRoaXMgPT09IG92ZXIuQ29yZU1PKCkgJiYgcGFyZW50LkdldCgiYWNjZW50IikpIHsKICAgICAgICAgICAgYyA9IEhUTUxDU1MuRk9OVERBVEEuUkVNQVBBQ0NFTlRbY10gfHwgYzsKICAgICAgICAgIH0gZWxzZSBpZiAodW5kZXIgJiYgdGhpcyA9PT0gdW5kZXIuQ29yZU1PKCkgJiYgcGFyZW50LkdldCgiYWNjZW50dW5kZXIiKSkgewogICAgICAgICAgICBjID0gSFRNTENTUy5GT05UREFUQS5SRU1BUEFDQ0VOVFVOREVSW2NdIHx8IGM7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjID0gSFRNTENTUy5GT05UREFUQS5ERUxJTUlURVJTW2MuY2hhckNvZGVBdCgwKV07CiAgICAgICAgdmFyIHN0cmV0Y2ggPSBjICYmIGMuZGlyID09PSBkaXJlY3Rpb24uc3Vic3RyKDAsIDEpOwogICAgICAgIHRoaXMuZm9yY2VTdHJldGNoID0gc3RyZXRjaCAmJiAodGhpcy5HZXQoIm1pbnNpemUiLCB0cnVlKSB8fCB0aGlzLkdldCgibWF4c2l6ZSIsIHRydWUpKTsKICAgICAgICByZXR1cm4gc3RyZXRjaDsKICAgICAgfSwKICAgICAgSFRNTHN0cmV0Y2hWOiBmdW5jdGlvbiBIVE1Mc3RyZXRjaFYoYm94LCBoLCBkKSB7CiAgICAgICAgdGhpcy5IVE1McmVtb3ZlQ29sb3IoKTsKICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoInN5bW1ldHJpYyIsICJtYXhzaXplIiwgIm1pbnNpemUiKTsKICAgICAgICB2YXIgc3BhbiA9IHRoaXMuSFRNTHNwYW5FbGVtZW50KCksCiAgICAgICAgICAgIG11ID0gdGhpcy5IVE1MZ2V0TXUoc3BhbiksCiAgICAgICAgICAgIEg7CiAgICAgICAgdmFyIHNjYWxlID0gdGhpcy5IVE1MZ2V0U2NhbGUoKSwKICAgICAgICAgICAgYXhpcyA9IEhUTUxDU1MuVGVYLmF4aXNfaGVpZ2h0ICogc2NhbGU7CgogICAgICAgIGlmICh2YWx1ZXMuc3ltbWV0cmljKSB7CiAgICAgICAgICBIID0gMiAqIE1hdGgubWF4KGggLSBheGlzLCBkICsgYXhpcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEggPSBoICsgZDsKICAgICAgICB9CgogICAgICAgIHZhbHVlcy5tYXhzaXplID0gSFRNTENTUy5sZW5ndGgyZW0odmFsdWVzLm1heHNpemUsIG11LCBzcGFuLmJib3guaCArIHNwYW4uYmJveC5kKTsKICAgICAgICB2YWx1ZXMubWluc2l6ZSA9IEhUTUxDU1MubGVuZ3RoMmVtKHZhbHVlcy5taW5zaXplLCBtdSwgc3Bhbi5iYm94LmggKyBzcGFuLmJib3guZCk7CiAgICAgICAgSCA9IE1hdGgubWF4KHZhbHVlcy5taW5zaXplLCBNYXRoLm1pbih2YWx1ZXMubWF4c2l6ZSwgSCkpOwoKICAgICAgICBpZiAoSCAhPSB2YWx1ZXMubWluc2l6ZSkgewogICAgICAgICAgSCA9IFtNYXRoLm1heChIICogSFRNTENTUy5UZVguZGVsaW1pdGVyZmFjdG9yIC8gMTAwMCwgSCAtIEhUTUxDU1MuVGVYLmRlbGltaXRlcnNob3J0ZmFsbCksIEhdOwogICAgICAgIH0KCiAgICAgICAgc3BhbiA9IHRoaXMuSFRNTGNyZWF0ZVNwYW4oYm94KTsgLy8gY2xlYXIgY29udGVudHMgYW5kIGF0dHJpYnV0ZXMKCiAgICAgICAgSFRNTENTUy5jcmVhdGVEZWxpbWl0ZXIoc3BhbiwgdGhpcy5kYXRhLmpvaW4oIiIpLmNoYXJDb2RlQXQoMCksIEgsIHNjYWxlKTsKCiAgICAgICAgaWYgKHZhbHVlcy5zeW1tZXRyaWMpIHsKICAgICAgICAgIEggPSAoc3Bhbi5iYm94LmggKyBzcGFuLmJib3guZCkgLyAyICsgYXhpczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgSCA9IChzcGFuLmJib3guaCArIHNwYW4uYmJveC5kKSAqIGggLyAoaCArIGQpOwogICAgICAgIH0KCiAgICAgICAgSFRNTENTUy5wb3NpdGlvbkRlbGltaXRlcihzcGFuLCBIKTsKICAgICAgICB0aGlzLkhUTUxoYW5kbGVTcGFjZShzcGFuKTsgLy8gYWRkIGluIGxzcGFjZS9yc3BhY2UsIGlmIGFueQoKICAgICAgICB0aGlzLkhUTUxoYW5kbGVDb2xvcihzcGFuKTsKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfSwKICAgICAgSFRNTHN0cmV0Y2hIOiBmdW5jdGlvbiBIVE1Mc3RyZXRjaEgoYm94LCBXKSB7CiAgICAgICAgdGhpcy5IVE1McmVtb3ZlQ29sb3IoKTsKICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoIm1heHNpemUiLCAibWluc2l6ZSIsICJtYXRodmFyaWFudCIsICJmb250d2VpZ2h0Iik7IC8vIEZJWE1FOiAgc2hvdWxkIHRha2Ugc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQiIGludG8gYWNjb3VudCBhcyB3ZWxsCgogICAgICAgIGlmICgodmFsdWVzLmZvbnR3ZWlnaHQgPT09ICJib2xkIiB8fCBwYXJzZUludCh2YWx1ZXMuZm9udHdlaWdodCkgPj0gNjAwKSAmJiAhdGhpcy5HZXQoIm1hdGh2YXJpYW50IiwgdHJ1ZSkpIHsKICAgICAgICAgIHZhbHVlcy5tYXRodmFyaWFudCA9IE1NTC5WQVJJQU5ULkJPTEQ7CiAgICAgICAgfQoKICAgICAgICB2YXIgc3BhbiA9IHRoaXMuSFRNTHNwYW5FbGVtZW50KCksCiAgICAgICAgICAgIG11ID0gdGhpcy5IVE1MZ2V0TXUoc3BhbiksCiAgICAgICAgICAgIHNjYWxlID0gc3Bhbi5zY2FsZTsKICAgICAgICB2YWx1ZXMubWF4c2l6ZSA9IEhUTUxDU1MubGVuZ3RoMmVtKHZhbHVlcy5tYXhzaXplLCBtdSwgc3Bhbi5iYm94LncpOwogICAgICAgIHZhbHVlcy5taW5zaXplID0gSFRNTENTUy5sZW5ndGgyZW0odmFsdWVzLm1pbnNpemUsIG11LCBzcGFuLmJib3gudyk7CiAgICAgICAgVyA9IE1hdGgubWF4KHZhbHVlcy5taW5zaXplLCBNYXRoLm1pbih2YWx1ZXMubWF4c2l6ZSwgVykpOwogICAgICAgIHNwYW4gPSB0aGlzLkhUTUxjcmVhdGVTcGFuKGJveCk7IC8vIGNsZWFyIGNvbnRlbnRzIGFuZCBhdHRyaWJ1dGVzCgogICAgICAgIEhUTUxDU1MuY3JlYXRlRGVsaW1pdGVyKHNwYW4sIHRoaXMuZGF0YS5qb2luKCIiKS5jaGFyQ29kZUF0KDApLCBXLCBzY2FsZSwgdmFsdWVzLm1hdGh2YXJpYW50KTsKICAgICAgICB0aGlzLkhUTUxoYW5kbGVTcGFjZShzcGFuKTsgLy8gYWRkIGluIGxzcGFjZS9yc3BhY2UsIGlmIGFueQoKICAgICAgICB0aGlzLkhUTUxoYW5kbGVDb2xvcihzcGFuKTsKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfQogICAgfSk7CiAgICBNTUwubXRleHQuQXVnbWVudCh7CiAgICAgIHRvSFRNTDogZnVuY3Rpb24gdG9IVE1MKHNwYW4pIHsKICAgICAgICBzcGFuID0gdGhpcy5IVE1MaGFuZGxlU2l6ZSh0aGlzLkhUTUxjcmVhdGVTcGFuKHNwYW4pKTsKICAgICAgICB2YXIgdmFyaWFudCA9IHRoaXMuSFRNTGdldFZhcmlhbnQoKTsgLy8gIEF2b2lkIHNldHRpbmcgdGhlIGZvbnQgc3R5bGUgZm9yIGVycm9yIHRleHQgb3IgaWYgbXRleHRGb250SW5oZXJpdCBpcyBzZXQKCiAgICAgICAgaWYgKEhUTUxDU1MuY29uZmlnLm10ZXh0Rm9udEluaGVyaXQgfHwgdGhpcy5QYXJlbnQoKS50eXBlID09PSAibWVycm9yIikgewogICAgICAgICAgdmFyIHZuYW1lID0gdGhpcy5HZXQoIm1hdGh2YXJpYW50Iik7CgogICAgICAgICAgaWYgKHZuYW1lID09PSAibW9ub3NwYWNlIikgewogICAgICAgICAgICBzcGFuLmNsYXNzTmFtZSArPSAiIE1KWC1tb25vc3BhY2UiOwogICAgICAgICAgfSBlbHNlIGlmICh2bmFtZS5tYXRjaCgvc2Fucy1zZXJpZi8pKSB7CiAgICAgICAgICAgIHNwYW4uY2xhc3NOYW1lICs9ICIgTUpYLXNhbnMtc2VyaWYiOwogICAgICAgICAgfQoKICAgICAgICAgIHZhcmlhbnQgPSB7CiAgICAgICAgICAgIGJvbGQ6IHZhcmlhbnQuYm9sZCwKICAgICAgICAgICAgaXRhbGljOiB2YXJpYW50Lml0YWxpYywKICAgICAgICAgICAgZm9udEluaGVyaXQ6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBpID0gMCwgbSA9IHRoaXMuZGF0YS5sZW5ndGg7IGkgPCBtOyBpKyspIHsKICAgICAgICAgIGlmICh0aGlzLmRhdGFbaV0pIHsKICAgICAgICAgICAgdGhpcy5kYXRhW2ldLnRvSFRNTChzcGFuLCB2YXJpYW50KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghc3Bhbi5iYm94KSB7CiAgICAgICAgICBzcGFuLmJib3ggPSB0aGlzLkhUTUx6ZXJvQkJveCgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZGF0YS5qb2luKCIiKS5sZW5ndGggIT09IDEpIHsKICAgICAgICAgIGRlbGV0ZSBzcGFuLmJib3guc2tldzsKICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGhhbmRsZVNwYWNlKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZUNvbG9yKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZURpcihzcGFuKTsKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfQogICAgfSk7CiAgICBNTUwubWVycm9yLkF1Z21lbnQoewogICAgICB0b0hUTUw6IGZ1bmN0aW9uIHRvSFRNTChzcGFuKSB7CiAgICAgICAgLy8KICAgICAgICAvLyAgV2lkdGggZG9lc24ndCBpbmNsdWRlIHBhZGRpbmcgYW5kIGJvcmRlciwgc28gdXNlIGFuIGV4dHJhIGlubGluZSBibG9jawogICAgICAgIC8vICBlbGVtZW50IHRvIGNhcHR1cmUgaXQuCiAgICAgICAgLy8gIAogICAgICAgIHZhciBTUEFOID0gTWF0aEpheC5IVE1MLmFkZEVsZW1lbnQoc3BhbiwgInNwYW4iLCB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lLWJsb2NrIgogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHNwYW4gPSB0aGlzLlNVUEVSKGFyZ3VtZW50cykudG9IVE1MLmNhbGwodGhpcywgU1BBTik7CiAgICAgICAgdmFyIEhEID0gSFRNTENTUy5nZXRIRChTUEFOKSwKICAgICAgICAgICAgVyA9IEhUTUxDU1MuZ2V0VyhTUEFOKTsKICAgICAgICBTUEFOLmJib3ggPSB7CiAgICAgICAgICBoOiBIRC5oLAogICAgICAgICAgZDogSEQuZCwKICAgICAgICAgIHc6IFcsCiAgICAgICAgICBsdzogMCwKICAgICAgICAgIHJ3OiBXLAogICAgICAgICAgZXhhY3RXOiB0cnVlCiAgICAgICAgfTsKICAgICAgICBTUEFOLmlkID0gc3Bhbi5pZDsKICAgICAgICBzcGFuLmlkID0gbnVsbDsKICAgICAgICByZXR1cm4gU1BBTjsKICAgICAgfQogICAgfSk7CiAgICBNTUwubXMuQXVnbWVudCh7CiAgICAgIHRvSFRNTDogTU1MLm1iYXNlLkhUTUxhdXRvbG9hZAogICAgfSk7CiAgICBNTUwubWdseXBoLkF1Z21lbnQoewogICAgICB0b0hUTUw6IE1NTC5tYmFzZS5IVE1MYXV0b2xvYWQKICAgIH0pOwogICAgTU1MLm1zcGFjZS5BdWdtZW50KHsKICAgICAgdG9IVE1MOiBmdW5jdGlvbiB0b0hUTUwoc3BhbikgewogICAgICAgIHNwYW4gPSB0aGlzLkhUTUxjcmVhdGVTcGFuKHNwYW4pOwogICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLmdldFZhbHVlcygiaGVpZ2h0IiwgImRlcHRoIiwgIndpZHRoIik7CiAgICAgICAgdmFyIG11ID0gdGhpcy5IVE1MZ2V0TXUoc3Bhbik7CiAgICAgICAgdGhpcy5IVE1MZ2V0U2NhbGUoKTsKICAgICAgICB2YWx1ZXMubWF0aGJhY2tncm91bmQgPSB0aGlzLm1hdGhiYWNrZ3JvdW5kOwoKICAgICAgICBpZiAodGhpcy5iYWNrZ3JvdW5kICYmICF0aGlzLm1hdGhiYWNrZ3JvdW5kKSB7CiAgICAgICAgICB2YWx1ZXMubWF0aGJhY2tncm91bmQgPSB0aGlzLmJhY2tncm91bmQ7CiAgICAgICAgfQoKICAgICAgICB2YXIgaCA9IEhUTUxDU1MubGVuZ3RoMmVtKHZhbHVlcy5oZWlnaHQsIG11KSAqIHRoaXMubXNjYWxlLAogICAgICAgICAgICBkID0gSFRNTENTUy5sZW5ndGgyZW0odmFsdWVzLmRlcHRoLCBtdSkgKiB0aGlzLm1zY2FsZSwKICAgICAgICAgICAgdyA9IEhUTUxDU1MubGVuZ3RoMmVtKHZhbHVlcy53aWR0aCwgbXUpICogdGhpcy5tc2NhbGU7CiAgICAgICAgSFRNTENTUy5jcmVhdGVTcGFjZShzcGFuLCBoLCBkLCB3LCB2YWx1ZXMubWF0aGJhY2tncm91bmQsIHRydWUpOwogICAgICAgIHJldHVybiBzcGFuOwogICAgICB9CiAgICB9KTsKICAgIE1NTC5tcGhhbnRvbS5BdWdtZW50KHsKICAgICAgdG9IVE1MOiBmdW5jdGlvbiB0b0hUTUwoc3BhbiwgSFcsIEQpIHsKICAgICAgICBzcGFuID0gdGhpcy5IVE1MY3JlYXRlU3BhbihzcGFuKTsKCiAgICAgICAgaWYgKHRoaXMuZGF0YVswXSAhPSBudWxsKSB7CiAgICAgICAgICB2YXIgYm94ID0gdGhpcy5kYXRhWzBdLnRvSFRNTChzcGFuKTsKCiAgICAgICAgICBpZiAoRCAhPSBudWxsKSB7CiAgICAgICAgICAgIEhUTUxDU1MuUmVtZWFzdXJlZCh0aGlzLmRhdGFbMF0uSFRNTHN0cmV0Y2hWKHNwYW4sIEhXLCBEKSwgc3Bhbik7CiAgICAgICAgICB9IGVsc2UgaWYgKEhXICE9IG51bGwpIHsKICAgICAgICAgICAgSFRNTENTUy5SZW1lYXN1cmVkKHRoaXMuZGF0YVswXS5IVE1Mc3RyZXRjaEgoc3BhbiwgSFcpLCBzcGFuKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJveCA9IEhUTUxDU1MuTWVhc3VyZWQoYm94LCBzcGFuKTsKICAgICAgICAgIH0KCiAgICAgICAgICBzcGFuLmJib3ggPSB7CiAgICAgICAgICAgIHc6IGJveC5iYm94LncsCiAgICAgICAgICAgIGg6IGJveC5iYm94LmgsCiAgICAgICAgICAgIGQ6IGJveC5iYm94LmQsCiAgICAgICAgICAgIGx3OiAwLAogICAgICAgICAgICBydzogMCwKICAgICAgICAgICAgZXhhY3RXOiB0cnVlCiAgICAgICAgICB9OwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBtID0gc3Bhbi5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgICAgICBzcGFuLmNoaWxkTm9kZXNbaV0uc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5IVE1MaGFuZGxlU3BhY2Uoc3Bhbik7CiAgICAgICAgdGhpcy5IVE1MaGFuZGxlQ29sb3Ioc3Bhbik7CiAgICAgICAgcmV0dXJuIHNwYW47CiAgICAgIH0sCiAgICAgIEhUTUxzdHJldGNoSDogTU1MLm1iYXNlLkhUTUxzdHJldGNoSCwKICAgICAgSFRNTHN0cmV0Y2hWOiBNTUwubWJhc2UuSFRNTHN0cmV0Y2hWCiAgICB9KTsKICAgIE1NTC5tcGFkZGVkLkF1Z21lbnQoewogICAgICB0b0hUTUw6IGZ1bmN0aW9uIHRvSFRNTChzcGFuLCBIVywgRCkgewogICAgICAgIHNwYW4gPSB0aGlzLkhUTUxjcmVhdGVTcGFuKHNwYW4pOwoKICAgICAgICBpZiAodGhpcy5kYXRhWzBdICE9IG51bGwpIHsKICAgICAgICAgIHZhciBzdGFjayA9IEhUTUxDU1MuY3JlYXRlU3RhY2soc3BhbiwgdHJ1ZSk7CiAgICAgICAgICB2YXIgYm94ID0gSFRNTENTUy5jcmVhdGVCb3goc3RhY2spOwogICAgICAgICAgdmFyIGNoaWxkID0gdGhpcy5kYXRhWzBdLnRvSFRNTChib3gpOwoKICAgICAgICAgIGlmIChEICE9IG51bGwpIHsKICAgICAgICAgICAgSFRNTENTUy5SZW1lYXN1cmVkKHRoaXMuZGF0YVswXS5IVE1Mc3RyZXRjaFYoYm94LCBIVywgRCksIGJveCk7CiAgICAgICAgICB9IGVsc2UgaWYgKEhXICE9IG51bGwpIHsKICAgICAgICAgICAgSFRNTENTUy5SZW1lYXN1cmVkKHRoaXMuZGF0YVswXS5IVE1Mc3RyZXRjaEgoYm94LCBIVyksIGJveCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBIVE1MQ1NTLk1lYXN1cmVkKGNoaWxkLCBib3gpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLmdldFZhbHVlcygiaGVpZ2h0IiwgImRlcHRoIiwgIndpZHRoIiwgImxzcGFjZSIsICJ2b2Zmc2V0IiksCiAgICAgICAgICAgICAgeCA9IDAsCiAgICAgICAgICAgICAgeSA9IDAsCiAgICAgICAgICAgICAgbXUgPSB0aGlzLkhUTUxnZXRNdShzcGFuKTsKICAgICAgICAgIHRoaXMuSFRNTGdldFNjYWxlKCk7CgogICAgICAgICAgaWYgKHZhbHVlcy5sc3BhY2UpIHsKICAgICAgICAgICAgeCA9IHRoaXMuSFRNTGxlbmd0aDJlbShib3gsIHZhbHVlcy5sc3BhY2UsIG11KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodmFsdWVzLnZvZmZzZXQpIHsKICAgICAgICAgICAgeSA9IHRoaXMuSFRNTGxlbmd0aDJlbShib3gsIHZhbHVlcy52b2Zmc2V0LCBtdSk7CiAgICAgICAgICB9CgogICAgICAgICAgSFRNTENTUy5wbGFjZUJveChib3gsIHgsIHkpOwogICAgICAgICAgeCAvPSB0aGlzLm1zY2FsZTsKICAgICAgICAgIHkgLz0gdGhpcy5tc2NhbGU7CiAgICAgICAgICBzcGFuLmJib3ggPSB7CiAgICAgICAgICAgIGg6IGJveC5iYm94LmgsCiAgICAgICAgICAgIGQ6IGJveC5iYm94LmQsCiAgICAgICAgICAgIHc6IGJveC5iYm94LncsCiAgICAgICAgICAgIGV4YWN0VzogdHJ1ZSwKICAgICAgICAgICAgbHc6IGJveC5iYm94Lmx3ICsgeCwKICAgICAgICAgICAgcnc6IGJveC5iYm94LnJ3ICsgeCwKICAgICAgICAgICAgSDogTWF0aC5tYXgoYm94LmJib3guSCA9PSBudWxsID8gLUhUTUxDU1MuQklHRElNRU4gOiBib3guYmJveC5IICsgeSwgYm94LmJib3guaCArIHkpLAogICAgICAgICAgICBEOiBNYXRoLm1heChib3guYmJveC5EID09IG51bGwgPyAtSFRNTENTUy5CSUdESU1FTiA6IGJveC5iYm94LkQgLSB5LCBib3guYmJveC5kIC0geSkKICAgICAgICAgIH07CgogICAgICAgICAgaWYgKHZhbHVlcy5oZWlnaHQgIT09ICIiKSB7CiAgICAgICAgICAgIHNwYW4uYmJveC5oID0gdGhpcy5IVE1MbGVuZ3RoMmVtKGJveCwgdmFsdWVzLmhlaWdodCwgbXUsICJoIiwgMCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHZhbHVlcy5kZXB0aCAhPT0gIiIpIHsKICAgICAgICAgICAgc3Bhbi5iYm94LmQgPSB0aGlzLkhUTUxsZW5ndGgyZW0oYm94LCB2YWx1ZXMuZGVwdGgsIG11LCAiZCIsIDApOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh2YWx1ZXMud2lkdGggIT09ICIiKSB7CiAgICAgICAgICAgIHNwYW4uYmJveC53ID0gdGhpcy5IVE1MbGVuZ3RoMmVtKGJveCwgdmFsdWVzLndpZHRoLCBtdSwgInciLCAwKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc3Bhbi5iYm94LkggPD0gc3Bhbi5iYm94LmgpIHsKICAgICAgICAgICAgZGVsZXRlIHNwYW4uYmJveC5IOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChzcGFuLmJib3guRCA8PSBzcGFuLmJib3guZCkgewogICAgICAgICAgICBkZWxldGUgc3Bhbi5iYm94LkQ7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRpbWVuID0gL15ccyooXGQrKFwuXGQqKT98XC5cZCspXHMqKHB0fGVtfGV4fG11fHB4fHBjfGlufG1tfGNtKVxzKiQvOwogICAgICAgICAgc3Bhbi5iYm94LmV4YWN0ID0gISEodGhpcy5kYXRhWzBdICYmIHRoaXMuZGF0YVswXS5kYXRhLmxlbmd0aCA9PSAwIHx8IGRpbWVuLmV4ZWModmFsdWVzLmhlaWdodCkgfHwgZGltZW4uZXhlYyh2YWx1ZXMud2lkdGgpIHx8IGRpbWVuLmV4ZWModmFsdWVzLmRlcHRoKSk7CiAgICAgICAgICBIVE1MQ1NTLnNldFN0YWNrV2lkdGgoc3RhY2ssIHNwYW4uYmJveC53KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGhhbmRsZVNwYWNlKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZUNvbG9yKHNwYW4pOwogICAgICAgIHJldHVybiBzcGFuOwogICAgICB9LAogICAgICBIVE1MbGVuZ3RoMmVtOiBmdW5jdGlvbiBIVE1MbGVuZ3RoMmVtKHNwYW4sIGxlbmd0aCwgbXUsIGQsIG0pIHsKICAgICAgICBpZiAobSA9PSBudWxsKSB7CiAgICAgICAgICBtID0gLUhUTUxDU1MuQklHRElNRU47CiAgICAgICAgfQoKICAgICAgICB2YXIgbWF0Y2ggPSBTdHJpbmcobGVuZ3RoKS5tYXRjaCgvd2lkdGh8aGVpZ2h0fGRlcHRoLyk7CiAgICAgICAgdmFyIHNpemUgPSBtYXRjaCA/IHNwYW4uYmJveFttYXRjaFswXS5jaGFyQXQoMCldIDogZCA/IHNwYW4uYmJveFtkXSA6IDA7CiAgICAgICAgdmFyIHYgPSBIVE1MQ1NTLmxlbmd0aDJlbShsZW5ndGgsIG11LCBzaXplIC8gdGhpcy5tc2NhbGUpICogdGhpcy5tc2NhbGU7CgogICAgICAgIGlmIChkICYmIFN0cmluZyhsZW5ndGgpLm1hdGNoKC9eXHMqWy0rXS8pKSB7CiAgICAgICAgICByZXR1cm4gTWF0aC5tYXgobSwgc3Bhbi5iYm94W2RdICsgdik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB2OwogICAgICAgIH0KICAgICAgfSwKICAgICAgSFRNTHN0cmV0Y2hIOiBNTUwubWJhc2UuSFRNTHN0cmV0Y2hILAogICAgICBIVE1Mc3RyZXRjaFY6IE1NTC5tYmFzZS5IVE1Mc3RyZXRjaFYKICAgIH0pOwogICAgTU1MLm1yb3cuQXVnbWVudCh7CiAgICAgIEhUTUxsaW5lQnJlYWtzOiBmdW5jdGlvbiBIVE1MbGluZUJyZWFrcyhzcGFuKSB7CiAgICAgICAgaWYgKCF0aGlzLnBhcmVudC5saW5lYnJlYWtDb250YWluZXIpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBIVE1MQ1NTLmNvbmZpZy5saW5lYnJlYWtzLmF1dG9tYXRpYyAmJiBzcGFuLmJib3gudyA+IEhUTUxDU1MubGluZWJyZWFrV2lkdGggfHwgdGhpcy5oYXNOZXdsaW5lKCk7CiAgICAgIH0sCiAgICAgIEhUTUxzdHJldGNoSDogZnVuY3Rpb24gSFRNTHN0cmV0Y2hIKGJveCwgdykgewogICAgICAgIHRoaXMuSFRNTHJlbW92ZUNvbG9yKCk7CiAgICAgICAgdmFyIHNwYW4gPSB0aGlzLkhUTUxzcGFuRWxlbWVudCgpOwogICAgICAgIHRoaXMuZGF0YVt0aGlzLmNvcmVdLkhUTUxzdHJldGNoSChzcGFuLCB3KTsKICAgICAgICB0aGlzLkhUTUxjb21wdXRlQkJveChzcGFuLCB0cnVlKTsKICAgICAgICB0aGlzLkhUTUxoYW5kbGVDb2xvcihzcGFuKTsKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfSwKICAgICAgSFRNTHN0cmV0Y2hWOiBmdW5jdGlvbiBIVE1Mc3RyZXRjaFYoYm94LCBoLCBkKSB7CiAgICAgICAgdGhpcy5IVE1McmVtb3ZlQ29sb3IoKTsKICAgICAgICB2YXIgc3BhbiA9IHRoaXMuSFRNTHNwYW5FbGVtZW50KCk7CiAgICAgICAgdGhpcy5kYXRhW3RoaXMuY29yZV0uSFRNTHN0cmV0Y2hWKHNwYW4sIGgsIGQpOwogICAgICAgIHRoaXMuSFRNTGNvbXB1dGVCQm94KHNwYW4sIHRydWUpOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZUNvbG9yKHNwYW4pOwogICAgICAgIHJldHVybiBzcGFuOwogICAgICB9CiAgICB9KTsKICAgIE1NTC5tc3R5bGUuQXVnbWVudCh7CiAgICAgIHRvSFRNTDogZnVuY3Rpb24gdG9IVE1MKHNwYW4sIEhXLCBEKSB7CiAgICAgICAgc3BhbiA9IHRoaXMuSFRNTGNyZWF0ZVNwYW4oc3Bhbik7CgogICAgICAgIGlmICh0aGlzLmRhdGFbMF0gIT0gbnVsbCkgewogICAgICAgICAgdmFyIFNQQU4gPSB0aGlzLmRhdGFbMF0udG9IVE1MKHNwYW4pOwoKICAgICAgICAgIGlmIChEICE9IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5kYXRhWzBdLkhUTUxzdHJldGNoVihzcGFuLCBIVywgRCk7CiAgICAgICAgICB9IGVsc2UgaWYgKEhXICE9IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5kYXRhWzBdLkhUTUxzdHJldGNoSChzcGFuLCBIVyk7CiAgICAgICAgICB9CgogICAgICAgICAgc3Bhbi5iYm94ID0gU1BBTi5iYm94OwogICAgICAgIH0KCiAgICAgICAgdGhpcy5IVE1MaGFuZGxlU3BhY2Uoc3Bhbik7CiAgICAgICAgdGhpcy5IVE1MaGFuZGxlQ29sb3Ioc3Bhbik7CiAgICAgICAgcmV0dXJuIHNwYW47CiAgICAgIH0sCiAgICAgIEhUTUxzdHJldGNoSDogTU1MLm1iYXNlLkhUTUxzdHJldGNoSCwKICAgICAgSFRNTHN0cmV0Y2hWOiBNTUwubWJhc2UuSFRNTHN0cmV0Y2hWCiAgICB9KTsKICAgIE1NTC5tZnJhYy5BdWdtZW50KHsKICAgICAgdG9IVE1MOiBmdW5jdGlvbiB0b0hUTUwoc3BhbikgewogICAgICAgIHNwYW4gPSB0aGlzLkhUTUxjcmVhdGVTcGFuKHNwYW4pOwogICAgICAgIHZhciBmcmFjID0gSFRNTENTUy5jcmVhdGVTdGFjayhzcGFuKTsKICAgICAgICB2YXIgbnVtID0gSFRNTENTUy5jcmVhdGVCb3goZnJhYyksCiAgICAgICAgICAgIGRlbiA9IEhUTUxDU1MuY3JlYXRlQm94KGZyYWMpOwogICAgICAgIEhUTUxDU1MuTWVhc3VyZVNwYW5zKFt0aGlzLkhUTUxib3hDaGlsZCgwLCBudW0pLCB0aGlzLkhUTUxib3hDaGlsZCgxLCBkZW4pXSk7CiAgICAgICAgdmFyIHZhbHVlcyA9IHRoaXMuZ2V0VmFsdWVzKCJkaXNwbGF5c3R5bGUiLCAibGluZXRoaWNrbmVzcyIsICJudW1hbGlnbiIsICJkZW5vbWFsaWduIiwgImJldmVsbGVkIik7CiAgICAgICAgdmFyIHNjYWxlID0gdGhpcy5IVE1MZ2V0U2NhbGUoKSwKICAgICAgICAgICAgaXNEaXNwbGF5ID0gdmFsdWVzLmRpc3BsYXlzdHlsZTsKICAgICAgICB2YXIgYSA9IEhUTUxDU1MuVGVYLmF4aXNfaGVpZ2h0ICogc2NhbGU7CgogICAgICAgIGlmICh2YWx1ZXMuYmV2ZWxsZWQpIHsKICAgICAgICAgIHZhciBkZWx0YSA9IGlzRGlzcGxheSA/IC40IDogLjE1OwogICAgICAgICAgdmFyIEggPSBNYXRoLm1heChudW0uYmJveC5oICsgbnVtLmJib3guZCwgZGVuLmJib3guaCArIGRlbi5iYm94LmQpICsgMiAqIGRlbHRhOwogICAgICAgICAgdmFyIGJldmVsID0gSFRNTENTUy5jcmVhdGVCb3goZnJhYyk7CiAgICAgICAgICBIVE1MQ1NTLmNyZWF0ZURlbGltaXRlcihiZXZlbCwgMHgyRiwgSCk7CiAgICAgICAgICBIVE1MQ1NTLnBsYWNlQm94KG51bSwgMCwgKG51bS5iYm94LmQgLSBudW0uYmJveC5oKSAvIDIgKyBhICsgZGVsdGEpOwogICAgICAgICAgSFRNTENTUy5wbGFjZUJveChiZXZlbCwgbnVtLmJib3gudyAtIGRlbHRhIC8gMiwgKGJldmVsLmJib3guZCAtIGJldmVsLmJib3guaCkgLyAyICsgYSk7CiAgICAgICAgICBIVE1MQ1NTLnBsYWNlQm94KGRlbiwgbnVtLmJib3gudyArIGJldmVsLmJib3gudyAtIGRlbHRhLCAoZGVuLmJib3guZCAtIGRlbi5iYm94LmgpIC8gMiArIGEgLSBkZWx0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBXID0gTWF0aC5tYXgobnVtLmJib3gudywgZGVuLmJib3gudyk7CiAgICAgICAgICB2YXIgdCA9IEhUTUxDU1MudGhpY2tuZXNzMmVtKHZhbHVlcy5saW5ldGhpY2tuZXNzLCB0aGlzLnNjYWxlKSAqIHRoaXMubXNjYWxlLAogICAgICAgICAgICAgIHAsCiAgICAgICAgICAgICAgcSwKICAgICAgICAgICAgICB1LAogICAgICAgICAgICAgIHY7CiAgICAgICAgICB2YXIgbXQgPSBIVE1MQ1NTLlRlWC5taW5fcnVsZV90aGlja25lc3MgLyB0aGlzLmVtOwoKICAgICAgICAgIGlmIChpc0Rpc3BsYXkpIHsKICAgICAgICAgICAgdSA9IEhUTUxDU1MuVGVYLm51bTE7CiAgICAgICAgICAgIHYgPSBIVE1MQ1NTLlRlWC5kZW5vbTE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1ID0gdCA9PT0gMCA/IEhUTUxDU1MuVGVYLm51bTMgOiBIVE1MQ1NTLlRlWC5udW0yOwogICAgICAgICAgICB2ID0gSFRNTENTUy5UZVguZGVub20yOwogICAgICAgICAgfQoKICAgICAgICAgIHUgKj0gc2NhbGU7CiAgICAgICAgICB2ICo9IHNjYWxlOwoKICAgICAgICAgIGlmICh0ID09PSAwKSB7CiAgICAgICAgICAgIC8vIFxhdG9wCiAgICAgICAgICAgIHAgPSBNYXRoLm1heCgoaXNEaXNwbGF5ID8gNyA6IDMpICogSFRNTENTUy5UZVgucnVsZV90aGlja25lc3MsIDIgKiBtdCk7IC8vIGZvcmNlIHRvIGF0IGxlYXN0IDIgcHgKCiAgICAgICAgICAgIHEgPSB1IC0gbnVtLmJib3guZCAtIChkZW4uYmJveC5oIC0gdik7CgogICAgICAgICAgICBpZiAocSA8IHApIHsKICAgICAgICAgICAgICB1ICs9IChwIC0gcSkgLyAyOwogICAgICAgICAgICAgIHYgKz0gKHAgLSBxKSAvIDI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFxvdmVyCiAgICAgICAgICAgIHAgPSBNYXRoLm1heCgoaXNEaXNwbGF5ID8gMiA6IDApICogbXQgKyB0LCB0IC8gMiArIDEuNSAqIG10KTsgLy8gZm9yY2UgdG8gYmUgYXQgbGVhc3QgMS41cHgKCiAgICAgICAgICAgIHEgPSB1IC0gbnVtLmJib3guZCAtIChhICsgdCAvIDIpOwoKICAgICAgICAgICAgaWYgKHEgPCBwKSB7CiAgICAgICAgICAgICAgdSArPSBwIC0gcTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcSA9IGEgLSB0IC8gMiAtIChkZW4uYmJveC5oIC0gdik7CgogICAgICAgICAgICBpZiAocSA8IHApIHsKICAgICAgICAgICAgICB2ICs9IHAgLSBxOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcnVsZSA9IEhUTUxDU1MuY3JlYXRlQm94KGZyYWMpOwogICAgICAgICAgICBIVE1MQ1NTLmNyZWF0ZVJ1bGUocnVsZSwgdCwgMCwgVyArIDIgKiB0KTsKICAgICAgICAgICAgSFRNTENTUy5wbGFjZUJveChydWxlLCAwLCBhIC0gdCAvIDIpOwogICAgICAgICAgfQoKICAgICAgICAgIEhUTUxDU1MuYWxpZ25Cb3gobnVtLCB2YWx1ZXMubnVtYWxpZ24sIHUpOwogICAgICAgICAgSFRNTENTUy5hbGlnbkJveChkZW4sIHZhbHVlcy5kZW5vbWFsaWduLCAtdik7CiAgICAgICAgfQoKICAgICAgICB0aGlzLkhUTUxoYW5kbGVTcGFjZShzcGFuKTsKICAgICAgICB0aGlzLkhUTUxoYW5kbGVDb2xvcihzcGFuKTsKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfSwKICAgICAgSFRNTGNhblN0cmV0Y2g6IGZ1bmN0aW9uIEhUTUxjYW5TdHJldGNoKGRpcmVjdGlvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwKICAgICAgSFRNTGhhbmRsZVNwYWNlOiBmdW5jdGlvbiBIVE1MaGFuZGxlU3BhY2Uoc3BhbikgewogICAgICAgIGlmICghdGhpcy50ZXhXaXRoRGVsaW1zICYmICF0aGlzLnVzZU1NTHNwYWNpbmcpIHsKICAgICAgICAgIC8vCiAgICAgICAgICAvLyAgQWRkIG51bGxkZWxpbWl0ZXJzcGFjZSBhcm91bmQgdGhlIGZyYWN0aW9uCiAgICAgICAgICAvLyAgKFRlWEJvb2sgcGcgMTUwIGFuZCBBcHBlbmRpeCBHIHJ1bGUgMTVlKQogICAgICAgICAgLy8KICAgICAgICAgIHZhciBzcGFjZSA9IEhUTUxDU1MuVGVYLm51bGxkZWxpbWl0ZXJzcGFjZSAqIHRoaXMubXNjYWxlOwogICAgICAgICAgdmFyIHN0eWxlID0gc3Bhbi5jaGlsZE5vZGVzW0hUTUxDU1MubXNpZVBhZGRpbmdXaWR0aEJ1ZyA/IDEgOiAwXS5zdHlsZTsKICAgICAgICAgIHN0eWxlLm1hcmdpbkxlZnQgPSBzdHlsZS5tYXJnaW5SaWdodCA9IEhUTUxDU1MuRW0oc3BhY2UpOwogICAgICAgICAgc3Bhbi5iYm94LncgKz0gMiAqIHNwYWNlOwogICAgICAgICAgc3Bhbi5iYm94LnJ3ICs9IDIgKiBzcGFjZTsKICAgICAgICB9CgogICAgICAgIHRoaXMuU1VQRVIoYXJndW1lbnRzKS5IVE1MaGFuZGxlU3BhY2UuY2FsbCh0aGlzLCBzcGFuKTsKICAgICAgfQogICAgfSk7CiAgICBNTUwubXNxcnQuQXVnbWVudCh7CiAgICAgIHRvSFRNTDogZnVuY3Rpb24gdG9IVE1MKHNwYW4pIHsKICAgICAgICBzcGFuID0gdGhpcy5IVE1MY3JlYXRlU3BhbihzcGFuKTsKICAgICAgICB2YXIgc3FydCA9IEhUTUxDU1MuY3JlYXRlU3RhY2soc3Bhbik7CiAgICAgICAgdmFyIGJhc2UgPSBIVE1MQ1NTLmNyZWF0ZUJveChzcXJ0KSwKICAgICAgICAgICAgcnVsZSA9IEhUTUxDU1MuY3JlYXRlQm94KHNxcnQpLAogICAgICAgICAgICBzdXJkID0gSFRNTENTUy5jcmVhdGVCb3goc3FydCk7CiAgICAgICAgdmFyIHNjYWxlID0gdGhpcy5IVE1MZ2V0U2NhbGUoKTsKICAgICAgICB2YXIgdCA9IEhUTUxDU1MuVGVYLnJ1bGVfdGhpY2tuZXNzICogc2NhbGUsCiAgICAgICAgICAgIHAsCiAgICAgICAgICAgIHEsCiAgICAgICAgICAgIEgsCiAgICAgICAgICAgIFc7CgogICAgICAgIGlmICh0aGlzLkdldCgiZGlzcGxheXN0eWxlIikpIHsKICAgICAgICAgIHAgPSBIVE1MQ1NTLlRlWC54X2hlaWdodCAqIHNjYWxlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwID0gdDsKICAgICAgICB9CgogICAgICAgIHEgPSBNYXRoLm1heCh0ICsgcCAvIDQsIDEuNSAqIEhUTUxDU1MuVGVYLm1pbl9ydWxlX3RoaWNrbmVzcyAvIHRoaXMuZW0pOyAvLyBmb3JjZSB0byBiZSBhdCBsZWFzdCAxcHgKCiAgICAgICAgdmFyIEJBU0UgPSB0aGlzLkhUTUxib3hDaGlsZCgwLCBiYXNlKTsKICAgICAgICBIID0gQkFTRS5iYm94LmggKyBCQVNFLmJib3guZCArIHEgKyB0OwogICAgICAgIEhUTUxDU1MuY3JlYXRlRGVsaW1pdGVyKHN1cmQsIDB4MjIxQSwgSCwgc2NhbGUpOwogICAgICAgIEhUTUxDU1MuTWVhc3VyZVNwYW5zKFtCQVNFLCBzdXJkXSk7CiAgICAgICAgVyA9IEJBU0UuYmJveC53OwogICAgICAgIHZhciB4ID0gMDsKCiAgICAgICAgaWYgKHN1cmQuaXNNdWx0aUNoYXIgfHwgSFRNTENTUy5BZGp1c3RTdXJkICYmIEhUTUxDU1MuaW1nRm9udHMpIHsKICAgICAgICAgIHN1cmQuYmJveC53ICo9IC45NTsKICAgICAgICB9CgogICAgICAgIGlmIChzdXJkLmJib3guaCArIHN1cmQuYmJveC5kID4gSCkgewogICAgICAgICAgcSA9IChzdXJkLmJib3guaCArIHN1cmQuYmJveC5kIC0gKEggLSB0KSkgLyAyOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJ1bGVDID0gSFRNTENTUy5GT05UREFUQS5ERUxJTUlURVJTW0hUTUxDU1MuRk9OVERBVEEuUlVMRUNIQVJdOwoKICAgICAgICBpZiAoIXJ1bGVDIHx8IFcgPCBydWxlQy5IV1swXVswXSAqIHNjYWxlIHx8IHNjYWxlIDwgLjc1KSB7CiAgICAgICAgICBIVE1MQ1NTLmNyZWF0ZVJ1bGUocnVsZSwgMCwgdCwgVyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEhUTUxDU1MuY3JlYXRlRGVsaW1pdGVyKHJ1bGUsIEhUTUxDU1MuRk9OVERBVEEuUlVMRUNIQVIsIFcsIHNjYWxlKTsKICAgICAgICB9CgogICAgICAgIEggPSBCQVNFLmJib3guaCArIHEgKyB0OwogICAgICAgIHEgPSBIICogSFRNTENTUy5yZnV6ejsKCiAgICAgICAgaWYgKHN1cmQuaXNNdWx0aUNoYXIpIHsKICAgICAgICAgIHEgPSBIVE1MQ1NTLnJmdXp6OwogICAgICAgIH0KCiAgICAgICAgeCA9IHRoaXMuSFRNTGFkZFJvb3Qoc3FydCwgc3VyZCwgeCwgc3VyZC5iYm94LmggKyBzdXJkLmJib3guZCAtIEgsIHNjYWxlKTsKICAgICAgICBIVE1MQ1NTLnBsYWNlQm94KHN1cmQsIHgsIEggLSBzdXJkLmJib3guaCk7CiAgICAgICAgSFRNTENTUy5wbGFjZUJveChydWxlLCB4ICsgc3VyZC5iYm94LncsIEggLSBydWxlLmJib3guaCArIHEpOwogICAgICAgIEhUTUxDU1MucGxhY2VCb3goYmFzZSwgeCArIHN1cmQuYmJveC53LCAwKTsKICAgICAgICB0aGlzLkhUTUxoYW5kbGVTcGFjZShzcGFuKTsKICAgICAgICB0aGlzLkhUTUxoYW5kbGVDb2xvcihzcGFuKTsKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfSwKICAgICAgSFRNTGFkZFJvb3Q6IGZ1bmN0aW9uIEhUTUxhZGRSb290KHNxcnQsIHN1cmQsIHgsIGQsIHNjYWxlKSB7CiAgICAgICAgcmV0dXJuIHg7CiAgICAgIH0KICAgIH0pOwogICAgTU1MLm1yb290LkF1Z21lbnQoewogICAgICB0b0hUTUw6IE1NTC5tc3FydC5wcm90b3R5cGUudG9IVE1MLAogICAgICBIVE1MYWRkUm9vdDogZnVuY3Rpb24gSFRNTGFkZFJvb3Qoc3FydCwgc3VyZCwgeCwgZCwgc2NhbGUpIHsKICAgICAgICB2YXIgYm94ID0gSFRNTENTUy5jcmVhdGVCb3goc3FydCk7CgogICAgICAgIGlmICh0aGlzLmRhdGFbMV0pIHsKICAgICAgICAgIHZhciByb290ID0gdGhpcy5kYXRhWzFdLnRvSFRNTChib3gpOwogICAgICAgICAgcm9vdC5zdHlsZS5wYWRkaW5nUmlnaHQgPSByb290LnN0eWxlLnBhZGRpbmdMZWZ0ID0gIiI7IC8vIHJlbW92ZSBleHRyYSBwYWRkaW5nLCBpZiBhbnkKCiAgICAgICAgICBIVE1MQ1NTLk1lYXN1cmVkKHJvb3QsIGJveCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJveC5iYm94ID0gdGhpcy5IVE1MemVyb0JCb3goKTsKICAgICAgICB9CgogICAgICAgIHZhciBoID0gdGhpcy5IVE1Mcm9vdEhlaWdodChzdXJkLmJib3guaCArIHN1cmQuYmJveC5kLCBzY2FsZSwgYm94KSAtIGQ7CiAgICAgICAgdmFyIHcgPSBNYXRoLm1pbihib3guYmJveC53LCBib3guYmJveC5ydyk7IC8vIHJlbW92ZSBleHRyYSByaWdodC1oYW5kIHBhZGRpbmcsIGlmIGFueQoKICAgICAgICB4ID0gTWF0aC5tYXgodywgc3VyZC5vZmZzZXQpOwogICAgICAgIEhUTUxDU1MucGxhY2VCb3goYm94LCB4IC0gdywgaCk7CiAgICAgICAgcmV0dXJuIHggLSBzdXJkLm9mZnNldDsKICAgICAgfSwKICAgICAgSFRNTHJvb3RIZWlnaHQ6IGZ1bmN0aW9uIEhUTUxyb290SGVpZ2h0KGQsIHNjYWxlLCByb290KSB7CiAgICAgICAgcmV0dXJuIC40NSAqIChkIC0gLjkgKiBzY2FsZSkgKyAuNiAqIHNjYWxlICsgTWF0aC5tYXgoMCwgcm9vdC5iYm94LmQgLSAuMDc1KTsKICAgICAgfQogICAgfSk7CiAgICBNTUwubWZlbmNlZC5BdWdtZW50KHsKICAgICAgdG9IVE1MOiBmdW5jdGlvbiB0b0hUTUwoc3BhbikgewogICAgICAgIHNwYW4gPSB0aGlzLkhUTUxjcmVhdGVTcGFuKHNwYW4pOwoKICAgICAgICBpZiAodGhpcy5kYXRhLm9wZW4pIHsKICAgICAgICAgIHRoaXMuZGF0YS5vcGVuLnRvSFRNTChzcGFuKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmRhdGFbMF0gIT0gbnVsbCkgewogICAgICAgICAgdGhpcy5kYXRhWzBdLnRvSFRNTChzcGFuKTsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIGkgPSAxLCBtID0gdGhpcy5kYXRhLmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgICAgaWYgKHRoaXMuZGF0YVtpXSkgewogICAgICAgICAgICBpZiAodGhpcy5kYXRhWyJzZXAiICsgaV0pIHsKICAgICAgICAgICAgICB0aGlzLmRhdGFbInNlcCIgKyBpXS50b0hUTUwoc3Bhbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuZGF0YVtpXS50b0hUTUwoc3Bhbik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5kYXRhLmNsb3NlKSB7CiAgICAgICAgICB0aGlzLmRhdGEuY2xvc2UudG9IVE1MKHNwYW4pOwogICAgICAgIH0KCiAgICAgICAgdmFyIHN0cmV0Y2h5ID0gdGhpcy5IVE1MY29tcHV0ZUJCb3goc3Bhbik7CiAgICAgICAgdmFyIGggPSBzcGFuLmJib3guaCwKICAgICAgICAgICAgZCA9IHNwYW4uYmJveC5kOwoKICAgICAgICBmb3IgKGkgPSAwLCBtID0gc3RyZXRjaHkubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgICBzdHJldGNoeVtpXS5IVE1Mc3RyZXRjaFYoc3BhbiwgaCwgZCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3RyZXRjaHkubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLkhUTUxjb21wdXRlQkJveChzcGFuLCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGhhbmRsZVNwYWNlKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZUNvbG9yKHNwYW4pOwogICAgICAgIHJldHVybiBzcGFuOwogICAgICB9LAogICAgICBIVE1MY29tcHV0ZUJCb3g6IGZ1bmN0aW9uIEhUTUxjb21wdXRlQkJveChzcGFuLCBmdWxsKSB7CiAgICAgICAgdmFyIEJCT1ggPSBzcGFuLmJib3ggPSB7fSwKICAgICAgICAgICAgc3RyZXRjaHkgPSBbXTsKICAgICAgICB0aGlzLkhUTUxjaGVja1N0cmV0Y2h5KHRoaXMuZGF0YS5vcGVuLCBCQk9YLCBzdHJldGNoeSwgZnVsbCk7CiAgICAgICAgdGhpcy5IVE1MY2hlY2tTdHJldGNoeSh0aGlzLmRhdGFbMF0sIEJCT1gsIHN0cmV0Y2h5LCBmdWxsKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDEsIG0gPSB0aGlzLmRhdGEubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy5kYXRhW2ldKSB7CiAgICAgICAgICAgIHRoaXMuSFRNTGNoZWNrU3RyZXRjaHkodGhpcy5kYXRhWyJzZXAiICsgaV0sIEJCT1gsIHN0cmV0Y2h5LCBmdWxsKTsKICAgICAgICAgICAgdGhpcy5IVE1MY2hlY2tTdHJldGNoeSh0aGlzLmRhdGFbaV0sIEJCT1gsIHN0cmV0Y2h5LCBmdWxsKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGNoZWNrU3RyZXRjaHkodGhpcy5kYXRhLmNsb3NlLCBCQk9YLCBzdHJldGNoeSwgZnVsbCk7CiAgICAgICAgdGhpcy5IVE1MY2xlYW5CQm94KEJCT1gpOwogICAgICAgIHJldHVybiBzdHJldGNoeTsKICAgICAgfSwKICAgICAgSFRNTGNoZWNrU3RyZXRjaHk6IGZ1bmN0aW9uIEhUTUxjaGVja1N0cmV0Y2h5KGNvcmUsIEJCT1gsIHN0cmV0Y2h5LCBmdWxsKSB7CiAgICAgICAgaWYgKGNvcmUpIHsKICAgICAgICAgIGlmICghZnVsbCAmJiBjb3JlLkhUTUxjYW5TdHJldGNoKCJWZXJ0aWNhbCIpKSB7CiAgICAgICAgICAgIHN0cmV0Y2h5LnB1c2goY29yZSk7CiAgICAgICAgICAgIGNvcmUgPSBjb3JlLkNvcmVNTygpIHx8IGNvcmU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5IVE1MY29tYmluZUJCb3hlcyhjb3JlLCBCQk9YKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgTU1MLm1lbmNsb3NlLkF1Z21lbnQoewogICAgICB0b0hUTUw6IE1NTC5tYmFzZS5IVE1MYXV0b2xvYWQKICAgIH0pOwogICAgTU1MLm1hY3Rpb24uQXVnbWVudCh7CiAgICAgIHRvSFRNTDogTU1MLm1iYXNlLkhUTUxhdXRvbG9hZAogICAgfSk7CiAgICBNTUwuc2VtYW50aWNzLkF1Z21lbnQoewogICAgICB0b0hUTUw6IGZ1bmN0aW9uIHRvSFRNTChzcGFuLCBIVywgRCkgewogICAgICAgIHNwYW4gPSB0aGlzLkhUTUxjcmVhdGVTcGFuKHNwYW4pOwoKICAgICAgICBpZiAodGhpcy5kYXRhWzBdICE9IG51bGwpIHsKICAgICAgICAgIHZhciBTUEFOID0gdGhpcy5kYXRhWzBdLnRvSFRNTChzcGFuKTsKCiAgICAgICAgICBpZiAoRCAhPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMuZGF0YVswXS5IVE1Mc3RyZXRjaFYoc3BhbiwgSFcsIEQpOwogICAgICAgICAgfSBlbHNlIGlmIChIVyAhPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMuZGF0YVswXS5IVE1Mc3RyZXRjaEgoc3BhbiwgSFcpOwogICAgICAgICAgfQoKICAgICAgICAgIHNwYW4uYmJveCA9IFNQQU4uYmJveDsKICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGhhbmRsZVNwYWNlKHNwYW4pOwogICAgICAgIHJldHVybiBzcGFuOwogICAgICB9LAogICAgICBIVE1Mc3RyZXRjaEg6IE1NTC5tYmFzZS5IVE1Mc3RyZXRjaEgsCiAgICAgIEhUTUxzdHJldGNoVjogTU1MLm1iYXNlLkhUTUxzdHJldGNoVgogICAgfSk7CiAgICBNTUwubXVuZGVyb3Zlci5BdWdtZW50KHsKICAgICAgdG9IVE1MOiBmdW5jdGlvbiB0b0hUTUwoc3BhbiwgSFcsIEQpIHsKICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoImRpc3BsYXlzdHlsZSIsICJhY2NlbnQiLCAiYWNjZW50dW5kZXIiLCAiYWxpZ24iKTsKICAgICAgICB2YXIgYmFzZSA9IHRoaXMuZGF0YVt0aGlzLmJhc2VdOwoKICAgICAgICBpZiAoIXZhbHVlcy5kaXNwbGF5c3R5bGUgJiYgYmFzZSAhPSBudWxsICYmIChiYXNlLm1vdmFibGVsaW1pdHMgfHwgYmFzZS5Db3JlTU8oKS5HZXQoIm1vdmFibGVsaW1pdHMiKSkpIHsKICAgICAgICAgIHJldHVybiBNTUwubXN1YnN1cC5wcm90b3R5cGUudG9IVE1MLmNhbGwodGhpcywgc3Bhbik7CiAgICAgICAgfQoKICAgICAgICBzcGFuID0gdGhpcy5IVE1MY3JlYXRlU3BhbihzcGFuKTsKICAgICAgICB2YXIgc2NhbGUgPSB0aGlzLkhUTUxnZXRTY2FsZSgpOwogICAgICAgIHZhciBzdGFjayA9IEhUTUxDU1MuY3JlYXRlU3RhY2soc3Bhbik7CiAgICAgICAgdmFyIGJveGVzID0gW10sCiAgICAgICAgICAgIGNoaWxkcmVuID0gW10sCiAgICAgICAgICAgIHN0cmV0Y2ggPSBbXSwKICAgICAgICAgICAgYm94LAogICAgICAgICAgICBpLAogICAgICAgICAgICBtOwoKICAgICAgICBmb3IgKGkgPSAwLCBtID0gdGhpcy5kYXRhLmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgICAgaWYgKHRoaXMuZGF0YVtpXSAhPSBudWxsKSB7CiAgICAgICAgICAgIGJveCA9IGJveGVzW2ldID0gSFRNTENTUy5jcmVhdGVCb3goc3RhY2spOwogICAgICAgICAgICBjaGlsZHJlbltpXSA9IHRoaXMuZGF0YVtpXS50b0hUTUwoYm94KTsKCiAgICAgICAgICAgIGlmIChpID09IHRoaXMuYmFzZSkgewogICAgICAgICAgICAgIGlmIChEICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGF0YVt0aGlzLmJhc2VdLkhUTUxzdHJldGNoVihib3gsIEhXLCBEKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKEhXICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGF0YVt0aGlzLmJhc2VdLkhUTUxzdHJldGNoSChib3gsIEhXKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0cmV0Y2hbaV0gPSBEID09IG51bGwgJiYgSFcgIT0gbnVsbCA/IGZhbHNlIDogdGhpcy5kYXRhW2ldLkhUTUxjYW5TdHJldGNoKCJIb3Jpem9udGFsIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3RyZXRjaFtpXSA9IHRoaXMuZGF0YVtpXS5IVE1MY2FuU3RyZXRjaCgiSG9yaXpvbnRhbCIpOwogICAgICAgICAgICAgIGNoaWxkcmVuW2ldLnN0eWxlLnBhZGRpbmdMZWZ0ID0gY2hpbGRyZW5baV0uc3R5bGUucGFkZGluZ1JpZ2h0ID0gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEhUTUxDU1MuTWVhc3VyZVNwYW5zKGNoaWxkcmVuKTsKICAgICAgICB2YXIgVyA9IC1IVE1MQ1NTLkJJR0RJTUVOLAogICAgICAgICAgICBXVyA9IFc7CgogICAgICAgIGZvciAoaSA9IDAsIG0gPSB0aGlzLmRhdGEubGVuZ3RoOyBpIDwgbTsgaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy5kYXRhW2ldKSB7CiAgICAgICAgICAgIGlmIChib3hlc1tpXS5iYm94LncgPiBXVykgewogICAgICAgICAgICAgIFdXID0gYm94ZXNbaV0uYmJveC53OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXN0cmV0Y2hbaV0gJiYgV1cgPiBXKSB7CiAgICAgICAgICAgICAgVyA9IFdXOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoRCA9PSBudWxsICYmIEhXICE9IG51bGwpIHsKICAgICAgICAgIFcgPSBIVzsKICAgICAgICB9IGVsc2UgaWYgKFcgPT0gLUhUTUxDU1MuQklHRElNRU4pIHsKICAgICAgICAgIFcgPSBXVzsKICAgICAgICB9CgogICAgICAgIGZvciAoaSA9IFdXID0gMCwgbSA9IHRoaXMuZGF0YS5sZW5ndGg7IGkgPCBtOyBpKyspIHsKICAgICAgICAgIGlmICh0aGlzLmRhdGFbaV0pIHsKICAgICAgICAgICAgYm94ID0gYm94ZXNbaV07CgogICAgICAgICAgICBpZiAoc3RyZXRjaFtpXSkgewogICAgICAgICAgICAgIGJveC5iYm94ID0gdGhpcy5kYXRhW2ldLkhUTUxzdHJldGNoSChib3gsIFcpLmJib3g7CgogICAgICAgICAgICAgIGlmIChpICE9PSB0aGlzLmJhc2UpIHsKICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLnN0eWxlLnBhZGRpbmdMZWZ0ID0gY2hpbGRyZW5baV0uc3R5bGUucGFkZGluZ1JpZ2h0ID0gIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYm94LmJib3gudyA+IFdXKSB7CiAgICAgICAgICAgICAgV1cgPSBib3guYmJveC53OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgdCA9IEhUTUxDU1MuVGVYLnJ1bGVfdGhpY2tuZXNzICogdGhpcy5tc2NhbGUsCiAgICAgICAgICAgIGZhY3RvciA9IEhUTUxDU1MuRk9OVERBVEEuVGVYX2ZhY3RvcjsKICAgICAgICB2YXIgeCwKICAgICAgICAgICAgeSwKICAgICAgICAgICAgejEsCiAgICAgICAgICAgIHoyLAogICAgICAgICAgICB6MywKICAgICAgICAgICAgZHcsCiAgICAgICAgICAgIGssCiAgICAgICAgICAgIGRlbHRhID0gMDsKICAgICAgICBiYXNlID0gYm94ZXNbdGhpcy5iYXNlXSB8fCB7CiAgICAgICAgICBiYm94OiB0aGlzLkhUTUx6ZXJvQkJveCgpCiAgICAgICAgfTsKCiAgICAgICAgaWYgKGJhc2UuYmJveC5pYykgewogICAgICAgICAgZGVsdGEgPSAxLjMgKiBiYXNlLmJib3guaWMgKyAuMDU7CiAgICAgICAgfSAvLyBhZGp1c3QgZmFrZWQgSUMgdG8gYmUgbW9yZSBpbiBsaW5lIHdpdGggZXhwZXRlZCByZXN1bHRzCgoKICAgICAgICBmb3IgKGkgPSAwLCBtID0gdGhpcy5kYXRhLmxlbmd0aDsgaSA8IG07IGkrKykgewogICAgICAgICAgaWYgKHRoaXMuZGF0YVtpXSAhPSBudWxsKSB7CiAgICAgICAgICAgIGJveCA9IGJveGVzW2ldOwogICAgICAgICAgICB6MyA9IEhUTUxDU1MuVGVYLmJpZ19vcF9zcGFjaW5nNSAqIHNjYWxlOwogICAgICAgICAgICB2YXIgYWNjZW50ID0gaSAhPSB0aGlzLmJhc2UgJiYgdmFsdWVzW3RoaXMuQUNDRU5UU1tpXV07CgogICAgICAgICAgICBpZiAoYWNjZW50ICYmIGJveC5iYm94LncgPD0gMSAvIEhUTUxDU1MuZW0gKyAuMDAwMSkgewogICAgICAgICAgICAgIC8vIGltYWdlcyBjYW4gZ2V0IHRoZSB3aWR0aCBvZmYgYnkgMXB4CiAgICAgICAgICAgICAgYm94LmJib3gudyA9IGJveC5iYm94LnJ3IC0gYm94LmJib3gubHc7CiAgICAgICAgICAgICAgYm94LmJib3gubm9jbGlwID0gdHJ1ZTsKCiAgICAgICAgICAgICAgaWYgKGJveC5iYm94Lmx3KSB7CiAgICAgICAgICAgICAgICBib3guaW5zZXJ0QmVmb3JlKEhUTUxDU1MuY3JlYXRlU3BhY2UoYm94LnBhcmVudE5vZGUsIDAsIDAsIC1ib3guYmJveC5sdyksIGJveC5maXJzdENoaWxkKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIEhUTUxDU1MuY3JlYXRlQmxhbmsoYm94LCAwLCAwLCBib3guYmJveC5ydyArIC4xKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZHcgPSB7CiAgICAgICAgICAgICAgbGVmdDogMCwKICAgICAgICAgICAgICBjZW50ZXI6IChXVyAtIGJveC5iYm94LncpIC8gMiwKICAgICAgICAgICAgICByaWdodDogV1cgLSBib3guYmJveC53CiAgICAgICAgICAgIH1bdmFsdWVzLmFsaWduXTsKICAgICAgICAgICAgeCA9IGR3OwogICAgICAgICAgICB5ID0gMDsKCiAgICAgICAgICAgIGlmIChpID09IHRoaXMub3ZlcikgewogICAgICAgICAgICAgIGlmIChhY2NlbnQpIHsKICAgICAgICAgICAgICAgIGsgPSBNYXRoLm1heCh0ICogc2NhbGUgKiBmYWN0b3IsIDIuNSAvIHRoaXMuZW0pOwogICAgICAgICAgICAgICAgejMgPSAwOwoKICAgICAgICAgICAgICAgIGlmIChiYXNlLmJib3guc2tldykgewogICAgICAgICAgICAgICAgICB4ICs9IGJhc2UuYmJveC5za2V3OwogICAgICAgICAgICAgICAgICBzcGFuLmJib3guc2tldyA9IGJhc2UuYmJveC5za2V3OwoKICAgICAgICAgICAgICAgICAgaWYgKHggKyBib3guYmJveC53ID4gV1cpIHsKICAgICAgICAgICAgICAgICAgICBzcGFuLmJib3guc2tldyArPSAoV1cgLSBib3guYmJveC53IC0geCkgLyAyOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHoxID0gSFRNTENTUy5UZVguYmlnX29wX3NwYWNpbmcxICogc2NhbGUgKiBmYWN0b3I7CiAgICAgICAgICAgICAgICB6MiA9IEhUTUxDU1MuVGVYLmJpZ19vcF9zcGFjaW5nMyAqIHNjYWxlICogZmFjdG9yOwogICAgICAgICAgICAgICAgayA9IE1hdGgubWF4KHoxLCB6MiAtIE1hdGgubWF4KDAsIGJveC5iYm94LmQpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGsgPSBNYXRoLm1heChrLCAxLjUgLyB0aGlzLmVtKTsgLy8gZm9yY2UgdG8gYmUgYXQgbGVhc3QgMS41cHgKCiAgICAgICAgICAgICAgeCArPSBkZWx0YSAvIDI7CiAgICAgICAgICAgICAgeSA9IGJhc2UuYmJveC5oICsgYm94LmJib3guZCArIGs7CiAgICAgICAgICAgICAgYm94LmJib3guaCArPSB6MzsKICAgICAgICAgICAgfSBlbHNlIGlmIChpID09IHRoaXMudW5kZXIpIHsKICAgICAgICAgICAgICBpZiAoYWNjZW50KSB7CiAgICAgICAgICAgICAgICBrID0gMyAqIHQgKiBzY2FsZSAqIGZhY3RvcjsKICAgICAgICAgICAgICAgIHozID0gMDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgejEgPSBIVE1MQ1NTLlRlWC5iaWdfb3Bfc3BhY2luZzIgKiBzY2FsZSAqIGZhY3RvcjsKICAgICAgICAgICAgICAgIHoyID0gSFRNTENTUy5UZVguYmlnX29wX3NwYWNpbmc0ICogc2NhbGUgKiBmYWN0b3I7CiAgICAgICAgICAgICAgICBrID0gTWF0aC5tYXgoejEsIHoyIC0gYm94LmJib3guaCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBrID0gTWF0aC5tYXgoaywgMS41IC8gdGhpcy5lbSk7IC8vIGZvcmNlIHRvIGJlIGF0IGxlYXN0IDEuNXB4CgogICAgICAgICAgICAgIHggLT0gZGVsdGEgLyAyOwogICAgICAgICAgICAgIHkgPSAtKGJhc2UuYmJveC5kICsgYm94LmJib3guaCArIGspOwogICAgICAgICAgICAgIGJveC5iYm94LmQgKz0gejM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxDU1MucGxhY2VCb3goYm94LCB4LCB5KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGhhbmRsZVNwYWNlKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZUNvbG9yKHNwYW4pOwogICAgICAgIHJldHVybiBzcGFuOwogICAgICB9LAogICAgICBIVE1Mc3RyZXRjaEg6IE1NTC5tYmFzZS5IVE1Mc3RyZXRjaEgsCiAgICAgIEhUTUxzdHJldGNoVjogTU1MLm1iYXNlLkhUTUxzdHJldGNoVgogICAgfSk7CiAgICBNTUwubXN1YnN1cC5BdWdtZW50KHsKICAgICAgdG9IVE1MOiBmdW5jdGlvbiB0b0hUTUwoc3BhbiwgSFcsIEQpIHsKICAgICAgICBzcGFuID0gdGhpcy5IVE1MY3JlYXRlU3BhbihzcGFuKTsKICAgICAgICB2YXIgc2NhbGUgPSB0aGlzLkhUTUxnZXRTY2FsZSgpLAogICAgICAgICAgICBtdSA9IHRoaXMuSFRNTGdldE11KHNwYW4pOwogICAgICAgIHZhciBzdGFjayA9IEhUTUxDU1MuY3JlYXRlU3RhY2soc3BhbiksCiAgICAgICAgICAgIHZhbHVlcywKICAgICAgICAgICAgY2hpbGRyZW4gPSBbXTsKICAgICAgICB2YXIgYmFzZSA9IEhUTUxDU1MuY3JlYXRlQm94KHN0YWNrKTsKCiAgICAgICAgaWYgKHRoaXMuZGF0YVt0aGlzLmJhc2VdKSB7CiAgICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMuZGF0YVt0aGlzLmJhc2VdLnRvSFRNTChiYXNlKSk7CgogICAgICAgICAgaWYgKEQgIT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmRhdGFbdGhpcy5iYXNlXS5IVE1Mc3RyZXRjaFYoYmFzZSwgSFcsIEQpOwogICAgICAgICAgfSBlbHNlIGlmIChIVyAhPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMuZGF0YVt0aGlzLmJhc2VdLkhUTUxzdHJldGNoSChiYXNlLCBIVyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJhc2UuYmJveCA9IHRoaXMuSFRNTHplcm9CQm94KCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgeF9oZWlnaHQgPSBIVE1MQ1NTLlRlWC54X2hlaWdodCAqIHNjYWxlLAogICAgICAgICAgICBzID0gSFRNTENTUy5UZVguc2NyaXB0c3BhY2UgKiBzY2FsZSAqIC43NTsgLy8gRklYTUU6IC43NSBjYW4gYmUgcmVtb3ZlZCB3aGVuIElDIGlzIHJpZ2h0PwoKICAgICAgICB2YXIgc3VwLCBzdWI7CgogICAgICAgIGlmICh0aGlzLkhUTUxub3RFbXB0eSh0aGlzLmRhdGFbdGhpcy5zdXBdKSkgewogICAgICAgICAgc3VwID0gSFRNTENTUy5jcmVhdGVCb3goc3RhY2spOwogICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLmRhdGFbdGhpcy5zdXBdLnRvSFRNTChzdXApKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLkhUTUxub3RFbXB0eSh0aGlzLmRhdGFbdGhpcy5zdWJdKSkgewogICAgICAgICAgc3ViID0gSFRNTENTUy5jcmVhdGVCb3goc3RhY2spOwogICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLmRhdGFbdGhpcy5zdWJdLnRvSFRNTChzdWIpKTsKICAgICAgICB9CgogICAgICAgIEhUTUxDU1MuTWVhc3VyZVNwYW5zKGNoaWxkcmVuKTsKCiAgICAgICAgaWYgKHN1cCkgewogICAgICAgICAgc3VwLmJib3gudyArPSBzOwogICAgICAgICAgc3VwLmJib3gucncgPSBNYXRoLm1heChzdXAuYmJveC53LCBzdXAuYmJveC5ydyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3ViKSB7CiAgICAgICAgICBzdWIuYmJveC53ICs9IHM7CiAgICAgICAgICBzdWIuYmJveC5ydyA9IE1hdGgubWF4KHN1Yi5iYm94LncsIHN1Yi5iYm94LnJ3KTsKICAgICAgICB9CgogICAgICAgIEhUTUxDU1MucGxhY2VCb3goYmFzZSwgMCwgMCk7CiAgICAgICAgdmFyIHNzY2FsZSA9IHNjYWxlOwoKICAgICAgICBpZiAoc3VwKSB7CiAgICAgICAgICBzc2NhbGUgPSB0aGlzLmRhdGFbdGhpcy5zdXBdLkhUTUxnZXRTY2FsZSgpOwogICAgICAgIH0gZWxzZSBpZiAoc3ViKSB7CiAgICAgICAgICBzc2NhbGUgPSB0aGlzLmRhdGFbdGhpcy5zdWJdLkhUTUxnZXRTY2FsZSgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHEgPSBIVE1MQ1NTLlRlWC5zdXBfZHJvcCAqIHNzY2FsZSwKICAgICAgICAgICAgciA9IEhUTUxDU1MuVGVYLnN1Yl9kcm9wICogc3NjYWxlOwogICAgICAgIHZhciB1ID0gYmFzZS5iYm94LmggLSBxLAogICAgICAgICAgICB2ID0gYmFzZS5iYm94LmQgKyByLAogICAgICAgICAgICBkZWx0YSA9IDAsCiAgICAgICAgICAgIHA7CgogICAgICAgIGlmIChiYXNlLmJib3guaWMpIHsKICAgICAgICAgIGJhc2UuYmJveC53IC09IGJhc2UuYmJveC5pYzsgLy8gcmVtb3ZlIElDIChhZGRlZCBieSBtbyBhbmQgbWkpCgogICAgICAgICAgZGVsdGEgPSAxLjMgKiBiYXNlLmJib3guaWMgKyAuMDU7IC8vIGFkanVzdCBmYWtlZCBJQyB0byBiZSBtb3JlIGluIGxpbmUgd2l0aCBleHBlY3RlZCByZXN1bHRzCiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5kYXRhW3RoaXMuYmFzZV0gJiYgSFcgPT0gbnVsbCAmJiBEID09IG51bGwgJiYgKHRoaXMuZGF0YVt0aGlzLmJhc2VdLnR5cGUgPT09ICJtaSIgfHwgdGhpcy5kYXRhW3RoaXMuYmFzZV0udHlwZSA9PT0gIm1vIikpIHsKICAgICAgICAgIGlmICh0aGlzLmRhdGFbdGhpcy5iYXNlXS5kYXRhLmpvaW4oIiIpLmxlbmd0aCA9PT0gMSAmJiBjaGlsZHJlblswXS5zY2FsZSA9PT0gMSAmJiAhdGhpcy5kYXRhW3RoaXMuYmFzZV0uR2V0KCJsYXJnZW9wIikpIHsKICAgICAgICAgICAgdSA9IHYgPSAwOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIG1pbiA9IHRoaXMuZ2V0VmFsdWVzKCJzdWJzY3JpcHRzaGlmdCIsICJzdXBlcnNjcmlwdHNoaWZ0Iik7CiAgICAgICAgbWluLnN1YnNjcmlwdHNoaWZ0ID0gbWluLnN1YnNjcmlwdHNoaWZ0ID09PSAiIiA/IDAgOiBIVE1MQ1NTLmxlbmd0aDJlbShtaW4uc3Vic2NyaXB0c2hpZnQsIG11KTsKICAgICAgICBtaW4uc3VwZXJzY3JpcHRzaGlmdCA9IG1pbi5zdXBlcnNjcmlwdHNoaWZ0ID09PSAiIiA/IDAgOiBIVE1MQ1NTLmxlbmd0aDJlbShtaW4uc3VwZXJzY3JpcHRzaGlmdCwgbXUpOwoKICAgICAgICBpZiAoIXN1cCkgewogICAgICAgICAgaWYgKHN1YikgewogICAgICAgICAgICB2ID0gTWF0aC5tYXgodiwgSFRNTENTUy5UZVguc3ViMSAqIHNjYWxlLCBzdWIuYmJveC5oIC0gNCAvIDUgKiB4X2hlaWdodCwgbWluLnN1YnNjcmlwdHNoaWZ0KTsKICAgICAgICAgICAgSFRNTENTUy5wbGFjZUJveChzdWIsIGJhc2UuYmJveC53LCAtdiwgc3ViLmJib3gpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoIXN1YikgewogICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLmdldFZhbHVlcygiZGlzcGxheXN0eWxlIiwgInRleHByaW1lc3R5bGUiKTsKICAgICAgICAgICAgcCA9IEhUTUxDU1MuVGVYW3ZhbHVlcy5kaXNwbGF5c3R5bGUgPyAic3VwMSIgOiB2YWx1ZXMudGV4cHJpbWVzdHlsZSA/ICJzdXAzIiA6ICJzdXAyIl07CiAgICAgICAgICAgIHUgPSBNYXRoLm1heCh1LCBwICogc2NhbGUsIHN1cC5iYm94LmQgKyAxIC8gNCAqIHhfaGVpZ2h0LCBtaW4uc3VwZXJzY3JpcHRzaGlmdCk7CiAgICAgICAgICAgIEhUTUxDU1MucGxhY2VCb3goc3VwLCBiYXNlLmJib3gudyArIGRlbHRhLCB1LCBzdXAuYmJveCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2ID0gTWF0aC5tYXgodiwgSFRNTENTUy5UZVguc3ViMiAqIHNjYWxlKTsKICAgICAgICAgICAgdmFyIHQgPSBIVE1MQ1NTLlRlWC5ydWxlX3RoaWNrbmVzcyAqIHNjYWxlOwoKICAgICAgICAgICAgaWYgKHUgLSBzdXAuYmJveC5kIC0gKHN1Yi5iYm94LmggLSB2KSA8IDMgKiB0KSB7CiAgICAgICAgICAgICAgdiA9IDMgKiB0IC0gdSArIHN1cC5iYm94LmQgKyBzdWIuYmJveC5oOwogICAgICAgICAgICAgIHEgPSA0IC8gNSAqIHhfaGVpZ2h0IC0gKHUgLSBzdXAuYmJveC5kKTsKCiAgICAgICAgICAgICAgaWYgKHEgPiAwKSB7CiAgICAgICAgICAgICAgICB1ICs9IHE7CiAgICAgICAgICAgICAgICB2IC09IHE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MQ1NTLnBsYWNlQm94KHN1cCwgYmFzZS5iYm94LncgKyBkZWx0YSwgTWF0aC5tYXgodSwgbWluLnN1cGVyc2NyaXB0c2hpZnQpKTsKICAgICAgICAgICAgSFRNTENTUy5wbGFjZUJveChzdWIsIGJhc2UuYmJveC53LCAtTWF0aC5tYXgodiwgbWluLnN1YnNjcmlwdHNoaWZ0KSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLkhUTUxoYW5kbGVTcGFjZShzcGFuKTsKICAgICAgICB0aGlzLkhUTUxoYW5kbGVDb2xvcihzcGFuKTsKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfSwKICAgICAgSFRNTHN0cmV0Y2hIOiBNTUwubWJhc2UuSFRNTHN0cmV0Y2hILAogICAgICBIVE1Mc3RyZXRjaFY6IE1NTC5tYmFzZS5IVE1Mc3RyZXRjaFYKICAgIH0pOwogICAgTU1MLm1tdWx0aXNjcmlwdHMuQXVnbWVudCh7CiAgICAgIHRvSFRNTDogTU1MLm1iYXNlLkhUTUxhdXRvbG9hZAogICAgfSk7CiAgICBNTUwubXRhYmxlLkF1Z21lbnQoewogICAgICB0b0hUTUw6IE1NTC5tYmFzZS5IVE1MYXV0b2xvYWQKICAgIH0pOwogICAgTU1MWyJhbm5vdGF0aW9uLXhtbCJdLkF1Z21lbnQoewogICAgICB0b0hUTUw6IE1NTC5tYmFzZS5IVE1MYXV0b2xvYWQKICAgIH0pOwogICAgTU1MLmFubm90YXRpb24uQXVnbWVudCh7CiAgICAgIHRvSFRNTDogZnVuY3Rpb24gdG9IVE1MKHNwYW4pIHsKICAgICAgICByZXR1cm4gdGhpcy5IVE1MY3JlYXRlU3BhbihzcGFuKTsKICAgICAgfQogICAgfSk7CiAgICBNTUwubWF0aC5BdWdtZW50KHsKICAgICAgdG9IVE1MOiBmdW5jdGlvbiB0b0hUTUwoc3Bhbiwgbm9kZSwgcGhhc2UpIHsKICAgICAgICB2YXIgc3RhY2ssCiAgICAgICAgICAgIGJveCwKICAgICAgICAgICAgaHRtbCwKICAgICAgICAgICAgbWF0aCwKICAgICAgICAgICAgU1BBTiA9IHNwYW47IC8vCiAgICAgICAgLy8gIFBoYXNlIEkgbGF5cyBvdXQgdGhlIG1hdGgsIGJ1dCBkb2Vzbid0IG1lYXN1cmUgdGhlIGZpbmFsIG1hdGggeWV0CiAgICAgICAgLy8gICh0aGF0IGlzIGRvbmUgZm9yIGEgY2h1bmsgYXQgYSB0aW1lLCB0byBhdm9pZCByZWZsb3dzKQogICAgICAgIC8vCgogICAgICAgIGlmICghcGhhc2UgfHwgcGhhc2UgPT09IEhUTUxDU1MuUEhBU0UuSSkgewogICAgICAgICAgdmFyIG5vYnIgPSBIVE1MQ1NTLmFkZEVsZW1lbnQoc3BhbiwgIm5vYnIiLCB7CiAgICAgICAgICAgIGlzTWF0aEpheDogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICBzcGFuID0gdGhpcy5IVE1MY3JlYXRlU3Bhbihub2JyKTsKICAgICAgICAgIHZhciBhbHR0ZXh0ID0gdGhpcy5HZXQoImFsdHRleHQiKTsKICAgICAgICAgIGlmIChhbHR0ZXh0ICYmICFzcGFuLmdldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIpKSBzcGFuLnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsIGFsdHRleHQpOwogICAgICAgICAgaWYgKCFzcGFuLmdldEF0dHJpYnV0ZSgicm9sZSIpKSBzcGFuLnNldEF0dHJpYnV0ZSgicm9sZSIsICJtYXRoIik7CiAgICAgICAgICBzdGFjayA9IEhUTUxDU1MuY3JlYXRlU3RhY2soc3Bhbik7CiAgICAgICAgICBib3ggPSBIVE1MQ1NTLmNyZWF0ZUJveChzdGFjayk7IC8vIE1vdmUgZm9udC1zaXplIGZyb20gb3V0ZXIgc3BhbiB0byBzdGFjayB0byBhdm9pZCBsaW5lIHNlcGFyYXRpb24gCiAgICAgICAgICAvLyBwcm9ibGVtIGluIHN0cmljdCBIVE1MIG1vZGUKCiAgICAgICAgICBzdGFjay5zdHlsZS5mb250U2l6ZSA9IG5vYnIucGFyZW50Tm9kZS5zdHlsZS5mb250U2l6ZTsKICAgICAgICAgIG5vYnIucGFyZW50Tm9kZS5zdHlsZS5mb250U2l6ZSA9ICIiOwoKICAgICAgICAgIGlmICh0aGlzLmRhdGFbMF0gIT0gbnVsbCkgewogICAgICAgICAgICBNTUwubWJhc2UucHJvdG90eXBlLmRpc3BsYXlBbGlnbiA9IEhVQi5jb25maWcuZGlzcGxheUFsaWduOwogICAgICAgICAgICBNTUwubWJhc2UucHJvdG90eXBlLmRpc3BsYXlJbmRlbnQgPSBIVUIuY29uZmlnLmRpc3BsYXlJbmRlbnQ7CiAgICAgICAgICAgIGlmIChTdHJpbmcoSFVCLmNvbmZpZy5kaXNwbGF5SW5kZW50KS5tYXRjaCgvXjAoJHxbYS16JV0pL2kpKSBNTUwubWJhc2UucHJvdG90eXBlLmRpc3BsYXlJbmRlbnQgPSAiMCI7CiAgICAgICAgICAgIGh0bWwgPSB0aGlzLmRhdGFbMF0udG9IVE1MKGJveCk7CiAgICAgICAgICAgIGh0bWwuYmJveC5leGFjdFcgPSBmYWxzZTsgLy8gZm9yY2UgcmVtZWFzdXJlIGp1c3QgdG8gYmUgc3VyZQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzcGFuID0gc3Bhbi5maXJzdENoaWxkLmZpcnN0Q2hpbGQ7CiAgICAgICAgICBpZiAodGhpcy5ocmVmKSBzcGFuID0gc3Bhbi5maXJzdENoaWxkOwogICAgICAgICAgc3RhY2sgPSBzcGFuLmZpcnN0Q2hpbGQ7CiAgICAgICAgICBpZiAoc3RhY2suc3R5bGUucG9zaXRpb24gIT09ICJyZWxhdGl2ZSIpIHN0YWNrID0gc3RhY2submV4dFNpYmxpbmc7CiAgICAgICAgICBib3ggPSBzdGFjay5maXJzdENoaWxkOwogICAgICAgICAgaHRtbCA9IGJveC5maXJzdENoaWxkOwogICAgICAgIH0gLy8KICAgICAgICAvLyAgUGhhc2UgSUkgbWVhc3VyZXMgdGhlIG1hdGggKHRoaXMgaXMgZG9uZSBmb3IgZWFjaCBvbmUgaW4gdGhlIGNodW5rIGF0IG9uY2UpCiAgICAgICAgLy8KCgogICAgICAgIG1hdGggPSAhcGhhc2UgfHwgcGhhc2UgPT09IEhUTUxDU1MuUEhBU0UuSUkgPyBIVE1MQ1NTLk1lYXN1cmVkKGh0bWwsIGJveCkgOiBodG1sOyAvLwogICAgICAgIC8vICBQaGFzZSBJSUkgZmluaXNoZXMgdGhlIGxheW91dCB1c2luZyB0aGUgbWVhc3VyZWQgbWF0aAogICAgICAgIC8vCgogICAgICAgIGlmICghcGhhc2UgfHwgcGhhc2UgPT09IEhUTUxDU1MuUEhBU0UuSUlJKSB7CiAgICAgICAgICBIVE1MQ1NTLnBsYWNlQm94KGJveCwgMCwgMCk7IC8vCiAgICAgICAgICAvLyAgR2V0IHdpZHRoIHJpZ2h0IGlmIG1pbmltdW0gZm9udCBzaXplIGlzIHNldDoKICAgICAgICAgIC8vICAgIFJvdW5kIHRvIG5lYXJlc3QgcGl4ZWwgKHBsdXMgYSBzbWFsbCBhbW91bnQpLCBhbmQgY29udmVydCBiYWNrIHRvIG91dGVyLWVtJ3MuCiAgICAgICAgICAvLyAgICBBZGQgdGhlIHdpZHRoIHRvIHRoZSBzcGFuIChvdXRzaWRlIHRoZSBNYXRoSmF4IGNsYXNzLCBzbyB1c2VzIG91dGVyIGVtIHNpemUsCiAgICAgICAgICAvLyAgICB3aGljaCBtYWtlcyBpdCB3b3JrIGV2ZW4gd2hlbiBtaW5pbXVtIGZvbnQgc2l6ZSBpcyBpbiBlZmZlY3QpLgogICAgICAgICAgLy8KCiAgICAgICAgICBzcGFuLnN0eWxlLndpZHRoID0gSFRNTENTUy5FbShNYXRoLm1heCgwLCBNYXRoLnJvdW5kKG1hdGguYmJveC53ICogdGhpcy5lbSkgKyAuMjUpIC8gSFRNTENTUy5vdXRlckVtKTsKICAgICAgICAgIHNwYW4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOyAvLwogICAgICAgICAgLy8gIEFkanVzdCBiYm94IHRvIG1hdGNoIG91dGVyIGVtLXNpemUKICAgICAgICAgIC8vIAoKICAgICAgICAgIHZhciBwID0gMSAvIEhUTUxDU1MuZW0sCiAgICAgICAgICAgICAgZiA9IEhUTUxDU1MuZW0gLyBIVE1MQ1NTLm91dGVyRW07CiAgICAgICAgICBIVE1MQ1NTLmVtIC89IGY7CiAgICAgICAgICBzcGFuLmJib3guaCAqPSBmOwogICAgICAgICAgc3Bhbi5iYm94LmQgKj0gZjsKICAgICAgICAgIHNwYW4uYmJveC53ICo9IGY7CiAgICAgICAgICBzcGFuLmJib3gubHcgKj0gZjsKICAgICAgICAgIHNwYW4uYmJveC5ydyAqPSBmOwoKICAgICAgICAgIGlmIChzcGFuLmJib3guSCkgewogICAgICAgICAgICBzcGFuLmJib3guSCAqPSBmOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChzcGFuLmJib3guRCkgewogICAgICAgICAgICBzcGFuLmJib3guRCAqPSBmOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChtYXRoICYmIG1hdGguYmJveC53aWR0aCAhPSBudWxsKSB7CiAgICAgICAgICAgIHNwYW4uc3R5bGUubWluV2lkdGggPSBtYXRoLmJib3gubWluV2lkdGggfHwgc3Bhbi5zdHlsZS53aWR0aDsKICAgICAgICAgICAgc3Bhbi5zdHlsZS53aWR0aCA9IG1hdGguYmJveC53aWR0aDsKICAgICAgICAgICAgYm94LnN0eWxlLndpZHRoID0gc3RhY2suc3R5bGUud2lkdGggPSBTUEFOLnN0eWxlLndpZHRoID0gIjEwMCUiOwogICAgICAgICAgfSAvLwogICAgICAgICAgLy8gIEFkZCBjb2xvciAoaWYgYW55KQogICAgICAgICAgLy8KCgogICAgICAgICAgdmFyIGNvbG9yID0gdGhpcy5IVE1MaGFuZGxlQ29sb3Ioc3Bhbik7IC8vCiAgICAgICAgICAvLyAgTWFrZSBtYXRoIHNwYW4gYmUgdGhlIGNvcnJlY3QgaGVpZ2h0IGFuZCBkZXB0aAogICAgICAgICAgLy8KCiAgICAgICAgICBpZiAobWF0aCkgewogICAgICAgICAgICBIVE1MQ1NTLmNyZWF0ZVJ1bGUoc3BhbiwgKG1hdGguYmJveC5oICsgcCkgKiBmLCAobWF0aC5iYm94LmQgKyBwKSAqIGYsIDApOwogICAgICAgICAgfSAvLwogICAgICAgICAgLy8gIEhhbmRsZSBpbmRlbnRhbGlnbiBhbmQgaW5kZW50c2hpZnQgZm9yIHNpbmdsZS1saW5lIGRpc3BsYXkgZXF1YXRpb25zCiAgICAgICAgICAvLwoKCiAgICAgICAgICBpZiAoIXRoaXMuaXNNdWx0aWxpbmUgJiYgdGhpcy5HZXQoImRpc3BsYXkiKSA9PT0gImJsb2NrIiAmJiBzcGFuLmJib3gud2lkdGggPT0gbnVsbCkgewogICAgICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoImluZGVudGFsaWduZmlyc3QiLCAiaW5kZW50c2hpZnRmaXJzdCIsICJpbmRlbnRhbGlnbiIsICJpbmRlbnRzaGlmdCIpOwoKICAgICAgICAgICAgaWYgKHZhbHVlcy5pbmRlbnRhbGlnbmZpcnN0ICE9PSBNTUwuSU5ERU5UQUxJR04uSU5ERU5UQUxJR04pIHsKICAgICAgICAgICAgICB2YWx1ZXMuaW5kZW50YWxpZ24gPSB2YWx1ZXMuaW5kZW50YWxpZ25maXJzdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHZhbHVlcy5pbmRlbnRhbGlnbiA9PT0gTU1MLklOREVOVEFMSUdOLkFVVE8pIHsKICAgICAgICAgICAgICB2YWx1ZXMuaW5kZW50YWxpZ24gPSB0aGlzLmRpc3BsYXlBbGlnbjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHZhbHVlcy5pbmRlbnRzaGlmdGZpcnN0ICE9PSBNTUwuSU5ERU5UU0hJRlQuSU5ERU5UU0hJRlQpIHsKICAgICAgICAgICAgICB2YWx1ZXMuaW5kZW50c2hpZnQgPSB2YWx1ZXMuaW5kZW50c2hpZnRmaXJzdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHZhbHVlcy5pbmRlbnRzaGlmdCA9PT0gImF1dG8iKSB7CiAgICAgICAgICAgICAgdmFsdWVzLmluZGVudHNoaWZ0ID0gIjAiOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc2hpZnQgPSBIVE1MQ1NTLmxlbmd0aDJlbSh2YWx1ZXMuaW5kZW50c2hpZnQsIDEsIEhUTUxDU1Muc2NhbGUgKiBIVE1MQ1NTLmN3aWR0aCk7CgogICAgICAgICAgICBpZiAodGhpcy5kaXNwbGF5SW5kZW50ICE9PSAiMCIpIHsKICAgICAgICAgICAgICB2YXIgaW5kZW50ID0gSFRNTENTUy5sZW5ndGgyZW0odGhpcy5kaXNwbGF5SW5kZW50LCAxLCBIVE1MQ1NTLnNjYWxlICogSFRNTENTUy5jd2lkdGgpOwogICAgICAgICAgICAgIHNoaWZ0ICs9IHZhbHVlcy5pbmRlbnRhbGlnbiA9PT0gTU1MLklOREVOVEFMSUdOLlJJR0hUID8gLWluZGVudCA6IGluZGVudDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbm9kZS5zdHlsZS50ZXh0QWxpZ24gPSB2YWx1ZXMuaW5kZW50YWxpZ247IC8vICMjIyBGSVhNRTogbWFrZSBwZXJjZW50YWdlIHdpZHRocyByZXNwb25kIHRvIGNoYW5nZXMgaW4gY29udGFpbmVyCgogICAgICAgICAgICBpZiAoc2hpZnQpIHsKICAgICAgICAgICAgICBIVUIuSW5zZXJ0KHNwYW4uc3R5bGUsIHsKICAgICAgICAgICAgICAgIGxlZnQ6IHsKICAgICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogSFRNTENTUy5FbShzaGlmdCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByaWdodDogewogICAgICAgICAgICAgICAgICBtYXJnaW5SaWdodDogSFRNTENTUy5FbSgtc2hpZnQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2VudGVyOiB7CiAgICAgICAgICAgICAgICAgIG1hcmdpbkxlZnQ6IEhUTUxDU1MuRW0oc2hpZnQpLAogICAgICAgICAgICAgICAgICBtYXJnaW5SaWdodDogSFRNTENTUy5FbSgtc2hpZnQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfVt2YWx1ZXMuaW5kZW50YWxpZ25dKTsgLy8KICAgICAgICAgICAgICAvLyAgTW92ZSB0aGUgYmFja2dyb3VuZCBjb2xvciwgb2YgYW55CiAgICAgICAgICAgICAgLy8KCiAgICAgICAgICAgICAgaWYgKGNvbG9yKSB7CiAgICAgICAgICAgICAgICB2YXIgTCA9IHBhcnNlRmxvYXQoY29sb3Iuc3R5bGUubWFyZ2luTGVmdCB8fCAiMCIpICsgc2hpZnQsCiAgICAgICAgICAgICAgICAgICAgUiA9IHBhcnNlRmxvYXQoY29sb3Iuc3R5bGUubWFyZ2luUmlnaHQgfHwgIjAiKSAtIHNoaWZ0OwogICAgICAgICAgICAgICAgY29sb3Iuc3R5bGUubWFyZ2luTGVmdCA9IEhUTUxDU1MuRW0oTCk7CiAgICAgICAgICAgICAgICBjb2xvci5zdHlsZS5tYXJnaW5SaWdodCA9IEhUTUxDU1MuRW0oUiArICh2YWx1ZXMuaW5kZW50YWxpZ24gPT09ICJyaWdodCIgPyBzcGFuLmJib3gudyArIHNoaWZ0IC0gc3Bhbi5iYm94LncgOiAwKSk7CgogICAgICAgICAgICAgICAgaWYgKEhUTUxDU1MubXNpZUNvbG9yQnVnICYmIHZhbHVlcy5pbmRlbnRhbGlnbiA9PT0gInJpZ2h0IikgewogICAgICAgICAgICAgICAgICBpZiAocGFyc2VGbG9hdChjb2xvci5zdHlsZS5tYXJnaW5MZWZ0KSA+IDApIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGFkZGluZyA9IE1hdGhKYXguSFRNTC5hZGRFbGVtZW50KGNvbG9yLnBhcmVudE5vZGUsICJzcGFuIik7CiAgICAgICAgICAgICAgICAgICAgcGFkZGluZy5zdHlsZS5tYXJnaW5MZWZ0ID0gSFRNTENTUy5FbShSICsgTWF0aC5taW4oMCwgc3Bhbi5iYm94LncgKyBzaGlmdCkpOwogICAgICAgICAgICAgICAgICAgIGNvbG9yLm5leHRTaWJsaW5nLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjBlbSI7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGNvbG9yLm5leHRTaWJsaW5nLnN0eWxlLm1hcmdpbkxlZnQgPSAiMGVtIjsKICAgICAgICAgICAgICAgICAgY29sb3Iuc3R5bGUubWFyZ2luUmlnaHQgPSBjb2xvci5zdHlsZS5tYXJnaW5MZWZ0ID0gIjBlbSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3BhbjsKICAgICAgfSwKICAgICAgSFRNTHNwYW5FbGVtZW50OiBNTUwubWJhc2UucHJvdG90eXBlLkhUTUxzcGFuRWxlbWVudAogICAgfSk7CiAgICBNTUwuVGVYQXRvbS5BdWdtZW50KHsKICAgICAgdG9IVE1MOiBmdW5jdGlvbiB0b0hUTUwoc3BhbiwgSFcsIEQpIHsKICAgICAgICBzcGFuID0gdGhpcy5IVE1MY3JlYXRlU3BhbihzcGFuKTsKCiAgICAgICAgaWYgKHRoaXMuZGF0YVswXSAhPSBudWxsKSB7CiAgICAgICAgICBpZiAodGhpcy50ZXhDbGFzcyA9PT0gTU1MLlRFWENMQVNTLlZDRU5URVIpIHsKICAgICAgICAgICAgdmFyIHN0YWNrID0gSFRNTENTUy5jcmVhdGVTdGFjayhzcGFuKTsKICAgICAgICAgICAgdmFyIGJveCA9IEhUTUxDU1MuY3JlYXRlQm94KHN0YWNrKTsKICAgICAgICAgICAgdmFyIGNoaWxkID0gdGhpcy5kYXRhWzBdLnRvSFRNTChib3gpOwoKICAgICAgICAgICAgaWYgKEQgIT0gbnVsbCkgewogICAgICAgICAgICAgIEhUTUxDU1MuUmVtZWFzdXJlZCh0aGlzLmRhdGFbMF0uSFRNTHN0cmV0Y2hWKGJveCwgSFcsIEQpLCBib3gpOwogICAgICAgICAgICB9IGVsc2UgaWYgKEhXICE9IG51bGwpIHsKICAgICAgICAgICAgICBIVE1MQ1NTLlJlbWVhc3VyZWQodGhpcy5kYXRhWzBdLkhUTUxzdHJldGNoSChib3gsIEhXKSwgYm94KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBIVE1MQ1NTLk1lYXN1cmVkKGNoaWxkLCBib3gpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYSA9IEhUTUxDU1MuVGVYLmF4aXNfaGVpZ2h0ICogdGhpcy5IVE1MZ2V0U2NhbGUoKTsKICAgICAgICAgICAgSFRNTENTUy5wbGFjZUJveChib3gsIDAsIGEgLSAoYm94LmJib3guaCArIGJveC5iYm94LmQpIC8gMiArIGJveC5iYm94LmQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGh0bWwgPSB0aGlzLmRhdGFbMF0udG9IVE1MKHNwYW4sIEhXLCBEKTsKCiAgICAgICAgICAgIGlmIChEICE9IG51bGwpIHsKICAgICAgICAgICAgICBodG1sID0gdGhpcy5kYXRhWzBdLkhUTUxzdHJldGNoVihib3gsIEhXLCBEKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChIVyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgaHRtbCA9IHRoaXMuZGF0YVswXS5IVE1Mc3RyZXRjaEgoYm94LCBIVyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNwYW4uYmJveCA9IGh0bWwuYmJveDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuSFRNTGhhbmRsZVNwYWNlKHNwYW4pOwogICAgICAgIHRoaXMuSFRNTGhhbmRsZUNvbG9yKHNwYW4pOwogICAgICAgIHJldHVybiBzcGFuOwogICAgICB9LAogICAgICBIVE1Mc3RyZXRjaEg6IE1NTC5tYmFzZS5IVE1Mc3RyZXRjaEgsCiAgICAgIEhUTUxzdHJldGNoVjogTU1MLm1iYXNlLkhUTUxzdHJldGNoVgogICAgfSk7IC8vCiAgICAvLyAgTG9hZGluZyBpc24ndCBjb21wbGV0ZSB1bnRpbCB0aGUgZWxlbWVudCBqYXggaXMgbW9kaWZpZWQsCiAgICAvLyAgYnV0IGNhbid0IGNhbGwgbG9hZENvbXBsZXRlIHdpdGhpbiB0aGUgY2FsbGJhY2sgZm9yICJtbWwgSmF4IFJlYWR5IgogICAgLy8gIChpdCB3b3VsZCBjYWxsIEhUTUxDU1MncyBSZXF1aXJlIHJvdXRpbmUsIGFza2luZyBmb3IgdGhlIG1tbCBqYXggYWdhaW4pCiAgICAvLyAgc28gd2FpdCB1bnRpbCBhZnRlciB0aGUgbW1sIGpheCBoYXMgZmluaXNoZWQgcHJvY2Vzc2luZy4KICAgIC8vICAKICAgIC8vICBXZSBhbHNvIG5lZWQgdG8gd2FpdCBmb3IgdGhlIG9ubG9hZCBoYW5kbGVyIHRvIHJ1biwgc2luY2UgdGhlIGxvYWRDb21wbGV0ZQogICAgLy8gIHdpbGwgY2FsbCBDb25maWcgYW5kIFN0YXJ0dXAsIHdoaWNoIG5lZWQgdG8gbW9kaWZ5IHRoZSBib2R5LgogICAgLy8KCiAgICBIVUIuUmVnaXN0ZXIuU3RhcnR1cEhvb2soIm9uTG9hZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgc2V0VGltZW91dChNYXRoSmF4LkNhbGxiYWNrKFsibG9hZENvbXBsZXRlIiwgSFRNTENTUywgImpheC5qcyJdKSwgMCk7CiAgICB9KTsKICB9KTsKICBIVUIuUmVnaXN0ZXIuU3RhcnR1cEhvb2soIkVuZCBDb25maWciLCBmdW5jdGlvbiAoKSB7CiAgICAvLwogICAgLy8gIEhhbmRsZSBicm93c2VyLXNwZWNpZmljIHNldHVwCiAgICAvLwogICAgSFVCLkJyb3dzZXIuU2VsZWN0KHsKICAgICAgTVNJRTogZnVuY3Rpb24gTVNJRShicm93c2VyKSB7CiAgICAgICAgdmFyIF9IVE1MQ1NTJEF1Z21lbnQ7CgogICAgICAgIHZhciBtb2RlID0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlIHx8IDA7CiAgICAgICAgdmFyIGlzSUU3ID0gYnJvd3Nlci52ZXJzaW9uQXRMZWFzdCgiNy4wIik7CiAgICAgICAgdmFyIGlzSUU4ID0gYnJvd3Nlci52ZXJzaW9uQXRMZWFzdCgiOC4wIikgJiYgbW9kZSA+IDc7CiAgICAgICAgdmFyIHF1aXJrcyA9IGRvY3VtZW50LmNvbXBhdE1vZGUgPT09ICJCYWNrQ29tcGF0IjsKCiAgICAgICAgaWYgKG1vZGUgPCA5KSB7CiAgICAgICAgICAvLyBJRSBkb2Vzbid0IGRvIG1vdXNlIGV2ZW50cyBvbiB0cmFzcGFyZW50IG9iamVjdHMsCiAgICAgICAgICAvLyAgIHNvIGdpdmUgYSBiYWNrZ3JvdW5kIGNvbG9yLCBidXQgb3BhY2l0eSBtYWtlcyBpdCB0cmFuc3BhcmVudAogICAgICAgICAgSFRNTENTUy5jb25maWcuc3R5bGVzWyIuTWF0aEpheCAuTWF0aEpheF9IaXRCb3giXVsiYmFja2dyb3VuZC1jb2xvciJdID0gIndoaXRlIjsKICAgICAgICAgIEhUTUxDU1MuY29uZmlnLnN0eWxlc1siLk1hdGhKYXggLk1hdGhKYXhfSGl0Qm94Il0ub3BhY2l0eSA9IDA7CiAgICAgICAgICBIVE1MQ1NTLmNvbmZpZy5zdHlsZXNbIi5NYXRoSmF4IC5NYXRoSmF4X0hpdEJveCJdLmZpbHRlciA9ICJhbHBoYShvcGFjaXR5PTApIjsKICAgICAgICB9IC8vIEZJWE1FOiAgd29yayBvdXQgdGVzdHMgZm9yIHRoZXNlPwoKCiAgICAgICAgSFRNTENTUy5BdWdtZW50KChfSFRNTENTUyRBdWdtZW50ID0gewogICAgICAgICAgUGFkZGluZ1dpZHRoQnVnOiB0cnVlLAogICAgICAgICAgbXNpZUFjY2VudEJ1ZzogdHJ1ZSwKICAgICAgICAgIG1zaWVDb2xvckJ1ZzogbW9kZSA8IDgsCiAgICAgICAgICAvLyBuZWdhdGl2ZSBtYXJnaW4tcmlnaHQgZG9lc24ndCB3b3JrIHRvIHBvc2l0aW9uIGNvbG9yCiAgICAgICAgICBtc2llQ29sb3JQb3NpdGlvbkJ1ZzogdHJ1ZSwKICAgICAgICAgIC8vIG5lZWRzIHBvc2l0aW9uOnJlbGF0aXZlIHRvIHB1dCBjb2xvciBiZWhpbmQgdGV4dAogICAgICAgICAgbXNpZVJlbGF0aXZlV2lkdGhCdWc6IHF1aXJrcywKICAgICAgICAgIG1zaWVEaXNhcHBlYXJpbmdCdWc6IG1vZGUgPj0gOCwKICAgICAgICAgIC8vIGlubGluZSBtYXRoIGRpc2FwcGVhcnMKICAgICAgICAgIG1zaWVNYXJnaW5TY2FsZUJ1ZzogbW9kZSA8IDgsCiAgICAgICAgICAvLyByZWxhdGl2ZSBtYXJnaW5zIGFyZSBub3Qgc2NhbGVkIHByb3Blcmx5IGJ5IGZvbnQtc2l6ZQogICAgICAgICAgbXNpZVBhZGRpbmdXaWR0aEJ1ZzogdHJ1ZSwKICAgICAgICAgIG1zaWVCb3JkZXJXaWR0aEJ1ZzogcXVpcmtzLAogICAgICAgICAgbXNpZUZyYW1lU2l6ZUJ1ZzogbW9kZSA8PSA4LAogICAgICAgICAgLy8gY3Jhc2hlcyBpZiBzaXplIG9mIGJveCBpc24ndCBiaWcgZW5vdWdoIGZvciBib3JkZXIKICAgICAgICAgIG1zaWVJbmxpbmVCbG9ja0FsaWduQnVnOiAhaXNJRTggfHwgcXVpcmtzLAogICAgICAgICAgbXNpZVBsYWNlQm94QnVnOiBpc0lFOCAmJiAhcXVpcmtzLAogICAgICAgICAgbXNpZUNsaXBSZWN0QnVnOiAhaXNJRTgsCiAgICAgICAgICBtc2llTmVnYXRpdmVTcGFjZUJ1ZzogcXVpcmtzLAogICAgICAgICAgbXNpZVJ1bGVCdWc6IG1vZGUgPCA3LAogICAgICAgICAgLy8gcnVsZXMgbmVlZCB0byBiZSBtZWFzdXJlZAogICAgICAgICAgY2xvbmVOb2RlQnVnOiBpc0lFOCAmJiBicm93c2VyLnZlcnNpb24gPT09ICI4LjAiLAogICAgICAgICAgbXNpZUl0YWxpY1dpZHRoQnVnOiB0cnVlLAogICAgICAgICAgLy8gY2FuJ3QgbWVhc3VyZSBib3hlcyBlbmRpbmcgaW4gaXRhbGljcyBjb3JyZWN0bHkKICAgICAgICAgIGluaXRpYWxTa2lwQnVnOiBtb2RlIDwgOCwKICAgICAgICAgIC8vIGNvbmZ1c2VkIGJ5IGluaXRpYWwgbGVmdC1tYXJnaW4gdmFsdWVzCiAgICAgICAgICBtc2llTmVnYXRpdmVCQm94QnVnOiBtb2RlID49IDgsCiAgICAgICAgICAvLyBuZWdhdGl2ZSBiYm94ZXMgaGF2ZSBwb3NpdGl2ZSB3aWR0aHMKICAgICAgICAgIG1zaWVJRTY6ICFpc0lFNwogICAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfSFRNTENTUyRBdWdtZW50LCAibXNpZUl0YWxpY1dpZHRoQnVnIiwgdHJ1ZSksIF9kZWZpbmVQcm9wZXJ0eShfSFRNTENTUyRBdWdtZW50LCAiRm9udEZhY2VCdWciLCBtb2RlIDwgOSksIF9kZWZpbmVQcm9wZXJ0eShfSFRNTENTUyRBdWdtZW50LCAibXNpZUZvbnRDU1NCdWciLCBicm93c2VyLmlzSUU5KSwgX2RlZmluZVByb3BlcnR5KF9IVE1MQ1NTJEF1Z21lbnQsICJhbGxvd1dlYkZvbnRzIiwgbW9kZSA+PSA5ID8gIndvZmYiIDogImVvdCIpLCBfSFRNTENTUyRBdWdtZW50KSk7CiAgICAgIH0sCiAgICAgIEZpcmVmb3g6IGZ1bmN0aW9uIEZpcmVmb3goYnJvd3NlcikgewogICAgICAgIHZhciB3ZWJGb250cyA9IGZhbHNlOwoKICAgICAgICBpZiAoYnJvd3Nlci52ZXJzaW9uQXRMZWFzdCgiMy41IikpIHsKICAgICAgICAgIHZhciByb290ID0gU3RyaW5nKGRvY3VtZW50LmxvY2F0aW9uKS5yZXBsYWNlKC9bXlwvXSokLywgIiIpOwoKICAgICAgICAgIGlmIChkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCAhPT0gImZpbGU6IiB8fCBIVUIuY29uZmlnLnJvb3QubWF0Y2goL15odHRwcz86XC9cLy8pIHx8IChIVUIuY29uZmlnLnJvb3QgKyAiLyIpLnN1YnN0cigwLCByb290Lmxlbmd0aCkgPT09IHJvb3QpIHsKICAgICAgICAgICAgd2ViRm9udHMgPSAib3RmIjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEhUTUxDU1MuQXVnbWVudCh7CiAgICAgICAgICBmZlZlcnRpY2FsQWxpZ25CdWc6ICFicm93c2VyLnZlcnNpb25BdExlYXN0KCIyMC4wIiksCiAgICAgICAgICAvLyBub3Qgc3VyZSB3aGVuIHRoaXMgYnVnIHdhcyBmaXhlZAogICAgICAgICAgQWNjZW50QnVnOiB0cnVlLAogICAgICAgICAgYWxsb3dXZWJGb250czogd2ViRm9udHMsCiAgICAgICAgICBmZkZvbnRPcHRpbWl6YXRpb25CdWc6IHRydWUKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgU2FmYXJpOiBmdW5jdGlvbiBTYWZhcmkoYnJvd3NlcikgewogICAgICAgIHZhciB2M3AwID0gYnJvd3Nlci52ZXJzaW9uQXRMZWFzdCgiMy4wIik7CiAgICAgICAgdmFyIHYzcDEgPSBicm93c2VyLnZlcnNpb25BdExlYXN0KCIzLjEiKTsKICAgICAgICB2YXIgdHJ1ZVNhZmFyaSA9IG5hdmlnYXRvci5hcHBWZXJzaW9uLm1hdGNoKC8gU2FmYXJpXC9cZC8pICYmIG5hdmlnYXRvci5hcHBWZXJzaW9uLm1hdGNoKC8gVmVyc2lvblwvXGQvKSAmJiBuYXZpZ2F0b3IudmVuZG9yLm1hdGNoKC9BcHBsZS8pOwogICAgICAgIHZhciBhbmRyb2lkID0gbmF2aWdhdG9yLmFwcFZlcnNpb24ubWF0Y2goLyBBbmRyb2lkIChcZCspXC4oXGQrKS8pOwogICAgICAgIHZhciBmb3JjZUltYWdlcyA9IHYzcDEgJiYgYnJvd3Nlci5pc01vYmlsZSAmJiAobmF2aWdhdG9yLnBsYXRmb3JtLm1hdGNoKC9pUGFkfGlQb2R8aVBob25lLykgJiYgIWJyb3dzZXIudmVyc2lvbkF0TGVhc3QoIjUuMCIpIHx8IGFuZHJvaWQgIT0gbnVsbCAmJiAoYW5kcm9pZFsxXSA8IDIgfHwgYW5kcm9pZFsxXSA9PSAyICYmIGFuZHJvaWRbMl0gPCAyKSk7CiAgICAgICAgSFRNTENTUy5BdWdtZW50KHsKICAgICAgICAgIGNvbmZpZzogewogICAgICAgICAgICBzdHlsZXM6IHsKICAgICAgICAgICAgICAiLk1hdGhKYXggaW1nLCAuTWF0aEpheCBub2JyLCAuTWF0aEpheCBhIjogewogICAgICAgICAgICAgICAgLy8gIm5vbmUiIHNlZW1zIHRvIHdvcmsgbGlrZSAiMHB4IiB3aGVuIHdpZHRoIGlzIGluaXRpYWxseSAwCiAgICAgICAgICAgICAgICAibWF4LXdpZHRoIjogIjUwMDBlbSIsCiAgICAgICAgICAgICAgICAibWF4LWhlaWdodCI6ICI1MDAwZW0iCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgRW06IChicm93c2VyLndlYmtpdCB8fCAwKSA+PSA1MzggPyBIVE1MQ1NTLkVtUm91bmRlZCA6IEhUTUxDU1MuRW0sCiAgICAgICAgICAvLyBpc3N1ZSAjOTMxCiAgICAgICAgICByZnV6ejogLjAxMSwKICAgICAgICAgIEFjY2VudEJ1ZzogdHJ1ZSwKICAgICAgICAgIEFkanVzdFN1cmQ6IHRydWUsCiAgICAgICAgICBuZWdhdGl2ZUJCb3hlczogdHJ1ZSwKICAgICAgICAgIHNhZmFyaU5lZ2F0aXZlU3BhY2VCdWc6IHRydWUsCiAgICAgICAgICBzYWZhcmlWZXJ0aWNhbEFsaWduQnVnOiAhdjNwMSwKICAgICAgICAgIHNhZmFyaVRleHROb2RlQnVnOiAhdjNwMCwKICAgICAgICAgIGZvcmNlUmVmbG93OiB0cnVlLAogICAgICAgICAgRm9udEZhY2VCdWc6IHRydWUsCiAgICAgICAgICBhbGxvd1dlYkZvbnRzOiB2M3AxICYmICFmb3JjZUltYWdlcyA/ICJvdGYiIDogZmFsc2UKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHRydWVTYWZhcmkpIHsKICAgICAgICAgIEhUTUxDU1MuQXVnbWVudCh7CiAgICAgICAgICAgIHdlYkZvbnREZWZhdWx0OiBicm93c2VyLmlzTW9iaWxlID8gInNhbnMtc2VyaWYiIDogInNlcmlmIgogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYnJvd3Nlci5pc1BDKSB7CiAgICAgICAgICBIVE1MQ1NTLkF1Z21lbnQoewogICAgICAgICAgICBhZGp1c3RBdmFpbGFibGVGb250czogSFRNTENTUy5yZW1vdmVTVElYZm9udHMsCiAgICAgICAgICAgIC8vIGNhbid0IGFjY2VzcyBwbGFuZTEKICAgICAgICAgICAgY2hlY2tXZWJGb250c1R3aWNlOiB0cnVlIC8vIGJ1ZyBpbiBTYWZhcmkvV2luIHRoYXQgZG9lc24ndCB1cGRhdGUgZm9udCB0ZXN0IGRpdiBwcm9wZXJseQoKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZvcmNlSW1hZ2VzKSB7CiAgICAgICAgICAvLyAgRm9yY2UgaW1hZ2UgbW9kZSBmb3IgaU9TIHByaW9yIHRvIDQuMiBhbmQgRHJvaWQgcHJpb3IgdG8gMi4yCiAgICAgICAgICB2YXIgY29uZmlnID0gSFVCLmNvbmZpZ1siSFRNTC1DU1MiXTsKCiAgICAgICAgICBpZiAoY29uZmlnKSB7CiAgICAgICAgICAgIGNvbmZpZy5hdmFpbGFibGVGb250cyA9IFtdOwogICAgICAgICAgICBjb25maWcucHJlZmVycmVkRm9udCA9IG51bGw7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBIVUIuY29uZmlnWyJIVE1MLUNTUyJdID0gewogICAgICAgICAgICAgIGF2YWlsYWJsZUZvbnRzOiBbXSwKICAgICAgICAgICAgICBwcmVmZXJyZWRGb250OiBudWxsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBDaHJvbWU6IGZ1bmN0aW9uIENocm9tZShicm93c2VyKSB7CiAgICAgICAgSFRNTENTUy5BdWdtZW50KHsKICAgICAgICAgIEVtOiBIVE1MQ1NTLkVtUm91bmRlZCwKICAgICAgICAgIC8vIHZlcnRpY2FsIGFsaWdubWVudCBuZWVkcyBoZWxwIChzaW5jZSBhcm91bmQgdjIwKQogICAgICAgICAgY2xvbmVOb2RlQnVnOiB0cnVlLAogICAgICAgICAgLy8gQ2hyb21lIGdldHMgaGVpZ2h0cyB3cm9uZyB3aXRoIHRoZSBjbG9uZWQgb25lcwogICAgICAgICAgcmZ1eno6IC0uMDIsCiAgICAgICAgICBBY2NlbnRCdWc6IHRydWUsCiAgICAgICAgICBBZGp1c3RTdXJkOiB0cnVlLAogICAgICAgICAgRm9udEZhY2VCdWc6IGJyb3dzZXIudmVyc2lvbkF0TGVhc3QoIjMyLjAiKSwKICAgICAgICAgIC8vIENocm9tZSAzMiBmYWlscyBvbiBib2xkLWl0YWxpYyAoIzczNSkKICAgICAgICAgIG5lZ2F0aXZlQkJveGVzOiB0cnVlLAogICAgICAgICAgc2FmYXJpTmVnYXRpdmVTcGFjZUJ1ZzogdHJ1ZSwKICAgICAgICAgIHNhZmFyaVdlYkZvbnRTZXJpZjogWyIiXSwKICAgICAgICAgIGZvcmNlUmVmbG93OiB0cnVlLAogICAgICAgICAgYWxsb3dXZWJGb250czogYnJvd3Nlci52ZXJzaW9uQXRMZWFzdCgiNC4wIikgPyAib3RmIiA6ICJzdmciCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIE9wZXJhOiBmdW5jdGlvbiBPcGVyYShicm93c2VyKSB7CiAgICAgICAgYnJvd3Nlci5pc01pbmkgPSBuYXZpZ2F0b3IuYXBwVmVyc2lvbi5tYXRjaCgiT3BlcmEgTWluaSIpICE9IG51bGw7CiAgICAgICAgSFRNTENTUy5jb25maWcuc3R5bGVzWyIuTWF0aEpheCAubWVycm9yIl1bInZlcnRpY2FsLWFsaWduIl0gPSBudWxsOwogICAgICAgIEhUTUxDU1MuY29uZmlnLnN0eWxlc1siLk1hdGhKYXggc3BhbiJdWyJ6LWluZGV4Il0gPSAwOwogICAgICAgIEhUTUxDU1MuQXVnbWVudCh7CiAgICAgICAgICBvcGVyYUhlaWdodEJ1ZzogdHJ1ZSwKICAgICAgICAgIG9wZXJhVmVydGljYWxBbGlnbkJ1ZzogdHJ1ZSwKICAgICAgICAgIG9wZXJhRm9udFNpemVCdWc6IGJyb3dzZXIudmVyc2lvbkF0TGVhc3QoIjEwLjYxIiksCiAgICAgICAgICBpbml0aWFsU2tpcEJ1ZzogdHJ1ZSwKICAgICAgICAgIEZvbnRGYWNlQnVnOiB0cnVlLAogICAgICAgICAgUGFkZGluZ1dpZHRoQnVnOiB0cnVlLAogICAgICAgICAgYWxsb3dXZWJGb250czogYnJvd3Nlci52ZXJzaW9uQXRMZWFzdCgiMTAuMCIpICYmICFicm93c2VyLmlzTWluaSA/ICJvdGYiIDogZmFsc2UsCiAgICAgICAgICBhZGp1c3RBdmFpbGFibGVGb250czogSFRNTENTUy5yZW1vdmVTVElYZm9udHMKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgS29ucXVlcm9yOiBmdW5jdGlvbiBLb25xdWVyb3IoYnJvd3NlcikgewogICAgICAgIEhUTUxDU1MuQXVnbWVudCh7CiAgICAgICAgICBrb25xdWVyb3JWZXJ0aWNhbEFsaWduQnVnOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogIH0pOwogIE1hdGhKYXguSHViLlJlZ2lzdGVyLlN0YXJ0dXBIb29rKCJFbmQgQ29va2llIiwgZnVuY3Rpb24gKCkgewogICAgaWYgKEhVQi5jb25maWcubWVudVNldHRpbmdzLnpvb20gIT09ICJOb25lIikgewogICAgICBBSkFYLlJlcXVpcmUoIltNYXRoSmF4XS9leHRlbnNpb25zL01hdGhab29tLmpzIik7CiAgICB9CiAgfSk7Cn0pKE1hdGhKYXguQWpheCwgTWF0aEpheC5IdWIsIE1hdGhKYXguT3V0cHV0SmF4WyJIVE1MLUNTUyJdKTs="},{"version":3,"sources":["/home/hads/Downloads/pycharm-community-2020.1/plugins/python-ce/helpers/MathJax/jax/output/HTML-CSS/jax.js"],"names":["AJAX","HUB","HTMLCSS","MML","isMobile","Browser","MESSAGE","data","slice","call","arguments","MathJax","Message","Set","apply","FONTTEST","Object","Subclass","timeout","comparisonFont","testSize","FedoraSTIXcheck","family","testString","noStyleChar","Init","div","HTML","addElement","document","body","style","position","width","height","overflow","padding","border","margin","id","visibility","top","left","whiteSpace","textAlign","textIndent","textTransform","lineHeight","letterSpacing","wordSpacing","fontSize","fontWeight","fontStyle","fontSizeAdjust","firstChild","text","findFont","fonts","pref","found","testCollection","i","m","length","testFont","name","font","TeX","STIX","replace","isWebFont","FontFaceBug","weight","familyFixed","match","W","getComparisonWidths","fontFamily","offsetWidth","offsetHeight","FONTDATA","hasStyleChar","testStyleChar","safariTextNodeBug","innerHTML","nodeValue","styleChar","versionChar","compChar","size","n","extra","dw","SIZE","msieItalicWidthBug","N","Math","floor","version","string","webFontDefault","sW","sH","loadWebFont","Startup","signal","Post","fontInUse","directory","done","Callback","callback","timer","start","checkWebFont","loadComplete","status","Clear","STATUS","OK","webFontLoaded","loadError","isFirefox","allowWebFonts","host","location","protocol","hostname","port","fileURL","webfontDir","substr","firefoxFontError","loadWebFontError","check","time","Font","setTimeout","delay","fontFace","type","FONT","FONTS","msieFontCSSBug","webfonts","dir","fullname","rev","fileRev","def","src","EVENT","TOUCH","HOVER","Augment","config","styles","display","transition","cursor","background","opacity","filter","settings","menuSettings","maxStretchyParts","fontName","TeXLocal","TeXWeb","TeXImage","STIXLocal","STIXWeb","AsanaMathWeb","GyrePagellaWeb","GyreTermesWeb","LatinModernWeb","NeoEulerWeb","TeX_factor","baselineskip","lineH","lineD","ffLineH","VARIANT","RANGES","DELIMITERS","RULECHAR","REMAP","Config","require","SUPER","adjustAvailableFonts","availableFonts","scale","Array","preferredFont","webFont","webFonts","imageFont","imgFonts","fontDir","push","join","OutputJax","extensionDir","Extension","MathEvents","Event","Touch","Hover","ContextMenu","Mousedown","AltContextMenu","Mouseover","Mouseout","Mousemove","hiddenDiv","Element","appendChild","insertBefore","pxPerInch","removeChild","startMarker","createStrut","endMarker","addText","parentNode","HDspan","operaHeightBug","msieInlineBlockAlignBug","HDimg","err","EmExSpan","className","linebreakSpan","Styles","removeSTIXfonts","splice","PreloadWebFonts","preloadWebFonts","available","InitializeHTML","getDefaultExEm","defaultEm","ready","defaultEmDelay","defaultEmTimeout","defaultEx","lastChild","defaultWidth","preTranslate","state","scripts","jax","script","prev","span","test","ex","em","maxwidth","relwidth","cwidth","linebreak","linebreaks","automatic","previousSibling","String","elementJax","root","Get","inputID","isMathJax","jaxID","oncontextmenu","Menu","onmousedown","onmouseover","onmouseout","onmousemove","onclick","Click","ondblclick","DblClick","onkeydown","Keydown","tabIndex","getTabOrder","noContextMenu","ontouchstart","ontouchend","end","msieDisappearingBug","cloneNode","hidden","isHidden","matchFontHeight","x_height","max","minScaleAdjust","outerEm","lineWidth","length2em","HTMLCSSeqn","HTMLCSSlast","HTMLCSSi","HTMLCSSchunk","EqnChunk","HTMLCSSdelay","PHASE","I","II","III","Translate","RestartAfter","Delay","EqnChunkDelay","math","getElementById","getMetrics","initImg","initHTML","savePreview","setTeXclass","toHTML","restart","restorePreview","split","postTranslate","EqnChunkFactor","preview","tmpPreview","createElement","replaceChild","mbase","prototype","linebreakWidth","partial","STATE","PROCESSED","forceReflow","sheet","styleSheets","disabled","getJaxFromMath","nextSibling","nodeName","toLowerCase","getJaxFor","getHoverSpan","HTMLspanElement","getHoverBBox","bbox","BBOX","w","h","d","Zoom","Mw","Mh","emex","zoomScale","parseInt","zscale","idPostfix","tw","spanID","child","H","marginTop","Em","D","marginBottom","lw","paddingLeft","rw","marginRight","zW","zH","mH","mW","Y","getBBox","initFont","AVAIL","Remove","getHD","force","noReflows","HD","getW","exactW","unEm","paddingRight","initialSkipBug","negativeBBoxes","msieNegativeBBoxBug","offsetLeft","HH","Measured","parent","isMultiline","Remeasured","MeasureSpans","SPANS","spans","abs","toFixed","EmRounded","round","parseFloat","Px","s","unPx","Percent","mu","toString","NORMAL","BIG","SMALL","BIGDIMEN","factor","emFactor","MATHSPACE","unit","thickness2em","thick","rule_thickness","LINETHICKNESS","MEDIUM","THIN","THICK","getPadding","right","bottom","has","hasOwnProperty","pad","charAt","toUpperCase","getBorders","css","ID","setBorders","borders","before","strut","createBlank","blank","createShift","space","marginLeft","createSpace","color","isSpace","isBox","verticalAlign","msieNegativeSpaceBug","safariNegativeSpaceBug","COLOR","TRANSPARENT","backgroundColor","createRule","min","min_rule_thickness","f","borderTop","msieRuleBug","borderLeft","rule","noAdjust","createFrame","t","T","msieFrameSizeBug","msieBorderWidthBug","B","frame","createStack","nobbox","msiePaddingWidthBug","relativeW","createBox","box","addBox","placeBox","x","y","noclip","msiePlaceBoxBug","NBSP","imgSpaceBug","imgSpace","dx","chromeHeightBug","msieClipRectBug","dd","b","l","r","clip","isFixed","minWidth","alignBox","align","node","isRelative","c","msieMarginScaleBug","Insert","center","setStackWidth","createDelimiter","code","HW","nulldelimiterspace","hw","delim","alias","load","Require","stretch","chr","createChar","offset","extendDelimiterV","stack","bot","ext","mid","EXT","eH","eh","k","ceil","fullExtenders","dy","msieCloneNodeBug","isMultiChar","extendDelimiterH","rep","REP","rW","fillExtenders","cloneNodeBug","SPAN","variant","noRemap","BOLD","fromCharCode","handleVariant","AccentBug","positionDelimiter","safariVerticalAlignBug","konquerorVerticalAlignBug","operaVerticalAlignBug","ffVerticalAlignBug","newtext","charCodeAt","RemapPlane1","nv","M","noLowerCase","low","high","remap","add","lookupChar","checkFont","img","addSpan","subSpan","handleFont","handleChar","isUnknown","skew","C","handleImg","ffFontOptimizationBug","textRendering","rfix","msieAccentBug","normal","loadFont","findBlock","unknownChar","unknown","defaultFont","undefinedFamily","bold","italic","Ranges","file","j","queue","Queue","Push","isPacked","imgPacked","TextNode","ucMatch","GetID","veryverythinmathspace","verythinmathspace","thinmathspace","mediummathspace","thickmathspace","verythickmathspace","veryverythickmathspace","negativeveryverythinmathspace","negativeverythinmathspace","negativethinmathspace","negativemediummathspace","negativethickmathspace","negativeverythickmathspace","negativeveryverythickmathspace","quad","num1","num2","num3","denom1","denom2","sup1","sup2","sup3","sub1","sub2","sup_drop","sub_drop","delim1","delim2","axis_height","big_op_spacing1","big_op_spacing2","big_op_spacing3","big_op_spacing4","big_op_spacing5","scriptspace","delimiterfactor","delimitershortfall","rfuzz","Hub","Register","StartupHook","ElementJax","mml","HTMLcreateSpan","HTMLhandleSize","stretchy","HTMLcomputeBBox","stretched","forceStretch","HTMLstretchV","needsBBox","HTMLlineBreaks","HTMLmultiline","HTMLhandleSpace","HTMLhandleColor","HTMLautoloadFile","full","core","HTMLcanStretch","CoreMO","HTMLcombineBBoxes","HTMLcleanBBox","HTMLemptyBBox","ic","HTMLzeroBBox","direction","isEmbellished","Core","HTMLstretchH","HTMLnotEmpty","HTMLmeasureChild","HTMLboxChild","SetData","mrow","isMultChar","cssText","href","imgHeightBug","mathsize","HTMLaddAttributes","attrNames","copy","skip","nocopyAttributes","ignore","ignoreMMLattributes","defaults","setAttribute","attr","HTMLhandleVariant","HTMLgetScale","HTMLhandleDir","values","getValues","mathbackground","mathcolor","exact","lW","lpad","rpad","isToken","PaddingWidthBug","keepPadding","lp","rp","msieColorPositionBug","HTMLremoveColor","useMMLspacing","scriptlevel","hasValue","HTMLgetMu","lspace","rspace","Parent","texSpacing","mscale","fontsize","pow","scriptminsize","sqrt","scriptsizemultiplier","HTMLgetVariant","hasVariant","fontfamily","fontweight","fontstyle","mathvariant","variantForm","BOLDITALIC","fraktur","BOLDFRAKTUR","BOLDSCRIPT","BOLDSANSSERIF","SANSSERIFBOLDITALIC","ITALIC","FRAKTUR","SCRIPT","SANSSERIF","SANSSERIFITALIC","HTMLdrawBBox","HTMLautoload","autoloadDir","chars","fontInherit","entity","mi","noIC","mn","mo","largeop","displaystyle","CoreParent","isScript","isa","msubsup","base","mapchars","remapChars","munderover","CoreText","over","under","REMAPACCENT","REMAPACCENTUNDER","a","p","axis","symmetric","maxsize","minsize","mtext","mtextFontInherit","vname","merror","ms","mglyph","mspace","depth","mphantom","childNodes","mpadded","HTMLlength2em","voffset","dimen","exec","v","linebreakContainer","hasNewline","mstyle","mfrac","frac","num","den","isDisplay","bevelled","delta","bevel","linethickness","q","u","mt","numalign","denomalign","texWithDelims","msqrt","surd","BASE","AdjustSurd","ruleC","HTMLaddRoot","mroot","HTMLrootHeight","mfenced","open","close","HTMLcheckStretchy","menclose","maction","semantics","movablelimits","boxes","children","WW","z1","z2","z3","accent","ACCENTS","sup","sub","sscale","subscriptshift","superscriptshift","texprimestyle","mmultiscripts","mtable","annotation","phase","html","nobr","alttext","getAttribute","displayAlign","displayIndent","indentalignfirst","INDENTALIGN","indentalign","AUTO","indentshiftfirst","INDENTSHIFT","indentshift","shift","indent","RIGHT","L","R","msieColorBug","TeXAtom","texClass","TEXCLASS","VCENTER","Select","MSIE","browser","mode","documentMode","isIE7","versionAtLeast","isIE8","quirks","compatMode","msieRelativeWidthBug","msieIE6","isIE9","Firefox","Safari","v3p0","v3p1","trueSafari","navigator","appVersion","vendor","android","forceImages","platform","webkit","isPC","checkWebFontsTwice","Chrome","safariWebFontSerif","Opera","isMini","operaFontSizeBug","Konqueror","zoom","Ajax"],"mappings":"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","sourcesContent":["/* -*- Mode: Javascript; indent-tabs-mode:nil; js-indent-level: 2 -*- */\n/* vim: set ts=2 et sw=2 tw=80: */\n\n/*************************************************************\n *\n *  MathJax/jax/output/HTML-CSS/jax.js\n *\n *  Implements the HTML-CSS OutputJax that displays mathematics\n *  using HTML and CSS to position the characters from math fonts\n *  in their proper locations.\n *  \n *  ---------------------------------------------------------------------\n *  \n *  Copyright (c) 2009-2015 The MathJax Consortium\n * \n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n * \n *      http://www.apache.org/licenses/LICENSE-2.0\n * \n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n */\n\n(function (AJAX,HUB,HTMLCSS) {\n  var MML, isMobile = HUB.Browser.isMobile;\n\n  var MESSAGE = function () {\n    var data = [].slice.call(arguments,0);\n    data[0][0] = [\"HTML-CSS\",data[0][0]];\n    return MathJax.Message.Set.apply(MathJax.Message,data);\n  };\n   \n  var FONTTEST = MathJax.Object.Subclass({\n    timeout:  (isMobile? 15:8)*1000,   // timeout for loading web fonts\n    comparisonFont: [\"sans-serif\",\"monospace\",\"script\",\"Times\",\"Courier\",\"Arial\",\"Helvetica\"],\n    testSize: [\"40px\",\"50px\",\"60px\",\"30px\",\"20px\"],\n    //\n    //  Fedora aliases STIXSizeOneSym to STIX Word, so MathJax thinks STIX is\n    //  available, but the fonts aren't actually correct.  This is to test if\n    //  STIXSizeOneSym has letters in it (so is actually STIX Word).\n    //  \n    FedoraSTIXcheck: {family:\"STIXSizeOneSym\", testString:\"abcABC\", noStyleChar:true},\n\n    Init: function () {\n      //\n      //  Wrap the Font_Test DIV in a 0x0 DIV so that it takes no room\n      //\n      this.div = MathJax.HTML.addElement(document.body,\"div\",{style: {\n          position:\"absolute\", width:0, height:0, overflow:\"hidden\",\n          padding:0, border:0, margin:0\n        }},[[\"div\",{\n          id: \"MathJax_Font_Test\",\n          style: {position:\"absolute\", visibility:\"hidden\", top:0, left:0, width: \"auto\",\n                  padding:0, border:0, margin:0, whiteSpace:\"nowrap\",\n                  textAlign:\"left\", textIndent:0, textTransform:\"none\",\n                  lineHeight:\"normal\", letterSpacing:\"normal\", wordSpacing:\"normal\",\n                  fontSize:this.testSize[0], fontWeight:\"normal\", fontStyle:\"normal\",\n                  fontSizeAdjust:\"none\"}\n          },[\"\"]]]\n      ).firstChild;\n      this.text = this.div.firstChild;\n    },\n\n    findFont: function (fonts,pref) {\n      var found = null;\n      if (pref && this.testCollection(pref)) {\n        found = pref;\n      } else {\n        for (var i = 0, m = fonts.length; i < m; i++) {\n          if (fonts[i] === pref) continue;\n          if (this.testCollection(fonts[i])) {found = fonts[i]; break}\n        }\n      }\n      if (found === \"STIX\" && this.testFont(this.FedoraSTIXcheck)) {found = null}\n      return found;\n    },\n\n    testCollection: function (name) {\n      var font = {testString: \"() {} []\"};\n      font.family = {TeX:\"MathJax_Size1\", STIX:\"STIXSizeOneSym\"}[name] ||\n                     name.replace(/-(Math)?/,\"\")+\"MathJax_Size1\";\n      if (name === \"STIX\") {font.noStyleChar = true}\n      return this.testFont(font);\n    },\n\n    testFont: function (font) {\n      if (font.isWebFont && HTMLCSS.FontFaceBug) {\n        this.div.style.fontWeight = this.div.style.fontStyle = \"normal\";\n      } else {\n        this.div.style.fontWeight = (font.weight||\"normal\");\n        this.div.style.fontStyle  = (font.style||\"normal\");\n      }\n      //\n      //  Hack:  Fix up web font names for local access.\n      //  (The names for Windows and Mac are different, unlike in the STIX and\n      //  TeX fonts, so we have to work out a list of names here.)\n      //\n      //  This should be removed when the web fonts are fixed.  FIXME\n      //\n      var family = font.familyFixed || font.family;\n      if (!font.isWebFont && !family.match(/^(STIX|MathJax)|'/)) {\n        family = family.replace(/_/g,\" \").replace(/([a-z])([A-Z])/g,\"$1 $2\").replace(/ Jax/,\"Jax\")\n               + \"','\" + family + \"','\" + family + \"-\";\n        if (font.weight) {family += \"Bold\"}; if (font.style) {family += \"Italic\"}\n        if (!font.weight && !font.style) {family += \"Regular\"}\n        font.familyFixed = family = \"'\"+family+\"'\"\n      }\n\n      var W = this.getComparisonWidths(font.testString,font.noStyleChar);\n      var found = null;\n      if (W) {\n        this.div.style.fontFamily = family+\",\"+this.comparisonFont[0];\n        if (this.div.offsetWidth == W[0]) {\n          this.div.style.fontFamily = family+\",\"+this.comparisonFont[W[2]];\n          if (this.div.offsetWidth == W[1]) {found = false}\n        }\n        if (found === null && (this.div.offsetWidth != W[3] || this.div.offsetHeight != W[4])) {\n          if (!font.noStyleChar && HTMLCSS.FONTDATA && HTMLCSS.FONTDATA.hasStyleChar) {\n            for (var i = 0, m = this.testSize.length; i < m; i++)\n              {if (this.testStyleChar(font,this.testSize[i])) {found = true; m = 0}}\n          } else {found = true}\n        }\n      }\n      if (HTMLCSS.safariTextNodeBug) {this.div.innerHTML = \"\"} else {this.text.nodeValue = \"\"}\n      return found;\n    },\n\n    styleChar:   \"\\uEFFD\", // width encodes style\n    versionChar: \"\\uEFFE\", // width encodes version\n    compChar:    \"\\uEFFF\", // \"standard\" width to compare to\n\n    testStyleChar: function (font,size) {\n      var n = 3 + (font.weight ? 2 : 0) + (font.style ? 4 : 0);\n      var extra = \"\", dw = 0;\n      var SIZE = this.div.style.fontSize; this.div.style.fontSize = size;\n      if (HTMLCSS.msieItalicWidthBug && font.style === \"italic\") {\n        this.text.nodeValue = extra = this.compChar;\n        dw = this.div.offsetWidth;\n      }\n      if (HTMLCSS.safariTextNodeBug) {this.div.innerHTML = this.compChar+extra}\n        else {this.text.nodeValue = this.compChar+extra}\n      var W = this.div.offsetWidth-dw;\n      if (HTMLCSS.safariTextNodeBug) {this.div.innerHTML = this.styleChar+extra}\n        else {this.text.nodeValue = this.styleChar+extra}\n      var N = Math.floor((this.div.offsetWidth-dw)/W+.5);\n      if (N === n) {\n        if (HTMLCSS.safariTextNodeBug) {this.div.innerHTML = this.versionChar+extra}\n          else {this.text.nodeValue = this.versionChar+extra}\n        font.version = Math.floor((this.div.offsetWidth-dw)/W+1.5)/2;\n      }\n      this.div.style.fontSize = SIZE;\n      return (N === n);\n    },\n\n    getComparisonWidths: function (string,noStyleChar) {\n      if (HTMLCSS.FONTDATA && HTMLCSS.FONTDATA.hasStyleChar && !noStyleChar)\n        {string += this.styleChar + \" \" + this.compChar}\n      if (HTMLCSS.safariTextNodeBug) {this.div.innerHTML = string}\n        else {this.text.nodeValue = string}\n      this.div.style.fontFamily = this.comparisonFont[0];\n      var W = this.div.offsetWidth;\n      this.div.style.fontFamily = HTMLCSS.webFontDefault;\n      var sW = this.div.offsetWidth, sH = this.div.offsetHeight;\n      for (var i = 1, m = this.comparisonFont.length; i < m; i++) {\n        this.div.style.fontFamily = this.comparisonFont[i];\n        if (this.div.offsetWidth != W) {return [W,this.div.offsetWidth,i,sW,sH]}\n      }\n      return null;\n    },\n\n    loadWebFont: function (font) {\n      HUB.Startup.signal.Post(\"HTML-CSS Jax - Web-Font \"+HTMLCSS.fontInUse+\"/\"+font.directory);\n      var n = MESSAGE([\"LoadWebFont\",\"Loading web-font %1\",HTMLCSS.fontInUse+\"/\"+font.directory]);\n      var done = MathJax.Callback({}); // called when font is loaded\n      var callback = MathJax.Callback([\"loadComplete\",this,font,n,done]);\n      AJAX.timer.start(AJAX,[this.checkWebFont,font,callback],0,this.timeout);\n      return done;\n    },\n    loadComplete: function (font,n,done,status) {\n      MathJax.Message.Clear(n);\n      if (status === AJAX.STATUS.OK) {this.webFontLoaded = true; done(); return}\n      this.loadError(font);\n      if (HUB.Browser.isFirefox && HTMLCSS.allowWebFonts) {\n        var host = document.location.protocol + \"//\" + document.location.hostname;\n        if (document.location.port != \"\") {host += \":\" + document.location.port}\n        host += \"/\";\n        if (AJAX.fileURL(HTMLCSS.webfontDir).substr(0,host.length) !== host)\n          {this.firefoxFontError(font)}\n      }\n      if (!this.webFontLoaded) {HTMLCSS.loadWebFontError(font,done)} else {done()}\n    },\n    loadError: function (font) {\n      MESSAGE([\"CantLoadWebFont\",\"Can't load web font %1\",HTMLCSS.fontInUse+\"/\"+font.directory],null,2000);\n      HUB.Startup.signal.Post([\"HTML-CSS Jax - web font error\",HTMLCSS.fontInUse+\"/\"+font.directory,font]);\n    },\n    firefoxFontError: function (font) {\n      MESSAGE([\"FirefoxCantLoadWebFont\",\"Firefox can't load web fonts from a remote host\"],null,3000);\n      HUB.Startup.signal.Post(\"HTML-CSS Jax - Firefox web fonts on remote host error\");\n    },\n\n    checkWebFont: function (check,font,callback) {\n      if (check.time(callback)) return;\n      if (HTMLCSS.Font.testFont(font)) {callback(check.STATUS.OK)}\n        else {setTimeout(check,check.delay)}\n    },\n\n    fontFace: function (name) {\n      var type = HTMLCSS.allowWebFonts;\n      var FONT = HTMLCSS.FONTDATA.FONTS[name];\n      if (HTMLCSS.msieFontCSSBug && !FONT.family.match(/-Web$/)) {FONT.family += \"-Web\"}\n      if (FONT.isWebFont) delete FONT.familyFixed;\n      var webfonts = HTMLCSS.webfontDir+\"/\"+type;\n      var dir = AJAX.fileURL(webfonts);\n      var fullname = name.replace(/-b/,\"-B\").replace(/-i/,\"-I\").replace(/-Bold-/,\"-Bold\");\n      if (!fullname.match(/-/)) {fullname += \"-Regular\"}\n      if (type === \"svg\") {fullname += \".svg#\"+fullname} else {fullname += \".\"+type}\n      var rev = AJAX.fileRev(webfonts+\"/\"+fullname.replace(/#.*/,\"\"));\n      var def = {\n        \"font-family\": FONT.family,\n        src: \"url('\"+dir+\"/\"+fullname+rev+\"')\"\n      };\n      if (type === \"otf\") {\n        fullname = fullname.replace(/otf$/,\"woff\");\n        rev = AJAX.fileRev(webfonts+\"/\"+fullname);\n        def.src += \" format('opentype')\";\n        dir = AJAX.fileURL(HTMLCSS.webfontDir+\"/woff\");  // add woff fonts as well\n        def.src = \"url('\"+dir+\"/\"+fullname+rev+\"') format('woff'), \"+def.src;\n      } else if (type !== \"eot\") {def.src += \" format('\"+type+\"')\"}\n      if (!(HTMLCSS.FontFaceBug && FONT.isWebFont)) {\n        if (name.match(/-bold/)) {def[\"font-weight\"] = \"bold\"}\n        if (name.match(/-italic/)) {def[\"font-style\"] = \"italic\"}\n      }\n      return def;\n    }\n  });\n  \n  var EVENT, TOUCH, HOVER; // filled in later\n\n  HTMLCSS.Augment({\n    config: {\n      styles: {\n        \".MathJax\": {\n          \"display\":         \"inline\",\n          \"font-style\":      \"normal\",\n          \"font-weight\":     \"normal\",\n          \"line-height\":     \"normal\",\n          \"font-size\":       \"100%\",\n          \"font-size-adjust\":\"none\",\n          \"text-indent\":     0,\n          \"text-align\":      \"left\",\n          \"text-transform\":  \"none\",\n          \"letter-spacing\":  \"normal\",\n          \"word-spacing\":    \"normal\",\n          \"word-wrap\":       \"normal\",\n          \"white-space\":     \"nowrap\",\n          \"float\":           \"none\",\n          \"direction\":       \"ltr\",\n          \"max-width\": \"none\", \"max-height\": \"none\",\n          \"min-width\": 0, \"min-height\": 0,\n          border: 0, padding: 0, margin: 0\n        },\n\n        // Focus elements for keyboard tabbing.\n        \".MathJax:focus, body :focus .MathJax\": {\n          display:\"inline-table\" // see issues #1282 and #1338\n        },\n\n        \".MathJax_Display\": {\n          position: \"relative\",\n          display: \"block!important\",\n          \"text-indent\": 0,\n          \"max-width\": \"none\", \"max-height\": \"none\",\n          \"min-width\": 0, \"min-height\": 0,\n          width: \"100%\"\n        },\n\n        \".MathJax img, .MathJax nobr, .MathJax a\": {\n          border: 0, padding: 0, margin: 0,\n          \"max-width\": \"none\", \"max-height\": \"none\",\n          \"min-width\": 0, \"min-height\": 0,\n          \"vertical-align\": 0, \"line-height\": \"normal\",\n          \"text-decoration\": \"none\"\n        },\n        \"img.MathJax_strut\": {\n          border:\"0!important\", padding:\"0!important\", margin:\"0!important\",\n          \"vertical-align\": \"0!important\"\n        },\n        \n\t\".MathJax span\": {\n\t  display: \"inline\", position: \"static\",\n\t  border: 0, padding: 0, margin: 0,\n\t  \"vertical-align\": 0, \"line-height\": \"normal\",\n\t  \"text-decoration\": \"none\"\n\t},\n\n        \".MathJax nobr\": {\n          \"white-space\": \"nowrap!important\"\n        },\n        \n        \".MathJax img\": {\n          display: \"inline!important\",\n          \"float\": \"none!important\"\n        },\n        \n        \".MathJax *\": {\n          transition: \"none\",\n          \"-webkit-transition\": \"none\",\n          \"-moz-transition\": \"none\",\n          \"-ms-transition\": \"none\",\n          \"-o-transition\": \"none\"\n        },\n\n        \".MathJax_Processing\": {\n          visibility: \"hidden\", position:\"fixed\",\n          width: 0, height: 0, overflow:\"hidden\"\n        },\n        \".MathJax_Processed\": {display:\"none!important\"},\n        \n        \".MathJax_ExBox\": {\n          display:\"block!important\", overflow:\"hidden\",\n          width:\"1px\", height:\"60ex\",\n          \"min-height\": 0, \"max-height\":\"none\"\n        },\n        \".MathJax .MathJax_EmBox\": {\n          display:\"block!important\", overflow:\"hidden\",\n          width:\"1px\", height:\"60em\",\n          \"min-height\": 0, \"max-height\":\"none\"\n        },\n        \n        \".MathJax .MathJax_HitBox\": {\n          cursor: \"text\",\n          background: \"white\",\n          opacity:0, filter:\"alpha(opacity=0)\"\n        },\n        \".MathJax .MathJax_HitBox *\": {\n          filter: \"none\", opacity:1, background:\"transparent\" // for IE\n        },\n        \n        \"#MathJax_Tooltip\": {\n          position: \"absolute\", left: 0, top: 0,\n          width: \"auto\", height: \"auto\",\n          display: \"none\"\n        },\n        \"#MathJax_Tooltip *\": {\n          filter: \"none\", opacity:1, background:\"transparent\" // for IE\n        },\n\n        //\n        //  Used for testing web fonts against the default font used while\n        //  web fonts are loading\n        //\n        \"@font-face\": {\n          \"font-family\": \"MathJax_Blank\",\n          \"src\": \"url('about:blank')\"\n        }\n\n      }\n    },\n    settings: HUB.config.menuSettings,\n\n    Font: null,                        // created by Config() below\n    webFontDefault: \"MathJax_Blank\",\n    allowWebFonts: \"otf\",              // assume browser can use OTF web fonts\n\n    maxStretchyParts: 1000,            // limit the number of parts allowed for\n                                       // stretchy operators. See issue 366.\n\n    fontName: {\n      TeXLocal:       \"TeX\",\n      TeXWeb:         [\"\",\"TeX\"],\n      TeXImage:       [\"\",\"\"],\n      STIXLocal:      [\"STIX\",\"STIX-Web\"],\n      STIXWeb:        \"STIX-Web\",\n      AsanaMathWeb:   \"Asana-Math\",\n      GyrePagellaWeb: \"Gyre-Pagella\",\n      GyreTermesWeb:  \"Gyre-Termes\",\n      LatinModernWeb: \"Latin-Modern\",\n      NeoEulerWeb:    \"Neo-Euler\"\n    },\n    \n    fontInUse: \"generic\",\n    FONTDATA: {\n      TeX_factor: 1, baselineskip: 1.2, lineH: .8, lineD: .2, ffLineH: .8,\n      FONTS: {},\n      VARIANT: {\"normal\": {fonts:[]}, \"-generic-variant\": {}, \"-largeOp\": {}, \"-smallOp\": {}},\n      RANGES: [], DELIMITERS: {}, RULECHAR: 0x2D, REMAP: {}\n    },\n\n    Config: function () {\n      if (!this.require) {this.require = []}\n      this.Font = FONTTEST(); this.SUPER(arguments).Config.call(this);\n      var settings = this.settings, config = this.config, font = settings.font;\n      if (this.adjustAvailableFonts) {this.adjustAvailableFonts(config.availableFonts)}\n      if (settings.scale) {config.scale = settings.scale}\n      if (font && font !== \"Auto\" && this.fontName[font]) {\n        config.availableFonts = []; delete config.fonts;\n        if (this.fontName[font] instanceof Array) {\n          config.preferredFont = this.fontName[font][0];\n          config.webFont = this.fontName[font][1];\n        } else {\n          config.preferredFont = config.webFont = this.fontName[font];\n        }\n        if (config.preferredFont) {config.availableFonts[0] = config.preferredFont}\n      }\n      if (config.fonts) {\n        config.availableFonts = config.fonts;\n        config.preferredFont = config.webFont = config.fonts[0];\n        if (config.webFont === \"STIX\") {config.webFont += \"-Web\"}\n      }\n      font = this.Font.findFont(config.availableFonts,config.preferredFont);\n      if (!font && this.allowWebFonts) {font = config.webFont; if (font) {this.webFonts = true}}\n      if (!font && this.config.imageFont) {font = config.imageFont; this.imgFonts = true}\n      if (font) {\n        this.fontInUse = font; this.fontDir += \"/\" + font; this.webfontDir += \"/\" + font;\n        this.require.push(this.fontDir+\"/fontdata.js\");\n        if (this.imgFonts) {\n          this.require.push(this.directory+\"/imageFonts.js\");\n          HUB.Startup.signal.Post(\"HTML-CSS Jax - using image fonts\");\n        }\n      } else {\n        MESSAGE([\"CantFindFontUsing\",\"Can't find a valid font using %1\",\n                \"[\"+this.config.availableFonts.join(\", \")+\"]\"],null,3000);\n        HUB.Startup.signal.Post(\"HTML-CSS Jax - no valid font\");\n      }\n      this.require.push(MathJax.OutputJax.extensionDir+\"/MathEvents.js\");\n    },\n\n    Startup: function () {\n      //  Set up event handling\n      EVENT = MathJax.Extension.MathEvents.Event;\n      TOUCH = MathJax.Extension.MathEvents.Touch;\n      HOVER = MathJax.Extension.MathEvents.Hover;\n      this.ContextMenu = EVENT.ContextMenu;\n      this.Mousedown   = EVENT.AltContextMenu;\n      this.Mouseover   = HOVER.Mouseover;\n      this.Mouseout    = HOVER.Mouseout;\n      this.Mousemove   = HOVER.Mousemove;\n\n      // Make hidden div for when math is in a display:none block\n      this.hiddenDiv = this.Element(\"div\",{\n        style:{visibility:\"hidden\", overflow:\"hidden\", position:\"absolute\", top:0,\n               height:\"1px\", width: \"auto\", padding:0, border:0, margin:0,\n               textAlign:\"left\", textIndent:0, textTransform:\"none\",\n               lineHeight:\"normal\", letterSpacing:\"normal\", wordSpacing:\"normal\"}\n      });\n      if (!document.body.firstChild) {document.body.appendChild(this.hiddenDiv)}\n        else {document.body.insertBefore(this.hiddenDiv,document.body.firstChild)}\n      this.hiddenDiv = this.addElement(this.hiddenDiv,\"div\",{id:\"MathJax_Hidden\"});\n\n      // Determine pixels per inch\n      var div = this.addElement(this.hiddenDiv,\"div\",{style:{width:\"5in\"}});\n      this.pxPerInch = div.offsetWidth/5; this.hiddenDiv.removeChild(div);\n\n      // Markers used by getW\n      this.startMarker = this.createStrut(this.Element(\"span\"),10,true);\n      this.endMarker = this.addText(this.Element(\"span\"),\"x\").parentNode;\n\n      // Used in getHD\n      this.HDspan = this.Element(\"span\");\n      if (this.operaHeightBug) {this.createStrut(this.HDspan,0)}\n      if (this.msieInlineBlockAlignBug) {\n        this.HDimg = this.addElement(this.HDspan,\"img\",{style:{height:\"0px\", width:\"1px\"}});\n        try {this.HDimg.src = \"about:blank\"} catch(err) {}\n      } else {\n        this.HDimg = this.createStrut(this.HDspan,0);\n      }\n\n      // Used in preTranslate to get scaling factors\n      this.EmExSpan = this.Element(\"span\",\n        {style:{position:\"absolute\",\"font-size-adjust\":\"none\"}},\n        [\n          [\"span\",{className:\"MathJax_ExBox\"}],\n          [\"span\",{className:\"MathJax\"},\n            [[\"span\",{className:\"MathJax_EmBox\"}]]\n          ]\n        ]\n      );\n\n      // Used in preTranslate to get linebreak width\n      this.linebreakSpan = this.Element(\"span\",null,\n        [[\"hr\",{style: {width:\"100%\", size:1, padding:0, border:0, margin:0}}]]);\n\n      // Set up styles and preload web fonts\n      return AJAX.Styles(this.config.styles,[\"InitializeHTML\",this]);\n    },\n    \n    removeSTIXfonts: function (fonts) {\n      //\n      //  Opera doesn't display large chunks of the STIX fonts, and\n      //  Safari/Windows doesn't display Plane1,\n      //  so disable STIX for these browsers.\n      //\n      //  ### FIXME ### Do we need to disable the other web fonts for these?\n      //\n      for (var i = 0, m = fonts.length; i < m; i++)\n        {if (fonts[i] === \"STIX\") {fonts.splice(i,1); m--; i--;}}\n      if (this.config.preferredFont === \"STIX\") {this.config.preferredFont = fonts[0]}\n    },\n\n    PreloadWebFonts: function () {\n      if (!HTMLCSS.allowWebFonts || !HTMLCSS.config.preloadWebFonts) return;\n      for (var i = 0, m = HTMLCSS.config.preloadWebFonts.length; i < m; i++) {\n        var FONT = HTMLCSS.FONTDATA.FONTS[HTMLCSS.config.preloadWebFonts[i]];\n        if (!FONT.available) {HTMLCSS.Font.testFont(FONT)}\n      }\n    },\n    \n    //\n    //  Handle initialization that requires styles to be set up\n    //\n    InitializeHTML: function () {\n      this.PreloadWebFonts();\n      this.getDefaultExEm();\n      //\n      //  If the defaultEm size is zero, it might be that a web font hasn't\n      //  arrived yet, so try to wait for it, but don't wait too long.\n      //\n      if (this.defaultEm) return;\n      var ready = MathJax.Callback();\n      AJAX.timer.start(AJAX,function (check) {\n        if (check.time(ready)) {HUB.signal.Post([\"HTML-CSS Jax - no default em size\"]); return}\n        HTMLCSS.getDefaultExEm();\n        if (HTMLCSS.defaultEm) {ready()} else {setTimeout(check,check.delay)}\n      },this.defaultEmDelay,this.defaultEmTimeout);\n      return ready;\n    },\n    defaultEmDelay: 100,      // initial delay when checking for defaultEm\n    defaultEmTimeout: 1000,   // when to stop looking for defaultEm\n    getDefaultExEm: function () {\n      //\n      //  Get the default sizes (need styles in place to do this)\n      //\n      document.body.appendChild(this.EmExSpan);\n      document.body.appendChild(this.linebreakSpan);\n      this.defaultEx    = this.EmExSpan.firstChild.offsetHeight/60;\n      this.defaultEm    = this.EmExSpan.lastChild.firstChild.offsetHeight/60;\n      this.defaultWidth = this.linebreakSpan.firstChild.offsetWidth;\n      document.body.removeChild(this.linebreakSpan);\n      document.body.removeChild(this.EmExSpan);\n    },\n    \n    preTranslate: function (state) {\n      var scripts = state.jax[this.id], i, m = scripts.length, n,\n          script, prev, span, div, test, jax, ex, em, scale, maxwidth, relwidth = false, cwidth,\n          linebreak = this.config.linebreaks.automatic, width = this.config.linebreaks.width;\n      if (linebreak) {\n        relwidth = (width.match(/^\\s*(\\d+(\\.\\d*)?%\\s*)?container\\s*$/) != null);\n        if (relwidth) {width = width.replace(/\\s*container\\s*/,\"\")}\n          else {maxwidth = this.defaultWidth}\n        if (width === \"\") {width = \"100%\"}\n      } else {maxwidth = 100000} // a big width, so no implicit line breaks\n      //\n      //  Loop through the scripts\n      //\n      for (i = 0; i < m; i++) {\n        script = scripts[i]; if (!script.parentNode) continue;\n        //\n        //  Remove any existing output\n        //\n        prev = script.previousSibling;\n        if (prev && String(prev.className).match(/^MathJax(_Display)?( MathJax_Processing)?$/))\n          {prev.parentNode.removeChild(prev)}\n        //\n        //  Add the span, and a div if in display mode,\n        //  then set the role and mark it as being processed\n        //\n        jax = script.MathJax.elementJax; if (!jax) continue;\n        jax.HTMLCSS = {display: (jax.root.Get(\"display\") === \"block\")}\n        span = div = this.Element(\"span\",{\n\t  className:\"MathJax\", id:jax.inputID+\"-Frame\", isMathJax:true, jaxID:this.id,\n          oncontextmenu:EVENT.Menu, onmousedown: EVENT.Mousedown,\n          onmouseover:EVENT.Mouseover, onmouseout:EVENT.Mouseout,\n          onmousemove:EVENT.Mousemove, onclick:EVENT.Click,\n          ondblclick:EVENT.DblClick,\n          // Added for keyboard accessible menu.\n          onkeydown: EVENT.Keydown, tabIndex: HUB.getTabOrder(jax)\n        });\n\tif (HUB.Browser.noContextMenu) {\n\t  span.ontouchstart = TOUCH.start;\n\t  span.ontouchend = TOUCH.end;\n\t}\n        if (jax.HTMLCSS.display) {\n          div = this.Element(\"div\",{className:\"MathJax_Display\"});\n          div.appendChild(span);\n        } else if (this.msieDisappearingBug) {span.style.display = \"inline-block\"}\n        div.className += \" MathJax_Processing\";\n        script.parentNode.insertBefore(div,script);\n        //\n        //  Add the test span for determining scales and linebreak widths\n        //\n        script.parentNode.insertBefore(this.EmExSpan.cloneNode(true),script);\n        div.parentNode.insertBefore(this.linebreakSpan.cloneNode(true),div)\n      }\n      //\n      //  Determine the scaling factors for each script\n      //  (this only requires one reflow rather than a reflow for each equation)\n      //  Record any that need to be hidden (don't move them now, since that\n      //  would cause reflows).\n      //\n      var hidden = [];\n      for (i = 0; i < m; i++) {\n        script = scripts[i]; if (!script.parentNode) continue;\n        test = script.previousSibling; div = test.previousSibling;\n        jax = script.MathJax.elementJax; if (!jax) continue;\n        ex = test.firstChild.offsetHeight/60;\n        em = test.lastChild.firstChild.offsetHeight/60;\n        cwidth = div.previousSibling.firstChild.offsetWidth;\n        if (relwidth) {maxwidth = cwidth}\n        if (ex === 0 || ex === \"NaN\") {\n          // can't read width, so move to hidden div for processing\n          hidden.push(div);\n          jax.HTMLCSS.isHidden = true;\n          ex = this.defaultEx; em = this.defaultEm; cwidth = this.defaultWidth;\n          if (relwidth) {maxwidth = cwidth}\n        }\n        scale = (this.config.matchFontHeight ? ex/this.TeX.x_height/em : 1);\n        scale = Math.floor(Math.max(this.config.minScaleAdjust/100,scale)*this.config.scale);\n        jax.HTMLCSS.scale = scale/100; jax.HTMLCSS.fontSize = scale+\"%\";\n        jax.HTMLCSS.em = jax.HTMLCSS.outerEm = em; this.em = em * scale/100; jax.HTMLCSS.ex = ex;\n        jax.HTMLCSS.cwidth = cwidth/this.em;\n        jax.HTMLCSS.lineWidth = (linebreak ? this.length2em(width,1,maxwidth/this.em) : 1000000);\n      }\n      for (i = 0, n = hidden.length; i < n; i++) {\n        this.hiddenDiv.appendChild(hidden[i]);\n        this.addElement(this.hiddenDiv,\"br\");\n      }\n      //\n      //  Remove the test spans used for determining scales and linebreak widths\n      //\n      for (i = 0; i < m; i++) {\n        script = scripts[i]; if (!script.parentNode) continue;\n        test = scripts[i].previousSibling;\n        jax = scripts[i].MathJax.elementJax; if (!jax) continue;\n        span = test.previousSibling;\n        if (!jax.HTMLCSS.isHidden) {span = span.previousSibling}\n        span.parentNode.removeChild(span);\n        test.parentNode.removeChild(test);\n      }\n      //\n      //  Set state variables used for displaying equations in chunks\n      //\n      state.HTMLCSSeqn = state.HTMLCSSlast = 0; state.HTMLCSSi = -1;\n      state.HTMLCSSchunk = this.config.EqnChunk;\n      state.HTMLCSSdelay = false;\n    },\n\n    PHASE: {I: 1, II: 2, III: 3},  // processing phases\n  \n    Translate: function (script,state) {\n      if (!script.parentNode) return;\n\n      //\n      //  If we are supposed to do a chunk delay, do it\n      //  \n      if (state.HTMLCSSdelay) {\n        state.HTMLCSSdelay = false;\n        HUB.RestartAfter(MathJax.Callback.Delay(this.config.EqnChunkDelay));\n      }\n\n      //\n      //  Get the data about the math\n      //\n      var jax = script.MathJax.elementJax, math = jax.root,\n          span = document.getElementById(jax.inputID+\"-Frame\"),\n          div = (jax.HTMLCSS.display ? (span||{}).parentNode : span);\n      if (!div) return;\n      //\n      //  Set the font metrics\n      //\n      this.getMetrics(jax);\n      if (this.scale !== 1) {span.style.fontSize = jax.HTMLCSS.fontSize}\n      //\n      //  Typeset the math\n      //\n      this.initImg(span);\n      this.initHTML(math,span);\n      this.savePreview(script);\n      try {\n        math.setTeXclass();\n        jax.HTMLCSS.span = span; jax.HTMLCSS.div = div;  // save for phase II and III\n        math.toHTML(span,div,this.PHASE.I);\n      } catch (err) {\n        if (err.restart) {while (span.firstChild) {span.removeChild(span.firstChild)}}\n        this.restorePreview(script);\n        throw err;\n      }\n      this.restorePreview(script);\n      //\n      //  Remove the processing marker, and signal the new math pending\n      //\n      div.className = div.className.split(/ /)[0] + \" MathJax_Processed\";\n      HUB.signal.Post([\"New Math Pending\",jax.inputID]); // FIXME: wait for this?  (i.e., restart if returns uncalled callback)\n      //\n      //  Check if we should show this chunk of equations\n      //\n      state.HTMLCSSeqn += (state.i - state.HTMLCSSi); state.HTMLCSSi = state.i;\n      if (state.HTMLCSSeqn >= state.HTMLCSSlast + state.HTMLCSSchunk) {\n        this.postTranslate(state,true);\n        state.HTMLCSSchunk = Math.floor(state.HTMLCSSchunk*this.config.EqnChunkFactor);\n        state.HTMLCSSdelay = true;  // delay if there are more scripts\n      }\n      return false;\n    },\n    //\n    //  MathML previews can contain the same ID's as the HTML output,\n    //  which confuses HTMLspanElement(), so remove the preview temporarily\n    //  and restore it after typesetting the math.\n    //\n    savePreview: function (script) {\n      var preview = script.MathJax.preview;\n      if (preview) {\n        script.MathJax.tmpPreview = document.createElement(\"span\");\n        preview.parentNode.replaceChild(script.MathJax.tmpPreview,preview);\n      }\n    },\n    restorePreview: function (script) {\n      var tmpPreview = script.MathJax.tmpPreview;\n      if (tmpPreview) {\n        tmpPreview.parentNode.replaceChild(script.MathJax.preview,tmpPreview);\n        delete script.MathJax.tmpPreview;\n      }\n    },\n    //\n    //  Get the jax metric information\n    //\n    getMetrics: function(jax) {\n      var data = jax.HTMLCSS;\n      this.em = MML.mbase.prototype.em = data.em * data.scale; \n      this.outerEm = data.em;\n      this.scale = data.scale;\n      this.cwidth = data.cwidth;\n      this.linebreakWidth = data.lineWidth;\n    },\n\n    postTranslate: function (state,partial) {\n      var scripts = state.jax[this.id], script, jax, i, m;\n      //\n      //  Remove the processed markers so that measuring can occur,\n      //  and remove the preview, if any, since the math will now be visible.\n      //\n      for (i = state.HTMLCSSlast, m = state.HTMLCSSeqn; i < m; i++) {\n        script = scripts[i];\n        if (script && script.MathJax.elementJax) {\n          var div = script.MathJax.elementJax.HTMLCSS.div;\n          div.className = div.className.split(/ /)[0];\n          if (script.MathJax.preview) {script.MathJax.preview.innerHTML = \"\"}\n        }\n      }\n      //\n      //  Measure the math in this chunk (toHTML phase II)\n      //\n      for (i = state.HTMLCSSlast, m = state.HTMLCSSeqn; i < m; i++) {\n        script = scripts[i];\n        if (script && script.MathJax.elementJax) {\n          jax = script.MathJax.elementJax; this.getMetrics(jax);\n          jax.root.toHTML(jax.HTMLCSS.span,jax.HTMLCSS.div,this.PHASE.II);\n        }\n      }\n      //\n      //  Reveal this chunk of math\n      //\n      for (i = state.HTMLCSSlast, m = state.HTMLCSSeqn; i < m; i++) {\n        script = scripts[i];\n        if (script && script.MathJax.elementJax) {\n          //\n          //  Finish the math with its measured size (toHTML phase III)\n          //\n          jax = script.MathJax.elementJax; this.getMetrics(jax);\n          jax.root.toHTML(jax.HTMLCSS.span,jax.HTMLCSS.div,this.PHASE.III);\n          if (jax.HTMLCSS.isHidden) script.parentNode.insertBefore(jax.HTMLCSS.div,script);\n          delete jax.HTMLCSS.span; delete jax.HTMLCSS.div;\n          //\n          //  The math is now fully processed\n          //\n          script.MathJax.state = jax.STATE.PROCESSED;\n          HUB.signal.Post([\"New Math\",script.MathJax.elementJax.inputID]); // FIXME: wait for this?  (i.e., restart if returns uncalled callback)\n        }\n      }\n      if (this.forceReflow) {\n        //  WebKit can misplace some elements that should wrap to the next line\n        //  but gets them right on a reflow, so force reflow by toggling a stylesheet\n        var sheet = (document.styleSheets||[])[0]||{};\n        sheet.disabled = true; sheet.disabled = false;\n      }\n      //\n      //  Save our place so we know what is revealed\n      //\n      state.HTMLCSSlast = state.HTMLCSSeqn;\n    },\n    \n    getJaxFromMath: function (math) {\n      if (math.parentNode.className === \"MathJax_Display\") {math = math.parentNode}\n      do {math = math.nextSibling} while (math && math.nodeName.toLowerCase() !== \"script\");\n      return HUB.getJaxFor(math);\n    },\n    getHoverSpan: function (jax,math) {return jax.root.HTMLspanElement()},\n    getHoverBBox: function (jax,span,math) {\n      var bbox = span.bbox, em = jax.HTMLCSS.outerEm;\n      var BBOX = {w:bbox.w*em, h:bbox.h*em, d:bbox.d*em};\n      if (bbox.width) {BBOX.width = bbox.width}\n      return BBOX;\n    },\n    \n    Zoom: function (jax,span,math,Mw,Mh) {\n      //\n      //  Re-render at larger size\n      //\n      span.className = \"MathJax\";\n      span.style.fontSize = jax.HTMLCSS.fontSize;\n\n      //\n      //  get em sizes (taken from HTMLCSS.preTranslate)\n      //\n      var emex = span.appendChild(this.EmExSpan.cloneNode(true));\n      var em = emex.lastChild.firstChild.offsetHeight/60;\n      this.em = MML.mbase.prototype.em = em;\n      this.outerEm = em / jax.HTMLCSS.scale;\n      emex.parentNode.removeChild(emex);\n      this.scale = jax.HTMLCSS.scale;\n      this.linebreakWidth = jax.HTMLCSS.lineWidth;\n      this.cwidth = jax.HTMLCSS.cwidth;\n\n      this.zoomScale = parseInt(HUB.config.menuSettings.zscale) / 100;\n      this.idPostfix = \"-zoom\"; jax.root.toHTML(span,span); this.idPostfix = \"\";\n      this.zoomScale = 1;\n      \n      var bbox = jax.root.HTMLspanElement().bbox, width = bbox.width;\n      if (width) {\n        //  Handle full-width displayed equations\n        if (bbox.tw) {Mw = bbox.tw*em}\n        if (bbox.w*em < Mw) {Mw = bbox.w*em}\n        span.style.width = Math.floor(Mw-1.5*HTMLCSS.em)+\"px\"; span.style.display=\"inline-block\";\n        var id = (jax.root.id||\"MathJax-Span-\"+jax.root.spanID)+\"-zoom\";\n        var child = document.getElementById(id).firstChild;\n        while (child && child.style.width !== width) {child = child.nextSibling}\n        if (child) {\n          var cwidth = child.offsetWidth; child.style.width = \"100%\";\n          if (cwidth > Mw) {span.style.width = (cwidth+100)+\"px\"}\n        }\n      }\n      //\n      //  Adjust margins to prevent overlaps at the edges\n      //\n      child = span.firstChild.firstChild.style;\n      if (bbox.H != null && bbox.H > bbox.h)\n        {child.marginTop = HTMLCSS.Em(bbox.H-Math.max(bbox.h,HTMLCSS.FONTDATA.lineH))}\n      if (bbox.D != null && bbox.D > bbox.d)\n        {child.marginBottom = HTMLCSS.Em(bbox.D-Math.max(bbox.d,HTMLCSS.FONTDATA.lineD))}\n      if (bbox.lw < 0) {child.paddingLeft = HTMLCSS.Em(-bbox.lw)}\n      if (bbox.rw > bbox.w) {child.marginRight = HTMLCSS.Em(bbox.rw-bbox.w)}\n      //\n      //  Get height and width of zoomed math and original math\n      //\n      span.style.position = \"absolute\";\n      if (!width) {math.style.position = \"absolute\"}\n      var zW = span.offsetWidth, zH = span.offsetHeight,\n          mH = math.offsetHeight, mW = math.offsetWidth;\n      span.style.position = math.style.position = \"\";\n      //\n      return {Y:-EVENT.getBBox(span).h, mW:mW, mH:mH, zW:zW, zH:zH};\n    },\n\n    initImg: function (span) {},\n    initHTML: function (math,span) {},\n    initFont: function (name) {\n      var FONTS = HTMLCSS.FONTDATA.FONTS, AVAIL = HTMLCSS.config.availableFonts;\n      if (AVAIL && AVAIL.length && HTMLCSS.Font.testFont(FONTS[name])) {\n        FONTS[name].available = true;\n        if (FONTS[name].familyFixed) {\n          FONTS[name].family = FONTS[name].familyFixed;\n          delete FONTS[name].familyFixed;\n        }\n        return null;\n      }\n      if (!this.allowWebFonts) {return null}\n      FONTS[name].isWebFont = true;\n      if (HTMLCSS.FontFaceBug) {\n        FONTS[name].family = name;\n        if (HTMLCSS.msieFontCSSBug) {FONTS[name].family += \"-Web\"}\n      }\n      return AJAX.Styles({\"@font-face\":this.Font.fontFace(name)});\n    },\n\n    Remove: function (jax) {\n      var span = document.getElementById(jax.inputID+\"-Frame\");\n      if (span) {\n        if (jax.HTMLCSS.display) {span = span.parentNode}\n        span.parentNode.removeChild(span);\n      }\n      delete jax.HTMLCSS;\n    },\n    \n    getHD: function (span,force) {\n      if (span.bbox && this.config.noReflows && !force) {return {h:span.bbox.h, d:span.bbox.d}}\n      var position = span.style.position;\n      span.style.position = \"absolute\";\n      this.HDimg.style.height = \"0px\";\n      span.appendChild(this.HDspan);\n      var HD = {h:span.offsetHeight};\n      this.HDimg.style.height = HD.h+\"px\";\n      HD.d = span.offsetHeight - HD.h; HD.h -= HD.d;\n      HD.h /= this.em; HD.d /= this.em;\n      span.removeChild(this.HDspan);\n      span.style.position = position;\n      return HD;\n    },\n    getW: function (span) {\n      var W, H, w = (span.bbox||{}).w, start = span;\n      if (span.bbox && this.config.noReflows && span.bbox.exactW !== false) {\n        if (!span.bbox.exactW) {\n          if (span.style.paddingLeft) w += this.unEm(span.style.paddingLeft)*(span.scale||1);\n          if (span.style.paddingRight) w += this.unEm(span.style.paddingRight)*(span.scale||1);\n        }\n        return w;\n      }\n      if (span.bbox && span.bbox.exactW) {return w}\n      if ((span.bbox && w >= 0 && !this.initialSkipBug && !this.msieItalicWidthBug) ||\n           this.negativeBBoxes || !span.firstChild) {\n        W = span.offsetWidth; H = span.parentNode.offsetHeight;\n      } else if (span.bbox && w < 0 && this.msieNegativeBBoxBug) {\n        W = -span.offsetWidth, H = span.parentNode.offsetHeight;\n      } else {\n        // IE can't deal with a space at the beginning, so put something else first\n        var position = span.style.position; span.style.position = \"absolute\";\n        start = this.startMarker; span.insertBefore(start,span.firstChild)\n        span.appendChild(this.endMarker);\n        W = this.endMarker.offsetLeft - start.offsetLeft;\n        span.removeChild(this.endMarker);\n        span.removeChild(start); span.style.position = position\n      }\n      if (H != null) {span.parentNode.HH = H/this.em}\n      return W/this.em;\n    },\n    Measured: function (span,parent) {\n      var bbox = span.bbox;\n      if (bbox.width == null && bbox.w && !bbox.isMultiline) {\n        var w = this.getW(span);\n        bbox.rw += w - bbox.w;\n        bbox.w = w; bbox.exactW = true;\n      }\n      if (!parent) {parent = span.parentNode}\n      if (!parent.bbox) {parent.bbox = bbox}\n      return span;\n    },\n    Remeasured: function (span,parent) {\n      parent.bbox = this.Measured(span,parent).bbox;\n    },\n    MeasureSpans: function (SPANS) {\n      var spans = [], span, i, m, bbox, start, end, W, parent;\n      //\n      //  Insert the needed markers\n      // \n      for (i = 0, m = SPANS.length; i < m; i++) {\n        span = SPANS[i]; if (!span) continue;\n        bbox = span.bbox; parent = this.parentNode(span);\n        if (bbox.exactW || bbox.width || bbox.w === 0 || bbox.isMultiline ||\n            (this.config.noReflows && bbox.exactW !== false)) {\n          if (!parent.bbox) {parent.bbox = bbox}\n          continue;\n        }\n        if (this.negativeBBoxes || !span.firstChild || (bbox.w >= 0 && !this.initialSkipBug) ||\n            (bbox.w < 0 && this.msieNegativeBBoxBug)) {\n          spans.push([span]);\n        } else if (this.initialSkipBug) {\n          start = this.startMarker.cloneNode(true); end = this.endMarker.cloneNode(true);\n          span.insertBefore(start,span.firstChild); span.appendChild(end);\n          spans.push([span,start,end,span.style.position]); span.style.position = \"absolute\";\n        } else {\n          end = this.endMarker.cloneNode(true);\n          span.appendChild(end); spans.push([span,null,end]);\n        }\n      }\n      //\n      //  Read the widths and heights\n      //\n      for (i = 0, m = spans.length; i < m; i++) {\n        span = spans[i][0]; bbox = span.bbox; parent = this.parentNode(span);\n        if ((bbox.w >= 0 && !this.initialSkipBug) || this.negativeBBoxes || !span.firstChild) {\n          W = span.offsetWidth; parent.HH = parent.offsetHeight/this.em;\n        } else if (bbox.w < 0 && this.msieNegativeBBoxBug) {\n          W = -span.offsetWidth, parent.HH = parent.offsetHeight/this.em;\n        } else {\n          W = spans[i][2].offsetLeft - ((spans[i][1]||{}).offsetLeft||0);\n        }\n        W /= this.em;\n        bbox.rw += W - bbox.w;\n        bbox.w = W; bbox.exactW = true;\n        if (!parent.bbox) {parent.bbox = bbox}\n      }\n      //\n      //  Remove markers\n      //\n      for (i = 0, m = spans.length; i < m; i++) {\n        span = spans[i];\n        if (span[1]) {span[1].parentNode.removeChild(span[1]), span[0].style.position = span[3]}\n        if (span[2]) {span[2].parentNode.removeChild(span[2])}\n      }\n    },\n\n    Em: function (m) {\n      if (Math.abs(m) < .0006) {return \"0em\"}\n      return m.toFixed(3).replace(/\\.?0+$/,\"\") + \"em\";\n    },\n    EmRounded: function (m) {\n      m = (Math.round(m*HTMLCSS.em)+.05)/HTMLCSS.em;\n      if (Math.abs(m) < .0006) {return \"0em\"}\n      return m.toFixed(3).replace(/\\.?0+$/,\"\") + \"em\";\n    },\n    unEm: function (m) {\n      return parseFloat(m);\n    },\n    Px: function (m) {\n      m *= this.em; var s = (m < 0? \"-\" : \"\");\n      return s+Math.abs(m).toFixed(1).replace(/\\.?0+$/,\"\") + \"px\";\n    },\n    unPx: function (m) {\n      return parseFloat(m)/this.em;\n    },\n    Percent: function (m) {\n      return (100*m).toFixed(1).replace(/\\.?0+$/,\"\") + \"%\";\n    },\n    length2em: function (length,mu,size) {\n      if (typeof(length) !== \"string\") {length = length.toString()}\n      if (length === \"\") {return \"\"}\n      if (length === MML.SIZE.NORMAL) {return 1}\n      if (length === MML.SIZE.BIG)    {return 2}\n      if (length === MML.SIZE.SMALL)  {return .71}\n      if (length === \"infinity\")      {return HTMLCSS.BIGDIMEN}\n      var factor = this.FONTDATA.TeX_factor, emFactor = (HTMLCSS.zoomScale||1) / HTMLCSS.em;\n      if (length.match(/mathspace$/)) {return HTMLCSS.MATHSPACE[length]*factor}\n      var match = length.match(/^\\s*([-+]?(?:\\.\\d+|\\d+(?:\\.\\d*)?))?(pt|em|ex|mu|px|pc|in|mm|cm|%)?/);\n      var m = parseFloat(match[1]||\"1\"), unit = match[2];\n      if (size == null) {size = 1}; if (mu == null) {mu = 1}\n      if (unit === \"em\") {return m * factor}\n      if (unit === \"ex\") {return m * HTMLCSS.TeX.x_height * factor}\n      if (unit === \"%\")  {return m / 100 * size}\n      if (unit === \"px\") {return m * emFactor}\n      if (unit === \"pt\") {return m / 10 * factor}                      // 10 pt to an em\n      if (unit === \"pc\") {return m * 1.2 * factor}                     // 12 pt to a pc\n      if (unit === \"in\") {return m * this.pxPerInch * emFactor}\n      if (unit === \"cm\") {return m * this.pxPerInch * emFactor / 2.54} // 2.54 cm to an inch\n      if (unit === \"mm\") {return m * this.pxPerInch * emFactor / 25.4} // 10 mm to a cm\n      if (unit === \"mu\") {return m / 18 * factor * mu} // 18mu to an em for the scriptlevel\n      return m*size;  // relative to given size (or 1em as default)\n    },\n    thickness2em: function (length,mu) {\n      var thick = HTMLCSS.TeX.rule_thickness;\n      if (length === MML.LINETHICKNESS.MEDIUM) {return thick}\n      if (length === MML.LINETHICKNESS.THIN) {return .67*thick}\n      if (length === MML.LINETHICKNESS.THICK) {return 1.67*thick}\n      return this.length2em(length,mu,thick);\n    },\n    \n    getPadding: function (span) {\n      var padding = {top:0, right:0, bottom:0, left:0}, has = false;\n      for (var id in padding) {if (padding.hasOwnProperty(id)) {\n        var pad = span.style[\"padding\"+id.charAt(0).toUpperCase()+id.substr(1)];\n        if (pad) {padding[id] = this.length2em(pad); has = true;}\n      }}\n      return (has ? padding : false);\n    },\n    getBorders: function (span) {\n      var border = {top:0, right:0, bottom:0, left:0}, css = {}, has = false;\n      for (var id in border) {if (border.hasOwnProperty(id)) {\n        var ID = \"border\"+id.charAt(0).toUpperCase()+id.substr(1);\n        var style = span.style[ID+\"Style\"];\n        if (style) {\n          has = true;\n          border[id] = this.length2em(span.style[ID+\"Width\"]);\n          css[ID] = [span.style[ID+\"Width\"],span.style[ID+\"Style\"],span.style[ID+\"Color\"]].join(\" \");\n        }\n      }}\n      border.css = css;\n      return (has ? border : false);\n    },\n    setBorders: function (span,borders) {\n      if (borders) {\n        for (var id in borders.css) {if (borders.css.hasOwnProperty(id)) {\n          span.style[id] = borders.css[id];\n        }}\n      }\n    },\n\n    createStrut: function (span,h,before) {\n      var strut = this.Element(\"span\",{\n        isMathJax: true,\n        style:{display:\"inline-block\", overflow:\"hidden\", height:h+\"px\",\n               width:\"1px\", marginRight:\"-1px\"}\n      });\n      if (before) {span.insertBefore(strut,span.firstChild)} else {span.appendChild(strut)}\n      return strut;\n    },\n    createBlank: function (span,w,before) {\n      var blank = this.Element(\"span\",{\n        isMathJax: true,\n        style: {display:\"inline-block\", overflow:\"hidden\", height:\"1px\", width:this.Em(w)}\n      });\n      if (w < 0) {blank.style.marginRight = blank.style.width; blank.style.width = 0}\n      if (before) {span.insertBefore(blank,span.firstChild)} else {span.appendChild(blank)}\n      return blank;\n    },\n    createShift: function (span,w,before) {\n      var space = this.Element(\"span\",{style:{marginLeft:this.Em(w)}, isMathJax:true});\n      if (before) {span.insertBefore(space,span.firstChild)} else {span.appendChild(space)}\n      return space;\n    },\n    createSpace: function (span,h,d,w,color,isSpace) {\n      if (h < -d) {d = -h} // make sure h is above d\n      var H = this.Em(h+d), D = this.Em(-d);\n      if (this.msieInlineBlockAlignBug) {D = this.Em(HTMLCSS.getHD(span.parentNode,true).d-d)}\n      if (span.isBox || isSpace) {\n\tvar scale = (span.scale == null ? 1 : span.scale);\n\tspan.bbox = {exactW: true, h: h*scale, d: d*scale, w: w*scale, rw: w*scale, lw: 0};\n        span.style.height = H; span.style.verticalAlign = D;\n        span.HH = (h+d)*scale;\n      } else {\n        span = this.addElement(span,\"span\",{style: {height:H, verticalAlign:D}, isMathJax:true});\n      }\n      if (w >= 0) {\n        span.style.width = this.Em(w);\n        span.style.display = \"inline-block\";\n        span.style.overflow = \"hidden\";       // for IE in quirks mode\n      } else {\n        if (this.msieNegativeSpaceBug) {span.style.height = \"\"}\n        span.style.marginLeft = this.Em(w);\n        if (HTMLCSS.safariNegativeSpaceBug && span.parentNode.firstChild == span)\n          {this.createBlank(span,0,true)}\n      }\n      if (color && color !== MML.COLOR.TRANSPARENT) {\n        span.style.backgroundColor = color;\n        span.style.position = \"relative\"; // make sure it covers earlier items\n      }\n      return span;\n    },\n    createRule: function (span,h,d,w,color) {\n      if (h < -d) {d = -h} // make sure h is above d\n      var min = HTMLCSS.TeX.min_rule_thickness, f = 1;\n      // If rule is very thin, make it at least min_rule_thickness so it doesn't disappear\n      if (w > 0 && w*this.em < min) {w = min/this.em}\n      if (h+d > 0 && (h+d)*this.em < min) {f = 1/(h+d)*(min/this.em); h *= f; d *= f}\n      if (!color) {color = \"solid\"} else {color = \"solid \"+color}\n      var style = {display: \"inline-block\", overflow:\"hidden\", verticalAlign:this.Em(-d)};\n      if (w > h+d) {\n        style.borderTop = this.Px(h+d)+\" \"+color;\n        style.width = this.Em(w);\n        style.height = (this.msieRuleBug && h+d > 0 ? this.Em(h+d) : 0);\n      } else {\n        style.borderLeft = this.Px(w)+\" \"+color;\n        style.width = (this.msieRuleBug && w > 0 ? this.Em(w) : 0);\n        style.height = this.Em(h+d);\n      }\n      var rule = this.addElement(span,\"span\",{\n        style: style, noAdjust:true, HH:h+d, isMathJax:true,\n        bbox: {h:h, d:d, w:w, rw:w, lw:0, exactW:true}\n      });\n      if (span.isBox || span.className == \"mspace\") {span.bbox = rule.bbox, span.HH = h+d}\n      return rule;\n    },\n    createFrame: function (span,h,d,w,t,style) {\n      if (h < -d) {d = -h} // make sure h is above d\n      var T = 2*t;\n      if (this.msieFrameSizeBug) {if (w < T) {w = T}; if (h+d < T) {h = T-d}}\n      if (this.msieBorderWidthBug) {T = 0}\n      var H = this.Em(h+d-T), D = this.Em(-d-t), W = this.Em(w-T);\n      var B = this.Px(t)+\" \"+style;\n      var frame = this.addElement(span,\"span\",{\n        style: {border: B, display:\"inline-block\", overflow:\"hidden\", width:W, height:H},\n        bbox: {h:h, d:d, w:w, rw:w, lw:0, exactW:true}, noAdjust: true, HH:h+d, isMathJax:true\n      });\n      if (D) {frame.style.verticalAlign = D}\n      return frame;\n    },\n    \n    //\n    //  Find parent span (skipping over <a> tags)\n    //\n    parentNode: function (span) {\n      var parent = span.parentNode;\n      if (parent.nodeName.toLowerCase() === \"a\") {parent = parent.parentNode}\n      return parent;\n    },\n\n    createStack: function (span,nobbox,w) {\n      if (this.msiePaddingWidthBug) {this.createStrut(span,0)}\n      var relativeW = String(w).match(/%$/);\n      var W = (!relativeW && w != null ? w : 0);\n      span = this.addElement(span,\"span\",{\n        noAdjust: true, HH: 0, isMathJax: true,\n        style: {display:\"inline-block\", position:\"relative\",\n                width:(relativeW ? \"100%\" : this.Em(W)), height:0}\n      });\n      if (!nobbox) {\n        span.parentNode.bbox = span.bbox = {\n          exactW: true,\n          h: -this.BIGDIMEN, d: -this.BIGDIMEN,\n          w:W, lw: this.BIGDIMEN, rw: (!relativeW && w != null ? w : -this.BIGDIMEN)\n        };\n        if (relativeW) {span.bbox.width = w}\n      }\n      return span;\n    },\n    createBox: function (span,w) {\n      var box = this.addElement(span,\"span\",{style:{position:\"absolute\"}, isBox: true, isMathJax:true});\n      if (w != null) {box.style.width = w}\n      return box;\n    },\n    addBox: function (span,box) {\n      box.style.position = \"absolute\"; box.isBox = box.isMathJax = true;\n      return span.appendChild(box);\n    },\n    placeBox: function (span,x,y,noclip) {\n      span.isMathJax = true;\n      var parent = HTMLCSS.parentNode(span), bbox = span.bbox, BBOX = parent.bbox;\n      if (this.msiePlaceBoxBug) {this.addText(span,this.NBSP)}\n      if (this.imgSpaceBug) {this.addText(span,this.imgSpace)}\n      // Place the box\n      var HH, dx = 0;\n      if (span.HH != null) {HH = span.HH}\n        else if (bbox) {HH = Math.max(3,bbox.h+bbox.d)}\n        else {HH = span.offsetHeight/this.em}\n      if (!span.noAdjust) {\n        HH += 1;\n        HH = Math.round(HH*this.em)/this.em; // make this an integer number of pixels (for Chrome)\n        if (this.msieInlineBlockAlignBug) {\n          this.addElement(span,\"img\",{\n            className:\"MathJax_strut\", border:0, src:\"about:blank\", isMathJax:true,\n            style:{width:0,height:this.Em(HH)}\n          });\n        } else {\n          this.addElement(span,\"span\",{\n            isMathJax: true, style:{display:\"inline-block\",width:0,height:this.Em(HH)}\n          });\n          if (HTMLCSS.chromeHeightBug) \n            {HH -= (span.lastChild.offsetHeight - Math.round(HH*this.em))/this.em}\n        }\n      }\n      // Clip so that bbox doesn't include extra height and depth\n      if (bbox) {\n        if (this.initialSkipBug) {\n          if (bbox.lw < 0) {dx = bbox.lw; HTMLCSS.createBlank(span,-dx,true)}\n          if (bbox.rw > bbox.w) {HTMLCSS.createBlank(span,bbox.rw-bbox.w+.1)}\n        }\n        if (!this.msieClipRectBug && !bbox.noclip && !noclip) {\n          var dd = 3/this.em;\n          var H = (bbox.H == null ? bbox.h : bbox.H), D = (bbox.D == null ? bbox.d : bbox.D);\n          var t = HH - H - dd, b = HH + D + dd, l = -1000, r = bbox.rw+1000;\n          span.style.clip = \"rect(\"+this.Em(t)+\" \"+this.Em(r)+\" \"+this.Em(b)+\" \"+this.Em(l)+\")\";\n        }\n      }\n      // Place the box\n      span.style.top = this.Em(-y-HH);\n      span.style.left = this.Em(x+dx);\n      // Update the bounding box\n      if (bbox && BBOX) {\n        if (bbox.H != null && (BBOX.H == null || bbox.H + y > BBOX.H)) {BBOX.H = bbox.H + y}\n        if (bbox.D != null && (BBOX.D == null || bbox.D - y > BBOX.D)) {BBOX.D = bbox.D - y}\n        if (bbox.h + y > BBOX.h) {BBOX.h = bbox.h + y}\n        if (bbox.d - y > BBOX.d) {BBOX.d = bbox.d - y}\n        if (BBOX.H != null && BBOX.H <= BBOX.h) {delete BBOX.H}\n        if (BBOX.D != null && BBOX.D <= BBOX.d) {delete BBOX.D}\n        if (bbox.w + x > BBOX.w) {\n          BBOX.w = bbox.w + x;\n          if (BBOX.width == null) {parent.style.width = this.Em(BBOX.w)}\n        }\n        if (bbox.rw + x > BBOX.rw) {BBOX.rw = bbox.rw + x}\n        if (bbox.lw + x < BBOX.lw) {BBOX.lw = bbox.lw + x}\n        if (bbox.width != null && !bbox.isFixed) {\n          if (BBOX.width == null) {\n            parent.style.width = BBOX.width = \"100%\";\n            if (bbox.minWidth) {parent.style.minWidth = BBOX.minWidth = bbox.minWidth}\n          }\n          span.style.width = bbox.width;\n        }\n        if (bbox.tw) {BBOX.tw = bbox.tw}\n      }\n    },\n    alignBox: function (span,align,y,dx) {\n      if (dx == null) {dx = 0}\n      this.placeBox(span,dx,y); // set y position (and left aligned)\n      if (this.msiePlaceBoxBug) {\n        //\n        //  placeBox() adds an extra &nbsp;, so remove it here.\n        //\n        var node = span.lastChild;\n        while (node && node.nodeName !== \"#text\") {node = node.previousSibling}\n        if (node) {span.removeChild(node)}\n      }\n      var bbox = span.bbox; if (bbox.isMultiline) return;\n      var isRelative = bbox.width != null && !bbox.isFixed;\n      var r = 0, c = dx-bbox.w/2, l = \"50%\";\n      if (this.initialSkipBug) {r = bbox.w-bbox.rw-.1; c += bbox.lw}\n      if (this.msieMarginScaleBug) {c = (c*this.em) + \"px\"} else {c = this.Em(c)}\n      if (isRelative) {\n        c = (dx === 0 ? \"\" : this.Em(dx));\n        l = (50 - parseFloat(bbox.width)/2) + \"%\";\n      }\n      HUB.Insert(span.style,({\n        right:  {left:\"\", right: this.Em(r-dx)},\n        center: {left:l, marginLeft: c}\n      })[align]);\n    },\n    setStackWidth: function (span,w) {\n      if (typeof(w) === \"number\") {\n        span.style.width = this.Em(Math.max(0,w));\n        var bbox = span.bbox; if (bbox) {bbox.w = w; bbox.exactW = true};\n        bbox = span.parentNode.bbox; if (bbox) {bbox.w = w; bbox.exactW = true};\n      } else {\n        span.style.width = span.parentNode.style.width = \"100%\";\n        if (span.bbox) {span.bbox.width = w}\n        if (span.parentNode.bbox) {span.parentNode.bbox.width = w}\n      }\n    },\n\n    createDelimiter: function (span,code,HW,scale,font) {\n      if (!code) {\n        span.bbox = {h:0, d:0, w:this.TeX.nulldelimiterspace, lw: 0};\n        span.bbox.rw = span.bbox.w;\n        this.createSpace(span,span.bbox.h,span.bbox.d,span.bbox.w);\n        return;\n      }\n      if (!scale) {scale = 1};\n      if (!(HW instanceof Array)) {HW = [HW,HW]}\n      var hw = HW[1]; HW = HW[0];\n      var delim = {alias: code};\n      while (delim.alias) {\n        code = delim.alias; delim = this.FONTDATA.DELIMITERS[code];\n        if (!delim) {delim = {HW: [0,this.FONTDATA.VARIANT[MML.VARIANT.NORMAL]]}}\n      }\n      if (delim.load) {HUB.RestartAfter(AJAX.Require(this.fontDir+\"/fontdata-\"+delim.load+\".js\"))}\n      for (var i = 0, m = delim.HW.length; i < m; i++) {\n        if (delim.HW[i][0]*scale >= HW-.01 || (i == m-1 && !delim.stretch)) {\n          if (delim.HW[i][2]) {scale *= delim.HW[i][2]}\n          if (delim.HW[i][3]) {code = delim.HW[i][3]}\n          var chr = this.addElement(span,\"span\");\n          this.createChar(chr,[code,delim.HW[i][1]],scale,font);\n          span.bbox = chr.bbox;\n          span.offset = .65 * span.bbox.w;\n          span.scale = scale;\n          return;\n        }\n      }\n      if (delim.stretch) {this[\"extendDelimiter\"+delim.dir](span,hw,delim.stretch,scale,font)}\n    },\n    extendDelimiterV: function (span,H,delim,scale,font) {\n      var stack = this.createStack(span,true);\n      var top = this.createBox(stack), bot = this.createBox(stack);\n      this.createChar(top,(delim.top||delim.ext),scale,font);\n      this.createChar(bot,(delim.bot||delim.ext),scale,font);\n      var ext = {bbox:{w:0,lw:0,rw:0}}, mid = ext, EXT;\n      var h = top.bbox.h + top.bbox.d + bot.bbox.h + bot.bbox.d;\n      var y = -top.bbox.h; this.placeBox(top,0,y,true); y -= top.bbox.d;\n      if (delim.mid) {\n        mid = this.createBox(stack); this.createChar(mid,delim.mid,scale,font);\n        h += mid.bbox.h + mid.bbox.d;\n      }\n      if (delim.min && H < h*delim.min) {H = h*delim.min}\n      if (H > h) {\n        ext = this.Element(\"span\"); this.createChar(ext,delim.ext,scale,font);\n        var eH = ext.bbox.h + ext.bbox.d, eh = eH - .05, n, N, k = (delim.mid ? 2 : 1);\n        N = n = Math.min(Math.ceil((H-h)/(k*eh)), this.maxStretchyParts);\n        if (!delim.fullExtenders) {eh = (H-h)/(k*n)}\n        var dy = (n/(n+1))*(eH - eh); eh = eH - dy; y += dy + eh - ext.bbox.h;\n        while (k-- > 0) {\n          while (n-- > 0) {\n            if (!this.msieCloneNodeBug) {EXT = ext.cloneNode(true)}\n              else {EXT = this.Element(\"span\"); this.createChar(EXT,delim.ext,scale,font)}\n            EXT.bbox = ext.bbox;\n            y -= eh; this.placeBox(this.addBox(stack,EXT),0,y,true);\n          }\n          y += dy - ext.bbox.d;\n          if (delim.mid && k) {\n            this.placeBox(mid,0,y-mid.bbox.h,true); n = N;\n            y += -(mid.bbox.h + mid.bbox.d) + dy + eh - ext.bbox.h;\n          }\n        }\n      } else {\n        y += (h - H)/2;\n        if (delim.mid) {this.placeBox(mid,0,y-mid.bbox.h,true); y += -(mid.bbox.h + mid.bbox.d)}\n        y += (h - H)/2;\n      }\n      this.placeBox(bot,0,y-bot.bbox.h,true); y -= bot.bbox.h + bot.bbox.d;\n      span.bbox = {\n        w:  Math.max(top.bbox.w,ext.bbox.w,bot.bbox.w,mid.bbox.w),\n        lw: Math.min(top.bbox.lw,ext.bbox.lw,bot.bbox.lw,mid.bbox.lw),\n        rw: Math.max(top.bbox.rw,ext.bbox.rw,bot.bbox.rw,mid.bbox.rw),\n        h: 0, d: -y, exactW: true\n      }\n      span.scale = scale;\n      span.offset = .55 * span.bbox.w;\n      span.isMultiChar = true;\n      this.setStackWidth(stack,span.bbox.w);\n    },\n    extendDelimiterH: function (span,W,delim,scale,font) {\n      var stack = this.createStack(span,true);\n      var left = this.createBox(stack), right = this.createBox(stack);\n      this.createChar(left,(delim.left||delim.rep),scale,font);\n      this.createChar(right,(delim.right||delim.rep),scale,font);\n      var rep = this.Element(\"span\"); this.createChar(rep,delim.rep,scale,font);\n      var mid = {bbox: {h:-this.BIGDIMEN, d:-this.BIGDIMEN}}, REP;\n      this.placeBox(left,-left.bbox.lw,0,true);\n      var w = (left.bbox.rw - left.bbox.lw) + (right.bbox.rw - right.bbox.lw) - .05,\n          x = left.bbox.rw - left.bbox.lw - .025, dx;\n      if (delim.mid) {\n        mid = this.createBox(stack); this.createChar(mid,delim.mid,scale,font);\n        w += mid.bbox.w;\n      }\n      if (delim.min && W < w*delim.min) {W = w*delim.min}\n      if (W > w) {\n        var rW = rep.bbox.rw-rep.bbox.lw, rw = rW - .05, n, N, k = (delim.mid ? 2 : 1);\n        N = n = Math.min(Math.ceil((W-w)/(k*rw)), this.maxStretchyParts);\n        if (!delim.fillExtenders) {rw = (W-w)/(k*n)}\n        dx = (n/(n+1))*(rW - rw); rw = rW - dx; x -= rep.bbox.lw + dx;\n        while (k-- > 0) {\n          while (n-- > 0) {\n            if (!this.cloneNodeBug) {REP = rep.cloneNode(true)}\n              else {REP = this.Element(\"span\"); this.createChar(REP,delim.rep,scale,font)}\n            REP.bbox = rep.bbox;\n            this.placeBox(this.addBox(stack,REP),x,0,true); x += rw;\n          }\n          if (delim.mid && k) {this.placeBox(mid,x,0,true); x += mid.bbox.w - dx; n = N}\n        }\n      } else {\n        x -= (w - W)/2;\n        if (delim.mid) {this.placeBox(mid,x,0,true); x += mid.bbox.w};\n        x -= (w - W)/2;\n      }\n      this.placeBox(right,x,0,true);\n      span.bbox = {\n        w: x+right.bbox.rw, lw: 0, rw: x+right.bbox.rw,\n        h: Math.max(left.bbox.h,rep.bbox.h,right.bbox.h,mid.bbox.h),\n        d: Math.max(left.bbox.d,rep.bbox.d,right.bbox.d,mid.bbox.d),\n        exactW: true\n      }\n      span.scale = scale;\n      span.isMultiChar = true;\n      this.setStackWidth(stack,span.bbox.w);\n    },\n    createChar: function (span,data,scale,font) {\n      span.isMathJax = true;\n      var SPAN = span, text = \"\", variant = {fonts: [data[1]], noRemap:true};\n      if (font && font === MML.VARIANT.BOLD) {variant.fonts = [data[1]+\"-bold\",data[1]]}\n      if (typeof(data[1]) !== \"string\") {variant = data[1]}\n      if (data[0] instanceof Array) {\n        for (var i = 0, m = data[0].length; i < m; i++) {text += String.fromCharCode(data[0][i])}\n      } else {text = String.fromCharCode(data[0])}\n      if (data[4]) {scale *= data[4]}\n      if (scale !== 1 || data[3]) {\n\tSPAN = this.addElement(span,\"span\",{style:{fontSize: this.Percent(scale)}, scale:scale, isMathJax:true});\n        this.handleVariant(SPAN,variant,text);\n        span.bbox = SPAN.bbox;\n      } else {this.handleVariant(span,variant,text)}\n      if (data[2]) {span.style.marginLeft = this.Em(data[2])}     // x offset\n      if (data[3]) {                                              // y offset\n        span.firstChild.style.verticalAlign = this.Em(data[3]);\n        span.bbox.h += data[3]; if (span.bbox.h < 0) {span.bbox.h = 0}\n      }\n      if (data[5]) {span.bbox.h += data[5]}  // extra height\n      if (data[6]) {span.bbox.d += data[6]}  // extra depth\n      //  Handle combining characters by adding a non-breaking space so it shows up\n      if (this.AccentBug && span.bbox.w === 0) {SPAN.firstChild.nodeValue += this.NBSP}\n    },\n    positionDelimiter: function (span,h) {\n      h -= span.bbox.h; span.bbox.d -= h; span.bbox.h += h;\n      if (h) {\n        if (this.safariVerticalAlignBug || this.konquerorVerticalAlignBug ||\n           (this.operaVerticalAlignBug && span.isMultiChar)) {\n          if (span.firstChild.style.display === \"\" && span.style.top !== \"\")\n            {span = span.firstChild; h -= HTMLCSS.unEm(span.style.top)}\n          span.style.position = \"relative\";\n          span.style.top = this.Em(-h);\n        } else {\n          span.style.verticalAlign = this.Em(h);\n\t  if (HTMLCSS.ffVerticalAlignBug) {\n\t    HTMLCSS.createRule(span.parentNode,span.bbox.h,0,0);\n\t    delete span.parentNode.bbox;\n\t  }\n        }\n      }\n    },\n\n    handleVariant: function (span,variant,text) {\n      var newtext = \"\", n, c, font, VARIANT, SPAN = span, force = !!span.style.fontFamily;\n      if (text.length === 0) return;\n      if (!span.bbox) {\n        span.bbox = {\n          w: 0, h: -this.BIGDIMEN, d: -this.BIGDIMEN,\n          rw: -this.BIGDIMEN, lw: this.BIGDIMEN\n        };\n      }\n      if (!variant) {variant = this.FONTDATA.VARIANT[MML.VARIANT.NORMAL]}\n      VARIANT = variant;\n      for (var i = 0, m = text.length; i < m; i++) {\n        variant = VARIANT;\n        n = text.charCodeAt(i); c = text.charAt(i);\n        if (n >= 0xD800 && n < 0xDBFF) {\n          i++; n = (((n-0xD800)<<10)+(text.charCodeAt(i)-0xDC00))+0x10000;\n          if (this.FONTDATA.RemapPlane1) {\n            var nv = this.FONTDATA.RemapPlane1(n,variant);\n            n = nv.n; variant = nv.variant;\n          }\n        } else {\n          var id, M, RANGES = this.FONTDATA.RANGES;\n          for (id = 0, M = RANGES.length; id < M; id++) {\n            if (RANGES[id].name === \"alpha\" && variant.noLowerCase) continue;\n            var N = variant[\"offset\"+RANGES[id].offset];\n            if (N && n >= RANGES[id].low && n <= RANGES[id].high) {\n              if (RANGES[id].remap && RANGES[id].remap[n]) {\n                n = N + RANGES[id].remap[n];\n              } else {\n                n = n - RANGES[id].low + N;\n                if (RANGES[id].add) {n += RANGES[id].add}\n              }\n              if (variant[\"variant\"+RANGES[id].offset])\n                {variant = this.FONTDATA.VARIANT[variant[\"variant\"+RANGES[id].offset]]}\n              break;\n            }\n          }\n        }\n        if (variant.remap && variant.remap[n]) {\n          n = variant.remap[n];\n          if (variant.remap.variant) {variant = this.FONTDATA.VARIANT[variant.remap.variant]}\n        } else if (this.FONTDATA.REMAP[n] && !variant.noRemap) {\n          n = this.FONTDATA.REMAP[n];\n        }\n        if (n instanceof Array) {variant = this.FONTDATA.VARIANT[n[1]]; n = n[0]} \n        if (typeof(n) === \"string\") {\n          text = n+text.substr(i+1);\n          m = text.length; i = -1;\n          continue;\n        }\n        font = this.lookupChar(variant,n); c = font[n];\n        if (force || (!this.checkFont(font,SPAN.style) && !c[5].img)) {\n          if (newtext.length) {this.addText(SPAN,newtext); newtext = \"\"};\n          var addSpan = !!SPAN.style.fontFamily || !!span.style.fontStyle ||\n                        !!span.style.fontWeight || !font.directory || force; force = false;\n          if (SPAN !== span) {addSpan = !this.checkFont(font,span.style); SPAN = span}\n          if (addSpan) {SPAN = this.addElement(span,\"span\",{isMathJax:true, subSpan:true})}\n          this.handleFont(SPAN,font,SPAN !== span);\n        }\n        newtext = this.handleChar(SPAN,font,c,n,newtext);\n        if (!(c[5]||{}).space) {\n          if (c[0]/1000 > span.bbox.h) {span.bbox.h = c[0]/1000}\n          if (c[1]/1000 > span.bbox.d) {span.bbox.d = c[1]/1000}\n        }\n        if (span.bbox.w + c[3]/1000 < span.bbox.lw) {span.bbox.lw = span.bbox.w + c[3]/1000}\n        if (span.bbox.w + c[4]/1000 > span.bbox.rw) {span.bbox.rw = span.bbox.w + c[4]/1000}\n        span.bbox.w += c[2]/1000;\n        if ((c[5]||{}).isUnknown) span.bbox.exactW = false;  // force measurement\n      }\n      if (newtext.length) {this.addText(SPAN,newtext)}\n      if (span.scale && span.scale !== 1) {\n        span.bbox.h *= span.scale; span.bbox.d *= span.scale;\n        span.bbox.w *= span.scale; span.bbox.lw *= span.scale; span.bbox.rw *= span.scale;\n      }\n      if (text.length == 1 && font.skew && font.skew[n]) {span.bbox.skew = font.skew[n]}\n    },\n    checkFont: function (font,style) {\n      var weight = (style.fontWeight||\"normal\");\n      if (weight.match(/^\\d+$/)) {weight = (parseInt(weight) >= 600 ? \"bold\" : \"normal\")}\n      return (font.family.replace(/'/g,\"\") === style.fontFamily.replace(/'/g,\"\") &&\n             (font.style||\"normal\") === (style.fontStyle||\"normal\") &&\n             (font.weight||\"normal\") === weight);\n    },\n\n    handleFont: function (span,font,force) {\n      span.style.fontFamily = font.family;\n      if (!font.directory)\n        {span.style.fontSize = Math.floor(HTMLCSS.config.scale/HTMLCSS.scale+.5) + \"%\"}\n      if (!(HTMLCSS.FontFaceBug && font.isWebFont)) {\n        var style  = font.style  || \"normal\", weight = font.weight || \"normal\";\n        if (style !== \"normal\"  || force) {span.style.fontStyle  = style}\n        if (weight !== \"normal\" || force) {span.style.fontWeight = weight}\n      }\n    },\n\n    handleChar: function (span,font,c,n,text) {\n      var C = c[5];\n      if (C.space) {\n        if (text.length) {this.addText(span,text)}\n        HTMLCSS.createShift(span,c[2]/1000);\n        return \"\";\n      }\n      if (C.img) {return this.handleImg(span,font,c,n,text)}\n      if (C.isUnknown && this.FONTDATA.DELIMITERS[n]) {\n        if (text.length) {this.addText(span,text)}\n        var scale = span.scale;\n        HTMLCSS.createDelimiter(span,n,0,1,font);\n        if (this.FONTDATA.DELIMITERS[n].dir === \"V\") {\n          span.style.verticalAlign = this.Em(span.bbox.d);\n          span.bbox.h += span.bbox.d; span.bbox.d = 0;\n        }\n        span.scale = scale;\n        c[0] = span.bbox.h*1000; c[1] = span.bbox.d*1000;\n        c[2] = span.bbox.w*1000; c[3] = span.bbox.lw*1000; c[4] = span.bbox.rw*1000;\n        return \"\";\n      }\n      if (C.c == null) {\n        if (n <= 0xFFFF) {C.c = String.fromCharCode(n)} else {\n          var N = n - 0x10000;\n          C.c = String.fromCharCode((N>>10)+0xD800)\n              + String.fromCharCode((N&0x3FF)+0xDC00);\n        }\n      }\n      if (HTMLCSS.ffFontOptimizationBug && c[4] - c[2] > 125)\n        {span.style.textRendering = \"optimizeLegibility\"}\n      if (C.rfix) {this.addText(span,text+C.c); HTMLCSS.createShift(span,C.rfix/1000); return \"\"}\n      if (c[2] || !this.msieAccentBug || text.length) {return text + C.c}\n      //  Handle IE accent clipping bug\n      HTMLCSS.createShift(span,c[3]/1000);\n      HTMLCSS.createShift(span,(c[4]-c[3])/1000);\n      this.addText(span,C.c);\n      HTMLCSS.createShift(span,-c[4]/1000);\n      return \"\";\n    },\n    handleImg: function (span,font,c,n,text) {return text}, // replaced by imageFont extension\n\n    lookupChar: function (variant,n) {\n      var i, m;\n      if (!variant.FONTS) {\n        var FONTS = this.FONTDATA.FONTS;\n        var fonts = (variant.fonts || this.FONTDATA.VARIANT.normal.fonts);\n        if (!(fonts instanceof Array)) {fonts = [fonts]}\n        if (variant.fonts != fonts) {variant.fonts = fonts}\n        variant.FONTS = [];\n        for (i = 0, m = fonts.length; i < m; i++) {\n          if (FONTS[fonts[i]]) {\n            variant.FONTS.push(FONTS[fonts[i]]);\n            FONTS[fonts[i]].name = fonts[i]; // FIXME: should really be in the font files\n          }\n        }\n      }\n      for (i = 0, m = variant.FONTS.length; i < m; i++) {\n        var font = variant.FONTS[i];\n        if (typeof(font) === \"string\") {\n          delete variant.FONTS; this.loadFont(font);\n        }\n        if (font[n]) {\n          if (font[n].length === 5) {font[n][5] = {}}\n          if (HTMLCSS.allowWebFonts && !font.available)\n            {this.loadWebFont(font)} else {return font}\n        } else {this.findBlock(font,n)}\n      }\n      return this.unknownChar(variant,n);\n    },\n    \n    unknownChar: function (variant,n) {\n      var unknown = (variant.defaultFont || {family:HTMLCSS.config.undefinedFamily});\n      if (variant.bold) {unknown.weight = \"bold\"}; if (variant.italic) {unknown.style = \"italic\"}\n      if (!unknown[n]) {unknown[n] = [800,200,500,0,500,{isUnknown:true}]} // [h,d,w,lw,rw,{data}]\n      HUB.signal.Post([\"HTML-CSS Jax - unknown char\",n,variant]);\n      return unknown;\n    },\n\n    findBlock: function (font,c) {\n      if (font.Ranges) {\n        // FIXME:  do binary search?\n        for (var i = 0, m = font.Ranges.length; i < m; i++) {\n          if (c <  font.Ranges[i][0]) return;\n          if (c <= font.Ranges[i][1]) {\n            var file = font.Ranges[i][2];\n            for (var j = font.Ranges.length-1; j >= 0; j--)\n              {if (font.Ranges[j][2] == file) {font.Ranges.splice(j,1)}}\n            this.loadFont(font.directory+\"/\"+file+\".js\");\n          }\n        }\n      }\n    },\n\n    loadFont: function (file) {\n      var queue = MathJax.Callback.Queue();\n      queue.Push([\"Require\",AJAX,this.fontDir+\"/\"+file]);\n      if (this.imgFonts) {\n        if (!MathJax.isPacked) {file = file.replace(/\\/([^\\/]*)$/,HTMLCSS.imgPacked+\"/$1\")}\n        queue.Push([\"Require\",AJAX,this.webfontDir+\"/png/\"+file]);\n      }\n      HUB.RestartAfter(queue.Push({}));\n    },\n\n    loadWebFont: function (font) {\n      font.available = font.isWebFont = true;\n      if (HTMLCSS.FontFaceBug) {\n        font.family = font.name;\n        if (HTMLCSS.msieFontCSSBug) {font.family += \"-Web\"}\n      }\n      HUB.RestartAfter(this.Font.loadWebFont(font));\n    },\n    loadWebFontError: function (font,done) {\n      //\n      //  After the first web font fails to load, switch to image fonts, if possible\n      //  otherwise, give up on web fonts all together\n      // \n      HUB.Startup.signal.Post(\"HTML-CSS Jax - disable web fonts\");\n      font.isWebFont = false;\n      if (this.config.imageFont && this.config.imageFont === this.fontInUse) {\n        this.imgFonts = true;\n        HUB.Startup.signal.Post(\"HTML-CSS Jax - switch to image fonts\");\n        HUB.Startup.signal.Post(\"HTML-CSS Jax - using image fonts\");\n        MESSAGE([\"WebFontNotAvailable\",\"Web-Fonts not available -- using image fonts instead\"],null,3000);\n        AJAX.Require(this.directory+\"/imageFonts.js\",done);\n      } else {\n        this.allowWebFonts = false;\n        done();\n      }\n    },\n\n    Element: MathJax.HTML.Element,\n    addElement: MathJax.HTML.addElement,\n    TextNode: MathJax.HTML.TextNode,\n    addText: MathJax.HTML.addText,\n    ucMatch: MathJax.HTML.ucMatch,\n\n    BIGDIMEN: 10000000,\n    ID: 0, idPostfix: \"\",\n    GetID: function () {this.ID++; return this.ID},\n\n    MATHSPACE: {\n      veryverythinmathspace:  1/18,\n      verythinmathspace:      2/18,\n      thinmathspace:          3/18,\n      mediummathspace:        4/18,\n      thickmathspace:         5/18,\n      verythickmathspace:     6/18,\n      veryverythickmathspace: 7/18,\n      negativeveryverythinmathspace:  -1/18,\n      negativeverythinmathspace:      -2/18,\n      negativethinmathspace:          -3/18,\n      negativemediummathspace:        -4/18,\n      negativethickmathspace:         -5/18,\n      negativeverythickmathspace:     -6/18,\n      negativeveryverythickmathspace: -7/18\n    },\n\n    TeX: {\n      x_height:         .430554,\n      quad:             1,\n      num1:             .676508,\n      num2:             .393732,\n      num3:             .44373,\n      denom1:           .685951,\n      denom2:           .344841,\n      sup1:             .412892,\n      sup2:             .362892,\n      sup3:             .288888,\n      sub1:             .15,\n      sub2:             .247217,\n      sup_drop:         .386108,\n      sub_drop:         .05,\n      delim1:          2.39,\n      delim2:          1.0,\n      axis_height:      .25,\n      rule_thickness:   .06,\n      big_op_spacing1:  .111111,\n      big_op_spacing2:  .166666,\n      big_op_spacing3:  .2,\n      big_op_spacing4:  .6,\n      big_op_spacing5:  .1,\n\n      scriptspace:         .1,\n      nulldelimiterspace:  .12,\n      delimiterfactor:     901,\n      delimitershortfall:   .3,\n\n      min_rule_thickness:  1.25     // in pixels\n    },\n\n    NBSP: \"\\u00A0\",\n\n    rfuzz: 0         // adjustment to rule placements in roots\n  });\n\n  MathJax.Hub.Register.StartupHook(\"mml Jax Ready\",function () {\n\n    MML = MathJax.ElementJax.mml;\n\n    MML.mbase.Augment({\n      toHTML: function (span) {\n\tspan = this.HTMLcreateSpan(span); if (this.type != \"mrow\") {span = this.HTMLhandleSize(span)}\n\tfor (var i = 0, m = this.data.length; i < m; i++)\n\t  {if (this.data[i]) {this.data[i].toHTML(span)}}\n\tvar stretchy = this.HTMLcomputeBBox(span);\n\tvar h = span.bbox.h, d = span.bbox.d, stretched = false, bbox;\n\tfor (i = 0, m = stretchy.length; i < m; i++) {\n          bbox = stretchy[i].HTMLspanElement().bbox;\n          if (stretchy[i].forceStretch || bbox.h !== h || bbox.d !== d)\n            {stretchy[i].HTMLstretchV(span,h,d); stretched = true}\n          else if (stretchy[i].needsBBox) stretched = true;\n        }\n\tif (stretched) {this.HTMLcomputeBBox(span,true)}\n        if (this.HTMLlineBreaks(span)) {span = this.HTMLmultiline(span)}\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n        if (this.data.length === 1 && this.data[0]) {\n          // copy skew data from accented character\n          bbox = this.data[0].HTMLspanElement().bbox;\n          if (bbox.skew) span.bbox.skew = bbox.skew;\n        }\n\treturn span;\n      },\n      HTMLlineBreaks: function () {return false},\n      HTMLmultiline: function () {MML.mbase.HTMLautoloadFile(\"multiline\")},\n      HTMLcomputeBBox: function (span,full,i,m) {\n\tif (i == null) {i = 0}; if (m == null) {m = this.data.length}\n\tvar BBOX = span.bbox = {exactW: true}, stretchy = [];\n\twhile (i < m) {\n\t  var core = this.data[i]; if (!core) continue;\n\t  if (!full && core.HTMLcanStretch(\"Vertical\")) {\n            stretchy.push(core);\n            core = (core.CoreMO()||core);\n            stretchy[stretchy.length-1].needsBBox = (core !== this.data[i]);\n          }\n\t  this.HTMLcombineBBoxes(core,BBOX); i++;\n\t}\n\tthis.HTMLcleanBBox(BBOX);\n\treturn stretchy;\n      },\n      HTMLcombineBBoxes: function (core,BBOX) {\n\tif (BBOX.w == null) {this.HTMLemptyBBox(BBOX)}\n\tvar child = (core.bbox ? core : core.HTMLspanElement());\n        if (!child || !child.bbox) return;\n\tvar bbox = child.bbox;\n\tif (bbox.d > BBOX.d) {BBOX.d = bbox.d}\n\tif (bbox.h > BBOX.h) {BBOX.h = bbox.h}\n\tif (bbox.D != null && bbox.D > BBOX.D) {BBOX.D = bbox.D}\n\tif (bbox.H != null && bbox.H > BBOX.H) {BBOX.H = bbox.H}\n\tif (child.style.paddingLeft) {BBOX.w += HTMLCSS.unEm(child.style.paddingLeft)*(child.scale||1)}\n\tif (BBOX.w + bbox.lw < BBOX.lw) {BBOX.lw = BBOX.w + bbox.lw}\n\tif (BBOX.w + bbox.rw > BBOX.rw) {BBOX.rw = BBOX.w + bbox.rw}\n\tBBOX.w += bbox.w;\n\tif (child.style.paddingRight) {BBOX.w += HTMLCSS.unEm(child.style.paddingRight)*(child.scale||1)}\n\tif (bbox.width) {BBOX.width = bbox.width; BBOX.minWidth = bbox.minWidth}\n        if (bbox.tw) {BBOX.tw = bbox.tw}\n        if (bbox.ic) {BBOX.ic = bbox.ic} else {delete BBOX.ic}\n        if (BBOX.exactW && !bbox.exactW) {BBOX.exactW = bbox.exactW}\n      },\n      HTMLemptyBBox: function (BBOX) {\n\tBBOX.h = BBOX.d = BBOX.H = BBOX.D = BBOX.rw = -HTMLCSS.BIGDIMEN;\n\tBBOX.w = 0; BBOX.lw = HTMLCSS.BIGDIMEN;\n\treturn BBOX;\n      },\n      HTMLcleanBBox: function (BBOX) {\n\tif (BBOX.h === this.BIGDIMEN)\n\t  {BBOX.h = BBOX.d = BBOX.H = BBOX.D = BBOX.w = BBOX.rw = BBOX.lw = 0}\n\tif (BBOX.D <= BBOX.d) {delete BBOX.D}; if (BBOX.H <= BBOX.h) {delete BBOX.H}\n      },\n      HTMLzeroBBox: function () {return {h:0, d:0, w:0, lw: 0, rw:0}},\n      HTMLcanStretch: function (direction) {\n\tif (this.isEmbellished()) {\n          var core = this.Core();\n          if (core && core !== this) {return core.HTMLcanStretch(direction)}\n        }\n\treturn false;\n      },\n      HTMLstretchH: function (box,W) {return this.HTMLspanElement()},\n      HTMLstretchV: function (box,h,d) {return this.HTMLspanElement()},\n      HTMLnotEmpty: function (data) {\n\twhile (data) {\n\t  if ((data.type !== \"mrow\" && data.type !== \"texatom\") ||\n\t       data.data.length > 1) {return true}\n\t  data = data.data[0];\n\t}\n\treturn false;\n      },\n\n      HTMLmeasureChild: function (n,box) {\n\tif (this.data[n]) {HTMLCSS.Measured(this.data[n].toHTML(box),box)}\n\t  else {box.bbox = this.HTMLzeroBBox()}\n      },\n      HTMLboxChild: function (n,box) {\n        if (!this.data[n]) {this.SetData(n,MML.mrow())}\n\treturn this.data[n].toHTML(box);\n      },\n\n      HTMLcreateSpan: function (span) {\n\tif (this.spanID) {\n\t  var SPAN = this.HTMLspanElement();\n\t  if (SPAN && (SPAN.parentNode === span || (SPAN.parentNode||{}).parentNode === span)) {\n\t    while (SPAN.firstChild) {SPAN.removeChild(SPAN.firstChild)}\n\t    SPAN.bbox = this.HTMLzeroBBox();\n\t    SPAN.scale = 1; SPAN.isMultChar = SPAN.HH = null;\n\t    SPAN.style.cssText = \"\";\n\t    return SPAN;\n\t  }\n\t}\n\tif (this.href) {span = HTMLCSS.addElement(span,\"a\",{href:this.href, isMathJax:true})}\n\tspan = HTMLCSS.addElement(span,\"span\",{className: this.type, isMathJax:true});\n\tif (HTMLCSS.imgHeightBug) {span.style.display = \"inline-block\"}\n\tif (this[\"class\"]) {span.className += \" \"+this[\"class\"]}\n\tif (!this.spanID) {this.spanID = HTMLCSS.GetID()}\n\tspan.id = (this.id || \"MathJax-Span-\"+this.spanID) + HTMLCSS.idPostfix;\n\tspan.bbox = this.HTMLzeroBBox(); this.styles = {};\n\tif (this.style) {\n\t  span.style.cssText = this.style;\n\t  if (span.style.fontSize) {this.mathsize = span.style.fontSize; span.style.fontSize = \"\"}\n          this.styles = {border:HTMLCSS.getBorders(span), padding:HTMLCSS.getPadding(span)}\n          if (this.styles.border) {span.style.border = \"\"} // IE needs \"0px none\"?\n          if (this.styles.padding) {span.style.padding = \"\"}\n\t}\n\tif (this.href) {span.parentNode.bbox = span.bbox}\n        this.HTMLaddAttributes(span);\n\treturn span;\n      },\n      HTMLaddAttributes: function(span) {\n        //\n        //  Copy RDFa, aria, and other tags from the MathML to the HTML-CSS\n        //  output spans.  Don't copy those in the MML.nocopyAttributes list,\n        //  the ignoreMMLattributes configuration list, or anything that\n        //  already exists as a property of the span (e.g., no \"onlick\", etc.)\n        //  If a name in the ignoreMMLattributes object is set to false, then\n        //  the attribute WILL be copied.\n        //\n        if (this.attrNames) {\n          var copy = this.attrNames, skip = MML.nocopyAttributes, ignore = HUB.config.ignoreMMLattributes;\n          var defaults = (this.type === \"mstyle\" ? MML.math.prototype.defaults : this.defaults);\n          for (var i = 0, m = copy.length; i < m; i++) {\n            var id = copy[i];\n            if (ignore[id] == false || (!skip[id] && !ignore[id] &&\n                defaults[id] == null && typeof(span[id]) === \"undefined\")) {\n              span.setAttribute(id,this.attr[id])\n            }\n          }\n        }\n      },\n      HTMLspanElement: function () {\n\tif (!this.spanID) {return null}\n\treturn document.getElementById((this.id||\"MathJax-Span-\"+this.spanID)+HTMLCSS.idPostfix);\n      },\n\n      HTMLhandleVariant: function (span,variant,text) {HTMLCSS.handleVariant(span,variant,text)},\n\n      HTMLhandleSize: function (span) {\n\tif (!span.scale) {\n\t  span.scale = this.HTMLgetScale();\n\t  if (span.scale !== 1) {span.style.fontSize = HTMLCSS.Percent(span.scale)}\n\t}\n\treturn span;\n      },\n\n      HTMLhandleDir: function (span) {\n        var dir = this.Get(\"dir\",true); // only get value if not the default\n        if (dir) {span.dir = dir}\n        return span;\n      },\n\n      HTMLhandleColor: function (span) {\n\tvar values = this.getValues(\"mathcolor\",\"color\");\n\tif (this.mathbackground) {values.mathbackground = this.mathbackground}\n\tif (this.background) {values.background = this.background}\n        if (this.style && span.style.backgroundColor) {\n          values.mathbackground = span.style.backgroundColor;\n          span.style.backgroundColor = \"transparent\";\n        }\n        var borders = (this.styles||{}).border, padding = (this.styles||{}).padding;\n\tif (values.color && !this.mathcolor) {values.mathcolor = values.color}\n\tif (values.background && !this.mathbackground) {values.mathbackground = values.background}\n\tif (values.mathcolor) {span.style.color = values.mathcolor}\n\tif ((values.mathbackground && values.mathbackground !== MML.COLOR.TRANSPARENT) || \n             borders || padding) {\n\t  var bbox = span.bbox, dd = (bbox.exact ? 0 : 1/HTMLCSS.em), lW = 0, rW = 0,\n              lpad = span.style.paddingLeft, rpad = span.style.paddingRight;\n\t  if (this.isToken) {lW = bbox.lw; rW = bbox.rw - bbox.w}\n\t  if (lpad !== \"\") {lW += HTMLCSS.unEm(lpad)*(span.scale||1)}\n\t  if (rpad !== \"\") {rW -= HTMLCSS.unEm(rpad)*(span.scale||1)}\n          var dw = (HTMLCSS.PaddingWidthBug || bbox.keepPadding || bbox.exactW ? 0 : rW - lW);\n\t  var W = Math.max(0,HTMLCSS.getW(span) + dw);\n\t  var H = bbox.h + bbox.d, D = -bbox.d, lp = 0, rp = 0;\n\t  if (W > 0) {W += 2*dd; lW -= dd}; if (H > 0) {H += 2*dd; D -= dd}; rW = -W-lW;\n          if (borders) {\n            rW -= borders.right; D -= borders.bottom; lp += borders.left; rp += borders.right;\n            bbox.h += borders.top; bbox.d += borders.bottom;\n            bbox.w += borders.left + borders.right;\n            bbox.lw -= borders.left; bbox.rw += borders.right;\n          }\n          if (padding) {\n            H += padding.top + padding.bottom; W += padding.left + padding.right;\n            rW -= padding.right; D -= padding.bottom; lp += padding.left; rp += padding.right;\n            bbox.h += padding.top; bbox.d += padding.bottom;\n            bbox.w += padding.left + padding.right;\n            bbox.lw -= padding.left; bbox.rw += padding.right;\n          }\n          if (rp) {span.style.paddingRight = HTMLCSS.Em(rp)}\n\t  var frame = HTMLCSS.Element(\"span\",{\n            id:\"MathJax-Color-\"+this.spanID+HTMLCSS.idPostfix, isMathJax: true,\n\t    style:{display:\"inline-block\", backgroundColor:values.mathbackground,\n\t\t   width: HTMLCSS.Em(W), height:HTMLCSS.Em(H), verticalAlign: HTMLCSS.Em(D),\n\t\t   marginLeft: HTMLCSS.Em(lW), marginRight: HTMLCSS.Em(rW)}\n\t  });\n          HTMLCSS.setBorders(frame,borders);\n          if (bbox.width) {frame.style.width = bbox.width; frame.style.marginRight = \"-\"+bbox.width}\n\t  if (HTMLCSS.msieInlineBlockAlignBug) {\n            // FIXME:  handle variable width background\n\t    frame.style.position = \"relative\"; frame.style.width = frame.style.height = 0;\n\t    frame.style.verticalAlign = frame.style.marginLeft = frame.style.marginRight = \"\";\n            frame.style.border = frame.style.padding = \"\";\n            if (borders && HTMLCSS.msieBorderWidthBug)\n              {H += borders.top + borders.bottom; W += borders.left + borders.right}\n            frame.style.width = HTMLCSS.Em(lp+dd);\n\t    HTMLCSS.placeBox(HTMLCSS.addElement(frame,\"span\",{\n\t      noAdjust: true, isMathJax: true,\n\t      style: {display:\"inline-block\", position:\"absolute\", overflow:\"hidden\",\n\t\t      background:(values.mathbackground||\"transparent\"), \n                      width: HTMLCSS.Em(W), height: HTMLCSS.Em(H)}\n\t    }),lW,bbox.h+dd);\n            HTMLCSS.setBorders(frame.firstChild,borders);\n\t  }\n\t  span.parentNode.insertBefore(frame,span);\n          if (HTMLCSS.msieColorPositionBug) {span.style.position = \"relative\"}\n\t  return frame;\n\t}\n\treturn null;\n      },\n      HTMLremoveColor: function () {\n\tvar color = document.getElementById(\"MathJax-Color-\"+this.spanID+HTMLCSS.idPostfix);\n\tif (color) {color.parentNode.removeChild(color)}\n      },\n\n      HTMLhandleSpace: function (span) {\n\tif (this.useMMLspacing) {\n\t  if (this.type !== \"mo\") return;\n\t  var values = this.getValues(\"scriptlevel\",\"lspace\",\"rspace\");\n          if (values.scriptlevel <= 0 || this.hasValue(\"lspace\") || this.hasValue(\"rspace\")) {\n            var mu = this.HTMLgetMu(span);\n\t    values.lspace = Math.max(0,HTMLCSS.length2em(values.lspace,mu));\n\t    values.rspace = Math.max(0,HTMLCSS.length2em(values.rspace,mu));\n\t    var core = this, parent = this.Parent();\n\t    while (parent && parent.isEmbellished() && parent.Core() === core)\n\t      {core = parent; parent = parent.Parent(); span = core.HTMLspanElement()}\n\t    if (values.lspace) {span.style.paddingLeft =  HTMLCSS.Em(values.lspace)}\n\t    if (values.rspace) {span.style.paddingRight = HTMLCSS.Em(values.rspace)}\n\t  }\n\t} else {\n\t  var space = this.texSpacing();\n\t  if (space !== \"\") {\n            this.HTMLgetScale();\n\t    space = HTMLCSS.length2em(space,this.scale)/(span.scale||1)*this.mscale;\n\t    if (span.style.paddingLeft) {space += HTMLCSS.unEm(span.style.paddingLeft)}\n\t    span.style.paddingLeft = HTMLCSS.Em(space);\n\t  }\n\t}\n      },\n\n      HTMLgetScale: function () {\n        if (this.scale) {return this.scale * this.mscale}\n\tvar scale = 1, values = this.getValues(\"scriptlevel\",\"fontsize\");\n        values.mathsize = (this.isToken ? this : this.Parent()).Get(\"mathsize\");\n\tif (this.style) {\n\t  var span = this.HTMLspanElement();\n\t  if (span.style.fontSize != \"\") {values.fontsize = span.style.fontSize}\n\t}\n\tif (values.fontsize && !this.mathsize) {values.mathsize = values.fontsize}\n\tif (values.scriptlevel !== 0) {\n\t  if (values.scriptlevel > 2) {values.scriptlevel = 2}\n\t  scale = Math.pow(this.Get(\"scriptsizemultiplier\"),values.scriptlevel);\n\t  values.scriptminsize = HTMLCSS.length2em(this.Get(\"scriptminsize\"));\n\t  if (scale < values.scriptminsize) {scale = values.scriptminsize}\n\t}\n        this.scale = scale; this.mscale = HTMLCSS.length2em(values.mathsize);\n\treturn scale * this.mscale;\n      },\n      HTMLgetMu: function (span) {\n\tvar mu = 1, values = this.getValues(\"scriptlevel\",\"scriptsizemultiplier\");\n        if (span.scale && span.scale !== 1) {mu = 1/span.scale}\n\tif (values.scriptlevel !== 0) {\n\t  if (values.scriptlevel > 2) {values.scriptlevel = 2}\n\t  mu = Math.sqrt(Math.pow(values.scriptsizemultiplier,values.scriptlevel));\n\t}\n\treturn mu;\n      },\n\n      HTMLgetVariant: function () {\n\tvar values = this.getValues(\"mathvariant\",\"fontfamily\",\"fontweight\",\"fontstyle\");\n        values.hasVariant = this.Get(\"mathvariant\",true);  // null if not explicitly specified\n        if (!values.hasVariant) {\n          values.family = values.fontfamily;\n          values.weight = values.fontweight;\n          values.style  = values.fontstyle;\n        }\n\tif (this.style) {\n          var span = this.HTMLspanElement();\n\t  if (!values.family && span.style.fontFamily) {values.family = span.style.fontFamily}\n\t  if (!values.weight && span.style.fontWeight) {values.weight = span.style.fontWeight}\n\t  if (!values.style  && span.style.fontStyle)  {values.style  = span.style.fontStyle}\n\t}\n        if (values.weight && values.weight.match(/^\\d+$/))\n            {values.weight = (parseInt(values.weight) > 600 ? \"bold\" : \"normal\")}\n\tvar variant = values.mathvariant; if (this.variantForm) {variant = \"-\"+HTMLCSS.fontInUse+\"-variant\"}\n\tif (values.family && !values.hasVariant) {\n\t  if (!values.weight && values.mathvariant.match(/bold/)) {values.weight = \"bold\"}\n\t  if (!values.style && values.mathvariant.match(/italic/)) {values.style = \"italic\"}\n\t  return {FONTS:[], fonts:[], noRemap:true,\n\t\t  defaultFont: {family:values.family, style:values.style, weight:values.weight}};\n\t}\n        if (values.weight === \"bold\") {\n          variant = {\n            normal:MML.VARIANT.BOLD, italic:MML.VARIANT.BOLDITALIC,\n            fraktur:MML.VARIANT.BOLDFRAKTUR, script:MML.VARIANT.BOLDSCRIPT,\n            \"sans-serif\":MML.VARIANT.BOLDSANSSERIF,\n            \"sans-serif-italic\":MML.VARIANT.SANSSERIFBOLDITALIC\n          }[variant]||variant;\n        } else if (values.weight === \"normal\") {\n          variant = {\n            bold:MML.VARIANT.normal, \"bold-italic\":MML.VARIANT.ITALIC,\n            \"bold-fraktur\":MML.VARIANT.FRAKTUR, \"bold-script\":MML.VARIANT.SCRIPT,\n            \"bold-sans-serif\":MML.VARIANT.SANSSERIF,\n            \"sans-serif-bold-italic\":MML.VARIANT.SANSSERIFITALIC\n          }[variant]||variant;\n        }\n        if (values.style === \"italic\") {\n          variant = {\n            normal:MML.VARIANT.ITALIC, bold:MML.VARIANT.BOLDITALIC,\n            \"sans-serif\":MML.VARIANT.SANSSERIFITALIC,\n            \"bold-sans-serif\":MML.VARIANT.SANSSERIFBOLDITALIC\n          }[variant]||variant;\n        } else if (values.style === \"normal\") {\n          variant = {\n            italic:MML.VARIANT.NORMAL, \"bold-italic\":MML.VARIANT.BOLD,\n            \"sans-serif-italic\":MML.VARIANT.SANSSERIF,\n            \"sans-serif-bold-italic\":MML.VARIANT.BOLDSANSSERIF\n          }[variant]||variant;\n        }\n        if (!(variant in HTMLCSS.FONTDATA.VARIANT)) {\n          // If the mathvariant value is invalid or not supported by this\n          // font, fallback to normal. See issue 363.\n          variant = \"normal\";\n        }\n        return HTMLCSS.FONTDATA.VARIANT[variant];\n      },\n      \n      HTMLdrawBBox: function (span) {\n        var bbox = span.bbox;\n        var box = HTMLCSS.Element(\"span\",\n          {style:{\"font-size\":span.style.fontSize, display:\"inline-block\",\n                  opacity:.25,\"margin-left\":HTMLCSS.Em(-bbox.w)}},[\n          [\"span\",{style:{\n            height:HTMLCSS.Em(bbox.h),width:HTMLCSS.Em(bbox.w),\n            \"background-color\":\"red\", display:\"inline-block\"\n          }}],\n          [\"span\",{style:{\n            height:HTMLCSS.Em(bbox.d),width:HTMLCSS.Em(bbox.w),\n            \"margin-left\":HTMLCSS.Em(-bbox.w),\"vertical-align\":HTMLCSS.Em(-bbox.d),\n            \"background-color\":\"green\", display:\"inline-block\"\n          }}]\n        ]);\n        if (span.nextSibling) {span.parentNode.insertBefore(box,span.nextSibling)}\n          else {span.parentNode.appendChild(box)}\n      }\n\n    },{\n      HTMLautoload: function () {\n\tvar file = HTMLCSS.autoloadDir+\"/\"+this.type+\".js\";\n\tHUB.RestartAfter(AJAX.Require(file));\n      },\n      HTMLautoloadFile: function (name) {\n\tvar file = HTMLCSS.autoloadDir+\"/\"+name+\".js\";\n\tHUB.RestartAfter(AJAX.Require(file));\n      },\n\n      HTMLstretchH: function (box,w) {\n\tthis.HTMLremoveColor();\n\treturn this.toHTML(box,w);\n      },\n\n      HTMLstretchV: function (box,h,d) {\n\tthis.HTMLremoveColor();\n\treturn this.toHTML(box,h,d);\n      }\n    });\n\n    MML.chars.Augment({\n      toHTML: function (span,variant,remap,chars) {\n        var text = this.data.join(\"\").replace(/[\\u2061-\\u2064]/g,\"\"); // remove invisibles\n        if (remap) {text = remap(text,chars)}\n        if (variant.fontInherit) {\n          var scale = Math.floor(HTMLCSS.config.scale/HTMLCSS.scale+.5) + \"%\";\n          HTMLCSS.addElement(span,\"span\",{style:{\"font-size\":scale}},[text]);\n          if (variant.bold)   {span.lastChild.style.fontWeight = \"bold\"}\n          if (variant.italic) {span.lastChild.style.fontStyle = \"italic\"}\n          span.bbox = null;\n          var HD = HTMLCSS.getHD(span), W = HTMLCSS.getW(span);\n          span.bbox = {h:HD.h, d:HD.d, w:W, lw:0, rw:W, exactW: true};\n        } else {\n          this.HTMLhandleVariant(span,variant,text);\n        }\n      }\n    });\n    MML.entity.Augment({\n      toHTML: function (span,variant,remap,chars) {\n        var text = this.toString().replace(/[\\u2061-\\u2064]/g,\"\"); // remove invisibles\n        if (remap) {text = remap(text,chars)}\n        if (variant.fontInherit) {\n          var scale = Math.floor(HTMLCSS.config.scale/HTMLCSS.scale+.5) + \"%\";\n          HTMLCSS.addElement(span,\"span\",{style:{\"font-size\":scale}},[text]);\n          if (variant.bold)   {span.lastChild.style.fontWeight = \"bold\"}\n          if (variant.italic) {span.lastChild.style.fontStyle = \"italic\"}\n          delete span.bbox;\n          var HD = HTMLCSS.getHD(span), W = HTMLCSS.getW(span);\n          span.bbox = {h:HD.h, d:HD.d, w:W, lw:0, rw:W, exactW: true};\n        } else {\n          this.HTMLhandleVariant(span,variant,text);\n        }\n      }\n    });\n\n    MML.mi.Augment({\n      toHTML: function (span) {\n\tspan = this.HTMLhandleSize(this.HTMLcreateSpan(span)); span.bbox = null;\n\tvar variant = this.HTMLgetVariant();\n\tfor (var i = 0, m = this.data.length; i < m; i++)\n\t  {if (this.data[i]) {this.data[i].toHTML(span,variant)}}\n\tif (!span.bbox) {span.bbox = this.HTMLzeroBBox()}\n        var text = this.data.join(\"\"), bbox = span.bbox;\n\tif (bbox.skew && text.length !== 1) {delete bbox.skew}\n        if (bbox.rw > bbox.w && text.length === 1 && !variant.noIC) {\n          bbox.ic = bbox.rw - bbox.w;\n          HTMLCSS.createBlank(span,bbox.ic/this.mscale);\n          bbox.w = bbox.rw;\n        }\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n        this.HTMLhandleDir(span);\n\treturn span;\n      }\n    });\n\n    MML.mn.Augment({\n      toHTML: function (span) {\n\tspan = this.HTMLhandleSize(this.HTMLcreateSpan(span)); span.bbox = null;\n\tvar variant = this.HTMLgetVariant();\n\tfor (var i = 0, m = this.data.length; i < m; i++)\n\t  {if (this.data[i]) {this.data[i].toHTML(span,variant)}}\n\tif (!span.bbox) {span.bbox = this.HTMLzeroBBox()}\n\tif (this.data.join(\"\").length !== 1) {delete span.bbox.skew}\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n        this.HTMLhandleDir(span);\n\treturn span;\n      }\n    });\n\n    MML.mo.Augment({\n      toHTML: function (span) {\n\tspan = this.HTMLhandleSize(this.HTMLcreateSpan(span));\n\tif (this.data.length == 0) {return span} else {span.bbox = null}\n\tvar text = this.data.join(\"\");\n        //\n        //  Get the variant, and check for operator size\n        //\n\tvar variant = this.HTMLgetVariant();\n\tvar values = this.getValues(\"largeop\",\"displaystyle\");\n\tif (values.largeop)\n\t  {variant = HTMLCSS.FONTDATA.VARIANT[values.displaystyle ? \"-largeOp\" : \"-smallOp\"]}\n        //\n        //  Get character translation for superscript and accents\n        //\n        var parent = this.CoreParent(),\n            isScript = (parent && parent.isa(MML.msubsup) && this !== parent.data[parent.base]),\n            mapchars = (isScript?this.remapChars:null);\n        if (text.length === 1 && parent && parent.isa(MML.munderover) &&\n            this.CoreText(parent.data[parent.base]).length === 1) {\n          var over = parent.data[parent.over], under = parent.data[parent.under];\n          if (over && this === over.CoreMO() && parent.Get(\"accent\")) {mapchars = HTMLCSS.FONTDATA.REMAPACCENT}\n          else if (under && this === under.CoreMO() && parent.Get(\"accentunder\")) {mapchars = HTMLCSS.FONTDATA.REMAPACCENTUNDER}\n        }\n        //\n        //  STIX and TeX fonts need quotes from variant font\n        //\n        if (isScript && text.match(/['`\"\\u00B4\\u2032-\\u2037\\u2057]/))\n          {variant = HTMLCSS.FONTDATA.VARIANT[\"-\"+HTMLCSS.fontInUse+\"-variant\"]}\n        //\n        //  Typeset contents\n        //\n\tfor (var i = 0, m = this.data.length; i < m; i++)\n          {if (this.data[i]) {this.data[i].toHTML(span,variant,this.remap,mapchars)}}\n\tif (!span.bbox) {span.bbox = this.HTMLzeroBBox()}\n\tif (text.length !== 1) {delete span.bbox.skew}\n        //\n        //  Handle combining characters by adding a non-breaking space and removing that width\n        //\n\tif (HTMLCSS.AccentBug && span.bbox.w === 0 && text.length === 1 && span.firstChild) {\n\t  span.firstChild.nodeValue += HTMLCSS.NBSP;\n\t  HTMLCSS.createSpace(span,0,0,-span.offsetWidth/HTMLCSS.em);\n\t}\n        //\n        //  Handle large operator centering\n        //\n\tif (values.largeop) {\n          var a = HTMLCSS.TeX.axis_height * this.scale * this.mscale\n\t  var p = (span.bbox.h - span.bbox.d)/2 - a;\n\t  if (HTMLCSS.safariVerticalAlignBug && span.lastChild.nodeName === \"IMG\") {\n\t    span.lastChild.style.verticalAlign =\n\t      HTMLCSS.Em(HTMLCSS.unEm(span.lastChild.style.verticalAlign||0)/HTMLCSS.em-p/span.scale);\n\t  } else if (HTMLCSS.konquerorVerticalAlignBug && span.lastChild.nodeName === \"IMG\") {\n\t    span.style.position = \"relative\";\n\t    span.lastChild.style.position=\"relative\";\n\t    span.lastChild.style.top = HTMLCSS.Em(p/span.scale);\n\t  } else {\n\t    span.style.verticalAlign = HTMLCSS.Em(-p/span.scale);\n\t  }\n\t  span.bbox.h -= p; span.bbox.d += p;\n\t  if (span.bbox.rw > span.bbox.w) {\n\t    span.bbox.ic = span.bbox.rw-span.bbox.w;\n\t    HTMLCSS.createBlank(span,span.bbox.ic/this.mscale);\n\t    span.bbox.w = span.bbox.rw;\n\t  }\n\t}\n        //\n        //  Finish up\n        //\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n        this.HTMLhandleDir(span);\n\treturn span;\n      },\n      HTMLcanStretch: function (direction) {\n\tif (!this.Get(\"stretchy\")) {return false}\n\tvar c = this.data.join(\"\");\n\tif (c.length > 1) {return false}\n        var parent = this.CoreParent();\n        if (parent && parent.isa(MML.munderover) && \n            this.CoreText(parent.data[parent.base]).length === 1) {\n          var over = parent.data[parent.over], under = parent.data[parent.under];\n          if (over && this === over.CoreMO() && parent.Get(\"accent\")) {c = HTMLCSS.FONTDATA.REMAPACCENT[c]||c}\n          else if (under && this === under.CoreMO() && parent.Get(\"accentunder\")) {c = HTMLCSS.FONTDATA.REMAPACCENTUNDER[c]||c}\n        }\n\tc = HTMLCSS.FONTDATA.DELIMITERS[c.charCodeAt(0)];\n        var stretch = (c && c.dir === direction.substr(0,1));\n        this.forceStretch = (stretch && (this.Get(\"minsize\",true) || this.Get(\"maxsize\",true)));\n\treturn stretch;\n      },\n      HTMLstretchV: function (box,h,d) {\n\tthis.HTMLremoveColor();\n\tvar values = this.getValues(\"symmetric\",\"maxsize\",\"minsize\");\n\tvar span = this.HTMLspanElement(), mu = this.HTMLgetMu(span), H;\n\tvar scale = this.HTMLgetScale(), axis = HTMLCSS.TeX.axis_height * scale;\n\tif (values.symmetric) {H = 2*Math.max(h-axis,d+axis)} else {H = h + d}\n\tvalues.maxsize = HTMLCSS.length2em(values.maxsize,mu,span.bbox.h+span.bbox.d);\n\tvalues.minsize = HTMLCSS.length2em(values.minsize,mu,span.bbox.h+span.bbox.d);\n\tH = Math.max(values.minsize,Math.min(values.maxsize,H));\n        if (H != values.minsize)\n          {H = [Math.max(H*HTMLCSS.TeX.delimiterfactor/1000,H-HTMLCSS.TeX.delimitershortfall),H]}\n\tspan = this.HTMLcreateSpan(box); // clear contents and attributes\n\tHTMLCSS.createDelimiter(span,this.data.join(\"\").charCodeAt(0),H,scale);\n\tif (values.symmetric) {H = (span.bbox.h + span.bbox.d)/2 + axis}\n\t  else {H = (span.bbox.h + span.bbox.d) * h/(h + d)}\n\tHTMLCSS.positionDelimiter(span,H);\n\tthis.HTMLhandleSpace(span); // add in lspace/rspace, if any\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLstretchH: function (box,W) {\n\tthis.HTMLremoveColor();\n\tvar values = this.getValues(\"maxsize\",\"minsize\",\"mathvariant\",\"fontweight\");\n        // FIXME:  should take style=\"font-weight:bold\" into account as well\n\tif ((values.fontweight === \"bold\" || parseInt(values.fontweight) >= 600) &&\n            !this.Get(\"mathvariant\",true)) {values.mathvariant = MML.VARIANT.BOLD}\n\tvar span = this.HTMLspanElement(), mu = this.HTMLgetMu(span), scale = span.scale;\n\tvalues.maxsize = HTMLCSS.length2em(values.maxsize,mu,span.bbox.w);\n\tvalues.minsize = HTMLCSS.length2em(values.minsize,mu,span.bbox.w);\n\tW = Math.max(values.minsize,Math.min(values.maxsize,W));\n\tspan = this.HTMLcreateSpan(box); // clear contents and attributes\n\tHTMLCSS.createDelimiter(span,this.data.join(\"\").charCodeAt(0),W,scale,values.mathvariant);\n\tthis.HTMLhandleSpace(span); // add in lspace/rspace, if any\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      }\n    });\n\n    MML.mtext.Augment({\n      toHTML: function (span) {\n        span = this.HTMLhandleSize(this.HTMLcreateSpan(span)); \n        var variant = this.HTMLgetVariant();\n        //  Avoid setting the font style for error text or if mtextFontInherit is set\n        if (HTMLCSS.config.mtextFontInherit || this.Parent().type === \"merror\") {\n          var vname = this.Get(\"mathvariant\");\n          if (vname === \"monospace\") {span.className += \" MJX-monospace\"}\n            else if (vname.match(/sans-serif/)) {span.className += \" MJX-sans-serif\"}\n          variant = {bold:variant.bold, italic:variant.italic, fontInherit: true};\n        }\n        for (var i = 0, m = this.data.length; i < m; i++)\n          {if (this.data[i]) {this.data[i].toHTML(span,variant)}}\n        if (!span.bbox) {span.bbox = this.HTMLzeroBBox()}\n        if (this.data.join(\"\").length !== 1) {delete span.bbox.skew}\n        this.HTMLhandleSpace(span);\n        this.HTMLhandleColor(span);\n        this.HTMLhandleDir(span);\n        return span;\n      }\n    });\n    MML.merror.Augment({\n      toHTML: function (span) {\n        //\n        //  Width doesn't include padding and border, so use an extra inline block\n        //  element to capture it.\n        //  \n        var SPAN = MathJax.HTML.addElement(span,\"span\",{style:{display:\"inline-block\"}});\n        span = this.SUPER(arguments).toHTML.call(this,SPAN);\n        var HD = HTMLCSS.getHD(SPAN), W = HTMLCSS.getW(SPAN);\n        SPAN.bbox = {h:HD.h, d:HD.d, w:W, lw:0, rw:W, exactW: true};\n        SPAN.id = span.id; span.id = null;\n        return SPAN;\n      }\n    });\n\n    MML.ms.Augment({toHTML: MML.mbase.HTMLautoload});\n\n    MML.mglyph.Augment({toHTML: MML.mbase.HTMLautoload});\n\n    MML.mspace.Augment({\n      toHTML: function (span) {\n\tspan = this.HTMLcreateSpan(span);\n\tvar values = this.getValues(\"height\",\"depth\",\"width\");\n        var mu = this.HTMLgetMu(span); this.HTMLgetScale();\n\tvalues.mathbackground = this.mathbackground;\n\tif (this.background && !this.mathbackground) {values.mathbackground = this.background}\n\tvar h = HTMLCSS.length2em(values.height,mu) * this.mscale,\n            d = HTMLCSS.length2em(values.depth,mu) * this.mscale,\n\t    w = HTMLCSS.length2em(values.width,mu) * this.mscale;\n       HTMLCSS.createSpace(span,h,d,w,values.mathbackground,true);\n       return span;\n      }\n    });\n\n    MML.mphantom.Augment({\n      toHTML: function (span,HW,D) {\n\tspan = this.HTMLcreateSpan(span);\n\tif (this.data[0] != null) {\n\t  var box = this.data[0].toHTML(span);\n\t  if (D != null) {HTMLCSS.Remeasured(this.data[0].HTMLstretchV(span,HW,D),span)}\n\t  else if (HW != null) {HTMLCSS.Remeasured(this.data[0].HTMLstretchH(span,HW),span)}\n          else {box = HTMLCSS.Measured(box,span)}\n\t  span.bbox = {w: box.bbox.w, h: box.bbox.h, d: box.bbox.d, lw: 0, rw: 0, exactW: true};\n\t  for (var i = 0, m = span.childNodes.length; i < m; i++)\n\t    {span.childNodes[i].style.visibility = \"hidden\"}\n\t}\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLstretchH: MML.mbase.HTMLstretchH,\n      HTMLstretchV: MML.mbase.HTMLstretchV\n    });\n\n    MML.mpadded.Augment({\n      toHTML: function (span,HW,D) {\n\tspan = this.HTMLcreateSpan(span);\n\tif (this.data[0] != null) {\n\t  var stack = HTMLCSS.createStack(span,true);\n\t  var box = HTMLCSS.createBox(stack);\n          var child = this.data[0].toHTML(box);\n\t  if (D != null) {HTMLCSS.Remeasured(this.data[0].HTMLstretchV(box,HW,D),box)}\n\t  else if (HW != null) {HTMLCSS.Remeasured(this.data[0].HTMLstretchH(box,HW),box)}\n          else {HTMLCSS.Measured(child,box)}\n\t  var values = this.getValues(\"height\",\"depth\",\"width\",\"lspace\",\"voffset\"),\n              x = 0, y = 0, mu = this.HTMLgetMu(span);\n          this.HTMLgetScale();\n\t  if (values.lspace)  {x = this.HTMLlength2em(box,values.lspace,mu)}\n\t  if (values.voffset) {y = this.HTMLlength2em(box,values.voffset,mu)}\n\t  HTMLCSS.placeBox(box,x,y); x /= this.mscale; y /= this.mscale;\n\t  span.bbox = {\n\t    h: box.bbox.h, d: box.bbox.d, w: box.bbox.w, exactW: true,\n            lw: box.bbox.lw+x, rw: box.bbox.rw+x,\n            H: Math.max((box.bbox.H == null ? -HTMLCSS.BIGDIMEN : box.bbox.H+y),box.bbox.h+y),\n            D: Math.max((box.bbox.D == null ? -HTMLCSS.BIGDIMEN : box.bbox.D-y),box.bbox.d-y)\n\t  };\n\t  if (values.height !== \"\") {span.bbox.h = this.HTMLlength2em(box,values.height,mu,\"h\",0)}\n\t  if (values.depth  !== \"\") {span.bbox.d = this.HTMLlength2em(box,values.depth,mu,\"d\",0)}\n\t  if (values.width  !== \"\") {span.bbox.w = this.HTMLlength2em(box,values.width,mu,\"w\",0)}\n\t  if (span.bbox.H <= span.bbox.h) {delete span.bbox.H}\n\t  if (span.bbox.D <= span.bbox.d) {delete span.bbox.D}\n          var dimen = /^\\s*(\\d+(\\.\\d*)?|\\.\\d+)\\s*(pt|em|ex|mu|px|pc|in|mm|cm)\\s*$/\n          span.bbox.exact = !!((this.data[0] && this.data[0].data.length == 0) ||\n             dimen.exec(values.height) || dimen.exec(values.width) || dimen.exec(values.depth));\n\t  HTMLCSS.setStackWidth(stack,span.bbox.w);\n\t}\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLlength2em: function (span,length,mu,d,m) {\n\tif (m == null) {m = -HTMLCSS.BIGDIMEN}\n\tvar match = String(length).match(/width|height|depth/);\n\tvar size = (match ? span.bbox[match[0].charAt(0)] : (d ? span.bbox[d] : 0));\n\tvar v = HTMLCSS.length2em(length,mu,size/this.mscale) * this.mscale;\n\tif (d && String(length).match(/^\\s*[-+]/))\n\t  {return Math.max(m,span.bbox[d]+v)} else {return v}\n      },\n      HTMLstretchH: MML.mbase.HTMLstretchH,\n      HTMLstretchV: MML.mbase.HTMLstretchV\n    });\n\n    MML.mrow.Augment({\n      HTMLlineBreaks: function (span) {\n        if (!this.parent.linebreakContainer) {return false}\n        return (HTMLCSS.config.linebreaks.automatic &&\n                span.bbox.w > HTMLCSS.linebreakWidth) || this.hasNewline();\n      },\n      HTMLstretchH: function (box,w) {\n\tthis.HTMLremoveColor();\n\tvar span = this.HTMLspanElement();\n\tthis.data[this.core].HTMLstretchH(span,w);\n\tthis.HTMLcomputeBBox(span,true);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLstretchV: function (box,h,d) {\n\tthis.HTMLremoveColor();\n\tvar span = this.HTMLspanElement();\n\tthis.data[this.core].HTMLstretchV(span,h,d);\n\tthis.HTMLcomputeBBox(span,true);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      }\n    });\n\n    MML.mstyle.Augment({\n      toHTML: function (span,HW,D) {\n\tspan = this.HTMLcreateSpan(span);\n\tif (this.data[0] != null) {\n\t  var SPAN = this.data[0].toHTML(span);\n\t  if (D != null) {this.data[0].HTMLstretchV(span,HW,D)}\n\t  else if (HW != null) {this.data[0].HTMLstretchH(span,HW)}\n          span.bbox = SPAN.bbox;\n\t}\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLstretchH: MML.mbase.HTMLstretchH,\n      HTMLstretchV: MML.mbase.HTMLstretchV\n    });\n\n    MML.mfrac.Augment({\n      toHTML: function (span) {\n\tspan = this.HTMLcreateSpan(span);\n\tvar frac = HTMLCSS.createStack(span);\n\tvar num = HTMLCSS.createBox(frac), den = HTMLCSS.createBox(frac);\n        HTMLCSS.MeasureSpans([this.HTMLboxChild(0,num),this.HTMLboxChild(1,den)]);\n        var values = this.getValues(\"displaystyle\",\"linethickness\",\"numalign\",\"denomalign\",\"bevelled\");\n\tvar scale = this.HTMLgetScale(), isDisplay = values.displaystyle;\n\tvar a = HTMLCSS.TeX.axis_height * scale;\n\tif (values.bevelled) {\n\t  var delta = (isDisplay ? .4 : .15);\n\t  var H = Math.max(num.bbox.h+num.bbox.d,den.bbox.h+den.bbox.d)+2*delta;\n\t  var bevel = HTMLCSS.createBox(frac);\n\t  HTMLCSS.createDelimiter(bevel,0x2F,H);\n\t  HTMLCSS.placeBox(num,0,(num.bbox.d-num.bbox.h)/2+a+delta);\n\t  HTMLCSS.placeBox(bevel,num.bbox.w-delta/2,(bevel.bbox.d-bevel.bbox.h)/2+a);\n\t  HTMLCSS.placeBox(den,num.bbox.w+bevel.bbox.w-delta,(den.bbox.d-den.bbox.h)/2+a-delta);\n\t} else {\n\t  var W = Math.max(num.bbox.w,den.bbox.w);\n\t  var t = HTMLCSS.thickness2em(values.linethickness,this.scale)*this.mscale, p,q, u,v;\n\t  var mt = HTMLCSS.TeX.min_rule_thickness/this.em;\n\t  if (isDisplay) {u = HTMLCSS.TeX.num1; v = HTMLCSS.TeX.denom1}\n\t    else {u = (t === 0 ? HTMLCSS.TeX.num3 : HTMLCSS.TeX.num2); v = HTMLCSS.TeX.denom2}\n\t  u *= scale; v *= scale;\n\t  if (t === 0) {// \\atop\n\t    p = Math.max((isDisplay ? 7 : 3) * HTMLCSS.TeX.rule_thickness, 2*mt); // force to at least 2 px\n\t    q = (u - num.bbox.d) - (den.bbox.h - v);\n\t    if (q < p) {u += (p - q)/2; v += (p - q)/2}\n\t  } else {// \\over\n\t    p = Math.max((isDisplay ? 2 : 0) * mt + t, t/2 + 1.5*mt);  // force to be at least 1.5px\n\t    q = (u - num.bbox.d) - (a + t/2); if (q < p) {u += p - q}\n\t    q = (a - t/2) - (den.bbox.h - v); if (q < p) {v += p - q}\n\t    var rule = HTMLCSS.createBox(frac);\n\t    HTMLCSS.createRule(rule,t,0,W+2*t);\n\t    HTMLCSS.placeBox(rule,0,a-t/2);\n\t  }\n\t  HTMLCSS.alignBox(num,values.numalign,u);\n\t  HTMLCSS.alignBox(den,values.denomalign,-v);\n\t}\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLcanStretch: function (direction) {return false},\n      HTMLhandleSpace: function (span) {\n\tif (!this.texWithDelims && !this.useMMLspacing) {\n          //\n          //  Add nulldelimiterspace around the fraction\n          //  (TeXBook pg 150 and Appendix G rule 15e)\n          //\n          var space = HTMLCSS.TeX.nulldelimiterspace * this.mscale;\n          var style = span.childNodes[HTMLCSS.msiePaddingWidthBug ? 1 : 0].style;\n          style.marginLeft = style.marginRight = HTMLCSS.Em(space);\n          span.bbox.w += 2*space; span.bbox.rw += 2*space;\n\t}\n        this.SUPER(arguments).HTMLhandleSpace.call(this,span);\n      }\n    });\n\n    MML.msqrt.Augment({\n      toHTML: function (span) {\n\tspan = this.HTMLcreateSpan(span);\n\tvar sqrt = HTMLCSS.createStack(span);\n\tvar base = HTMLCSS.createBox(sqrt),\n\t    rule = HTMLCSS.createBox(sqrt),\n\t    surd = HTMLCSS.createBox(sqrt);\n\tvar scale = this.HTMLgetScale();\n\tvar t = HTMLCSS.TeX.rule_thickness * scale, p,q, H, W;\n\tif (this.Get(\"displaystyle\")) {p = HTMLCSS.TeX.x_height * scale} else {p = t}\n\tq = Math.max(t + p/4,1.5*HTMLCSS.TeX.min_rule_thickness/this.em); // force to be at least 1px\n\tvar BASE = this.HTMLboxChild(0,base);\n\tH = BASE.bbox.h + BASE.bbox.d + q + t;\n        HTMLCSS.createDelimiter(surd,0x221A,H,scale);\n\tHTMLCSS.MeasureSpans([BASE,surd]);\n\tW = BASE.bbox.w;\n\tvar x = 0;\n\tif (surd.isMultiChar || (HTMLCSS.AdjustSurd && HTMLCSS.imgFonts)) {surd.bbox.w *= .95}\n\tif (surd.bbox.h + surd.bbox.d > H) {q = ((surd.bbox.h+surd.bbox.d) - (H-t))/2}\n\tvar ruleC = HTMLCSS.FONTDATA.DELIMITERS[HTMLCSS.FONTDATA.RULECHAR];\n\tif (!ruleC || W < ruleC.HW[0][0]*scale || scale < .75) {\n\t  HTMLCSS.createRule(rule,0,t,W);\n\t} else {\n\t  HTMLCSS.createDelimiter(rule,HTMLCSS.FONTDATA.RULECHAR,W,scale);\n\t}\n\tH = BASE.bbox.h + q + t;\n        q = H*HTMLCSS.rfuzz; if (surd.isMultiChar) {q = HTMLCSS.rfuzz}\n\tx = this.HTMLaddRoot(sqrt,surd,x,surd.bbox.h+surd.bbox.d-H,scale);\n\tHTMLCSS.placeBox(surd,x,H-surd.bbox.h);\n\tHTMLCSS.placeBox(rule,x+surd.bbox.w,H-rule.bbox.h+q);\n\tHTMLCSS.placeBox(base,x+surd.bbox.w,0);\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLaddRoot: function (sqrt,surd,x,d,scale) {return x}\n    });\n\n    MML.mroot.Augment({\n      toHTML: MML.msqrt.prototype.toHTML,\n      HTMLaddRoot: function (sqrt,surd,x,d,scale) {\n\tvar box = HTMLCSS.createBox(sqrt);\n\tif (this.data[1]) {\n\t  var root = this.data[1].toHTML(box);\n\t  root.style.paddingRight = root.style.paddingLeft = \"\"; // remove extra padding, if any\n\t  HTMLCSS.Measured(root,box);\n\t} else {box.bbox = this.HTMLzeroBBox()}\n\tvar h = this.HTMLrootHeight(surd.bbox.h+surd.bbox.d,scale,box)-d;\n\tvar w = Math.min(box.bbox.w,box.bbox.rw); // remove extra right-hand padding, if any\n\tx = Math.max(w,surd.offset);\n\tHTMLCSS.placeBox(box,x-w,h);\n\treturn x - surd.offset;\n      },\n      HTMLrootHeight: function (d,scale,root) {\n\treturn .45*(d-.9*scale)+.6*scale + Math.max(0,root.bbox.d-.075);\n      }\n    });\n\n    MML.mfenced.Augment({\n      toHTML: function (span) {\n\tspan = this.HTMLcreateSpan(span);\n\tif (this.data.open) {this.data.open.toHTML(span)}\n\tif (this.data[0] != null) {this.data[0].toHTML(span)}\n\tfor (var i = 1, m = this.data.length; i < m; i++) {\n\t  if (this.data[i]) {\n\t    if (this.data[\"sep\"+i]) {this.data[\"sep\"+i].toHTML(span)}\n\t    this.data[i].toHTML(span);\n\t  }\n\t}\n\tif (this.data.close) {this.data.close.toHTML(span)}\n\tvar stretchy = this.HTMLcomputeBBox(span);\n\tvar h = span.bbox.h, d = span.bbox.d;\n\tfor (i = 0, m = stretchy.length; i < m; i++) {stretchy[i].HTMLstretchV(span,h,d)}\n\tif (stretchy.length) {this.HTMLcomputeBBox(span,true)}\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLcomputeBBox: function (span,full) {\n\tvar BBOX = span.bbox = {}, stretchy = [];\n\tthis.HTMLcheckStretchy(this.data.open,BBOX,stretchy,full);\n\tthis.HTMLcheckStretchy(this.data[0],BBOX,stretchy,full);\n\tfor (var i = 1, m = this.data.length; i < m; i++) {\n\t  if (this.data[i]) {\n\t    this.HTMLcheckStretchy(this.data[\"sep\"+i],BBOX,stretchy,full);\n\t    this.HTMLcheckStretchy(this.data[i],BBOX,stretchy,full);\n\t  }\n\t}\n\tthis.HTMLcheckStretchy(this.data.close,BBOX,stretchy,full);\n\tthis.HTMLcleanBBox(BBOX);\n\treturn stretchy;\n      },\n      HTMLcheckStretchy: function (core,BBOX,stretchy,full) {\n\tif (core) {\n\t  if (!full && core.HTMLcanStretch(\"Vertical\"))\n\t    {stretchy.push(core); core = (core.CoreMO()||core)}\n\t  this.HTMLcombineBBoxes(core,BBOX);\n\t}\n      }\n    });\n\n    MML.menclose.Augment({toHTML: MML.mbase.HTMLautoload});\n    MML.maction.Augment({toHTML: MML.mbase.HTMLautoload});\n\n    MML.semantics.Augment({\n      toHTML: function (span,HW,D) {\n\tspan = this.HTMLcreateSpan(span);\n\tif (this.data[0] != null) {\n\t  var SPAN = this.data[0].toHTML(span);\n\t  if (D != null) {this.data[0].HTMLstretchV(span,HW,D)}\n\t  else if (HW != null) {this.data[0].HTMLstretchH(span,HW)}\n          span.bbox = SPAN.bbox;\n\t}\n\tthis.HTMLhandleSpace(span);\n\treturn span;\n      },\n      HTMLstretchH: MML.mbase.HTMLstretchH,\n      HTMLstretchV: MML.mbase.HTMLstretchV\n    });\n\n    MML.munderover.Augment({\n      toHTML: function (span,HW,D) {\n\tvar values = this.getValues(\"displaystyle\",\"accent\",\"accentunder\",\"align\");\n        var base = this.data[this.base];\n\tif (!values.displaystyle && base != null &&\n\t    (base.movablelimits || base.CoreMO().Get(\"movablelimits\")))\n\t      {return MML.msubsup.prototype.toHTML.call(this,span)}\n\tspan = this.HTMLcreateSpan(span); var scale = this.HTMLgetScale();\n\tvar stack = HTMLCSS.createStack(span);\n\tvar boxes = [], children = [], stretch = [], box, i, m;\n\tfor (i = 0, m = this.data.length; i < m; i++) {\n\t  if (this.data[i] != null) {\n\t    box = boxes[i] = HTMLCSS.createBox(stack);\n\t    children[i] = this.data[i].toHTML(box);\n\t    if (i == this.base) {\n\t      if (D != null) {this.data[this.base].HTMLstretchV(box,HW,D)}\n\t      else if (HW != null) {this.data[this.base].HTMLstretchH(box,HW)}\n\t      stretch[i] = (D == null && HW != null ? false :\n\t\t\t   this.data[i].HTMLcanStretch(\"Horizontal\"));\n\t    } else {\n\t      stretch[i] = this.data[i].HTMLcanStretch(\"Horizontal\");\n              children[i].style.paddingLeft = children[i].style.paddingRight = \"\";\n\t    }\n          }\n        }\n        HTMLCSS.MeasureSpans(children);\n        var W = -HTMLCSS.BIGDIMEN, WW = W;\n\tfor (i = 0, m = this.data.length; i < m; i++) {\n\t  if (this.data[i]) {\n\t    if (boxes[i].bbox.w > WW) {WW = boxes[i].bbox.w}\n\t    if (!stretch[i] && WW > W) {W = WW}\n\t  }\n\t}\n\tif (D == null && HW != null) {W = HW} else if (W == -HTMLCSS.BIGDIMEN) {W = WW}\n        for (i = WW = 0, m = this.data.length; i < m; i++) {if (this.data[i]) {\n          box = boxes[i];\n          if (stretch[i]) {\n            box.bbox = this.data[i].HTMLstretchH(box,W).bbox;\n            if (i !== this.base)\n              {children[i].style.paddingLeft = children[i].style.paddingRight = \"\"}\n          }\n          if (box.bbox.w > WW) {WW = box.bbox.w}\n        }}\n\tvar t = HTMLCSS.TeX.rule_thickness * this.mscale, factor = HTMLCSS.FONTDATA.TeX_factor;\n\tvar x, y, z1, z2, z3, dw, k, delta = 0;\n\tbase = boxes[this.base] || {bbox: this.HTMLzeroBBox()};\n        if (base.bbox.ic) {delta = 1.3*base.bbox.ic + .05} // adjust faked IC to be more in line with expeted results\n\tfor (i = 0, m = this.data.length; i < m; i++) {\n\t  if (this.data[i] != null) {\n\t    box = boxes[i];\n\t    z3 = HTMLCSS.TeX.big_op_spacing5 * scale;\n\t    var accent = (i != this.base && values[this.ACCENTS[i]]);\n\t    if (accent && box.bbox.w <= 1/HTMLCSS.em+.0001) { // images can get the width off by 1px\n\t      box.bbox.w = box.bbox.rw - box.bbox.lw; box.bbox.noclip = true;\n\t      if (box.bbox.lw)\n\t\t{box.insertBefore(HTMLCSS.createSpace(box.parentNode,0,0,-box.bbox.lw),box.firstChild)}\n\t      HTMLCSS.createBlank(box,0,0,box.bbox.rw+.1);\n\t    }\n\t    dw = {left:0, center:(WW-box.bbox.w)/2, right:WW-box.bbox.w}[values.align];\n\t    x = dw; y = 0;\n\t    if (i == this.over) {\n\t      if (accent) {\n\t\tk = Math.max(t * scale * factor,2.5/this.em); z3 = 0;\n\t\tif (base.bbox.skew) {\n                  x += base.bbox.skew; span.bbox.skew = base.bbox.skew;\n                  if (x+box.bbox.w > WW) {span.bbox.skew += (WW-box.bbox.w-x)/2}\n                }\n\t      } else {\n\t\tz1 = HTMLCSS.TeX.big_op_spacing1 * scale * factor;\n\t\tz2 = HTMLCSS.TeX.big_op_spacing3 * scale * factor;\n\t\tk = Math.max(z1,z2-Math.max(0,box.bbox.d));\n\t      }\n\t      k = Math.max(k,1.5/this.em); // force to be at least 1.5px\n\t      x += delta/2; y = base.bbox.h + box.bbox.d + k;\n\t      box.bbox.h += z3;\n\t    } else if (i == this.under) {\n\t      if (accent) {\n\t\tk = 3*t * scale * factor; z3 = 0;\n\t      } else {\n\t\tz1 = HTMLCSS.TeX.big_op_spacing2 * scale * factor;\n\t\tz2 = HTMLCSS.TeX.big_op_spacing4 * scale * factor;\n\t\tk = Math.max(z1,z2-box.bbox.h);\n\t      }\n\t      k = Math.max(k,1.5/this.em); // force to be at least 1.5px\n\t      x -= delta/2; y = -(base.bbox.d + box.bbox.h + k);\n\t      box.bbox.d += z3;\n\t    }\n\t    HTMLCSS.placeBox(box,x,y);\n\t  }\n\t}\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLstretchH: MML.mbase.HTMLstretchH,\n      HTMLstretchV: MML.mbase.HTMLstretchV\n    });\n\n    MML.msubsup.Augment({\n      toHTML: function (span,HW,D) {\n\tspan = this.HTMLcreateSpan(span);\n        var scale = this.HTMLgetScale(), mu = this.HTMLgetMu(span);\n\tvar stack = HTMLCSS.createStack(span), values, children = [];\n\tvar base = HTMLCSS.createBox(stack);\n\tif (this.data[this.base]) {\n          children.push(this.data[this.base].toHTML(base));\n\t  if (D != null) {this.data[this.base].HTMLstretchV(base,HW,D)}\n\t  else if (HW != null) {this.data[this.base].HTMLstretchH(base,HW)}\n\t} else {base.bbox = this.HTMLzeroBBox()}\n\tvar x_height = HTMLCSS.TeX.x_height * scale,\n\t    s = HTMLCSS.TeX.scriptspace * scale * .75;  // FIXME: .75 can be removed when IC is right?\n\tvar sup, sub;\n\tif (this.HTMLnotEmpty(this.data[this.sup]))\n          {sup = HTMLCSS.createBox(stack); children.push(this.data[this.sup].toHTML(sup))}\n\tif (this.HTMLnotEmpty(this.data[this.sub]))\n          {sub = HTMLCSS.createBox(stack); children.push(this.data[this.sub].toHTML(sub))}\n        HTMLCSS.MeasureSpans(children);\n\tif (sup) {sup.bbox.w += s; sup.bbox.rw = Math.max(sup.bbox.w,sup.bbox.rw)}\n\tif (sub) {sub.bbox.w += s; sub.bbox.rw = Math.max(sub.bbox.w,sub.bbox.rw)}\n\tHTMLCSS.placeBox(base,0,0);\n        var sscale = scale;\n        if (sup) {\n          sscale = this.data[this.sup].HTMLgetScale();\n        } else if (sub) {\n          sscale = this.data[this.sub].HTMLgetScale();\n        }\n\tvar q = HTMLCSS.TeX.sup_drop * sscale, r = HTMLCSS.TeX.sub_drop * sscale;\n\tvar u = base.bbox.h - q, v = base.bbox.d + r, delta = 0, p;\n\tif (base.bbox.ic) {\n          base.bbox.w -= base.bbox.ic;    // remove IC (added by mo and mi)\n          delta = 1.3*base.bbox.ic + .05; // adjust faked IC to be more in line with expected results\n        }\n\tif (this.data[this.base] && HW == null && D == null &&\n\t   (this.data[this.base].type === \"mi\" || this.data[this.base].type === \"mo\")) {\n\t  if (this.data[this.base].data.join(\"\").length === 1 && children[0].scale === 1 &&\n\t      !this.data[this.base].Get(\"largeop\")) {u = v = 0}\n\t}\n\tvar min = this.getValues(\"subscriptshift\",\"superscriptshift\");\n\tmin.subscriptshift   = (min.subscriptshift === \"\"   ? 0 : HTMLCSS.length2em(min.subscriptshift,mu));\n\tmin.superscriptshift = (min.superscriptshift === \"\" ? 0 : HTMLCSS.length2em(min.superscriptshift,mu));\n\tif (!sup) {\n\t  if (sub) {\n\t    v = Math.max(v,HTMLCSS.TeX.sub1*scale,sub.bbox.h-(4/5)*x_height,min.subscriptshift);\n\t    HTMLCSS.placeBox(sub,base.bbox.w,-v,sub.bbox);\n\t  }\n\t} else {\n\t  if (!sub) {\n\t    values = this.getValues(\"displaystyle\",\"texprimestyle\");\n\t    p = HTMLCSS.TeX[(values.displaystyle ? \"sup1\" : (values.texprimestyle ? \"sup3\" : \"sup2\"))];\n\t    u = Math.max(u,p*scale,sup.bbox.d+(1/4)*x_height,min.superscriptshift);\n\t    HTMLCSS.placeBox(sup,base.bbox.w+delta,u,sup.bbox);\n\t  } else {\n\t    v = Math.max(v,HTMLCSS.TeX.sub2*scale);\n\t    var t = HTMLCSS.TeX.rule_thickness * scale;\n\t    if ((u - sup.bbox.d) - (sub.bbox.h - v) < 3*t) {\n\t      v = 3*t - u + sup.bbox.d + sub.bbox.h;\n\t      q = (4/5)*x_height - (u - sup.bbox.d);\n\t      if (q > 0) {u += q; v -= q}\n\t    }\n\t    HTMLCSS.placeBox(sup,base.bbox.w+delta,Math.max(u,min.superscriptshift));\n\t    HTMLCSS.placeBox(sub,base.bbox.w,-Math.max(v,min.subscriptshift));\n\t  }\n\t}\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLstretchH: MML.mbase.HTMLstretchH,\n      HTMLstretchV: MML.mbase.HTMLstretchV\n    });\n\n    MML.mmultiscripts.Augment({toHTML: MML.mbase.HTMLautoload});\n\n    MML.mtable.Augment({toHTML: MML.mbase.HTMLautoload});\n    \n    MML[\"annotation-xml\"].Augment({toHTML: MML.mbase.HTMLautoload});\n    MML.annotation.Augment({toHTML: function (span) {return this.HTMLcreateSpan(span)}});\n    \n    MML.math.Augment({\n      toHTML: function (span,node,phase) {\n        var stack, box, html, math, SPAN = span;\n        //\n        //  Phase I lays out the math, but doesn't measure the final math yet\n        //  (that is done for a chunk at a time, to avoid reflows)\n        //\n        if (!phase || phase === HTMLCSS.PHASE.I) {\n          var nobr = HTMLCSS.addElement(span,\"nobr\",{isMathJax: true});\n          span = this.HTMLcreateSpan(nobr);\n          var alttext = this.Get(\"alttext\");\n          if (alttext && !span.getAttribute(\"aria-label\")) span.setAttribute(\"aria-label\",alttext);\n          if (!span.getAttribute(\"role\")) span.setAttribute(\"role\",\"math\");\n\t  stack = HTMLCSS.createStack(span); box = HTMLCSS.createBox(stack);\n          // Move font-size from outer span to stack to avoid line separation \n          // problem in strict HTML mode\n          stack.style.fontSize = nobr.parentNode.style.fontSize; nobr.parentNode.style.fontSize = \"\";\n          if (this.data[0] != null) {\n            MML.mbase.prototype.displayAlign = HUB.config.displayAlign;\n            MML.mbase.prototype.displayIndent = HUB.config.displayIndent;\n            if (String(HUB.config.displayIndent).match(/^0($|[a-z%])/i))\n              MML.mbase.prototype.displayIndent = \"0\";\n            html = this.data[0].toHTML(box); html.bbox.exactW = false; // force remeasure just to be sure\n\t  }\n        } else {\n          span = span.firstChild.firstChild;\n          if (this.href) span = span.firstChild;\n          stack = span.firstChild;\n          if (stack.style.position !== \"relative\") stack = stack.nextSibling;\n          box = stack.firstChild;\n          html = box.firstChild;\n        }\n        //\n        //  Phase II measures the math (this is done for each one in the chunk at once)\n        //\n        math = ((!phase || phase === HTMLCSS.PHASE.II) ? HTMLCSS.Measured(html,box) : html);\n        //\n        //  Phase III finishes the layout using the measured math\n        //\n        if (!phase || phase === HTMLCSS.PHASE.III) {\n          HTMLCSS.placeBox(box,0,0);\n          //\n          //  Get width right if minimum font size is set:\n          //    Round to nearest pixel (plus a small amount), and convert back to outer-em's.\n          //    Add the width to the span (outside the MathJax class, so uses outer em size,\n          //    which makes it work even when minimum font size is in effect).\n          //\n          span.style.width = HTMLCSS.Em(Math.max(0,Math.round(math.bbox.w*this.em)+.25)/HTMLCSS.outerEm);\n          span.style.display = \"inline-block\";\n          //\n          //  Adjust bbox to match outer em-size\n          // \n          var p = 1/HTMLCSS.em, f = HTMLCSS.em / HTMLCSS.outerEm; HTMLCSS.em /= f;\n          span.bbox.h *= f; span.bbox.d *= f; span.bbox.w *= f;\n          span.bbox.lw *= f; span.bbox.rw *= f;\n          if (span.bbox.H) {span.bbox.H *= f}\n          if (span.bbox.D) {span.bbox.D *= f}\n          if (math && math.bbox.width != null) {\n            span.style.minWidth = (math.bbox.minWidth || span.style.width);\n            span.style.width = math.bbox.width;\n            box.style.width = stack.style.width = SPAN.style.width = \"100%\";\n          }\n          //\n          //  Add color (if any)\n          //\n          var color = this.HTMLhandleColor(span);\n          //\n          //  Make math span be the correct height and depth\n          //\n          if (math) {HTMLCSS.createRule(span,(math.bbox.h+p)*f,(math.bbox.d+p)*f,0)}\n          //\n          //  Handle indentalign and indentshift for single-line display equations\n          //\n          if (!this.isMultiline && this.Get(\"display\") === \"block\" && span.bbox.width == null) {\n            var values = this.getValues(\"indentalignfirst\",\"indentshiftfirst\",\"indentalign\",\"indentshift\");\n            if (values.indentalignfirst !== MML.INDENTALIGN.INDENTALIGN) {values.indentalign = values.indentalignfirst}\n            if (values.indentalign === MML.INDENTALIGN.AUTO) {values.indentalign = this.displayAlign}\n            if (values.indentshiftfirst !== MML.INDENTSHIFT.INDENTSHIFT) {values.indentshift = values.indentshiftfirst}\n            if (values.indentshift === \"auto\") {values.indentshift = \"0\"}\n            var shift = HTMLCSS.length2em(values.indentshift,1,HTMLCSS.scale*HTMLCSS.cwidth);\n            if (this.displayIndent !== \"0\") {\n              var indent = HTMLCSS.length2em(this.displayIndent,1,HTMLCSS.scale*HTMLCSS.cwidth);\n              shift += (values.indentalign === MML.INDENTALIGN.RIGHT ? -indent : indent);\n            }\n            node.style.textAlign = values.indentalign;\n            // ### FIXME: make percentage widths respond to changes in container\n            if (shift) {\n              HUB.Insert(span.style,({\n                left: {marginLeft: HTMLCSS.Em(shift)},\n                right: {marginRight: HTMLCSS.Em(-shift)},\n                center: {marginLeft: HTMLCSS.Em(shift), marginRight: HTMLCSS.Em(-shift)}\n              })[values.indentalign]);\n              //\n              //  Move the background color, of any\n              //\n\t      if (color) {\n                var L = parseFloat(color.style.marginLeft||\"0\")+shift,\n                    R = parseFloat(color.style.marginRight||\"0\")-shift;\n\t        color.style.marginLeft = HTMLCSS.Em(L);\n\t        color.style.marginRight =\n\t          HTMLCSS.Em(R + (values.indentalign === \"right\" ?\n                      span.bbox.w+shift - span.bbox.w : 0));\n\t\tif (HTMLCSS.msieColorBug && values.indentalign === \"right\") {\n                  if (parseFloat(color.style.marginLeft) > 0) {\n                    var padding = MathJax.HTML.addElement(color.parentNode,\"span\");\n                    padding.style.marginLeft = HTMLCSS.Em(R+Math.min(0,span.bbox.w+shift));\n                    color.nextSibling.style.marginRight = \"0em\";\n                  }\n\t\t  color.nextSibling.style.marginLeft = \"0em\";\n\t\t  color.style.marginRight = color.style.marginLeft = \"0em\";\n\t\t}\n\t      }\n            }\n          }\n        }\n\treturn span;\n      },\n      HTMLspanElement: MML.mbase.prototype.HTMLspanElement\n    });\n\n    MML.TeXAtom.Augment({\n      toHTML: function (span,HW,D) {\n\tspan = this.HTMLcreateSpan(span);\n\tif (this.data[0] != null) {\n\t  if (this.texClass === MML.TEXCLASS.VCENTER) {\n\t    var stack = HTMLCSS.createStack(span);\n\t    var box = HTMLCSS.createBox(stack);\n            var child = this.data[0].toHTML(box);\n            if (D != null) {HTMLCSS.Remeasured(this.data[0].HTMLstretchV(box,HW,D),box)}\n            else if (HW != null) {HTMLCSS.Remeasured(this.data[0].HTMLstretchH(box,HW),box)}\n            else {HTMLCSS.Measured(child,box)}\n            var a = HTMLCSS.TeX.axis_height * this.HTMLgetScale();\n\t    HTMLCSS.placeBox(box,0,a-(box.bbox.h+box.bbox.d)/2+box.bbox.d);\n\t  } else {\n\t    var html = this.data[0].toHTML(span,HW,D);\n            if (D != null) {html = this.data[0].HTMLstretchV(box,HW,D)}\n            else if (HW != null) {html = this.data[0].HTMLstretchH(box,HW)}\n            span.bbox = html.bbox;\n\t  }\n\t}\n\tthis.HTMLhandleSpace(span);\n\tthis.HTMLhandleColor(span);\n\treturn span;\n      },\n      HTMLstretchH: MML.mbase.HTMLstretchH,\n      HTMLstretchV: MML.mbase.HTMLstretchV\n    });\n    \n    //\n    //  Loading isn't complete until the element jax is modified,\n    //  but can't call loadComplete within the callback for \"mml Jax Ready\"\n    //  (it would call HTMLCSS's Require routine, asking for the mml jax again)\n    //  so wait until after the mml jax has finished processing.\n    //  \n    //  We also need to wait for the onload handler to run, since the loadComplete\n    //  will call Config and Startup, which need to modify the body.\n    //\n    HUB.Register.StartupHook(\"onLoad\",function () {\n      setTimeout(MathJax.Callback([\"loadComplete\",HTMLCSS,\"jax.js\"]),0);\n    });\n  });\n\n  HUB.Register.StartupHook(\"End Config\",function () {\n    \n    //\n    //  Handle browser-specific setup\n    //\n    HUB.Browser.Select({\n      MSIE: function (browser) {\n        var mode = (document.documentMode || 0);\n        var isIE7 = browser.versionAtLeast(\"7.0\");\n        var isIE8 = browser.versionAtLeast(\"8.0\") && mode > 7;\n        var quirks = (document.compatMode === \"BackCompat\");\n        if (mode < 9) {\n          // IE doesn't do mouse events on trasparent objects,\n          //   so give a background color, but opacity makes it transparent\n          HTMLCSS.config.styles[\".MathJax .MathJax_HitBox\"][\"background-color\"] = \"white\";\n          HTMLCSS.config.styles[\".MathJax .MathJax_HitBox\"].opacity = 0\n          HTMLCSS.config.styles[\".MathJax .MathJax_HitBox\"].filter = \"alpha(opacity=0)\";\n        }\n        // FIXME:  work out tests for these?\n        HTMLCSS.Augment({\n          PaddingWidthBug: true,\n          msieAccentBug: true,\n          msieColorBug: (mode < 8),      // negative margin-right doesn't work to position color\n          msieColorPositionBug: true,    // needs position:relative to put color behind text\n          msieRelativeWidthBug: quirks,\n          msieDisappearingBug: (mode >= 8), // inline math disappears\n          msieMarginScaleBug: (mode < 8),   // relative margins are not scaled properly by font-size\n          msiePaddingWidthBug: true,\n          msieBorderWidthBug: quirks,\n          msieFrameSizeBug: (mode <= 8),    // crashes if size of box isn't big enough for border\n          msieInlineBlockAlignBug: (!isIE8 || quirks),\n          msiePlaceBoxBug: (isIE8 && !quirks),\n          msieClipRectBug: !isIE8,\n          msieNegativeSpaceBug: quirks,\n          msieRuleBug: (mode < 7),           // rules need to be measured\n          cloneNodeBug: (isIE8 && browser.version === \"8.0\"),\n          msieItalicWidthBug: true,          // can't measure boxes ending in italics correctly\n          initialSkipBug: (mode < 8),        // confused by initial left-margin values\n          msieNegativeBBoxBug: (mode >= 8),  // negative bboxes have positive widths\n          msieIE6: !isIE7,\n          msieItalicWidthBug: true,\n          FontFaceBug: (mode < 9),\n          msieFontCSSBug: browser.isIE9,\n          allowWebFonts: (mode >= 9 ? \"woff\" : \"eot\")\n        });\n      },\n\n      Firefox: function (browser) {\n        var webFonts = false;\n        if (browser.versionAtLeast(\"3.5\")) {\n          var root = String(document.location).replace(/[^\\/]*$/,\"\");\n          if (document.location.protocol !== \"file:\" || HUB.config.root.match(/^https?:\\/\\//) ||\n              (HUB.config.root+\"/\").substr(0,root.length) === root) {webFonts = \"otf\"}\n        }\n        HTMLCSS.Augment({\n          ffVerticalAlignBug: !browser.versionAtLeast(\"20.0\"),  // not sure when this bug was fixed\n          AccentBug: true,\n          allowWebFonts: webFonts,\n          ffFontOptimizationBug: true\n        });\n      },\n\n      Safari: function (browser) {\n        var v3p0 = browser.versionAtLeast(\"3.0\");\n        var v3p1 = browser.versionAtLeast(\"3.1\");\n        var trueSafari = navigator.appVersion.match(/ Safari\\/\\d/) &&\n                         navigator.appVersion.match(/ Version\\/\\d/) &&\n                         navigator.vendor.match(/Apple/);\n        var android = (navigator.appVersion.match(/ Android (\\d+)\\.(\\d+)/));\n        var forceImages = (v3p1 && browser.isMobile && (\n          (navigator.platform.match(/iPad|iPod|iPhone/) && !browser.versionAtLeast(\"5.0\")) ||\n          (android != null && (android[1] < 2 || (android[1] == 2 && android[2] < 2)))\n        ));\n        HTMLCSS.Augment({\n          config: {\n            styles: {\n              \".MathJax img, .MathJax nobr, .MathJax a\": {\n                // \"none\" seems to work like \"0px\" when width is initially 0\n                \"max-width\": \"5000em\", \"max-height\": \"5000em\"\n              }\n            }\n          },\n          Em: ((browser.webkit||0) >= 538 ? HTMLCSS.EmRounded : HTMLCSS.Em), // issue #931\n          rfuzz: .011,\n          AccentBug: true,\n          AdjustSurd: true,\n          negativeBBoxes: true,\n          safariNegativeSpaceBug: true,\n          safariVerticalAlignBug: !v3p1,\n          safariTextNodeBug: !v3p0,\n          forceReflow: true,\n          FontFaceBug: true,\n          allowWebFonts: (v3p1 && !forceImages ? \"otf\" : false)\n        });\n        if (trueSafari) {\n          HTMLCSS.Augment({\n            webFontDefault: (browser.isMobile ? \"sans-serif\" : \"serif\")\n          });\n        }\n        if (browser.isPC) {\n          HTMLCSS.Augment({\n            adjustAvailableFonts: HTMLCSS.removeSTIXfonts,  // can't access plane1\n            checkWebFontsTwice: true  // bug in Safari/Win that doesn't update font test div properly\n          });\n        }\n        if (forceImages) {\n          //  Force image mode for iOS prior to 4.2 and Droid prior to 2.2\n          var config = HUB.config[\"HTML-CSS\"];\n          if (config) {config.availableFonts = []; config.preferredFont = null}\n            else {HUB.config[\"HTML-CSS\"] = {availableFonts: [], preferredFont: null}}\n        }\n      },\n\n      Chrome: function (browser) {\n        HTMLCSS.Augment({\n          Em: HTMLCSS.EmRounded,   // vertical alignment needs help (since around v20)\n          cloneNodeBug: true,      // Chrome gets heights wrong with the cloned ones\n          rfuzz: -.02,\n          AccentBug: true,\n          AdjustSurd: true,\n          FontFaceBug: browser.versionAtLeast(\"32.0\"), // Chrome 32 fails on bold-italic (#735)\n          negativeBBoxes: true,\n          safariNegativeSpaceBug: true,\n          safariWebFontSerif: [\"\"],\n          forceReflow: true,\n          allowWebFonts: (browser.versionAtLeast(\"4.0\") ? \"otf\" : \"svg\")\n        });\n      },\n\n      Opera: function (browser) {\n        browser.isMini = (navigator.appVersion.match(\"Opera Mini\") != null);\n        HTMLCSS.config.styles[\".MathJax .merror\"][\"vertical-align\"] = null;\n        HTMLCSS.config.styles[\".MathJax span\"][\"z-index\"] = 0;\n        HTMLCSS.Augment({\n          operaHeightBug: true,\n          operaVerticalAlignBug: true,\n          operaFontSizeBug: browser.versionAtLeast(\"10.61\"),\n          initialSkipBug: true,\n          FontFaceBug: true,\n          PaddingWidthBug: true,\n          allowWebFonts: (browser.versionAtLeast(\"10.0\") && !browser.isMini ? \"otf\" : false),\n          adjustAvailableFonts: HTMLCSS.removeSTIXfonts\n        });\n      },\n\n      Konqueror: function (browser) {\n        HTMLCSS.Augment({\n          konquerorVerticalAlignBug: true\n        });\n      }\n    });\n  \n  });\n\n  MathJax.Hub.Register.StartupHook(\"End Cookie\", function () {  \n    if (HUB.config.menuSettings.zoom !== \"None\")\n      {AJAX.Require(\"[MathJax]/extensions/MathZoom.js\")}\n  });\n    \n})(MathJax.Ajax, MathJax.Hub, MathJax.OutputJax[\"HTML-CSS\"]);\n"]}]}